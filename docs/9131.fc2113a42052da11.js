"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9131],{9131:(Mo,gs,ye)=>{ye.r(gs),ye.d(gs,{SplitBuilderPageModule:()=>Jn});var Je=ye(2200),ze=ye(7343),Xe=ye(4341),ps=ye(8132),ge=ye(467),oe=function(X){return X.FIXED_WALLET="FIXED_WALLET",X.SPLITXCH_PLACEHOLDER="SPLITXCH_PLACEHOLDER",X.SPLITXCH_REAL="SPLITXCH_REAL",X}(oe||{});let qt=(()=>{var X;class y{static percentageToBasisPoints(R){return Math.round(100*R)}static basisPointsToPercentage(R){return R/100}static formatBasisPoints(R,O=2){return this.basisPointsToPercentage(R).toFixed(O)+"%"}static#t=X=()=>(this.MAX_BASIS_POINTS=1e4,this.SPLITXCH_FEE_BASIS_POINTS=25)}return X(),y})();var k=ye(3664),ct=ye(2615),tn=ye(4412);let ms=(()=>{var X;class y{constructor(){this.currentTreeSubject=new tn.t(null),this.currentTree$=this.currentTreeSubject.asObservable()}generateId(){return`id_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generatePlaceholderAddress(){return`splitxch_temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}calculateNodeFees(R){if(!R.isSplitXCH)return{feeBasisPoints:0,netBasisPoints:R.basisPoints};const O=qt.SPLITXCH_FEE_BASIS_POINTS;return{feeBasisPoints:O,netBasisPoints:Math.round(R.basisPoints*(qt.MAX_BASIS_POINTS-O)/qt.MAX_BASIS_POINTS)}}updateNodeFees(R){const{feeBasisPoints:O,netBasisPoints:G}=this.calculateNodeFees(R);R.feeBasisPoints=O,R.netBasisPoints=G,R.children&&R.children.forEach(q=>this.updateNodeFees(q))}createNewTree(R){const O={id:this.generateId(),name:R||"Main Split",recipients:[{id:this.generateId(),name:"Recipient 1",address:"xch1...",addressType:oe.FIXED_WALLET,basisPoints:qt.MAX_BASIS_POINTS/2},{id:this.generateId(),name:"Recipient 2",address:"xch1...",addressType:oe.FIXED_WALLET,basisPoints:qt.MAX_BASIS_POINTS/2}],children:[],parentId:null,basisPoints:qt.MAX_BASIS_POINTS,splitAddress:this.generatePlaceholderAddress(),isSplitXCH:!0},{feeBasisPoints:G,netBasisPoints:q}=this.calculateNodeFees(O);O.feeBasisPoints=G,O.netBasisPoints=q;const ht={root:O,metadata:{name:R||"New Split Tree",createdAt:new Date,updatedAt:new Date,isFinalized:!1}};return this.currentTreeSubject.next(ht),ht}getCurrentTree(){return this.currentTreeSubject.value}setCurrentTree(R){R.metadata&&(R.metadata.updatedAt=new Date),this.currentTreeSubject.next(R)}findNodeById(R,O){const G=q=>{if(q.id===O)return q;if(q.children)for(const ht of q.children){const H=G(ht);if(H)return H}return null};return G(R.root)}addRecipient(R,O,G){const q=this.findNodeById(R,O);if(!q)throw new Error(`Node with id ${O} not found`);q.recipients||(q.recipients=[]);const ht={...G,id:this.generateId(),addressType:G.addressType||oe.FIXED_WALLET};return q.recipients.push(ht),this.setCurrentTree(R),R}removeRecipient(R,O,G){const q=this.findNodeById(R,O);return!q||!q.recipients||(q.recipients=q.recipients.filter(ht=>ht.id!==G),this.setCurrentTree(R)),R}addNestedSplit(R,O,G,q){const ht=this.findNodeById(R,O);if(!ht)throw new Error(`Parent node with id ${O} not found`);ht.children||(ht.children=[]);const H={id:this.generateId(),name:G,recipients:[],children:[],parentId:O,basisPoints:q,splitAddress:this.generatePlaceholderAddress(),isSplitXCH:!0},{feeBasisPoints:vt,netBasisPoints:z}=this.calculateNodeFees(H);return H.feeBasisPoints=vt,H.netBasisPoints=z,ht.children.push(H),this.setCurrentTree(R),R}addFixedWalletRecipient(R,O,G,q,ht){const H=this.findNodeById(R,O);if(!H)throw new Error(`Node with id ${O} not found`);H.recipients||(H.recipients=[]);const vt={id:this.generateId(),name:G,address:q,addressType:oe.FIXED_WALLET,basisPoints:ht};return H.recipients.push(vt),this.setCurrentTree(R),R}addSplitXCHRecipient(R,O,G,q,ht){const H=this.findNodeById(R,O),vt=this.findNodeById(R,q);if(!H)throw new Error(`Node with id ${O} not found`);if(!vt||!vt.isSplitXCH)throw new Error(`Target split node with id ${q} not found or is not a SplitXCH split`);H.recipients||(H.recipients=[]);const z={id:this.generateId(),name:G,address:vt.splitAddress||this.generatePlaceholderAddress(),addressType:oe.SPLITXCH_PLACEHOLDER,basisPoints:ht,splitNodeId:q};return H.recipients.push(z),this.setCurrentTree(R),R}removeNestedSplit(R,O,G){const q=this.findNodeById(R,O);if(!q||!q.children)return R;q.children=q.children.filter(H=>H.id!==G);const ht=H=>{H.recipients&&(H.recipients=H.recipients.filter(vt=>vt.splitNodeId!==G)),H.children&&H.children.forEach(vt=>ht(vt))};return ht(R.root),this.setCurrentTree(R),R}updateRecipient(R,O,G,q){const ht=this.findNodeById(R,O);if(!ht||!ht.recipients)return R;const H=ht.recipients.find(vt=>vt.id===G);return H&&(Object.assign(H,q),this.setCurrentTree(R)),R}updateSplitNode(R,O,G){const q=this.findNodeById(R,O);return q&&(Object.assign(q,G),this.updateNodeFees(q),this.setCurrentTree(R)),R}validateTree(R){const O=[],G=[],q=(ht,H="")=>{const vt=H?`${H} > ${ht.name}`:ht.name;let z=0;if(ht.recipients&&ht.recipients.length>0){z+=ht.recipients.reduce((xt,S)=>xt+S.basisPoints,0);const Vt=ht.recipients.filter(xt=>{const S=xt.address?.trim().toLowerCase()||"";return S&&!S.startsWith("splitxch_temp_")&&"xch1..."!==S&&""!==S}).map(xt=>xt.address.toLowerCase()),Ne=new Set(Vt);Vt.length!==Ne.size&&O.push(`Duplicate addresses found in ${vt}`),ht.recipients.forEach(xt=>{(xt.basisPoints<0||xt.basisPoints>qt.MAX_BASIS_POINTS)&&O.push(`Invalid basis points ${xt.basisPoints} (${qt.formatBasisPoints(xt.basisPoints)}) for recipient ${xt.name} in ${vt}`);const S=xt.address?.trim()||"";xt.addressType===oe.FIXED_WALLET&&(!S||""===S||"xch1..."===S)&&O.push(`Missing address for recipient ${xt.name} in ${vt}`)})}if(ht.children&&ht.children.length>0&&(z+=ht.children.reduce((Vt,Ne)=>Vt+Ne.basisPoints,0),ht.children.forEach(Vt=>{q(Vt,vt)})),z>0&&Math.abs(z-qt.MAX_BASIS_POINTS)>1){const Et=qt.formatBasisPoints(z);O.push(`Basis points in ${vt} sum to ${z} bp (${Et}) instead of ${qt.MAX_BASIS_POINTS} bp (100%)`)}const Yt=ht.recipients&&ht.recipients.length>0,Dt=ht.children&&ht.children.length>0;!Yt&&!Dt&&G.push(`Empty split node: ${vt}`),Yt&&Dt&&G.push(`Mixed node ${vt} has both recipients and nested splits. Ensure basis points are correctly distributed.`)};return q(R.root),{valid:0===O.length,errors:O,warnings:G}}calculateFinalBasisPoints(R){const O=new Map;this.updateNodeFees(R.root);const G=(q,ht=qt.MAX_BASIS_POINTS)=>{const H=Math.round(ht*q.basisPoints/qt.MAX_BASIS_POINTS);let vt=H;if(q.isSplitXCH&&q.feeBasisPoints){const z=Math.round(H*q.feeBasisPoints/qt.MAX_BASIS_POINTS);vt=Math.max(0,H-z)}if(q.recipients&&q.recipients.length>0){const z=q.recipients.reduce((Yt,Dt)=>Yt+Dt.basisPoints,0);q.recipients.forEach(Yt=>{const Dt=z>0?Math.round(vt*Yt.basisPoints/z):0,Et=O.get(Yt.address.toLowerCase())||0;O.set(Yt.address.toLowerCase(),Et+Dt)})}if(q.children&&q.children.length>0){const z=q.children.reduce((Yt,Dt)=>Yt+Dt.basisPoints,0);q.children.forEach(Yt=>{const Dt=z>0?Math.round(vt*Yt.basisPoints/z):0;G(Yt,Dt)})}};return G(R.root),O}calculateFinalPercentages(R){const O=this.calculateFinalBasisPoints(R),G=new Map;return O.forEach((q,ht)=>{G.set(ht,qt.basisPointsToPercentage(q))}),G}exportToSplitXCH(R){const O=this.calculateFinalBasisPoints(R),G=new Map,q=vt=>{vt.recipients&&vt.recipients.forEach(z=>{const Yt=z.address.toLowerCase(),Dt=G.get(Yt);(!Dt||Dt.name===z.name)&&G.set(Yt,{name:z.name,basisPoints:O.get(Yt)||0})}),vt.children&&vt.children.forEach(z=>{q(z)})};q(R.root);const ht=Array.from(G.values()).reduce((vt,z)=>vt+z.basisPoints,0);return{recipients:Array.from(G.entries()).map(([vt,z])=>({address:vt,name:z.name,basisPoints:ht>0?Math.round(z.basisPoints*qt.MAX_BASIS_POINTS/ht):0})),tree:JSON.parse(JSON.stringify(R.root))}}importTree(R){const O=JSON.parse(R),G=this.validateTree(O);if(!G.valid)throw new Error(`Invalid tree: ${G.errors.join(", ")}`);return this.setCurrentTree(O),O}exportToJSON(R){return JSON.stringify(R,null,2)}finalizeBlueprint(R,O){var G=this;return(0,ge.A)(function*(){const q={success:!0,createdAddresses:new Map,errors:[]};try{const ht=[],H=vt=>{vt.children&&vt.children.forEach(z=>H(z)),ht.push(vt)};H(R.root);for(const vt of ht){if(!vt.isSplitXCH)continue;const z=[];if(vt.recipients)for(const Dt of vt.recipients){let Et=Dt.address;if(Dt.addressType===oe.SPLITXCH_PLACEHOLDER&&Dt.splitNodeId){const Vt=q.createdAddresses.get(Dt.splitNodeId);if(!Vt){q.errors.push(`Recipient "${Dt.name}" references split node "${Dt.splitNodeId}" which hasn't been created yet`),q.success=!1;continue}Et=Vt}z.push({address:Et,basisPoints:Dt.basisPoints,name:Dt.name})}if(vt.children)for(const Dt of vt.children)if(Dt.isSplitXCH){const Et=q.createdAddresses.get(Dt.id);if(!Et){q.errors.push(`Child split "${Dt.name}" hasn't been created yet`),q.success=!1;continue}z.push({address:Et,basisPoints:Dt.basisPoints,name:Dt.name})}if(0===z.length){q.errors.push(`Split "${vt.name}" has no recipients`),q.success=!1;continue}const Yt=z.reduce((Dt,Et)=>Dt+Et.basisPoints,0);if(Math.abs(Yt-qt.MAX_BASIS_POINTS)>1)q.errors.push(`Split "${vt.name}" basis points sum to ${Yt} instead of ${qt.MAX_BASIS_POINTS}`),q.success=!1;else if(0!==z.length)if(z.some(Dt=>Dt.basisPoints<=0))q.errors.push(`Split "${vt.name}" has recipients with invalid (non-positive) basis points`),q.success=!1;else try{const Dt=yield O(z);q.createdAddresses.set(vt.id,Dt),vt.splitAddress=Dt,vt.recipients&&vt.recipients.forEach(Et=>{Et.splitNodeId===vt.id&&(Et.address=Dt,Et.addressType=oe.SPLITXCH_REAL)})}catch(Dt){q.errors.push(`Failed to create split "${vt.name}": ${Dt.message}`),q.success=!1}else q.errors.push(`Split "${vt.name}" has no recipients`),q.success=!1}return q.success&&(R.metadata&&(R.metadata.isFinalized=!0,R.metadata.updatedAt=new Date),q.finalizedTree=R,G.setCurrentTree(R)),q}catch(ht){return q.success=!1,q.errors.push(`Finalization failed: ${ht.message}`),q}})()}hasPlaceholders(R){const O=G=>{if(G.isSplitXCH&&G.splitAddress?.startsWith("splitxch_temp_"))return!0;if(G.recipients)for(const q of G.recipients)if(q.addressType===oe.SPLITXCH_PLACEHOLDER||q.address?.startsWith("splitxch_temp_"))return!0;if(G.children)for(const q of G.children)if(O(q))return!0;return!1};return O(R.root)}static#t=X=()=>(this.\u0275fac=function(O){return new(O||y)},this.\u0275prov=ct.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}))}return X(),y})();var sn=ye(9330);let nn=(()=>{var X;class y{constructor(R){this.http=R,this.apiUrl="https://splitxch.com/api"}createSplitAsync(R){var O=this;return(0,ge.A)(function*(){const G=`${O.apiUrl}/compute/fast`,q=R.reduce((Et,Vt)=>Et+Vt.basisPoints,0),vt=R.map((Et,Vt)=>({name:Et.name||`Recipient ${Vt+1}`,address:Et.address,points:Math.round(9850*Et.basisPoints/q),originalBasisPoints:Et.basisPoints,id:Vt+1})),Yt=9850-vt.reduce((Et,Vt)=>Et+Vt.points,0);0!==Yt&&vt.length>0&&(vt[vt.length-1].points+=Yt);const Dt={recipients:vt.map(Et=>({name:Et.name,address:Et.address,points:Et.points,id:Et.id}))};try{const Et=yield fetch(G,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Dt)});if(!Et.ok){const Ne=yield Et.text();let xt=`HTTP error! status: ${Et.status}`;try{const S=JSON.parse(Ne);xt=S.message||S.error||xt}catch{xt=Ne||xt}throw new Error(xt)}const Vt=yield Et.json();if(!Vt.address)throw new Error(Vt.message||"Failed to create split: No address returned");return Vt.address}catch(Et){throw console.error("SplitXCH API Error:",Et),Et}})()}getComputeStatus(R){var O=this;return(0,ge.A)(function*(){const G=`${O.apiUrl}/compute/${R}`;try{const q=yield fetch(G,{method:"GET",headers:{"Content-Type":"application/json"}});if(!q.ok){const H=yield q.text();throw new Error(`HTTP error! status: ${q.status}: ${H}`)}return yield q.json()}catch(q){throw console.error("SplitXCH API Status Error:",q),q}})()}static#t=X=()=>(this.\u0275fac=function(O){return new(O||y)(ct.KVO(sn.Qq))},this.\u0275prov=ct.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}))}return X(),y})();!function(){const X="object"==typeof globalThis&&globalThis||"object"==typeof global&&global.global===global&&global||"object"==typeof self&&self.self===self&&self||{};void 0===X.requestAnimationFrame&&(X.requestAnimationFrame=void 0===X.setImmediate?m=>X.setTimeout(m,0):X.setImmediate);let y=(()=>{class m{static ur=void 0!==X.navigator&&void 0!==X.navigator.platform&&null!==X.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i);static CP(t,i,s){let n=-1;return function(){const o=this,r=arguments;-1!==n&&m.wc(n),n=m.dn(()=>{n=-1,s||t.apply(o,r)},i),s&&!n&&t.apply(o,r)}}static dn(t,i){return X.setTimeout(t,i)}static wc(t){X.clearTimeout(t)}static Ni(t){return X.document.createElement(t)}static o(t){throw new Error(t)}static L(t,i){let s="The object is frozen, so its properties cannot be set: "+t.toString();void 0!==i&&(s+="  to value: "+i),m.o(s)}static se(t,i,s,n){}static s(t,i,s,n){}static CU(t,i,s){}static xc(t,i,s){if(null===t||"object"!=typeof t){let n=m.LL(i);void 0!==s&&(n+="."+s),m.si(t,"object",n)}}static S(t,i,s){m.s(t,"function",i,s)}static LU(t,i,s){}static si(t,i,s,n){}static J(t,i,s,n){let o=m.LL(s);void 0!==n&&(o+="."+n),m.o(o+" is not in the range "+i+": "+t)}static Gi(t){}static dr(t,i){}static ne(t){X.console&&X.console.log(t)}static $(t){return null!==t&&"object"==typeof t}static st(t){return"function"==typeof t}static LP=[];static nt(){const t=m.LP.pop();return void 0===t?[]:t}static Z(t){t.length=0,m.LP.push(t)}static AU=Object.freeze([]);static LL(t){return null===t?"*":"string"==typeof t?t:m.st(t)?t.name:""}static Hn(t){return m.st(t)?t.className?t.className:t.name:m.$(t)&&t.constructor?m.Hn(t.constructor):typeof t}static $a(t,i){return null==i||""===i?null:m.$(t)&&i in t||t[i]?t[i]:null}static toString(t){let i=t;return m.$(t)&&(t.text?i=t.text:t.name?i=t.name:void 0!==t.key?i=t.key:void 0!==t.id?i=t.id:t.constructor===Object&&(t.Text?i=t.Text:t.Name?i=t.Name:void 0!==t.Key?i=t.Key:void 0!==t.Id?i=t.Id:void 0!==t.ID&&(i=t.ID))),void 0===i?"undefined":null===i?"null":i.toString()}static jw(t,i){if(t.hasOwnProperty(i))return!0;let s=Object.getPrototypeOf(t);for(;s&&s!==Function;){if(s.hasOwnProperty(i))return!0;const n=s.TU;if(n&&n[i])return!0;s=Object.getPrototypeOf(s)}return!1}static zF(t){const i=[];let s=0;for(s=0;s<256;s++)i[s]=s;let n=0,o=0;for(s=0;s<256;s++)n=(n+i[s]+119)%256,o=i[s],i[s]=i[n],i[n]=o;s=0,n=0;let r="";for(let a=0;a<t.length;a++)s=(s+1)%256,n=(n+i[s])%256,o=i[s],i[s]=i[n],i[n]=o,r+=String.fromCharCode(t.charCodeAt(a)^i[(i[s]+i[n])%256]);return r}static XF(t){const i="0123456789abcdef",s=[];for(let a=0;a<256;a++)s[i.charAt(a>>4)+i.charAt(15&a)]=String.fromCharCode(a);t.length%2&&(t="0"+t);const n=[];let o=0;for(let a=0;a<t.length;a+=2)n[o++]=s[t.substring(a,a+2)];const r=n.join("");return""===r?"0":r}static We(t){return m.zF(m.XF(t))}static color1="@COLOR1";static color2="@COLOR2";static qw="32ab5ff3b26f42dc0ed90f21412913b5"}return m.vfo="29e647fdb0",m})();class Q{AP;constructor(){this.AP=[]}toString(){return this.AP.join("")}add(e){""!==e&&this.AP.push(e)}}class R{}class O{g;constructor(){this.g=[]}[Symbol.iterator](){return this.g.values()}key;value;get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(e){return this}filter(){return this}get count(){return 0}Ml(){}toString(){return"EmptyIterator"}static instance=new O}class G{constructor(e){this.key=-1,this.value=e}[Symbol.iterator](){return[this.value].values()}key;value;get iterator(){return this}reset(){this.key=-1}next(){return-1===this.key&&(this.key=0,!0)}hasNext(){return this.next()}first(){return this.key=0,this.value}any(e){return this.key=-1,e(this.value)}all(e){return this.key=-1,e(this.value)}each(e){return this.key=-1,e(this.value),this}map(e){return new G(e(this.value))}filter(e){return e(this.value)?new G(this.value):O.instance}get count(){return 1}Ml(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class q{jt;Xs;Gt;Tt;constructor(e){this.jt=e,this.Xs=null,e.gr=null,this.Gt=e.rt,this.Tt=-1}[Symbol.iterator](){return null===this.Xs?this.jt.r.values():this.jt.r.filter(this.Xs).values()}key;value;get iterator(){return this}get predicate(){return this.Xs}set predicate(e){this.Xs=e}reset(){const e=this.jt;e.gr=null,this.Gt=e.rt,this.Tt=-1}next(){const e=this.jt;if(e.rt!==this.Gt){if(this.key<0)return!1;y.Gi(e)}const t=e.r,i=t.length;let s=++this.Tt;const n=this.Xs;if(null!==n)for(;s<i;){const o=t[s];if(n(o))return this.Tt=s,this.key=s,this.value=o,!0;s++}else{if(s<i)return this.key=s,this.value=t[s],!0;this.Ml()}return!1}hasNext(){return this.next()}first(){const e=this.jt;this.Gt=e.rt,this.Tt=0;const t=e.r,i=t.length,s=this.Xs;if(null!==s){let n=0;for(;n<i;){const o=t[n];if(s(o))return this.Tt=n,this.key=n,this.value=o,o;n++}return null}if(i>0){const n=t[0];return this.key=0,this.value=n,n}return null}any(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=t.r,n=s.length,o=this.Xs;for(let r=0;r<n;r++){const a=s[r];if(null===o||o(a)){if(e(a))return!0;t.rt!==i&&y.Gi(t)}}return!1}all(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=t.r,n=s.length,o=this.Xs;for(let r=0;r<n;r++){const a=s[r];if(null===o||o(a)){if(!e(a))return!1;t.rt!==i&&y.Gi(t)}}return!0}each(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=t.r,n=s.length,o=this.Xs;for(let r=0;r<n;r++){const a=s[r];null!==o&&!o(a)||(e(a),t.rt!==i&&y.Gi(t))}return this}map(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=[],n=t.r,o=n.length,r=this.Xs;for(let l=0;l<o;l++){const h=n[l];null!==r&&!r(h)||(s.push(e(h)),t.rt!==i&&y.Gi(t))}const a=new H;return a.r=s,a.Yi(),a.iterator}filter(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=[],n=t.r,o=n.length,r=this.Xs;for(let l=0;l<o;l++){const h=n[l];null!==r&&!r(h)||(e(h)&&s.push(h),t.rt!==i&&y.Gi(t))}const a=new H;return a.r=s,a.Yi(),a.iterator}get count(){const e=this.Xs;if(null!==e){let t=0;const i=this.jt.r,s=i.length;for(let n=0;n<s;n++)e(i[n])&&t++;return t}return this.jt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.Xs=null,this.jt.gr=this}toString(){return"ListIterator@"+this.Tt+"/"+this.jt.count}}class ht{jt;Gt;Tt;constructor(e){this.jt=e,e.pr=null,this.Gt=e.rt,this.Tt=e.r.length}[Symbol.iterator](){return this.jt.r.reverse().values()}key;value;get iterator(){return this}reset(){const e=this.jt;e.pr=null,this.Gt=e.rt,this.Tt=e.r.length}next(){const e=this.jt;if(e.rt!==this.Gt){if(this.key<0)return!1;y.Gi(e)}const t=--this.Tt;return t>=0?(this.key=t,this.value=e.r[t],!0):(this.Ml(),!1)}hasNext(){return this.next()}first(){const e=this.jt;this.Gt=e.rt;const t=e.r,i=t.length-1;if(this.Tt=i,i>=0){const s=t[i];return this.key=i,this.value=s,s}return null}any(e){const t=this.jt;t.pr=null;const i=t.rt,s=t.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){if(e(s[o]))return!0;t.rt!==i&&y.Gi(t)}return!1}all(e){const t=this.jt;t.pr=null;const i=t.rt,s=t.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){if(!e(s[o]))return!1;t.rt!==i&&y.Gi(t)}return!0}each(e){const t=this.jt;t.pr=null;const i=t.rt,s=t.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--)e(s[o]),t.rt!==i&&y.Gi(t);return this}map(e){const t=this.jt;t.pr=null;const i=t.rt,s=[],n=t.r,o=n.length;this.Tt=o;for(let a=o-1;a>=0;a--)s.push(e(n[a])),t.rt!==i&&y.Gi(t);const r=new H;return r.r=s,r.Yi(),r.iterator}filter(e){const t=this.jt;t.pr=null;const i=t.rt,s=[],n=t.r,o=n.length;this.Tt=o;for(let a=o-1;a>=0;a--){const l=n[a];e(l)&&s.push(l),t.rt!==i&&y.Gi(t)}const r=new H;return r.r=s,r.Yi(),r.iterator}get count(){return this.jt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.jt.pr=this}toString(){return"ListIteratorBackwards("+this.Tt+"/"+this.jt.count+")"}}class H{f;r;rt;gr;pr;constructor(e){z.Je(this),this.f=!1,this.r=[],this.rt=0,this.gr=null,this.pr=null,void 0!==e&&this.addAll(e)}[Symbol.iterator](){return this.r.values()}Yi(){let e=this.rt;e++,e>999999999&&(e=0),this.rt=e}k(){return this.f=!0,this}ce(){return this.f=!1,this}toString(){return"List()#"+z.xs(this)}add(e){return this.f&&y.L(this,e),this.r.push(e),this.Yi(),this}push(e){this.add(e)}addAll(e){if(null===e)return this;this.f&&y.L(this);const t=this.r;if(e.first){const i=e.iterator;for(;i.next();)t.push(i.value)}else for(const i of e)t.push(i);return this.Yi(),this}clear(){this.f&&y.L(this),this.r.length=0,this.Yi()}contains(e){return this.has(e)}has(e){return null!==e&&-1!==this.r.indexOf(e)}indexOf(e){return null===e?-1:this.r.indexOf(e)}elt(e){const t=this.r;return(e<0||e>=t.length)&&y.J(e,"0 <= i < length",H,"elt:i"),t[e]}get(e){return this.elt(e)}setElt(e,t){const i=this.r;(e<0||e>=i.length)&&y.J(e,"0 <= i < length",H,"setElt:i"),this.f&&y.L(this,e),i[e]=t}set(e,t){this.setElt(e,t)}first(){const e=this.r;return 0===e.length?null:e[0]}last(){const e=this.r,t=e.length;return t>0?e[t-1]:null}pop(){this.f&&y.L(this);const e=this.r;if(e.length>0){const t=e.pop();return void 0===t?null:t}return null}any(e){const t=this.r,i=this.rt,s=t.length;for(let n=0;n<s;n++){if(e(t[n]))return!0;this.rt!==i&&y.Gi(this)}return!1}all(e){const t=this.r,i=this.rt,s=t.length;for(let n=0;n<s;n++){if(!e(t[n]))return!1;this.rt!==i&&y.Gi(this)}return!0}each(e){const t=this.r,i=this.rt,s=t.length;for(let n=0;n<s;n++)e(t[n]),this.rt!==i&&y.Gi(this);return this}map(e){const t=new H,i=[],s=this.r,n=this.rt,o=s.length;for(let r=0;r<o;r++)i.push(e(s[r])),this.rt!==n&&y.Gi(this);return t.r=i,t.Yi(),t}filter(e){const t=new H,i=[],s=this.r,n=this.rt,o=s.length;for(let r=0;r<o;r++){const a=s[r];e(a)&&i.push(a),this.rt!==n&&y.Gi(this)}return t.r=i,t.Yi(),t}insertAt(e,t){e<0&&y.J(e,">= 0",H,"insertAt:i"),this.f&&y.L(this,e);const i=this.r;e>=i.length?i.push(t):i.splice(e,0,t),this.Yi()}remove(e){return this.delete(e)}delete(e){if(null===e)return!1;this.f&&y.L(this,e);const t=this.r,i=t.indexOf(e);return-1!==i&&(i===t.length-1?t.pop():t.splice(i,1),this.Yi(),!0)}removeAt(e){const t=this.r;(e<0||e>=t.length)&&y.J(e,"0 <= i < length",H,"removeAt:i"),this.f&&y.L(this,e),e===t.length-1?t.pop():t.splice(e,1),this.Yi()}removeRange(e,t){const i=this.r,s=i.length;if(e<0)e=0;else if(e>=s)return this;if(t<0)return this;if(t>=s&&(t=s-1),e>t)return this;this.f&&y.L(this);let n=e,o=t+1;for(;o<s;)i[n++]=i[o++];return i.length=s-(t-e+1),this.Yi(),this}copy(){const e=new H,t=this.r;return t.length>0&&(e.r=Array.prototype.slice.call(t)),e}toArray(){const e=this.r,t=this.count,i=new Array(t);for(let s=0;s<t;s++)i[s]=e[s];return i}get AL(){return this.r}toSet(){const e=new z,t=this.r,i=this.count;for(let s=0;s<i;s++)e.add(t[s]);return e}sort(e){return this.f&&y.L(this),this.r.sort(e),this.Yi(),this}sortRange(e,t,i){const s=this.r,n=s.length;void 0===t&&(t=0),void 0===i&&(i=n),this.f&&y.L(this);const o=i-t;if(o<=1)return this;if((t<0||t>=n-1)&&y.J(t,"0 <= from < length",H,"sortRange:from"),2===o){const r=s[t],a=s[t+1];return e(r,a)>0&&(s[t]=a,s[t+1]=r,this.Yi()),this}if(0===t)if(i>=n)s.sort(e);else{const r=s.slice(0,i);r.sort(e);for(let a=0;a<i;a++)s[a]=r[a]}else if(i>=n){const r=s.slice(t);r.sort(e);for(let a=t;a<n;a++)s[a]=r[a-t]}else{const r=s.slice(t,i);r.sort(e);for(let a=t;a<i;a++)s[a]=r[a-t]}return this.Yi(),this}reverse(){return this.f&&y.L(this),this.r.reverse(),this.Yi(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return O.instance;const e=this.gr;return null!==e?(e.reset(),e):new q(this)}get iteratorBackwards(){if(this.r.length<=0)return O.instance;const e=this.pr;return null!==e?(e.reset(),e):new ht(this)}}class vt{Do;oe;constructor(e){this.Do=e,this.oe=e.g.values()}[Symbol.iterator](){return this.Do.g.values()}key;value;get iterator(){return this}reset(){this.oe=this.Do.g.values()}next(){const e=this.oe.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return 0===this.Do.g.size?null:(this.oe=this.Do.g.values(),this.oe.next().value)}any(e){return this.Do.any(e)}all(e){return this.Do.all(e)}each(e){return this.Do.each(e),this}map(e){const t=new H;return this.Do.g.forEach(i=>t.add(e(i))),t.iterator}filter(e){const t=new H;return this.Do.g.forEach(i=>{e(i)&&t.add(i)}),t.iterator}get count(){return this.Do.count}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"SetIterator"}}let z=(()=>{class m{f;g;constructor(t){this.f=!1,this.g=new Set,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.g.values()}values(){return this.g.values()}k(){return this.f=!0,this}ce(){return this.f=!1,this}toString(){return"Set()#"+m.xs(this)}add(t){return null===t||this.g.add(t),this}addAll(t){if(null===t)return this;if(this.f&&y.L(this),t.first){const i=t.iterator;for(;i.next();)this.g.add(i.value)}else for(const i of t)this.g.add(i);return this}has(t){return this.g.has(t)}contains(t){return this.has(t)}containsAll(t){if(null===t)return!0;if(t.first){const i=t.iterator;for(;i.next();)if(!this.has(i.value))return!1}else for(const i of t)if(!this.has(i))return!1;return!0}containsAny(t){if(null===t)return!0;if(t.first){const i=t.iterator;for(;i.next();)if(this.has(i.value))return!0}else for(const i of t)if(this.has(i))return!0;return!1}first(){return 0===this.g.size?null:this.g.values().next().value}any(t){for(const i of this.g)if(t(i))return!0;return!1}all(t){for(const i of this.g)if(!t(i))return!1;return!0}each(t){for(const i of this.g)t(i);return this}map(t){const i=new m;for(const s of this.g)i.add(t(s));return i}filter(t){const i=new m;for(const s of this.g)t(s)&&i.add(s);return i}delete(t){return this.f&&y.L(this),this.g.delete(t)}remove(t){return this.delete(t)}removeAll(t){if(null===t)return this;if(this.f&&y.L(this),t.first){const i=t.iterator;for(;i.next();)this.delete(i.value)}else for(const i of t)this.delete(i);return this}retainAll(t){if(null===t)return this;if(0===this.count)return this;this.f&&y.L(this);const i=new m;i.addAll(t);const s=[];if(t.first){const n=t.iterator;for(;n.next();){const o=n.value;i.has(o)||s.push(o)}}else for(const n of t)i.has(n)||s.push(n);return this.removeAll(s),this}clear(){this.f&&y.L(this),this.g.clear()}copy(){const t=new m;return this.g.forEach(i=>t.add(i)),t}toArray(){return Array.from(this.g)}toList(){const t=new H;return this.g.forEach(i=>t.add(i)),t}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?O.instance:new vt(this)}entries(){return this.g.entries()}keys(){return this.g.keys()}forEach(t,i){return this.g.forEach(t,i)}static Ww=1;static Je(t){t.__gohashid=m.Ww++}static xs(t){return t.__gohashid}}return m})();class Yt{q;oe;constructor(e){this.q=e,this.oe=e.g.keys()}[Symbol.iterator](){return this.q.g.keys()}key;value;get iterator(){return this}reset(){this.oe=this.q.g.keys()}next(){const e=this.oe.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return 0===this.q.g.size?null:(this.oe=this.q.g.keys(),this.oe.next().value)}any(e){for(const t of this.q.g)if(e(t[0]))return!0;return!1}all(e){for(const t of this.q.g)if(!e(t[0]))return!1;return!0}each(e){for(const t of this.q.g)e(t[0]);return this}map(e){const t=this.q,i=new H;for(const s of t.g)i.add(e(s[0]));return i.iterator}filter(e){const t=this.q,i=new H;for(const s of t.g){const n=s[0];e(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapKeySetIterator"}}class Dt extends z{q;constructor(e){super(),z.Je(this),this.f=!0,this.q=e}[Symbol.iterator](){return this.g.keys()}values(){return this.g.keys()}k(){return this}ce(){return this}toString(){return"MapKeySet("+this.q.toString()+")"}add(e){y.o("This Set is read-only: "+this.toString())}has(e){return this.q.has(e)}contains(e){return this.has(e)}delete(e){y.o("This Set is read-only: "+this.toString())}remove(e){return this.delete(e)}clear(){y.o("This Set is read-only: "+this.toString())}first(){return 0===this.q.g.size?null:this.q.g.keys().next().value}any(e){for(const t of this.q.g)if(e(t[0]))return!0;return!1}all(e){for(const t of this.q.g)if(!e(t[0]))return!1;return!0}each(e){for(const t of this.q.g)e(t[0]);return this}map(e){const t=new z;for(const i of this.q.g)t.add(e(i[0]));return t}filter(e){const t=new z;for(const i of this.q.g){const s=i[0];e(s)&&t.add(s)}return t}copy(){return new Dt(this.q)}toSet(){const e=new z,t=this.q.g;for(const i of t)e.add(i[0]);return e}toArray(){const e=this.q.g,t=new Array(e.size);let i=0;for(const s of e)t[i]=s[0],i++;return t}toList(){const e=new H,t=this.q.g;for(const i of t)e.add(i[0]);return e}get count(){return this.q.size}get size(){return this.q.size}get iterator(){return this.q.size<=0?O.instance:new Yt(this.q)}}class Et{q;oe;constructor(e){this.q=e,this.oe=e.g.values()}[Symbol.iterator](){return this.q.g.values()}key;value;get iterator(){return this}reset(){this.oe=this.q.g.values()}next(){const e=this.oe.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return 0===this.q.g.size?null:(this.oe=this.q.g.values(),this.oe.next().value)}any(e){for(const t of this.q.g)if(e(t[1]))return!0;return!1}all(e){for(const t of this.q.g)if(!e(t[1]))return!1;return!0}each(e){for(const t of this.q.g)e(t[1]);return this}map(e){const t=this.q,i=new H;for(const s of t.g)i.add(e(s[1]));return i.iterator}filter(e){const t=this.q,i=new H;for(const s of t.g){const n=s[1];e(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapValueSetIterator"}}class Vt{constructor(e,t){this.key=e,this.value=t}toString(){return"{"+this.key+":"+this.value+"}"}key;value}class Ne{q;oe;constructor(e){this.q=e,this.oe=e.g.entries()}[Symbol.iterator](){return this.q.g.entries()}key;value;get iterator(){return this}reset(){this.oe=this.q.g.entries()}next(){const e=this.oe.next();return e.done?(this.key=null,this.value=null,!1):(this.key=e.value[0],this.value=e.value[1],!0)}hasNext(){return this.next()}first(){if(0===this.q.g.size)return null;this.oe=this.q.g.entries();const e=this.oe.next().value;return this.key=e[0],this.value=e[1],new Vt(e[0],e[1])}any(e){return this.q.any(e)}all(e){return this.q.all(e)}each(e){return this.q.each(e),this}map(e){const t=new H;let i=null;return this.q.g.forEach((s,n)=>{null===i?i=new Vt(n,s):(i.key=n,i.value=s),t.add(e(i))}),t.iterator}filter(e){const t=new H;let i=null;return this.q.g.forEach((s,n)=>{null===i?i=new Vt(n,s):(i.key=n,i.value=s),e(i)&&(t.add(i),i=null)}),t.iterator}get count(){return this.q.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapIterator"}}class xt{f;g;constructor(e){z.Je(this),this.f=!1,this.g=new Map,void 0!==e&&this.addAll(e)}[Symbol.iterator](){return this.g.entries()}entries(){return this.g.entries()}k(){return this.f=!0,this}ce(){return this.f=!1,this}toString(){return"Map()#"+z.xs(this)}set(e,t){return this.f&&y.L(this,e),this.g.set(e,t),this}add(e,t){return this.set(e,t)}addAll(e){if(null===e)return this;if(this.f&&y.L(this),e instanceof xt){const t=e.iterator;for(;t.next();)this.g.set(t.key,t.value)}else if(e.first){const t=e.iterator;for(;t.next();){const i=t.value;this.g.set(i.key,i.value)}}else for(const t of e){const i=t;Array.isArray(i)?this.g.set(i[0],i[1]):this.g.set(i.key,i.value)}return this}first(){if(0===this.g.size)return null;const e=this.g.entries().next().value;return e?new Vt(e[0],e[1]):null}any(e){let t=null;for(const[i,s]of this.g)if(null===t?t=new Vt(i,s):(t.key=i,t.value=s),e(t))return!0;return!1}all(e){let t=null;for(const[i,s]of this.g)if(null===t?t=new Vt(i,s):(t.key=i,t.value=s),!e(t))return!1;return!0}each(e){let t=null;for(const[i,s]of this.g)null===t?t=new Vt(i,s):(t.key=i,t.value=s),e(t);return this}map(e){const t=new xt;let i=null;for(const[s,n]of this.g)null===i?i=new Vt(s,n):(i.key=s,i.value=n),t.set(s,e(i));return t}filter(e){const t=new xt;let i=null;for(const[s,n]of this.g)null===i?i=new Vt(s,n):(i.key=s,i.value=n),e(i)&&t.set(s,n);return t}has(e){return this.g.has(e)}contains(e){return this.has(e)}get(e){const t=this.g.get(e);return void 0===t?null:t}getValue(e){return this.get(e)}delete(e){return null!==e&&(this.f&&y.L(this,e),this.g.delete(e))}remove(e){return this.delete(e)}clear(){this.f&&y.L(this),this.g.clear()}copy(){const e=new xt;return e.g=new Map(this.g),e}toArray(){const e=this.g,t=new Array(e.size);let i=0;for(const s of e)t[i]=new Vt(s[0],s[1]),i++;return t}toKeySet(){return new Dt(this)}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?O.instance:new Ne(this)}get iteratorKeys(){return this.count<=0?O.instance:new Yt(this)}keys(){return this.g.keys()}get iteratorValues(){return this.count<=0?O.instance:new Et(this)}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}}class S{px;py;f;constructor(e,t){void 0===e?(this.px=0,this.py=0):"number"==typeof e&&"number"==typeof t?(this.px=e,this.py=t):y.o("Invalid arguments to Point constructor: "+e+", "+t),this.f=!1}h(e){return this.px=e.px,this.py=e.py,this}e(e,t){return this.px=e,this.py=t,this}setTo(e,t){return this.px=e,this.py=t,this}set(e){return this.px=e.px,this.py=e.py,this}copy(){const e=new S;return e.px=this.px,e.py=this.py,e}kt(){return this.f=!0,Object.freeze(this),this}N(){return this.f||Object.isFrozen(this)?this:this.copy().k()}k(){return this.f||(this.f=!0),this}Jw(e){}static parse(e){if("string"==typeof e){const t=e.split(" ");let i=0,s=0;for(;""===t[i];)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;""===t[i];)i++;return n=t[i++],n&&(o=parseFloat(n)),new S(s,o)}return new S}static stringify(e){return e.x.toString()+" "+e.y.toString()}static stringifyFixed(e){return y.s(e,"number",S,"stringifyFixed:digits"),t=>t.x.toFixed(e)+" "+t.y.toFixed(e)}toString(){return"Point("+this.x+","+this.y+")"}equals(e){return e instanceof S&&this.px===e.x&&this.py===e.y}equalTo(e,t){return this.px===e&&this.py===t}equalsApprox(e){return L.u(this.px,e.x)&&L.u(this.py,e.y)}add(e){return this.px+=e.x,this.py+=e.y,this}subtract(e){return this.px-=e.x,this.py-=e.y,this}offset(e,t){return this.px+=e,this.py+=t,this}rotate(e){if(0===e)return this;const t=this.px,i=this.py;if(0===t&&0===i)return this;let s=0,n=0;if(90===(e=L.Ee(e)))s=0,n=1;else if(180===e)s=-1,n=0;else if(270===e)s=0,n=-1;else{const o=e*Math.PI/180;s=Math.cos(o),n=Math.sin(o)}return this.px=s*t-n*i,this.py=n*t+s*i,this}scale(e,t){return this.px*=e,this.py*=t,this}distanceSquaredPoint(e){const t=e.x-this.px,i=e.y-this.py;return t*t+i*i}distanceSquared(e,t){const i=e-this.px,s=t-this.py;return i*i+s*s}normalize(){const e=this.px,t=this.py,i=Math.sqrt(e*e+t*t);return i>0&&(this.px=e/i,this.py=t/i),this}directionPoint(e){return this.TL(e.x-this.px,e.y-this.py)}direction(e,t){return this.TL(e-this.px,t-this.py)}TL(e,t){if(0===e)return t>0?90:t<0?270:0;if(0===t)return e>0?0:180;{if(isNaN(e)||isNaN(t))return 0;let i=180*Math.atan(Math.abs(t/e))/Math.PI;return e<0?t<0?i+=180:i=180-i:t<0&&(i=360-i),i}}static compareWithLineSegment(e,t,i,s,n,o){return L.ku(e,t,i,s,n,o)}compareWithLineSegmentPoint(e,t){return L.ku(e.x,e.y,t.x,t.y,this.x,this.y)}static intersectingLineSegments(e,t,i,s,n,o,r,a){return L.Pu(e,t,i,s,n,o,r,a)}projectOntoLineSegment(e,t,i,s){return L.Nl(e,t,i,s,this.px,this.py,this),this}projectOntoLineSegmentPoint(e,t){return L.Nl(e.x,e.y,t.x,t.y,this.px,this.py,this),this}snapToGrid(e,t,i,s){return L.tm(this.px,this.py,e,t,i,s,this),this}snapToGridPoint(e,t){return L.tm(this.px,this.py,e.x,e.y,t.width,t.height,this),this}setRectSpot(e,t){return this.px=e.x+t.x*e.width+t.offsetX,this.py=e.y+t.y*e.height+t.offsetY,this}setSpot(e,t,i,s,n){return this.px=e+n.x*i+n.offsetX,this.py=t+n.y*s+n.offsetY,this}v(e){return e.gt(this),this}Ki(e){return e.Ci(this),this}static distanceLineSegmentSquared(e,t,i,s,n,o){let r=n-i,a=o-s;const l=r*r+a*a,h=i-e,c=s-t,u=-h*r-c*a;if(u<=0||u>=l)return r=n-e,a=o-t,Math.min(h*h+c*c,r*r+a*a);{const d=r*c-a*h;return d*d/l}}static distanceSquared(e,t,i,s){const n=i-e,o=s-t;return n*n+o*o}static direction(e,t,i,s){const n=i-e,o=s-t;if(0===n)return o>0?90:o<0?270:0;if(0===o)return n>0?0:180;{if(isNaN(n)||isNaN(o))return 0;let r=180*Math.atan(Math.abs(o/n))/Math.PI;return n<0?o<0?r+=180:r=180-r:o<0&&(r=360-r),r}}get x(){return this.px}set x(e){this.px=e}get y(){return this.py}set y(e){this.py=e}isReal(){return isFinite(this.x)&&isFinite(this.y)}static gn=new S(0,0).kt();static DL=new S(-1/0,-1/0).kt();static vL=new S(1/0,1/0).kt();static FL=new S(6,6).kt();static mn=new S(NaN,NaN).kt();static $w=[];static l(){const e=S.$w.pop();return void 0===e?new S:e}static bs(e){const t=S.$w.pop();return void 0===t?e.copy():t.h(e)}static z(e,t){const i=S.$w.pop();return void 0===i?new S(e,t):(i.x=e,i.y=t,i)}static i(e){S.$w.push(e)}}class lt{sw;sh;f;constructor(e,t){void 0===e?(this.sw=0,this.sh=0):"number"==typeof e&&(e>=0||isNaN(e))&&"number"==typeof t&&(t>=0||isNaN(t))?(this.sw=e,this.sh=t):y.o("Invalid arguments to Size constructor: "+e+", "+t),this.f=!1}h(e){return this.sw=e.sw,this.sh=e.sh,this}e(e,t){return this.sw=e,this.sh=t,this}setTo(e,t){return this.sw=e,this.sh=t,this}set(e){return this.sw=e.sw,this.sh=e.sh,this}copy(){const e=new lt;return e.sw=this.sw,e.sh=this.sh,e}kt(){return this.f=!0,Object.freeze(this),this}N(){return this.f||Object.isFrozen(this)?this:this.copy().k()}k(){return this.f||(this.f=!0),this}Jw(e){}static parse(e){if("string"==typeof e){const t=e.split(" ");let i=0,s=0;for(;""===t[i];)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;""===t[i];)i++;return n=t[i++],n&&(o=parseFloat(n)),new lt(s,o)}return new lt}static stringify(e){return e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return y.s(e,"number",lt,"stringifyFixed:digits"),t=>t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Size("+this.width+","+this.height+")"}equals(e){return e instanceof lt&&this.sw===e.width&&this.sh===e.height}equalTo(e,t){return this.sw===e&&this.sh===t}equalsApprox(e){return L.u(this.sw,e.width)&&L.u(this.sh,e.height)}inflate(e,t){const i=this.width+e;this.sw=i>=0?i:0;const s=this.height+t;return this.sh=s>=0?s:0,this}get width(){return this.sw}set width(e){e<0&&y.J(e,">= 0",lt,"width"),this.sw=e}get height(){return this.sh}set height(e){e<0&&y.J(e,">= 0",lt,"height"),this.sh=e}isReal(){return isFinite(this.width)&&isFinite(this.height)}static bc=new lt(0,0).kt();static TP=new lt(1,1).kt();static RL=new lt(6,6).kt();static Su=new lt(8,8).kt();static OL=new lt(10,10).kt();static DP=new lt(1/0,1/0).kt();static Zw=new lt(NaN,NaN).kt();static IL=[];static l(){const e=lt.IL.pop();return void 0===e?new lt:e}static i(e){lt.IL.push(e)}}class j{rx;ry;rw;rh;f;constructor(e,t,i,s){if(void 0===e)this.rx=0,this.ry=0,this.rw=0,this.rh=0;else if("number"==typeof e&&"number"==typeof t&&"number"==typeof i&&(i>=0||isNaN(i))&&"number"==typeof s&&(s>=0||isNaN(s)))this.rx=e,this.ry=t,this.rw=i,this.rh=s;else if(e instanceof S){const n=e.x,o=e.y;if(t instanceof S){const r=t.x,a=t.y;this.rx=Math.min(n,r),this.ry=Math.min(o,a),this.rw=Math.abs(n-r),this.rh=Math.abs(o-a)}else t instanceof lt?(this.rx=n,this.ry=o,this.rw=t.width,this.rh=t.height):y.o("Incorrect second argument supplied to Rect constructor "+t)}else y.o("Invalid arguments to Rect constructor: "+e+", "+t+", "+i+", "+s);this.f=!1}h(e){return this.rx=e.rx,this.ry=e.ry,this.rw=e.rw,this.rh=e.rh,this}e(e,t,i,s){return this.rx=e,this.ry=t,this.rw=i,this.rh=s,this}jn(e,t){return this.rw=e,this.rh=t,this}setTo(e,t,i,s){return this.rx=e,this.ry=t,this.rw=i,this.rh=s,this}set(e){return this.rx=e.rx,this.ry=e.ry,this.rw=e.rw,this.rh=e.rh,this}setPoint(e){return this.rx=e.x,this.ry=e.y,this}setSize(e){return this.rw=e.width,this.rh=e.height,this}copy(){const e=new j;return e.rx=this.rx,e.ry=this.ry,e.rw=this.rw,e.rh=this.rh,e}kt(){return this.f=!0,Object.freeze(this),this}N(){return this.f||Object.isFrozen(this)?this:this.copy().k()}k(){return this.f||(this.f=!0),this}ce(){return this.f&&(Object.isFrozen(this)&&y.o("cannot thaw constant: "+this),this.f=!1),this}Jw(e){}static parse(e){if("string"==typeof e){const t=e.split(" ");let i=0,s=0;for(;""===t[i];)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;""===t[i];)i++;n=t[i++],n&&(o=parseFloat(n));let r=0;for(;""===t[i];)i++;n=t[i++],n&&(r=parseFloat(n));let a=0;for(;""===t[i];)i++;return n=t[i++],n&&(a=parseFloat(n)),new j(s,o,r,a)}return new j}static stringify(e){return e.x.toString()+" "+e.y.toString()+" "+e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return y.s(e,"number",j,"stringifyFixed:digits"),t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(e){return e instanceof j&&this.rx===e.x&&this.ry===e.y&&this.rw===e.width&&this.rh===e.height}equalTo(e,t,i,s){return this.rx===e&&this.ry===t&&this.rw===i&&this.rh===s}equalsApprox(e){return L.u(this.rx,e.x)&&L.u(this.ry,e.y)&&L.u(this.rw,e.width)&&L.u(this.rh,e.height)}equalsApproxTo(e,t,i,s){return L.u(this.rx,e)&&L.u(this.ry,t)&&L.u(this.rw,i)&&L.u(this.rh,s)}equalsApproxClose(e){return L.X(this.rx,e.x)&&L.X(this.ry,e.y)&&L.X(this.rw,e.width)&&L.X(this.rh,e.height)}containsPoint(e){return this.rx<=e.x&&this.rx+this.rw>=e.x&&this.ry<=e.y&&this.ry+this.rh>=e.y}containsRect(e){return this.rx<=e.x&&e.x+e.width<=this.rx+this.rw&&this.ry<=e.y&&e.y+e.height<=this.ry+this.rh}contains(e,t,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),this.rx<=e&&e+i<=this.rx+this.rw&&this.ry<=t&&t+s<=this.ry+this.rh}offset(e,t){return this.rx+=e,this.ry+=t,this}inflate(e,t){return this.Qw(t,e,t,e)}addMargin(e){return this.Qw(e.top,e.right,e.bottom,e.left)}subtractMargin(e){return this.Qw(-e.top,-e.right,-e.bottom,-e.left)}grow(e,t,i,s){return this.Qw(e,t,i,s)}Qw(e,t,i,s){const n=this.rw;t+s<=-n?(this.rx+=n/2,this.rw=0):(this.rx-=s,this.rw+=t+s);const o=this.rh;return e+i<=-o?(this.ry+=o/2,this.rh=0):(this.ry-=e,this.rh+=e+i),this}intersectRect(e){return this.EL(e.x,e.y,e.width,e.height)}intersect(e,t,i,s){return this.EL(e,t,i,s)}EL(e,t,i,s){const n=Math.max(this.rx,e),o=Math.max(this.ry,t),r=Math.min(this.rx+this.rw,e+i),a=Math.min(this.ry+this.rh,t+s);return this.rx=n,this.ry=o,this.rw=Math.max(0,r-n),this.rh=Math.max(0,a-o),this}intersectsRect(e){return this.intersects(e.x,e.y,e.width,e.height)}intersects(e,t,i,s){let n=this.rw;const o=this.rx;if(n!==1/0&&i!==1/0&&(n+=o,i+=e,isNaN(i)||isNaN(n)||o>i||e>n))return!1;let r=this.rh;const a=this.ry;return!(r!==1/0&&s!==1/0&&(r+=a,s+=t,isNaN(s)||isNaN(r)||a>s||t>r))}UL(e,t){let i=this.rw,s=e.width+t+t;const n=this.rx,o=e.x-t;if(i+=n,s+=o,n>s||o>i)return!1;let r=this.rh,a=e.height+t+t;const l=this.ry,h=e.y-t;return r+=l,a+=h,!(l>a||h>r)}unionPoint(e){return this.re(e.x,e.y,0,0)}unionRect(e){return this.re(e.rx,e.ry,e.rw,e.rh)}union(e,t,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),this.re(e,t,i,s)}re(e,t,i,s){const n=Math.min(this.rx,e),o=Math.min(this.ry,t),r=Math.max(this.rx+this.rw,e+i),a=Math.max(this.ry+this.rh,t+s);return this.rx=n,this.ry=o,this.rw=r-n,this.rh=a-o,this}setSpot(e,t,i){return this.rx=e-i.offsetX-i.x*this.rw,this.ry=t-i.offsetY-i.y*this.rh,this}nearestSideDirection(e,t){return L._w(this,e,t,!0)}nearestSideDirectionPoint(e){return L._w(this,e.x,e.y,!0)}static contains(e,t,i,s,n,o,r,a){return void 0===r&&(r=0),void 0===a&&(a=0),e<=n&&n+r<=e+i&&t<=o&&o+a<=t+s}static intersects(e,t,i,s,n,o,r,a){let l=i,h=r;if(l+=e,h+=n,e>h||n>l)return!1;let d=s,f=a;return d+=t,f+=o,!(t>f||o>d)}static intersectsLineSegment(e,t,i,s,n,o,r,a){return L.VL(e,t,i,s,n,o,r,a)}get x(){return this.rx}set x(e){this.rx=e}get y(){return this.ry}set y(e){this.ry=e}get width(){return this.rw}set width(e){e<0&&y.J(e,">= 0",j,"width"),this.rw=e}get height(){return this.rh}set height(e){e<0&&y.J(e,">= 0",j,"height"),this.rh=e}get left(){return this.rx}set left(e){this.rx=e}get top(){return this.ry}set top(e){this.ry=e}get right(){return this.rx+this.rw}set right(e){this.rx+=e-(this.rx+this.rw)}get bottom(){return this.ry+this.rh}set bottom(e){this.ry+=e-(this.ry+this.rh)}get position(){return new S(this.rx,this.ry)}set position(e){this.rx=e.x,this.ry=e.y}get size(){return new lt(this.rw,this.rh)}set size(e){this.rw=e.width,this.rh=e.height}get center(){return new S(this.rx+this.rw/2,this.ry+this.rh/2)}set center(e){this.rx=e.x-this.rw/2,this.ry=e.y-this.rh/2}get centerX(){return this.rx+this.rw/2}set centerX(e){this.rx=e-this.rw/2}get centerY(){return this.ry+this.rh/2}set centerY(e){this.ry=e-this.rh/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return 0===this.width&&0===this.height}static em=new j(0,0,0,0).kt();static GF=new j(NaN,NaN,NaN,NaN).kt();static tx=[];static l(){const e=j.tx.pop();return void 0===e?new j:e}static bs(e){const t=j.tx.pop();return void 0===t?e.copy():t.h(e)}static z(e,t,i,s){const n=j.tx.pop();return void 0===n?new j(e,t,i,s):n.e(e,t,i,s)}static i(e){j.tx.push(e)}}class It{mt;mr;mb;ml;constructor(e,t,i,s){void 0===e?(this.mt=0,this.mr=0,this.mb=0,this.ml=0):void 0===t?(t=e,i=e,s=e,this.mt=e,this.mr=t,this.mb=i,this.ml=s):void 0===i?(i=e,s=t,this.mt=e,this.mr=t,this.mb=i,this.ml=s):void 0!==s?(this.mt=e,this.mr=t,this.mb=i,this.ml=s):y.o("Invalid arguments to Margin constructor: "+e+", "+t+", "+i+", "+s)}setTo(e,t,i,s){return this.mt=e,this.mr=t,this.mb=i,this.ml=s,this}set(e){return this.mt=e.mt,this.mr=e.mr,this.mb=e.mb,this.ml=e.ml,this}copy(){const e=new It;return e.mt=this.mt,e.mr=this.mr,e.mb=this.mb,e.ml=this.ml,e}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(e){}static parse(e){if("string"==typeof e){const t=e.split(" ");let i=0,s=NaN;for(;""===t[i];)i++;let n=t[i++];if(n&&(s=parseFloat(n)),isNaN(s))return new It;let o=NaN;for(;""===t[i];)i++;if(n=t[i++],n&&(o=parseFloat(n)),isNaN(o))return new It(s);let r=NaN;for(;""===t[i];)i++;if(n=t[i++],n&&(r=parseFloat(n)),isNaN(r))return new It(s,o);let a=NaN;for(;""===t[i];)i++;return n=t[i++],n&&(a=parseFloat(n)),isNaN(a)?new It(s,o):new It(s,o,r,a)}return new It}static stringify(e){return e.top.toString()+" "+e.right.toString()+" "+e.bottom.toString()+" "+e.left.toString()}static stringifyFixed(e){return y.s(e,"number",It,"stringifyFixed:digits"),t=>t.top.toFixed(e)+" "+t.right.toFixed(e)+" "+t.bottom.toFixed(e)+" "+t.left.toFixed(e)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(e){return e instanceof It&&this.mt===e.top&&this.mr===e.right&&this.mb===e.bottom&&this.ml===e.left}equalTo(e,t,i,s){return this.mt===e&&this.mr===t&&this.mb===i&&this.ml===s}equalsApprox(e){return L.u(this.mt,e.top)&&L.u(this.mr,e.right)&&L.u(this.mb,e.bottom)&&L.u(this.ml,e.left)}get top(){return this.mt}set top(e){this.mt=e}get right(){return this.mr}set right(e){this.mr=e}get bottom(){return this.mb}set bottom(e){this.mb=e}get left(){return this.ml}set left(e){this.ml=e}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static im=new It(0,0,0,0).kt();static BL=new It(2,2,2,2).kt()}class A{sx;sy;ox;oy;constructor(e,t,i,s){void 0===e?(this.sx=0,this.sy=0,this.ox=0,this.oy=0):(void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=0),this.sx=e,this.sy=t,this.ox=i,this.oy=s)}setTo(e,t,i,s){return this.sx=e,this.sy=t,this.ox=i,this.oy=s,this}set(e){return this.sx=e.sx,this.sy=e.sy,this.ox=e.ox,this.oy=e.oy,this}copy(){const e=new A;return e.sx=this.sx,e.sy=this.sy,e.ox=this.ox,e.oy=this.oy,e}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(e){}Hi(e){return this.sx=NaN,this.sy=NaN,this.ox=e,this.kt()}DU(e,t){(isNaN(e)||e>1||e<0)&&y.J(e,"0 <= "+t+" <= 1",A,t)}vU(e,t){(isNaN(e)||e===1/0||e===-1/0)&&y.J(e,"real number, not NaN or Infinity",A,t)}static parse(e){if("string"==typeof e){if("None"===(e=e.trim()))return A.None;if("TopLeft"===e)return A.TopLeft;if("Top"===e||"TopCenter"===e||"MiddleTop"===e)return A.TopCenter;if("TopRight"===e)return A.TopRight;if("Left"===e||"LeftCenter"===e||"MiddleLeft"===e)return A.LeftCenter;if("Center"===e)return A.Center;if("Right"===e||"RightCenter"===e||"MiddleRight"===e)return A.RightCenter;if("BottomLeft"===e)return A.BottomLeft;if("Bottom"===e||"BottomCenter"===e||"MiddleBottom"===e)return A.BottomCenter;if("BottomRight"===e)return A.BottomRight;if("TopSide"===e)return A.TopSide;if("LeftSide"===e)return A.LeftSide;if("RightSide"===e)return A.RightSide;if("BottomSide"===e)return A.BottomSide;if("TopBottomSides"===e)return A.TopBottomSides;if("LeftRightSides"===e)return A.LeftRightSides;if("TopLeftSides"===e)return A.TopLeftSides;if("TopRightSides"===e)return A.TopRightSides;if("BottomLeftSides"===e)return A.BottomLeftSides;if("BottomRightSides"===e)return A.BottomRightSides;if("NotTopSide"===e)return A.NotTopSide;if("NotLeftSide"===e)return A.NotLeftSide;if("NotRightSide"===e)return A.NotRightSide;if("NotBottomSide"===e)return A.NotBottomSide;if("AllSides"===e)return A.AllSides;if("Default"===e)return A.Default;const t=e.split(" ");let i=0,s=0;for(;""===t[i];)i++;let n=t[i++];void 0!==n&&n.length>0&&(s=parseFloat(n));let o=0;for(;""===t[i];)i++;n=t[i++],void 0!==n&&n.length>0&&(o=parseFloat(n));let r=0;for(;""===t[i];)i++;n=t[i++],void 0!==n&&n.length>0&&(r=parseFloat(n));let a=0;for(;""===t[i];)i++;return n=t[i++],void 0!==n&&n.length>0&&(a=parseFloat(n)),new A(s,o,r,a)}return new A}static stringify(e){return e.isSpot()?e.x.toString()+" "+e.y.toString()+" "+e.offsetX.toString()+" "+e.offsetY.toString():e.toString()}static stringifyFixed(e){return y.s(e,"number",A,"stringifyFixed:digits"),t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.offsetX.toFixed(e)+" "+t.offsetY.toFixed(e)}toString(){return this.isSpot()?0===this.ox&&0===this.oy?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(A.None)?"None":this.equals(A.TopLeft)?"TopLeft":this.equals(A.TopCenter)?"Top":this.equals(A.TopRight)?"TopRight":this.equals(A.LeftCenter)?"Left":this.equals(A.Center)?"Center":this.equals(A.RightCenter)?"Right":this.equals(A.BottomLeft)?"BottomLeft":this.equals(A.BottomCenter)?"Bottom":this.equals(A.BottomRight)?"BottomRight":this.equals(A.TopSide)?"TopSide":this.equals(A.LeftSide)?"LeftSide":this.equals(A.RightSide)?"RightSide":this.equals(A.BottomSide)?"BottomSide":this.equals(A.TopBottomSides)?"TopBottomSides":this.equals(A.LeftRightSides)?"LeftRightSides":this.equals(A.TopLeftSides)?"TopLeftSides":this.equals(A.TopRightSides)?"TopRightSides":this.equals(A.BottomLeftSides)?"BottomLeftSides":this.equals(A.BottomRightSides)?"BottomRightSides":this.equals(A.NotTopSide)?"NotTopSide":this.equals(A.NotLeftSide)?"NotLeftSide":this.equals(A.NotRightSide)?"NotRightSide":this.equals(A.NotBottomSide)?"NotBottomSide":this.equals(A.AllSides)?"AllSides":this.equals(A.Default)?"Default":"None"}equals(e){return e instanceof A&&(this.sx===e.x||isNaN(this.sx)&&isNaN(e.x))&&(this.sy===e.y||isNaN(this.sy)&&isNaN(e.y))&&this.ox===e.offsetX&&this.oy===e.offsetY}opposite(){return new A(.5-(this.sx-.5),.5-(this.sy-.5),-this.ox,-this.oy)}includesSide(e){if(!this.isSide())return!1;if(!e.isSide())if(e.equals(A.Left))e=A.LeftSide;else if(e.equals(A.Right))e=A.RightSide;else if(e.equals(A.Top))e=A.TopSide;else{if(!e.equals(A.Bottom))return!1;e=A.BottomSide}const i=e.offsetY;return(this.oy&i)===i}get x(){return this.sx}set x(e){this.sx=e}get y(){return this.sy}set y(e){this.sy=e}get offsetX(){return this.ox}set offsetX(e){this.ox=e}get offsetY(){return this.oy}set offsetY(e){this.oy=e}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&1===this.offsetX&&0!==this.offsetY}isNone(){return isNaN(this.x)&&isNaN(this.y)&&0===this.offsetX&&0===this.offsetY}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&-1===this.offsetX&&0===this.offsetY}static None=new A(0,0,0,0).Hi(0);static Default=new A(0,0,-1,0).Hi(-1);static TopLeft=new A(0,0,0,0).kt();static TopCenter=new A(.5,0,0,0).kt();static TopRight=new A(1,0,0,0).kt();static LeftCenter=new A(0,.5,0,0).kt();static Center=new A(.5,.5,0,0).kt();static RightCenter=new A(1,.5,0,0).kt();static BottomLeft=new A(0,1,0,0).kt();static BottomCenter=new A(.5,1,0,0).kt();static BottomRight=new A(1,1,0,0).kt();static MiddleTop=A.TopCenter;static MiddleLeft=A.LeftCenter;static MiddleRight=A.RightCenter;static MiddleBottom=A.BottomCenter;static Top=A.TopCenter;static Left=A.LeftCenter;static Right=A.RightCenter;static Bottom=A.BottomCenter;static TopSide=new A(0,0,1,1).Hi(1);static LeftSide=new A(0,0,1,2).Hi(1);static RightSide=new A(0,0,1,4).Hi(1);static BottomSide=new A(0,0,1,8).Hi(1);static TopBottomSides=new A(0,0,1,9).Hi(1);static LeftRightSides=new A(0,0,1,6).Hi(1);static TopLeftSides=new A(0,0,1,3).Hi(1);static TopRightSides=new A(0,0,1,5).Hi(1);static BottomLeftSides=new A(0,0,1,10).Hi(1);static BottomRightSides=new A(0,0,1,12).Hi(1);static NotTopSide=new A(0,0,1,14).Hi(1);static NotLeftSide=new A(0,0,1,13).Hi(1);static NotRightSide=new A(0,0,1,11).Hi(1);static NotBottomSide=new A(0,0,1,7).Hi(1);static AllSides=new A(0,0,1,15).Hi(1);static vP=new A(.156,.156).kt();static FP=new A(.844,.844).kt()}let Ot=(()=>{class m{m11;m12;m21;m22;dx;dy;constructor(){this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(t){return this.m11=t.m11,this.m12=t.m12,this.m21=t.m21,this.m22=t.m22,this.dx=t.dx,this.dy=t.dy,this}setTo(t,i,s,n,o,r){return this.m11=t,this.m12=i,this.m21=s,this.m22=n,this.dx=o,this.dy=r,this}copy(){const t=new m;return t.m11=this.m11,t.m12=this.m12,t.m21=this.m21,t.m22=this.m22,t.dx=this.dx,t.dy=this.dy,t}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(t){return this.m11===t.m11&&this.m12===t.m12&&this.m21===t.m21&&this.m22===t.m22&&this.dx===t.dx&&this.dy===t.dy}RP(){return 0===this.dx&&0===this.dy&&1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22}Ue(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}kc(t){const i=this.m11*t.m11+this.m21*t.m12,s=this.m12*t.m11+this.m22*t.m12,n=this.m11*t.m21+this.m21*t.m22,o=this.m12*t.m21+this.m22*t.m22;return this.dx=this.m11*t.dx+this.m21*t.dy+this.dx,this.dy=this.m12*t.dx+this.m22*t.dy+this.dy,this.m11=i,this.m12=s,this.m21=n,this.m22=o,this}zL(t){const i=1/(t.m11*t.m22-t.m12*t.m21),s=t.m22*i,n=-t.m12*i,o=-t.m21*i,r=t.m11*i,a=i*(t.m21*t.dy-t.m22*t.dx),l=i*(t.m12*t.dx-t.m11*t.dy),h=this.m11*s+this.m21*n,c=this.m12*s+this.m22*n,u=this.m11*o+this.m21*r,d=this.m12*o+this.m22*r;return this.dx=this.m11*a+this.m21*l+this.dx,this.dy=this.m12*a+this.m22*l+this.dy,this.m11=h,this.m12=c,this.m21=u,this.m22=d,this}ex(){const t=1/(this.m11*this.m22-this.m12*this.m21),s=-this.m12*t,n=-this.m21*t,o=this.m11*t,r=t*(this.m21*this.dy-this.m22*this.dx),a=t*(this.m12*this.dx-this.m11*this.dy);return this.m11=this.m22*t,this.m12=s,this.m21=n,this.m22=o,this.dx=r,this.dy=a,this}ks(t,i,s){if(0===(t=L.Ee(t)))return this;this.Gs(i,s);let n=0,o=0;if(90===t)n=0,o=1;else if(180===t)n=-1,o=0;else if(270===t)n=0,o=-1;else{const c=t*Math.PI/180;n=Math.cos(c),o=Math.sin(c)}const a=this.m12*n+this.m22*o,l=this.m11*-o+this.m21*n,h=this.m12*-o+this.m22*n;return this.m11=this.m11*n+this.m21*o,this.m12=a,this.m21=l,this.m22=h,this.Gs(-i,-s),this}Gs(t,i){return this.dx+=this.m11*t+this.m21*i,this.dy+=this.m12*t+this.m22*i,this}it(t,i){return void 0===i&&(i=t),this.m11*=t,this.m12*=t,this.m21*=i,this.m22*=i,this}YF(){if(1===this.m11&&0===this.m12)return 0;let t=180*Math.atan2(this.m12,this.m11)/Math.PI;return t<0&&(t+=360),t}gt(t){const i=t.x,s=t.y;return t.e(i*this.m11+s*this.m21+this.dx,i*this.m12+s*this.m22+this.dy)}Ci(t){const i=1/(this.m11*this.m22-this.m12*this.m21),a=t.x-this.dx,l=t.y-this.dy;return t.e(a*(this.m22*i)+l*(-this.m21*i),a*(-this.m12*i)+l*(this.m11*i))}Mu(t){const i=1/(this.m11*this.m22-this.m12*this.m21),h=1.25*t.x,c=1.2*t.y;return t.e(h*(this.m22*i)+c*(-this.m21*i)+i*(this.m21*this.dy-this.m22*this.dx),h*(-this.m12*i)+c*(this.m11*i)+i*(this.m12*this.dx-this.m11*this.dy))}sm(t){const i=t.x,s=t.y,n=i+t.width,o=s+t.height,r=this.m11,a=this.m12,l=this.m21,h=this.m22,c=this.dx,u=this.dy,d=i*r+s*l+c,f=i*a+s*h+u,p=n*r+s*l+c,g=n*a+s*h+u,b=i*r+o*l+c,x=i*a+o*h+u,v=n*r+o*l+c,P=n*a+o*h+u;let w=d,M=d,C=f,N=f;return w=Math.min(w,p),M=Math.max(M,p),C=Math.min(C,g),N=Math.max(N,g),w=Math.min(w,b),M=Math.max(M,b),C=Math.min(C,x),N=Math.max(N,x),w=Math.min(w,v),M=Math.max(M,v),C=Math.min(C,P),N=Math.max(N,P),t.e(w,C,M-w,N-C),t}static XL=[];static l(){const t=m.XL.pop();return void 0===t?new m:t}static i(t){m.XL.push(t)}static OP="54a702f3e53909c447824c6706603faf4c"}return m})();const L={KF:"7da71ca0ad381e90",qn:(Math.sqrt(2)-1)/3*4,GL:[],ix:m=>{if(m<=0)return 0;let e=L.GL;if(null===e){e=[];for(let t=0;t<=2e3;t++)e[t]=Math.sqrt(t);L.GL=e}if(m<1){const t=1/m;return t<=2e3?1/e[0|t]:Math.sqrt(m)}return m<=2e3?e[0|m]:Math.sqrt(m)},u:(m,e)=>{const t=m-e;return t<.5&&t>-.5},X:(m,e)=>{const t=m-e;return t<5e-8&&t>-5e-8},Ve:(m,e,t,i,s,n,o)=>{s<=0&&(s=1e-6);let r=0,a=0,l=0,h=0;if(m<t?(a=m,r=t):(a=t,r=m),e<i?(h=e,l=i):(h=i,l=e),m===t)return h<=o&&o<=l&&m-s<=n&&n<=m+s;if(e===i)return a<=n&&n<=r&&e-s<=o&&o<=e+s;const c=r+s,u=a-s;if(u<=n&&n<=c){const d=l+s,f=h-s;if(f<=o&&o<=d)if(c-u>d-f){if(!(m-t>s||t-m>s))return!0;{const p=(i-e)/(t-m)*(n-m)+e;if(p-s<=o&&o<=p+s)return!0}}else{if(!(e-i>s||i-e>s))return!0;{const p=(t-m)/(i-e)*(o-e)+m;if(p-s<=n&&n<=p+s)return!0}}}return!1},nx:(m,e,t,i,s,n,o,r,a,l,h,c)=>{if(L.Ve(m,e,o,r,c,t,i)&&L.Ve(m,e,o,r,c,s,n))return L.Ve(m,e,o,r,c,l,h);{const u=(m+t)/2,d=(e+i)/2,f=(t+s)/2,p=(i+n)/2,g=(s+o)/2,b=(n+r)/2,x=(u+f)/2,v=(d+p)/2,P=(f+g)/2,w=(p+b)/2,M=(x+P)/2,C=(v+w)/2;return L.nx(m,e,u,d,x,v,M,C,a,l,h,c)||L.nx(M,C,P,w,g,b,o,r,a,l,h,c)}},YL:(m,e,t,i,s,n,o,r,a)=>{const c=(t+s)/2,u=(i+n)/2;return a.e((((m+t)/2+c)/2+(c+(s+o)/2)/2)/2,(((e+i)/2+u)/2+(u+(n+r)/2)/2)/2),a},HF:(m,e,t,i,s,n,o,r)=>{const h=(t+s)/2,c=(i+n)/2;return S.direction(((m+t)/2+h)/2,((e+i)/2+c)/2,(h+(s+o)/2)/2,(c+(n+r)/2)/2)},Nu:(m,e,t,i,s,n,o,r,a,l)=>{if(L.Ve(m,e,o,r,a,t,i)&&L.Ve(m,e,o,r,a,s,n))l.re(m,e,0,0),l.re(o,r,0,0);else{const h=(m+t)/2,c=(e+i)/2,u=(t+s)/2,d=(i+n)/2,f=(s+o)/2,p=(n+r)/2,g=(h+u)/2,b=(c+d)/2,x=(u+f)/2,v=(d+p)/2,P=(g+x)/2,w=(b+v)/2;L.Nu(m,e,h,c,g,b,P,w,a,l),L.Nu(P,w,x,v,f,p,o,r,a,l)}return l},Wn:(m,e,t,i,s,n,o,r,a,l)=>{if(L.Ve(m,e,o,r,a,t,i)&&L.Ve(m,e,o,r,a,s,n))0===l.length&&(l.push(m),l.push(e)),l.push(o),l.push(r);else{const h=(m+t)/2,c=(e+i)/2,u=(t+s)/2,d=(i+n)/2,f=(s+o)/2,p=(n+r)/2,g=(h+u)/2,b=(c+d)/2,x=(u+f)/2,v=(d+p)/2,P=(g+x)/2,w=(b+v)/2;L.Wn(m,e,h,c,g,b,P,w,a,l),L.Wn(P,w,x,v,f,p,o,r,a,l)}return l},IP:(m,e,t,i,s,n,o,r,a,l)=>{if(L.Ve(m,e,s,n,l,t,i))return L.Ve(m,e,s,n,l,r,a);{const h=(m+t)/2,c=(e+i)/2,u=(t+s)/2,d=(i+n)/2,f=(h+u)/2,p=(c+d)/2;return L.IP(m,e,h,c,f,p,o,r,a,l)||L.IP(f,p,u,d,s,n,o,r,a,l)}},EP:(m,e,t,i,s,n,o,r)=>{if(L.Ve(m,e,s,n,o,t,i))r.re(m,e,0,0),r.re(s,n,0,0);else{const a=(m+t)/2,l=(e+i)/2,h=(t+s)/2,c=(i+n)/2,u=(a+h)/2,d=(l+c)/2;L.EP(m,e,a,l,u,d,o,r),L.EP(u,d,h,c,s,n,o,r)}return r},nm:(m,e,t,i,s,n,o,r)=>{if(L.Ve(m,e,s,n,o,t,i))0===r.length&&(r.push(m),r.push(e)),r.push(s),r.push(n);else{const a=(m+t)/2,l=(e+i)/2,h=(t+s)/2,c=(i+n)/2,u=(a+h)/2,d=(l+c)/2;L.nm(m,e,a,l,u,d,o,r),L.nm(u,d,h,c,s,n,o,r)}return r},om:(m,e,t,i,s,n,o,r,a,l,h,c,u,d)=>{if(L.Ve(m,e,o,r,u,t,i)&&L.Ve(m,e,o,r,u,s,n)){if(!L.Pu(m,e,o,r,a,l,h,c))return!1;const f=(m-o)*(l-c)-(e-r)*(a-h);return 0!==f&&(d.e(((m*r-e*o)*(a-h)-(m-o)*(a*c-l*h))/f,((m*r-e*o)*(l-c)-(e-r)*(a*c-l*h))/f),!0)}{const f=(m+t)/2,p=(e+i)/2,g=(t+s)/2,b=(i+n)/2,x=(s+o)/2,v=(n+r)/2,P=(f+g)/2,w=(p+b)/2,M=(g+x)/2,C=(b+v)/2,N=(P+M)/2,I=(w+C)/2;let T=1/0,D=!1,F=0,E=0;if(L.om(m,e,f,p,P,w,N,I,a,l,h,c,u,d)){const B=(d.x-a)**2+(d.y-l)**2;B<T&&(T=B,D=!0,F=d.x,E=d.y)}if(L.om(N,I,M,C,x,v,o,r,a,l,h,c,u,d)){const B=(d.x-a)**2+(d.y-l)**2;B<T&&(T=B,D=!0,F=d.x,E=d.y)}return D&&(d.x=F,d.y=E),D}},rm:(m,e,t,i,s,n,o,r,a,l,h,c,u)=>{let d=0;if(L.Ve(m,e,o,r,u,t,i)&&L.Ve(m,e,o,r,u,s,n)){const f=(m-o)*(l-c)-(e-r)*(a-h);if(0===f)return d;const p=((m*r-e*o)*(a-h)-(m-o)*(a*c-l*h))/f,g=((m*r-e*o)*(l-c)-(e-r)*(a*c-l*h))/f;if(p>=h)return d;let b=0,x=0;if((a>h?a-h:h-a)<(l>c?l-c:c-l)){if(e<r?(b=e,x=r):(b=r,x=e),g<b||g>x)return d}else if(m<o?(b=m,x=o):(b=o,x=m),p<b||p>x)return d;f>0?d++:f<0&&d--}else{const f=(m+t)/2,p=(e+i)/2,g=(t+s)/2,b=(i+n)/2,x=(s+o)/2,v=(n+r)/2,P=(f+g)/2,w=(p+b)/2,M=(g+x)/2,C=(b+v)/2,N=(P+M)/2,I=(w+C)/2;d+=L.rm(m,e,f,p,P,w,N,I,a,l,h,c,u),d+=L.rm(N,I,M,C,x,v,o,r,a,l,h,c,u)}return d},Nl:(m,e,t,i,s,n,o)=>{if(L.X(m,t)){let r=0,a=0;e<i?(r=e,a=i):(r=i,a=e);const l=n;return l<r?(o.e(m,r),!1):l>a?(o.e(m,a),!1):(o.e(m,l),!0)}if(L.X(e,i)){let r=0,a=0;m<t?(r=m,a=t):(r=t,a=m);const l=s;return l<r?(o.e(r,e),!1):l>a?(o.e(a,e),!1):(o.e(l,e),!0)}{const a=((m-s)*(m-t)+(e-n)*(e-i))/((t-m)**2+(i-e)**2);return a<-5e-6?(o.e(m,e),!1):a>1.000005?(o.e(t,i),!1):(o.e(m+a*(t-m),e+a*(i-e)),!0)}},vo:(m,e,t,i,s,n,o,r,a)=>{if(L.u(m,t)&&L.u(e,i))return a.e(m,e),!1;if(L.X(s,o))return L.X(m,t)?(L.Nl(m,e,t,i,s,n,a),!1):L.Nl(m,e,t,i,s,(i-e)/(t-m)*(s-m)+e,a);{const l=(r-n)/(o-s);if(L.X(m,t)){const h=l*(m-s)+n;let c=0,u=0;return e<i?(c=e,u=i):(c=i,u=e),h<c?(a.e(m,c),!1):h>u?(a.e(m,u),!1):(a.e(m,h),!0)}{const h=(i-e)/(t-m);if(L.X(l,h))return L.Nl(m,e,t,i,s,n,a),!1;{const c=(h*m-l*s+n-e)/(h-l);if(L.X(h,0)){let u=0,d=0;return m<t?(u=m,d=t):(u=t,d=m),c<u?(a.e(u,e),!1):c>d?(a.e(d,e),!1):(a.e(c,e),!0)}return L.Nl(m,e,t,i,c,h*(c-m)+e,a)}}}},Cl:(m,e,t,i,s,n,o,r,a)=>{let l=1e21,h=m,c=e;if(L.vo(m,e,m,i,s,n,o,r,a)){const u=(a.x-s)**2+(a.y-n)**2;u<l&&(l=u,h=a.x,c=a.y)}if(L.vo(t,e,t,i,s,n,o,r,a)){const u=(a.x-s)**2+(a.y-n)**2;u<l&&(l=u,h=a.x,c=a.y)}if(L.vo(m,e,t,e,s,n,o,r,a)){const u=(a.x-s)**2+(a.y-n)**2;u<l&&(l=u,h=a.x,c=a.y)}if(L.vo(m,i,t,i,s,n,o,r,a)){const u=(a.x-s)**2+(a.y-n)**2;u<l&&(l=u,h=a.x,c=a.y)}return a.e(h,c),l<1e21},lx:(m,e,t)=>L.VL(m.x,m.y,m.width,m.height,e.x,e.y,t.x,t.y),VL:(m,e,t,i,s,n,o,r)=>{const a=m,l=m+t,h=e,c=e+i;if(s===o){let u=0,d=0;return n<r?(u=n,d=r):(u=r,d=n),a<=s&&s<=l&&u<=c&&d>=h}if(n===r){let u=0,d=0;return s<o?(u=s,d=o):(u=o,d=s),h<=n&&n<=c&&u<=l&&d>=a}return!!(j.contains(m,e,t,i,s,n)||j.contains(m,e,t,i,o,r)||L.Pu(a,h,l,h,s,n,o,r)||L.Pu(l,h,l,c,s,n,o,r)||L.Pu(l,c,a,c,s,n,o,r)||L.Pu(a,c,a,h,s,n,o,r))},Pu:(m,e,t,i,s,n,o,r)=>m===t&&e===i&&s===o&&n===r?m===s&&e===n:L.ku(m,e,t,i,s,n)*L.ku(m,e,t,i,o,r)<=0&&L.ku(s,n,o,r,m,e)*L.ku(s,n,o,r,t,i)<=0,ku:(m,e,t,i,s,n)=>{const o=t-m,r=i-e;let a=s-m,l=n-e,h=a*r-l*o;return 0===h&&(h=a*o+l*r,h>0&&(a-=o,l-=r,h=a*o+l*r,h<0&&(h=0))),h},_w(m,e,t,i){void 0===i&&(i=!1);let s=0;const n=null===m?e:(e-m.x)/(m.width>0?m.width:1),o=null===m?t:(t-m.y)/(m.height>0?m.height:1);return n>o?n>1-o||(s=i||n<1-o?270:315):i||n<o?s=n>1-o?90:i||n<1-o?180:135:n<.5?s=225:n>.5&&(s=45),s},Ee:m=>(m>=360?m-=360:m<0&&(m+=360),m),jF:(m,e)=>m>e?Math.min(m-e,Math.abs(m-360-e)):e>m?Math.min(e-m,Math.abs(m-(e-360))):0,KL:(m,e,t,i,s,n)=>{const o=Math.PI;n||(i*=o/180,s*=o/180);const r=i>s?-1:1,a=1e-5,h=[],c=o/2;let u=i,d=Math.min(2*o,Math.abs(s-i));if(d<a){const f=u+r*Math.min(d,c),p=m+t*Math.cos(u),g=e+t*Math.sin(u),b=m+t*Math.cos(f),x=e+t*Math.sin(f),v=(p+b)/2,P=(g+x)/2;return h.push([p,g,v,P,v,P,b,x]),h}for(;d>a;){const f=u+r*Math.min(d,c);h.push(L.qF(t,u,f,m,e)),d-=Math.abs(f-u),u=f}return h},qF:(m,e,t,i,s)=>{const n=(t-e)/2,o=m*Math.cos(n),r=m*Math.sin(n),a=o,l=-r,h=a*a+l*l,c=h+a*o+l*r,u=4/3*(Math.sqrt(2*h*c)-c)/(a*r-l*o),d=a-u*l,f=l+u*a,p=d,g=-f,b=n+e,x=Math.cos(b),v=Math.sin(b);return[i+m*Math.cos(e),s+m*Math.sin(e),i+d*x-f*v,s+d*v+f*x,i+p*x-g*v,s+p*v+g*x,i+m*Math.cos(t),s+m*Math.sin(t)]},tm:(m,e,t,i,s,n,o)=>{const r=s,a=n,l=Math.floor((m-t)/r)*r+t,h=Math.floor((e-i)/a)*a+i;let c=l;l+r-m<r/2&&(c=l+r);let u=h;return h+a-e<a/2&&(u=h+a),o.e(c,u),o},HL:(m,e)=>{let t=Math.max(m,e),i=Math.min(m,e),s=1,n=1;do{s=t%i,n=i,t=i,i=s}while(s>0);return n},WF:(m,e,t,i)=>{const s=t<0,n=i<0;let o=0,r=0,a=0;m<e?(r=1,a=0):(r=0,a=1);let l=0,h=0,c=0,u=0;return o=r,l=0===o?m:e,c=0===o?t:i,(0===o?s:n)&&(c=-c),o=a,h=0===o?m:e,u=0===o?t:i,(0===o?s:n)&&(u=-u),L.JF(l,h,c,u,0,0)},JF:(m,e,t,i,s,n)=>{let o=0;if(i>0)if(t>0){const r=m*m,a=e*e,l=m*t,h=e*i;let c=-a+h,u=-a+Math.sqrt(l*l+h*h),d=c;const f=9999999999;for(let b=0;b<f&&(d=.5*(c+u),d!==c&&d!==u);++b){const x=l/(d+r),v=h/(d+a),P=x*x+v*v-1;if(P>0)c=d;else{if(!(P<0))break;u=d}}const p=(s=r*t/(d+r))-t,g=(n=a*i/(d+a))-i;o=Math.sqrt(p*p+g*g)}else s=0,n=e,o=Math.abs(i-e);else{const r=m*m-e*e,a=m*t;if(a<r){const l=a/r;s=m*l,n=e*Math.sqrt(Math.abs(1-l*l));const c=s-t;o=Math.sqrt(c*c+n*n)}else s=m,n=0,o=Math.abs(t-m)}return o},Jn:{},lm:new R,yr:new R,wr:0,am:100};L.za=L.KF;var m,Ke=((m=Ke||{})[m.Line=1]="Line",m[m.Rectangle=2]="Rectangle",m[m.Ellipse=3]="Ellipse",m[m.Path=4]="Path",m),Fi=(m=>(m[m.None=0]="None",m[m.Default=1]="Default",m[m.Fill=2]="Fill",m[m.Uniform=6]="Uniform",m))(Fi||{});class Ct{n;hm;cm;Pc;Cu;Lu;$n;Zn;Qn;W;Li;Ai;ni;oi;Ys;Sc;Mc;constructor(e,t){z.Je(this),this.n=2,void 0===e&&(e=4),this.W=e,this.Li=0,this.Ai=0,this.ni=0,this.oi=0,this.Ys=4===e?new H:Ct.hx,this.hm=this.Ys.rt,this.cm=new j,this.Pc=null,this.Cu=null,this.Lu=NaN,this.$n=A.TopLeft,this.Zn=A.BottomRight,this.Sc=NaN,this.Mc=NaN,this.Qn=2,t&&Object.assign(this,t)}copy(){const e=new Ct;if(e.n=-2&this.n,e.W=this.W,e.Li=this.Li,e.Ai=this.Ai,e.ni=this.ni,e.oi=this.oi,4===this.W){const t=this.Ys.r,i=e.Ys;for(let s=0;s<t.length;s++)i.add(t[s].copy());e.Ys=i}else e.Ys=this.Ys;return e.hm=this.hm,e.cm.h(this.cm),e.Pc=this.Pc,e.Cu=this.Cu,e.Lu=this.Lu,e.$n=this.$n.N(),e.Zn=this.Zn.N(),e.Sc=this.Sc,e.Mc=this.Mc,e.Qn=this.Qn,e}static Line=1;static Rectangle=2;static Ellipse=3;static Path=4;static hx=(new H).k();get f(){return!!(1&this.n)}set f(e){e?this.n|=1:this.n&=-2}get yt(){return!!(2&this.n)}set yt(e){e?this.n|=2:this.n&=-3}k(){if(this.f=!0,4!==this.type)return this;const e=this.figures;e.k();for(const t of e)t.k();return this}equalsApprox(e){if(!(e instanceof Ct))return!1;if(this.type!==e.type)return 1===this.type&&4===e.type?this.jL(e):1===e.type&&4===this.type&&e.jL(this);if(4===this.type){const t=this.figures.r,i=e.figures.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++)if(!t[n].equalsApprox(i[n]))return!1;return!0}return L.u(this.startX,e.startX)&&L.u(this.startY,e.startY)&&L.u(this.endX,e.endX)&&L.u(this.endY,e.endY)}jL(e){if(1!==this.type||4!==e.type)return!1;if(1===e.figures.count){const t=e.figures.elt(0);if(1===t.segments.count&&L.u(this.startX,t.startX)&&L.u(this.startY,t.startY)){const i=t.segments.elt(0);if(2===i.type&&L.u(this.endX,i.endX)&&L.u(this.endY,i.endY))return!0}}return!1}static stringify(e){return e.toString()}static stringifyFixed(e){return y.s(e,"number",Ct,"stringifyFixed:digits"),t=>t.toString(e)}fe(e){e in Ke?this.type=e:y.dr(this,e)}toString(e){void 0===e&&(e=-1);const t=s=>0===s?"0":s.toFixed(e);let i;switch(this.type){case 1:return e<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+t(this.startX)+" "+t(this.startY)+"L"+t(this.endX)+" "+t(this.endY);case 2:return i=new j(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0?"M"+i.x.toString()+" "+i.y.toString()+"H"+i.right.toString()+"V"+i.bottom.toString()+"H"+i.left.toString()+"z":"M"+t(i.x)+" "+t(i.y)+"H"+t(i.right)+"V"+t(i.bottom)+"H"+t(i.left)+"z";case 3:if(i=new j(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0){const r=i.left.toString()+" "+(i.y+i.height/2).toString(),a=i.right.toString()+" "+(i.y+i.height/2).toString();return"M"+r+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+a+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+r}{const r=t(i.left)+" "+t(i.y+i.height/2),a=t(i.right)+" "+t(i.y+i.height/2);return"M"+r+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+a+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+r}case 4:let s="";const n=this.figures.r,o=n.length;for(let r=0;r<o;r++){const a=n[r];r>0&&(s+=" x "),a.isFilled&&(s+="F "),s+=a.toString(e)}return s;default:return Ke[this.type]}}static fillPath(e){"string"!=typeof e&&y.si(e,"string",Ct,"fillPath:str");const t=e.split(/[Xx]/),i=t.length;let s="";for(let n=0;n<i;n++){const o=t[n];null===o.match(/[Ff]/)?s+=(0===n?"":"X ")+"F"+(" "===o[0]?"":" ")+o:s+=0===n?o:"X"+(" "===o[0]?"":" ")+o}return s}static fm="UuBbMmZzLlHhVvCcSsQqTtAaFfXx";static parse(e,t){void 0===t&&(t=!1),"string"!=typeof e&&y.si(e,"string",Ct,"parse:str");const i=new RegExp("(["+Ct.fm+"])(["+Ct.fm+"])","gm"),s=new RegExp("(["+Ct.fm+"])([^s])","gm"),n=new RegExp("([^s])(["+Ct.fm+"])","gm"),o=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/,/gm," ")).replace(i,"$1 $2")).replace(i,"$1 $2")).replace(s,"$1 $2")).replace(n,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2")).replace(/[\s\r\t\n]+/gm," ")).replace(/^\s+|\s+$/g,"")).split(" ");for(let F=0;F<o.length;F++){const E=o[F];if(null!==E.match(/(\.[0-9]*)(\.)/gm)){const B=y.nt();let Y="",W=!1;for(let $=0;$<E.length;$++){const K=E[$];"."!==K||W?"."===K?(B.push(Y),Y="."):Y+=K:(W=!0,Y+=K)}B.push(Y),o.splice(F,1);for(let $=0;$<B.length;$++)o.splice(F+$,0,B[$]);F+=B.length-1,y.Z(B)}}let r=-1,a="",l="";const h=new S(0,0),c=new S(0,0),u=new S(0,0);let d=!0;function f(){return r>=P-1||null!==o[r+1].match(T)||(d=!1,!1)}function p(){return r++,o[r]}function g(F){let E=parseFloat(p()),B=parseFloat(p());a===a.toLowerCase()&&(E=u.x+E,B=u.y+B),F.e(E,B)}function b(){return g(u),u}function x(){return g(c),c}function v(){const F=l.toLowerCase();return"c"===F||"s"===F||"q"===F||"t"===F?new S(2*u.x-c.x,2*u.y-c.y):new S(u.x,u.y)}const P=o.length,w=Ni.qL(null);let M=!1,C=!1,N=!1,I=!0;const T=new RegExp("["+Ct.fm+"]");for(;!(r>=P-1);){if(l=a,a=p(),""===a)continue;d=!0;let F=!1;switch(a.toUpperCase()){case"X":I=!0,M=!1,C=!1;break;case"M":const E=b();for(null===w.Ne||!0===I?(w.Au(E.x,E.y,M,!1,!C,N),I=!1):w.$F(E.x,E.y),h.h(u);!f();){const B=b();w.Ks(B.x,B.y)}break;case"L":for(;!f();){const B=b();w.Ks(B.x,B.y)}d&&(F=!0);break;case"H":for(;!f();)u.e((a===a.toLowerCase()?u.x:0)+parseFloat(p()),u.y),w.Ks(u.x,u.y);break;case"V":for(;!f();)u.e(u.x,(a===a.toLowerCase()?u.y:0)+parseFloat(p())),w.Ks(u.x,u.y);d&&(F=!0);break;case"C":for(;!f();){const B=new S;g(B);const Y=x(),W=b();w.xr(B.x,B.y,Y.x,Y.y,W.x,W.y)}d&&(F=!0);break;case"S":for(;!f();){const B=v(),Y=x(),W=b();w.xr(B.x,B.y,Y.x,Y.y,W.x,W.y)}d&&(F=!0);break;case"Q":for(;!f();){const B=x(),Y=b();w.Tu(B.x,B.y,Y.x,Y.y)}d&&(F=!0);break;case"T":for(;!f();){const B=v();c.h(B);const Y=b();w.Tu(B.x,B.y,Y.x,Y.y),c.h(Y)}d&&(F=!0);break;case"B":for(;!f();){const B=parseFloat(p()),Y=parseFloat(p());let W=parseFloat(p()),$=parseFloat(p());const K=parseFloat(p());let Z=K,it=!1;f()||(Z=parseFloat(p()),f()||(it=0!==parseFloat(p()))),a===a.toLowerCase()&&(W+=u.x,$+=u.y),w.ZF(B,Y,W,$,K,Z,it)}d&&(F=!0);break;case"A":for(;!f();){const B=Math.abs(parseFloat(p())),Y=Math.abs(parseFloat(p())),W=parseFloat(p());let $=!1,K=!1,Z=0,it=0;const yt=p();1===yt.length?($=!!parseFloat(yt),K=!!parseFloat(p()),Z=parseFloat(p()),it=parseFloat(p())):2===yt.length?($=!!parseFloat(yt[0]),K=!!parseFloat(yt[1]),Z=parseFloat(p()),it=parseFloat(p())):($=!!parseFloat(yt[0]),K=!!parseFloat(yt[1]),Z=parseFloat(yt.slice(2)),it=parseFloat(p())),a===a.toLowerCase()&&(Z=u.x+Z,it=u.y+it),u.e(Z,it),w.QF(B,Y,W,$,K,Z,it)}d&&(F=!0);break;case"Z":w._F(),u.h(h);break;case"F":{let B="",Y=1;for(;o[r+Y];)if("0"!==o[r+Y])if(null===o[r+Y].match(/[Uu]/)){if(null!==o[r+Y].match(T)){B=o[r+Y];break}Y++}else Y++;else N=!0,Y++;B.match(/[Mm]/)?M=!0:w.tR();break}case"U":{let B="",Y=1;for(;o[r+Y];)if(null===o[r+Y].match(/[Ff]/)){if(null!==o[r+Y].match(T)){B=o[r+Y];break}Y++}else Y++;B.match(/[Mm]/)?C=!0:w.eR(!1);break}default:if("0"===a||"1"===a)break;y.ne("Unknown geometry command: "+a)}if(F){y.ne(`Bad geometry command: ${a}, next token: ${p()},\nstring: ${e}`);break}}const D=w.um;if(Ni.WL(w),t){const F=D.figures.iterator;for(;F.next();)F.value.isFilled=!0}return D}static JL(e,t){const i=e.length,s=S.l();for(let n=0;n<i;n++){const o=e[n];s.x=o[0],s.y=o[1],t.gt(s),o[0]=s.x,o[1]=s.y,s.x=o[2],s.y=o[3],t.gt(s),o[2]=s.x,o[3]=s.y,s.x=o[4],s.y=o[5],t.gt(s),o[4]=s.x,o[5]=s.y,s.x=o[6],s.y=o[7],t.gt(s),o[6]=s.x,o[7]=s.y}S.i(s)}UP(){if(this.yt)return!0;if(4===this.type){if(this.hm!==this.figures.rt)return!0;const t=this.figures.r,i=t.length;for(let s=0;s<i;s++)if(t[s].UP())return!0}return!1}cx(){if(this.yt=!1,this.Pc=null,this.Cu=null,this.Lu=NaN,4===this.type){this.hm=this.figures.rt;const i=this.figures.r,s=i.length;for(let n=0;n<s;n++)i[n].iR()}const e=this.cm;isNaN(this.Sc)||isNaN(this.Mc)?e.e(0,0,0,0):e.e(0,0,this.Sc,this.Mc),this.$L(e,!1),e.re(0,0,0,0)}computeBoundsWithoutOrigin(){const e=new j;return this.$L(e,!0),e}$L(e,t){switch(this.type){case 1:case 2:case 3:t?e.e(this.Li,this.Ai,0,0):e.re(this.Li,this.Ai,0,0),e.re(this.ni,this.oi,0,0);break;case 4:const i=this.figures,s=i.r,n=i.length;for(let o=0;o<n;o++){const r=s[o];t&&0===o?e.e(r.startX,r.startY,0,0):e.re(r.startX,r.startY,0,0);const a=r.segments.r,l=a.length;let h=r.startX,c=r.startY;for(let u=0;u<l;u++){const d=a[u];switch(d.type){case 2:case 1:h=d.endX,c=d.endY,e.re(h,c,0,0);break;case 3:L.Nu(h,c,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,e),h=d.endX,c=d.endY;break;case 4:L.EP(h,c,d.point1X,d.point1Y,d.endX,d.endY,.5,e),h=d.endX,c=d.endY;break;case 5:case 6:const f=5===d.type?d.Fo(r):d.Za(r,h,c),p=f.length;if(0===p){h=5===d.type?d.centerX:d.endX,c=5===d.type?d.centerY:d.endY,e.re(h,c,0,0);break}let g=null;for(let b=0;b<p;b++)g=f[b],L.Nu(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],.5,e);null!==g&&(h=g[6],c=g[7]);break;default:y.o("Unknown Segment type: "+d.type)}}}break;default:y.o("Unknown Geometry type: "+this.type)}}sR(e,t){const i=this.bounds;let s=e/i.width,n=t/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),1===s&&1===n?this:this.copy().scale(s,n)}normalize(){this.f&&y.L(this);const e=this.computeBoundsWithoutOrigin();return this.offset(-e.x,-e.y),new S(-e.x,-e.y)}offset(e,t){return this.f&&y.L(this),this.v(1,0,0,1,e,t),this}scale(e,t){return this.f&&y.L(this),this.v(e,0,0,t,0,0),this}rotate(e,t,i){this.f&&y.L(this),void 0===t&&(t=0),void 0===i&&(i=0);const s=Ot.l();return s.Ue(),s.ks(e,t,i),this.v(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),Ot.i(s),this}v(e,t,i,s,n,o){let r=0,a=0;switch(this.type){case 1:case 2:case 3:r=this.Li,a=this.Ai,this.Li=r*e+a*i+n,this.Ai=r*t+a*s+o,r=this.ni,a=this.oi,this.ni=r*e+a*i+n,this.oi=r*t+a*s+o;break;case 4:const l=this.figures.r,h=l.length;for(let c=0;c<h;c++){const u=l[c];r=u.startX,a=u.startY,u.startX=r*e+a*i+n,u.startY=r*t+a*s+o;const d=u.segments.r,f=d.length;for(let p=0;p<f;p++){const g=d[p];switch(g.type){case 2:case 1:r=g.endX,a=g.endY,g.endX=r*e+a*i+n,g.endY=r*t+a*s+o;break;case 3:r=g.point1X,a=g.point1Y,g.point1X=r*e+a*i+n,g.point1Y=r*t+a*s+o,r=g.point2X,a=g.point2Y,g.point2X=r*e+a*i+n,g.point2Y=r*t+a*s+o,r=g.endX,a=g.endY,g.endX=r*e+a*i+n,g.endY=r*t+a*s+o;break;case 4:r=g.point1X,a=g.point1Y,g.point1X=r*e+a*i+n,g.point1Y=r*t+a*s+o,r=g.endX,a=g.endY,g.endX=r*e+a*i+n,g.endY=r*t+a*s+o;break;case 5:if(r=g.centerX,a=g.centerY,g.centerX=r*e+a*i+n,g.centerY=r*t+a*s+o,0!==t){let b=180*Math.atan2(t,e)/Math.PI;b<0&&(b+=360),g.startAngle+=b}e<0&&(g.startAngle=180-g.startAngle,g.sweepAngle=-g.sweepAngle),s<0&&(g.startAngle=-g.startAngle,g.sweepAngle=-g.sweepAngle),g.radiusX*=Math.sqrt(e*e+i*i),void 0!==g.radiusY&&(g.radiusY*=Math.sqrt(t*t+s*s));break;case 6:if(r=g.endX,a=g.endY,g.endX=r*e+a*i+n,g.endY=r*t+a*s+o,0===g.radiusX||0===g.radiusY)break;if(0!==t){let b=180*Math.atan2(t,e)/Math.PI;b<0&&(b+=360),g.xAxisRotation+=b}e<0&&(g.xAxisRotation=180-g.xAxisRotation,g.isClockwiseArc=!g.isClockwiseArc),s<0&&(g.xAxisRotation=-g.xAxisRotation,g.isClockwiseArc=!g.isClockwiseArc),g.radiusX*=Math.sqrt(e*e+i*i),g.radiusY*=Math.sqrt(t*t+s*s);break;default:y.o("Unknown Segment type: "+g.type)}}}}return this.yt=!0,this}containsPoint(e,t){void 0===t&&(t=0);const i=this.Li,s=this.Ai,n=this.ni,o=this.oi;switch(this.type){case 1:return L.Ve(i,s,n,o,t,e.x,e.y);case 2:{const r=Math.min(i,n)-t,a=Math.min(s,o)-t,l=Math.abs(n-i)+2*t,h=Math.abs(o-s)+2*t,c=j.z(r,a,l,h),u=c.containsPoint(e);return j.i(c),u}case 3:{let r=Math.min(i,n)-t,a=Math.min(s,o)-t;const c=(Math.abs(n-i)+2*t)/2,u=(Math.abs(o-s)+2*t)/2;return!(c<=0||u<=0)&&(r=e.x-(r+c),a=e.y-(a+u),r*r/(c*c)+a*a/(u*u)<=1)}case 4:return this.VP(e,t,!0,!1);default:return!1}}VP(e,t,i,s){const n=e.x,o=e.y,r=this.bounds.x-20,a=o;let l=0,h=0,c=0,u=0,d=0,f=0;const p=this.figures.r,g=p.length;for(let b=0;b<g;b++){const x=p[b],v=!x.isEvenOdd;if(!x.isFilled){if(x.BP(n,o,s?t:t+2))return!0;continue}if(i&&x.BP(n,o,t))return!0;const P=x.segments;h=x.startX,c=x.startY;let w=h,M=c;const C=P.r;let N=C[0];for(let I=0;I<=P.length;I++){let T;switch(I!==P.length?(N=C[I],T=N.type,d=N.endX,f=N.endY):(T=2,d=w,f=M),T){case 1:{const D=this.fx(n,o,r,a,h,c,w,M);if(isNaN(D))return!0;l+=D,w=d,M=f;break}case 2:{const D=this.fx(n,o,r,a,h,c,d,f);if(isNaN(D))return!0;l+=D;break}case 3:u=L.rm(h,c,N.point1X,N.point1Y,N.point2X,N.point2Y,d,f,r,a,n,o,.5),l+=u;break;case 4:u=L.rm(h,c,(h+2*N.point1X)/3,(c+2*N.point1Y)/3,(2*N.point1X+d)/3,(2*N.point1Y+f)/3,d,f,r,a,n,o,.5),l+=u;break;case 5:case 6:{const D=5===N.type?N.Fo(x):N.Za(x,h,c),F=D.length;if(0===F){const B=this.fx(n,o,r,a,h,c,5===N.type?N.centerX:N.endX,5===N.type?N.centerY:N.endY);if(isNaN(B))return!0;l+=B;break}let E=null;for(let B=0;B<F;B++){if(E=D[B],0===B){const Y=this.fx(n,o,r,a,h,c,E[0],E[1]);if(isNaN(Y))return!0;l+=Y}u=L.rm(E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],r,a,n,o,.5),l+=u}null!==E&&(d=E[6],f=E[7]);break}default:y.o("Unknown Segment type: "+N.type)}h=d,c=f}if(v){if(0!==l)return!0}else if(l%2!=0)return!0;l=0}return!1}fx(e,t,i,s,n,o,r,a){if(L.Ve(n,o,r,a,.05,e,t))return NaN;const l=(e-i)*(o-a);if(0===l)return 0;const h=((e*s-t*i)*(n-r)-(e-i)*(n*a-o*r))/l,c=(e*s-t*i)*(o-a)/l;if(h>=e)return 0;if((n>r?n-r:r-n)<(o>a?o-a:a-o)){if(o<a){if(c<o||c>a)return 0}else if(c<a||c>o)return 0}else if(n<r){if(h<n||h>r)return 0}else if(h<r||h>n)return 0;return l>0?1:-1}ZL(e,t,i){const s=this.figures.r,n=s.length;for(let o=0;o<n;o++)if(s[o].BP(e,t,i))return!0;return!1}getPointAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),void 0===t&&(t=new S),1===this.type)return t.e(this.startX+e*(this.endX-this.startX),this.startY+e*(this.endY-this.startY)),t;const i=this.flattenedSegments,s=this.flattenedLengths,o=i.length,r=this.flattenedTotalLength*e;let a=0;for(let l=0;l<o;l++){const h=s[l],c=h.length;for(let u=0;u<c;u++){const d=h[u];if(a+d>=r){const p=0===d?0:(r-a)/d,g=i[l],b=g[2*u],x=g[2*u+1];return t.e(b+(g[2*u+2]-b)*p,x+(g[2*u+3]-x)*p),t}a+=d}}return t}getAngleAlongPath(e){if(e<0?e=0:e>1&&(e=1),1===this.type)return 180*Math.atan2(this.endY-this.startY,this.endX-this.startX)/Math.PI;const t=this.flattenedSegments,i=this.flattenedLengths,n=t.length,o=this.flattenedTotalLength*e;let r=0;for(let a=0;a<n;a++){const l=i[a],h=l.length;for(let c=0;c<h;c++){const u=l[c];if(r+u>=o){const d=t[a],f=d[2*c],p=d[2*c+1],g=d[2*c+2],b=d[2*c+3];return Math.abs(g-f)<1&&Math.abs(b-p)<1?0:Math.abs(g-f)<1?b-p>=0?90:270:Math.abs(b-p)<1?g-f>=0?0:180:180*Math.atan2(b-p,g-f)/Math.PI}r+=u}}return NaN}getPointAndAngleAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),void 0===t&&(t=[]),t.length=3,1===this.type)return t[0]=this.startX+e*(this.endX-this.startX),t[1]=this.startY+e*(this.endY-this.startY),t[2]=180*Math.atan2(this.endY-this.startY,this.endX-this.startX)/Math.PI,t;const i=this.flattenedSegments,s=this.flattenedLengths,o=i.length,r=this.flattenedTotalLength*e;let a=0;for(let l=0;l<o;l++){const h=s[l],c=h.length;for(let u=0;u<c;u++){const d=h[u];if(a+d>=r){const p=0===d?0:(r-a)/d,g=i[l],b=g[2*u],x=g[2*u+1],v=g[2*u+2],P=g[2*u+3];let w;return t[0]=b+(v-b)*p,t[1]=x+(P-x)*p,w=Math.abs(v-b)<1&&Math.abs(P-x)<1?0:Math.abs(v-b)<1?P-x>=0?90:270:Math.abs(P-x)<1?v-b>=0?0:180:180*Math.atan2(P-x,v-b)/Math.PI,t[2]=w,t}a+=d}}return t}getFractionForPoint(e){if(1===this.type){const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=e.x,r=e.y;let a=0,l=0;if(t===s)return i<n?(a=i,l=n):(a=n,l=i),r<=a?a===i?0:1:r>=l?l===i?0:1:Math.abs(r-i)/(l-a);if(i===n)return t<s?(a=t,l=s):(a=s,l=t),o<=a?a===t?0:1:o>=l?l===t?0:1:Math.abs(o-t)/(l-a);{const h=(s-t)**2+(n-i)**2,c=S.l();L.Nl(t,i,s,n,o,r,c);const u=c.x,d=c.y;return S.i(c),Math.sqrt(((u-t)**2+(d-i)**2)/h)}}}if(2!==this.type){const t=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=S.l();let o=1/0,r=0,a=0;const l=t.length;let h=0,c=0;for(let d=0;d<l;d++){const f=t[d],p=i[d],g=f.length;for(let b=0;b<g;b+=2){const x=f[b],v=f[b+1];if(0===b){h=x,c=v;continue}L.Nl(h,c,x,v,e.x,e.y,n);const P=(n.x-e.x)**2+(n.y-e.y)**2;P<o&&(o=P,r=a,r+=Math.sqrt((n.x-h)**2+(n.y-c)**2)),a+=p[(b-2)/2],h=x,c=v}}S.i(n);const u=r/s;return u<0?0:u>1?1:u}{const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=s-t,r=n-i,a=2*o+2*r;let l=e.x,h=e.y;l=Math.min(Math.max(l,t),s),h=Math.min(Math.max(h,i),n);const c=Math.abs(l-t),u=Math.abs(l-s),d=Math.abs(h-i),f=Math.abs(h-n),p=Math.min(c,u,d,f);if(p===d)return l/a;if(p===u)return(o+h)/a;if(p===f)return(2*o+r-l)/a;if(p===c)return(2*o+2*r-h)/a}}return 0}get flattenedSegments(){return this.QL(),this.Pc}QL(){if(null===this.Pc){const e=this.Pc=[],t=this.Cu=[];this.nR(e,t)}}get flattenedLengths(){return this.QL(),this.Cu}get flattenedTotalLength(){let e=this.Lu;if(isNaN(e)){if(1===this.type){const t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=Math.sqrt(t*t+i*i)}else if(2===this.type)e=2*Math.abs(this.endX-this.startX)+2*Math.abs(this.endY-this.startY);else{const t=this.flattenedLengths,i=t.length;e=0;for(let s=0;s<i;s++){const n=t[s],o=n.length;for(let r=0;r<o;r++)e+=n[r]}}this.Lu=e}return e}zP(e){const t=[];let i=0,s=0;const n=e.length;for(let o=0;o<n;o+=2){const r=e[o],a=e[o+1];if(0===o){i=r,s=a;continue}const l=Math.sqrt(S.distanceSquared(i,s,r,a));t.push(l),i=r,s=a}return t}nR(e,t){let i=[];const s=[];if(1===this.type)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.endY),e.push(i),s.push(Math.sqrt((this.startX-this.endX)**2+(this.startY-this.endY)**2)),t.push(s);else if(2===this.type)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.startY),i.push(this.endX),i.push(this.endY),i.push(this.startX),i.push(this.endY),i.push(this.startX),i.push(this.startY),e.push(i),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),t.push(s);else if(3===this.type){const n=new Ht;n.startX=this.endX,n.startY=(this.startY+this.endY)/2;const o=new St(5);o.startAngle=0,o.sweepAngle=360,o.centerX=(this.startX+this.endX)/2,o.centerY=(this.startY+this.endY)/2,o.radiusX=Math.abs(this.startX-this.endX)/2,o.radiusY=Math.abs(this.startY-this.endY)/2,n.add(o);const r=o.Fo(n),a=r.length;if(0===a)i.push(o.centerX),i.push(o.centerY);else{let l=n.startX,h=n.startY;for(let c=0;c<a;c++){const u=r[c];L.Wn(l,h,u[2],u[3],u[4],u[5],u[6],u[7],.5,i),l=u[6],h=u[7]}}e.push(i),t.push(this.zP(i))}else{const n=this.figures.iterator;for(;n.next();){const o=n.value;i=[],i.push(o.startX),i.push(o.startY);let r=o.startX,a=o.startY,l=r,h=a;const c=o.segments.r,u=c.length;for(let d=0;d<u;d++){const f=c[d];switch(f.type){case 1:i.length>=4&&(e.push(i),t.push(this.zP(i))),i=[],i.push(f.endX),i.push(f.endY),r=f.endX,a=f.endY,l=r,h=a;break;case 2:i.push(f.endX),i.push(f.endY),r=f.endX,a=f.endY;break;case 3:L.Wn(r,a,f.point1X,f.point1Y,f.point2X,f.point2Y,f.endX,f.endY,.5,i),r=f.endX,a=f.endY;break;case 4:L.nm(r,a,f.point1X,f.point1Y,f.endX,f.endY,.5,i),r=f.endX,a=f.endY;break;case 5:{const p=f.Fo(o),g=p.length;if(0===g){i.push(f.centerX),i.push(f.centerY),r=f.centerX,a=f.centerY;break}for(let b=0;b<g;b++){const x=p[b];L.Wn(r,a,x[2],x[3],x[4],x[5],x[6],x[7],.5,i),r=x[6],a=x[7]}break}case 6:{const p=f.Za(o,r,a),g=p.length,b=f.endX,x=f.endY;if(0===g){i.push(b),i.push(x),r=b,a=x;break}for(let v=0;v<g;v++){const P=p[v];L.Wn(r,a,P[2],P[3],P[4],P[5],P[6],P[7],.5,i),r=P[6],a=P[7]}break}default:y.o("Segment not of valid type: "+f.type)}f.isClosed&&(i.push(l),i.push(h))}i.length>=4&&(e.push(i),t.push(this.zP(i)))}}}get type(){return this.W}set type(e){this.W!==e&&(this.f&&y.L(this,e),this.W=e,4===e?this.Ys=new H:(null===Ct.hx&&(Ct.hx=(new H).k()),this.Ys=Ct.hx),this.yt=!0)}get startX(){return this.Li}set startX(e){this.Li!==e&&(this.f&&y.L(this,e),this.Li=e,this.yt=!0)}get startY(){return this.Ai}set startY(e){this.Ai!==e&&(this.f&&y.L(this,e),this.Ai=e,this.yt=!0)}get endX(){return this.ni}set endX(e){this.ni!==e&&(this.f&&y.L(this,e),this.ni=e,this.yt=!0)}get endY(){return this.oi}set endY(e){this.oi!==e&&(this.f&&y.L(this,e),this.oi=e,this.yt=!0)}get figures(){return this.Ys}set figures(e){this.Ys!==e&&(this.f&&y.L(this,e),this.Ys=e,this.yt=!0)}add(e){return this.Ys.add(e),this}setSpots(e,t,i,s,n,o,r,a){return this.f&&y.L(this),this.$n=new A(e,t,n,o),this.Zn=new A(i,s,r,a),this}get spot1(){return this.$n}set spot1(e){this.f&&y.L(this,e),this.$n=e.N()}get spot2(){return this.Zn}set spot2(e){this.f&&y.L(this,e),this.Zn=e.N()}get defaultStretch(){return this.Qn}set defaultStretch(e){this.Qn=e}get bounds(){return this.UP()&&this.cx(),this.cm}polygonClosestSegment(e,t){if(void 0===t&&(t=10),4!==this.type)return null;const i=e.x,s=e.y;let n=1/0,o=0,r=0,a=0,l=0,h=0,c=0,u=0,d=0;return this.figures.each(f=>{let p=f.startX,g=f.startY;f.segments.each(b=>{let x=b.endX,v=b.endY,P=0;if(2!==b.type)return p=b.endX,void(g=b.endY);P=S.distanceLineSegmentSquared(i,s,p,g,x,v),P<n&&(n=P,o=a,r=l,h=p,c=g,u=x,d=v),p=x,g=v,l++,b.isClosed&&(x=f.startX,v=f.startY,P=S.distanceLineSegmentSquared(i,s,p,g,x,v),P<n&&(n=P,o=a,r=l,h=p,c=g,u=x,d=v),l++)}),a++,l=0}),n<t*t?{figi:o,segi:r,ax:h,ay:c,bx:u,by:d}:null}get polygonArea(){if(4===this.type){const e=this.figures.iterator;let t=0,i=0,s=0,n=0,o=0;for(;e.next();){const r=e.value;if(!r.isFilled)continue;t=r.startX,i=r.startY;const a=r.segments.iterator;for(;a.next();){const l=a.value;s=l.endX,n=l.endY,1===l.type||5!==l.type&&(o+=t*n-i*s),t=s,i=n}o+=t*r.startY-i*r.startX}return Math.abs(o)/2}if(2===this.type)return Math.abs(this.startX-this.endX)*Math.abs(this.startY-this.endY);if(3===this.type){const e=Math.abs(this.startX-this.endX),t=Math.abs(this.startY-this.endY);return Math.PI*e/2*t/2}return 0}get polygonLength(){if(4===this.type){const e=this.figures.iterator;let t=0,i=0,s=0,n=0,o=0;for(;e.next();){const r=e.value;t=r.startX,i=r.startY;const a=r.segments.iterator;for(;a.next();){const h=a.value;s=h.endX,n=h.endY,1===h.type||5!==h.type&&(o+=Math.sqrt((s-t)*(s-t)+(n-i)*(n-i))),t=s,i=n}const l=r.segments.last();l&&l.isClosed&&(s=r.startX,n=r.startY,o+=Math.sqrt((s-t)*(s-t)+(n-i)*(n-i)))}return o}if(2===this.type)return 2*Math.abs(this.startX-this.endX)+2*Math.abs(this.startY-this.endY);if(3===this.type){const e=Math.abs(this.startX-this.endX)/2,t=Math.abs(this.startY-this.endY)/2;if(e+t===0)return 0;const i=(e-t)*(e-t)/((e+t)*(e+t));let s=i,n=1+s/4;return s*=i,n+=s/64,s*=i,n+=s/256,s*=i,n+=25*s/16384,s*=i,n+=49*s/65536,s*=i,n+=441*s/1048576,Math.PI*(e+t)*n}{const e=this.startX,t=this.startY,i=this.endX,s=this.endY;return Math.sqrt((i-e)*(i-e)+(s-t)*(s-t))}}static computeConvexHull(e){e.sort((s,n)=>s.x===n.x?n.y-s.y:n.x-s.x);const t=[];for(let s=0;s<e.length;s++){for(;t.length>=2&&e[s].compareWithLineSegmentPoint(t[t.length-2],t[t.length-1])>=0;)t.pop();t.push(e[s])}t.pop();const i=[];for(let s=e.length-1;s>=0;s--){for(;i.length>=2&&e[s].compareWithLineSegmentPoint(i[i.length-2],i[i.length-1])>=0;)i.pop();i.push(e[s])}return i.pop(),t.concat(i)}static generatePolygon(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!0);const s=new Ct;if(e.length>1)if(t>0)if(i){e.push(e[0]),e.push(e[1]);let n=!0;const o=new Ht(0,0,i,!1);for(let a=1;a<e.length;a++){const l=(e[a-1].x+e[a].x)/2,h=(e[a-1].y+e[a].y)/2,c=e[a-1].distanceSquaredPoint(e[a]),u=.5*t/Math.sqrt(c);if(u<.5){const d=e[a-1].x+(e[a].x-e[a-1].x)*u,f=e[a-1].y+(e[a].y-e[a-1].y)*u;n?(n=!1,o.startX=d,o.startY=f):o.add(new St(3,d,f,e[a-1].x,e[a-1].y,e[a-1].x,e[a-1].y)),a<e.length-1&&o.add(new St(2,e[a].x+(e[a-1].x-e[a].x)*u,e[a].y+(e[a-1].y-e[a].y)*u))}else n?(n=!1,o.startX=l,o.startY=h):o.add(new St(3,l,h,e[a-1].x,e[a-1].y,e[a-1].x,e[a-1].y))}const r=o.segments.last();r&&r.close(),s.add(o)}else{const n=new Ht(e[0].x,e[0].y,!1,!1);for(let o=1;o<e.length;o++){const r=(e[o-1].x+e[o].x)/2,a=(e[o-1].y+e[o].y)/2,l=e[o-1].distanceSquaredPoint(e[o]),h=.5*t/Math.sqrt(l);h<.5?(o>1&&n.add(new St(3,e[o-1].x+(e[o].x-e[o-1].x)*h,e[o-1].y+(e[o].y-e[o-1].y)*h,e[o-1].x,e[o-1].y,e[o-1].x,e[o-1].y)),n.add(new St(2,e[o].x+(e[o-1].x-e[o].x)*h,e[o].y+(e[o-1].y-e[o].y)*h))):o>1&&n.add(new St(3,r,a,e[o-1].x,e[o-1].y,e[o-1].x,e[o-1].y)),o===e.length-1&&n.add(new St(2,e[o].x,e[o].y))}s.add(n)}else{const n=new Ht(e[0].x,e[0].y,i,!1);for(let o=1;o<e.length;o++)n.add(new St(2,e[o].x,e[o].y));if(i){const o=n.segments.last();o&&o.close()}s.add(n)}return s}}Ct.stringify=Ct.stringify,Ct.stringifyFixed=Ct.stringifyFixed,Ct.fillPath=Ct.fillPath,Ct.parse=Ct.parse;class Ht{n;Li;Ai;Nc;dm;ji;constructor(e,t,i,s,n){void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===n&&(n=!1),this.n=2|(i?4:0)|(s?8:0)|(n?16:0),this.Li=void 0!==e?e:0,this.Ai=void 0!==t?t:0,this.Nc=new H,this.dm=this.Nc.rt,this.ji=null}copy(){const e=new Ht;e.n=-2&this.n,e.Li=this.Li,e.Ai=this.Ai;const t=this.Nc.r,i=t.length,s=e.Nc;for(let n=0;n<i;n++){const o=t[n].copy();s.add(o)}return e.dm=this.dm,e.ji=this.ji,e}equalsApprox(e){if(!(e instanceof Ht&&L.u(this.startX,e.startX)&&L.u(this.startY,e.startY)))return!1;const t=this.segments.r,i=e.segments.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++)if(!t[n].equalsApprox(i[n]))return!1;return!0}toString(e){void 0===e&&(e=-1);let t="";if(e<0)t="M"+this.startX.toString()+" "+this.startY.toString();else{const n=o=>0===o?"0":o.toFixed(e);t="M"+n(this.startX)+" "+n(this.startY)}const i=this.segments.r,s=i.length;for(let n=0;n<s;n++)t+=" "+i[n].toString(e);return t}get f(){return!!(1&this.n)}set f(e){e?this.n|=1:this.n&=-2}get yt(){return!!(2&this.n)}set yt(e){e?this.n|=2:this.n&=-3}k(){this.f=!0;const e=this.segments;e.k();const t=e.r,i=e.length;for(let s=0;s<i;s++)t[s].k();return this}UP(){if(this.yt)return!0;const e=this.segments;if(this.dm!==e.rt)return!0;for(const t of e)if(t.yt)return!0;return!1}iR(){this.yt=!1,this.ji=null;const e=this.segments;this.dm=e.rt;for(const t of e)t.yt=!1,t.Hs=null}get isFilled(){return!!(4&this.n)}set isFilled(e){this.f&&y.L(this,e),e?this.n|=4:this.n&=-5}get isShadowed(){return!!(8&this.n)}set isShadowed(e){this.f&&y.L(this,e),e?this.n|=8:this.n&=-9}get isEvenOdd(){return!!(16&this.n)}set isEvenOdd(e){this.f&&y.L(this,e),e?this.n|=16:this.n&=-17}get startX(){return this.Li}set startX(e){this.f&&y.L(this,e),this.Li=e,this.ji=null,this.yt=!0}get startY(){return this.Ai}set startY(e){this.f&&y.L(this,e),this.Ai=e,this.ji=null,this.yt=!0}get segments(){return this.Nc}set segments(e){this.f&&y.L(this,e),this.Nc=e,this.ji=null,this.yt=!0}add(e){return this.Nc.add(e),this.ji=null,this}BP(e,t,i){const s=this;let n=s.startX,o=s.startY,r=n,a=o;const l=s.segments.r,h=l.length;for(let c=0;c<h;c++){const u=l[c];switch(u.type){case 1:r=u.endX,a=u.endY,n=u.endX,o=u.endY;break;case 2:if(L.Ve(n,o,u.endX,u.endY,i,e,t))return!0;n=u.endX,o=u.endY;break;case 3:if(L.nx(n,o,u.point1X,u.point1Y,u.point2X,u.point2Y,u.endX,u.endY,.5,e,t,i))return!0;n=u.endX,o=u.endY;break;case 4:if(L.IP(n,o,u.point1X,u.point1Y,u.endX,u.endY,.5,e,t,i))return!0;n=u.endX,o=u.endY;break;case 5:case 6:const d=5===u.type?u.Fo(s):u.Za(s,n,o),f=d.length,p=5===u.type?u.centerX:u.endX,g=5===u.type?u.centerY:u.endY;if(0===f){if(L.Ve(n,o,p,g,i,e,t))return!0;n=p,o=g;break}let b=null;for(let x=0;x<f;x++)if(b=d[x],0===x&&L.Ve(n,o,b[0],b[1],i,e,t)||L.nx(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],.5,e,t,i))return!0;null!==b&&(n=b[6],o=b[7]);break;default:y.o("Unknown Segment type: "+u.type)}if(u.isClosed&&(n!==r||o!==a)&&L.Ve(n,o,r,a,i,e,t))return!0}return!1}}var ai=(m=>(m[m.Move=1]="Move",m[m.Line=2]="Line",m[m.Bezier=3]="Bezier",m[m.QuadraticBezier=4]="QuadraticBezier",m[m.Arc=5]="Arc",m[m.SvgArc=6]="SvgArc",m))(ai||{});let St=(()=>{class m{W;n;ni;oi;pn;Ll;Al;br;Hs;constructor(t,i,s,n,o,r,a,l){if(z.Je(this),void 0===t&&(t=2),this.W=t,this.n=2,this.ni=void 0!==i?i:0,this.oi=void 0!==s?s:0,void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=0),6===t){let h=r;h%=360,h<0&&(h+=360),this.pn=h,this.Ll=0,this.Al=Math.max(n,0),this.br=Math.max(o,0),"boolean"==typeof a?a&&(this.isLargeArc=!0):"number"==typeof a&&a&&(this.isLargeArc=!0),l&&(this.isClockwiseArc=!0)}else this.pn=n,this.Ll=o,5===t&&(r=Math.max(r,0)),this.Al=r,"number"==typeof a?(5===t&&(a=Math.max(a,0)),this.br=a):this.br=0;this.Hs=null}copy(){const t=new m;return t.W=this.W,t.n=-2&this.n,t.ni=this.ni,t.oi=this.oi,t.pn=this.pn,t.Ll=this.Ll,t.Al=this.Al,t.br=this.br,t}equalsApprox(t){if(!(t instanceof m)||this.type!==t.type||this.isClosed!==t.isClosed)return!1;switch(this.type){case 1:case 2:return L.u(this.endX,t.endX)&&L.u(this.endY,t.endY);case 3:return L.u(this.endX,t.endX)&&L.u(this.endY,t.endY)&&L.u(this.point1X,t.point1X)&&L.u(this.point1Y,t.point1Y)&&L.u(this.point2X,t.point2X)&&L.u(this.point2Y,t.point2Y);case 4:return L.u(this.endX,t.endX)&&L.u(this.endY,t.endY)&&L.u(this.point1X,t.point1X)&&L.u(this.point1Y,t.point1Y);case 5:return L.u(this.startAngle,t.startAngle)&&L.u(this.sweepAngle,t.sweepAngle)&&L.u(this.centerX,t.centerX)&&L.u(this.centerY,t.centerY)&&L.u(this.radiusX,t.radiusX)&&L.u(this.radiusY,t.radiusY);case 6:return this.isClockwiseArc===t.isClockwiseArc&&this.isLargeArc===t.isLargeArc&&L.u(this.xAxisRotation,t.xAxisRotation)&&L.u(this.endX,t.endX)&&L.u(this.endY,t.endY)&&L.u(this.radiusX,t.radiusX)&&L.u(this.radiusY,t.radiusY);default:return!1}}fe(t){t in ai?this.type=t:y.dr(this,t)}toString(t){void 0===t&&(t=-1);const i=n=>0===n?"0":n.toFixed(t);let s="";switch(this.type){case 1:s=t<0?"M"+this.endX.toString()+" "+this.endY.toString():"M"+i(this.endX)+" "+i(this.endY);break;case 2:s=t<0?"L"+this.endX.toString()+" "+this.endY.toString():"L"+i(this.endX)+" "+i(this.endY);break;case 3:s=t<0?"C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():"C"+i(this.point1X)+" "+i(this.point1Y)+" "+i(this.point2X)+" "+i(this.point2Y)+" "+i(this.endX)+" "+i(this.endY);break;case 4:s=t<0?"Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():"Q"+i(this.point1X)+" "+i(this.point1Y)+" "+i(this.endX)+" "+i(this.endY);break;case 5:s=t<0?"B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():"B"+i(this.startAngle)+" "+i(this.sweepAngle)+" "+i(this.centerX)+" "+i(this.centerY)+" "+i(this.radiusX)+" "+i(this.radiusY);break;case 6:s=t<0?"A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():"A"+i(this.radiusX)+" "+i(this.radiusY)+" "+i(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+i(this.endX)+" "+i(this.endY);break;default:s=ai[this.type]}return s+(this.isClosed?"z":"")}static Move=1;static Line=2;static Bezier=3;static QuadraticBezier=4;static Arc=5;static SvgArc=6;get f(){return!!(1&this.n)}set f(t){t?this.n|=1:this.n&=-2}get yt(){return!!(2&this.n)}set yt(t){t?this.n|=2:this.n&=-3}k(){return this.f=!0,this}close(){return this.isClosed=!0,this}Fo(t){if(null!==this.Hs&&!1===t.yt)return this.Hs;const i=this.radiusX;let s=this.radiusY;if(void 0===s&&(s=i),0===i||0===s)return this.Hs=[],this.Hs;const n=this.pn,o=this.Ll,r=L.KL(0,0,i<s?i:s,this.startAngle,this.startAngle+this.sweepAngle,!1);if(i!==s){const l=Ot.l();l.Ue(),i<s?l.it(1,s/i):l.it(i/s,1),Ct.JL(r,l),Ot.i(l)}const a=r.length;for(let l=0;l<a;l++){const h=r[l];h[0]+=n,h[1]+=o,h[2]+=n,h[3]+=o,h[4]+=n,h[5]+=o,h[6]+=n,h[7]+=o}return this.Hs=r,this.Hs}Za(t,i,s){if(null!==this.Hs&&!1===t.yt)return this.Hs;if(0===this.radiusX||0===this.radiusY)return this.Hs=[],this.Hs;const n=i,o=s;let r=this.Al,a=this.br;0===r&&(r=1e-4),0===a&&(a=1e-4);const l=this.pn*(Math.PI/180),h=this.isLargeArc,c=this.isClockwiseArc,u=this.ni,d=this.oi,f=Math.cos(l),p=Math.sin(l),g=f*(n-u)/2+p*(o-d)/2,b=-p*(n-u)/2+f*(o-d)/2,x=g*g/(r*r)+b*b/(a*a);x>1&&(r*=Math.sqrt(x),a*=Math.sqrt(x));let v=(h===c?-1:1)*Math.sqrt((r*r*a*a-r*r*b*b-a*a*g*g)/(r*r*b*b+a*a*g*g));isNaN(v)&&(v=0);let P=v*r*b/a,w=v*-a*g/r;isNaN(P)&&(P=0),isNaN(w)&&(w=0);const M=(n+u)/2+f*P-p*w,C=(o+d)/2+p*P+f*w,N=(at,ft)=>Math.sqrt(at*at+ft*ft),I=(at,ft,ut,kt)=>(at*ut+ft*kt)/(N(at,ft)*N(ut,kt)),T=(at,ft,ut,kt)=>(at*kt<ft*ut?-1:1)*Math.acos(I(at,ft,ut,kt)),D=T(1,0,(g-P)/r,(b-w)/a),F=(g-P)/r,E=(b-w)/a,B=(-g-P)/r,Y=(-b-w)/a;let W=T(F,E,B,Y);const $=I(F,E,B,Y);$<=-1?W=Math.PI:$>=1&&(W=0),!c&&W>0&&(W-=2*Math.PI),c&&W<0&&(W+=2*Math.PI);const Z=r>a?1:r/a,it=r>a?a/r:1,yt=L.KL(0,0,r>a?r:a,D,D+W,!0),ot=Ot.l();return ot.Ue(),ot.Gs(M,C),ot.ks(this.pn,0,0),ot.it(Z,it),Ct.JL(yt,ot),Ot.i(ot),this.Hs=yt,this.Hs}get isClosed(){return!!(8&this.n)}set isClosed(t){this.isClosed!==t&&(t?this.n|=8:this.n&=-9,this.yt=!0)}get type(){return this.W}set type(t){this.f&&y.L(this,t),this.W=t,this.yt=!0}get endX(){return this.ni}set endX(t){this.f&&y.L(this,t),this.ni=t,this.yt=!0}get endY(){return this.oi}set endY(t){this.f&&y.L(this,t),this.oi=t,this.yt=!0}get point1X(){return this.pn}set point1X(t){this.f&&y.L(this,t),this.pn=t,this.yt=!0}get point1Y(){return this.Ll}set point1Y(t){this.f&&y.L(this,t),this.Ll=t,this.yt=!0}get point2X(){return this.Al}set point2X(t){this.f&&y.L(this,t),this.Al=t,this.yt=!0}get point2Y(){return this.br}set point2Y(t){this.f&&y.L(this,t),this.br=t,this.yt=!0}get centerX(){return this.pn}set centerX(t){this.f&&y.L(this,t),this.pn=t,this.yt=!0}get centerY(){return this.Ll}set centerY(t){this.f&&y.L(this,t),this.Ll=t,this.yt=!0}get radiusX(){return this.Al}set radiusX(t){t<0&&y.J(t,">= zero",m,"radiusX"),this.f&&y.L(this,t),this.Al=t,this.yt=!0}get radiusY(){return this.br}set radiusY(t){t<0&&y.J(t,">= zero",m,"radiusY"),this.f&&y.L(this,t),this.br=t,this.yt=!0}get startAngle(){return this.ni}set startAngle(t){this.f&&y.L(this,t),(t%=360)<0&&(t+=360),this.ni=t,this.yt=!0}get sweepAngle(){return this.oi}set sweepAngle(t){this.f&&y.L(this,t),t>360&&(t=360),t<-360&&(t=-360),this.oi=t,this.yt=!0}get isClockwiseArc(){return!!(4&this.n)}set isClockwiseArc(t){this.f&&y.L(this,t),t?this.n|=4:this.n&=-5,this.yt=!0}get isLargeArc(){return!!(16&this.n)}set isLargeArc(t){this.f&&y.L(this,t),t?this.n|=16:this.n&=-17,this.yt=!0}get xAxisRotation(){return this.pn}set xAxisRotation(t){this.f&&y.L(this,t),(t%=360)<0&&(t+=360),this.pn=t,this.yt=!0}}return m})();class xe{a;ux;gx;gm;mm;pm;ym;wm;xm;bm;km;Pm;Sm;Mm;Ro;Nm;Cm;Ps;Ti;constructor(){this.a=null,this.ux=new S(0,0).k(),this.gx=new S(0,0).k(),this.gm=0,this.mm=0,this.pm=1,this.ym="",this.wm="",this.xm=!1,this.bm=!1,this.km=0,this.Pm=0,this.Sm=!1,this.Mm=!1,this.Ro=!1,this.Nm=null,this.Cm=0,this.Ps=null,this.Ti=null}copy(){const e=new xe;return this.clone(e)}clone(e){return e.a=this.a,e.ux.h(this.viewPoint),e.gx.h(this.documentPoint),e.gm=this.gm,e.mm=this.mm,e.pm=this.pm,e.ym=this.ym,e.wm=this.wm,e.xm=this.xm,e.bm=this.bm,e.km=this.km,e.Pm=this.Pm,e.Sm=this.Sm,e.Mm=this.Mm,e.Ro=this.Ro,e.Nm=this.Nm,e.Cm=this.Cm,e.Ps=this.Ps,e.Ti=this.Ti,e}toString(){let e="^";return 0!==this.modifiers&&(e+="M:"+this.modifiers),0!==this.button&&(e+="B:"+this.button),""!==this.key&&(e+="K:"+this.key),0!==this.clickCount&&(e+="C:"+this.clickCount),0!==this.delta&&(e+="D:"+this.delta),this.handled&&(e+="h"),this.bubbles&&(e+="b"),null!==this.documentPoint&&(e+="@"+this.documentPoint.toString()),e}get diagram(){return this.a}set diagram(e){this.a=e}get viewPoint(){return this.ux}set viewPoint(e){this.ux.h(e)}get documentPoint(){return this.gx}set documentPoint(e){this.gx.h(e)}getMultiTouchViewPoint(e,t){const i=this.diagram;return null===i||i._L(this.event,e,t),t}getMultiTouchDocumentPoint(e,t){const i=this.diagram;return null===i||(i._L(this.event,e,t),t.h(i.transformViewToDoc(t))),t}get modifiers(){return this.gm}set modifiers(e){this.gm=e}get button(){return this.mm}set button(e){if(this.mm=e,null===this.event)switch(e){case 0:return void(this.buttons=1);case 1:return void(this.buttons=4);case 2:return void(this.buttons=2)}}get buttons(){return this.pm}set buttons(e){this.pm=e}get key(){return this.ym}set key(e){this.ym=e}get code(){return this.wm}set code(e){this.wm=e}get down(){return this.xm}set down(e){this.xm=e}get up(){return this.bm}set up(e){this.bm=e}get clickCount(){return this.km}set clickCount(e){this.km=e}get delta(){return this.Pm}set delta(e){this.Pm=e}get isMultiTouch(){return this.Sm}set isMultiTouch(e){this.Sm=e}get handled(){return this.Mm}set handled(e){this.Mm=e}get bubbles(){return this.Ro}set bubbles(e){this.Ro=e}get event(){return this.Nm}set event(e){this.Nm=e}get isTouchEvent(){const e=this.event;return null!==e&&("touch"===e.pointerType||"pen"===e.pointerType)}get timestamp(){return this.Cm}set timestamp(e){this.Cm=e}get targetDiagram(){return this.Ps}set targetDiagram(e){this.Ps=e}get targetObject(){return this.Ti}set targetObject(e){this.Ti=e}get control(){return!!(1&this.modifiers)}set control(e){this.modifiers=e?1|this.modifiers:-2&this.modifiers}get shift(){return!!(4&this.modifiers)}set shift(e){this.modifiers=e?4|this.modifiers:-5&this.modifiers}get alt(){return!!(2&this.modifiers)}set alt(e){this.modifiers=e?2|this.modifiers:-3&this.modifiers}get meta(){return!!(8&this.modifiers)}set meta(e){this.modifiers=e?8|this.modifiers:-9&this.modifiers}get left(){const e=this.event;return null===e||"mousedown"!==e.type&&"mouseup"!==e.type&&"pointerdown"!==e.type&&"pointerup"!==e.type?!!(1&this.buttons):0===this.button}set left(e){e?this.buttons|=1:this.buttons&=-2}get right(){const e=this.event;return null===e||"mousedown"!==e.type&&"mouseup"!==e.type&&"pointerdown"!==e.type&&"pointerup"!==e.type?!!(2&this.buttons):2===this.button}set right(e){e?this.buttons|=2:this.buttons&=-3}get middle(){const e=this.event;return null===e||"mousedown"!==e.type&&"mouseup"!==e.type&&"pointerdown"!==e.type&&"pointerup"!==e.type?!!(4&this.buttons):1===this.button}set middle(e){e?this.buttons|=4:this.buttons&=-5}get commandKey(){const e=this.code,t=this.key;return"cxvyzagCXVYZAG".includes(t)?t.toLowerCase():"KeyC"===e?"c":"KeyX"===e?"x":"KeyV"===e?"v":"KeyY"===e?"y":"KeyZ"===e?"z":"KeyA"===e?"a":"KeyG"===e?"g":""!==e?e:t}}class vi{a;Pt;Lm;Am;constructor(){this.a=null,this.Pt="",this.Lm=null,this.Am=null}copy(){const e=new vi;return e.a=this.a,e.Pt=this.Pt,e.Lm=this.Lm,e.Am=this.Am,e}toString(){let e="*"+this.name;return null!==this.subject&&(e+=":"+this.subject.toString()),null!==this.parameter&&(e+="("+this.parameter.toString()+")"),e}get diagram(){return this.a}set diagram(e){this.a=e}get name(){return this.Pt}set name(e){this.Pt=e}get subject(){return this.Lm}set subject(e){this.Lm=e}get parameter(){return this.Am}set parameter(e){this.Am=e}}var Oi=(m=>(m[m.Transaction=1]="Transaction",m[m.Property=2]="Property",m[m.Insert=3]="Insert",m[m.Remove=4]="Remove",m))(Oi||{});let li=(()=>{class m{Du;Tm;yn;Ce;a;vu;Cc;Lc;Ac;Tc;constructor(){this.Du=2,this.Tm="",this.yn="",this.Ce=null,this.a=null,this.vu=null,this.Cc=null,this.Lc=null,this.Ac=null,this.Tc=null}static Transaction=1;static Property=2;static Insert=3;static Remove=4;clear(){this.Ce=null,this.a=null,this.vu=null,this.Cc=null,this.Lc=null,this.Ac=null,this.Tc=null}copy(){const t=new m;t.Du=this.Du,t.Tm=this.Tm,t.yn=this.yn,t.Ce=this.Ce,t.a=this.a,t.vu=this.vu;let i=this.Cc;return t.Cc=y.$(i)&&y.st(i.copyFrozen)?i.copyFrozen():i,i=this.Lc,t.Lc=y.$(i)&&y.st(i.copyFrozen)?i.copyFrozen():i,i=this.Ac,t.Ac=y.$(i)&&y.st(i.copyFrozen)?i.copyFrozen():i,i=this.Tc,t.Tc=y.$(i)&&y.st(i.copyFrozen)?i.copyFrozen():i,t}fe(t){t in Oi?this.change=t:y.dr(this,t)}toString(){let t="";return t+=1===this.change?"* ":2===this.change?null!==this.model?"!m":"!d":(null!==this.model?"!m":"!d")+this.change,this.propertyName&&"string"==typeof this.propertyName&&(t+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(t+=" "+this.modelChange),t+=": ",1===this.change?null!==this.oldValue&&(t+=" "+this.oldValue):(null!==this.object&&(t+=y.toString(this.object)),null!==this.oldValue&&(t+="  old: "+y.toString(this.oldValue)),null!==this.oldParam&&(t+=" "+this.oldParam),null!==this.newValue&&(t+="  new: "+y.toString(this.newValue)),null!==this.newParam&&(t+=" "+this.newParam)),t}getValue(t){return t?this.oldValue:this.newValue}getParam(t){return t?this.oldParam:this.newParam}canUndo(){return null!==this.model||null!==this.diagram}undo(){this.canUndo()&&(null!==this.model?this.model.changeState(this,!0):null!==this.diagram&&this.diagram.tA(this,!0))}canRedo(){return null!==this.model||null!==this.diagram}redo(){this.canRedo()&&(null!==this.model?this.model.changeState(this,!1):null!==this.diagram&&this.diagram.tA(this,!1))}get model(){return this.Ce}set model(t){this.Ce=t}get diagram(){return this.a}set diagram(t){this.a=t}get change(){return this.Du}set change(t){this.Du=t}get modelChange(){return this.Tm}set modelChange(t){this.Tm=t}get propertyName(){return this.yn}set propertyName(t){this.yn=t}get isTransactionFinished(){return 1===this.Du&&("CommittedTransaction"===this.yn||"FinishedUndo"===this.yn||"FinishedRedo"===this.yn)}get object(){return this.vu}set object(t){this.vu=t}get oldValue(){return this.Cc}set oldValue(t){this.Cc=t}get oldParam(){return this.Lc}set oldParam(t){this.Lc=t}get newValue(){return this.Ac}set newValue(t){this.Ac=t}get newParam(){return this.Tc}set newParam(t){this.Tc=t}}return m})();class hi{eA;Pt;XP;constructor(){this.eA=(new H).k(),this.Pt="",this.XP=!1}toString(e){let t="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(void 0!==e&&e>0){const i=this.changes.count;for(let s=0;s<i;s++){const n=this.changes.elt(s);null!==n&&(t+="\n  "+n.toString())}}return t}clear(){const e=this.changes;e.ce();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);null!==i&&i.clear()}e.clear(),e.k()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let e=this.changes.count-1;e>=0;e--){const t=this.changes.elt(e);null!==t&&t.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;const e=this.changes.count;for(let t=0;t<e;t++){const i=this.changes.elt(t);null!==i&&i.redo()}}oR(e){const t=this.changes;for(let i=t.count-1;i>=e;i--){const s=t.elt(i);null!==s&&s.undo(),t.ce(),t.removeAt(i)}t.k()}thaw(){this.changes.ce()}optimize(){if(!this.isComplete)return;const e=this.changes;e.ce();const t=new Map;for(let s=0;s<e.count;s++){const n=e.elt(s);if(null===n||2!==n.change||!n.object)continue;let o=t.get(n.object);o||(o=new Map,t.set(n.object,o));const r=o.get(n.propertyName);void 0===r?o.set(n.propertyName,-1):(r>0&&e.setElt(r,null),o.set(n.propertyName,s))}let i=0;for(let s=0;s<e.count;s++){const n=e.elt(s);null!==n&&(s>i&&e.setElt(i,n),i++)}for(;e.length>i;)e.pop();e.k()}get changes(){return this.eA}get name(){return this.Pt}set name(e){this.Pt=e}get isComplete(){return this.XP}set isComplete(e){this.XP=e}}class Pi{mx;Be;iA;js;GP;Dm;Tl;YP;KP;wn;Dc;yx;qs;wx;xx;vm;kx;constructor(e){this.mx=new z,this.Be=!1,this.iA=(new H).k(),this.js=-1,this.GP=999,this.qs=!1,this.Dm=null,this.Tl=0,this.YP=!1,this.KP=23,this.wn=(new H).k(),this.Dc=new H,this.yx=!0,this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1,e&&Object.assign(this,e)}toString(e){let t="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;t+="[";let i=this.nestedTransactionNames.count;for(let s=0;s<i;s++)s>0&&(t+=" "),t+=this.nestedTransactionNames.elt(s);if(t+="]",void 0!==e&&e>0){i=this.history.count;for(let s=0;s<i;s++)t+="\n "+this.history.elt(s).toString(e-1)}return t}clear(){const e=this.history;e.ce();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);null!==i&&i.clear()}e.clear(),this.js=-1,e.k(),this.qs=!1,this.Dm=null,this.Tl=0,this.wn.ce(),this.wn.clear(),this.wn.k(),this.Dc.clear(),this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1}copyProperties(e){this.isEnabled=e.isEnabled,this.maxHistoryLength=e.maxHistoryLength,this.Fm=e.Fm}addModel(e){this.mx.add(e)}removeModel(e){this.mx.delete(e)}startTransaction(e){if(void 0===e&&(e=""),null===e&&(e=""),this.isUndoingRedoing)return!1;!0===this.yx&&(this.yx=!1,this.Tl++,this.Dl||this.vl("StartingFirstTransaction",e,this.currentTransaction),this.Tl>0&&this.Tl--),this.isEnabled&&(this.wn.ce(),this.wn.add(e),this.wn.k(),this.Dc.add(null===this.currentTransaction?0:this.currentTransaction.changes.count)),this.Tl++;const t=1===this.transactionLevel;return t&&(this.Dl||this.vl("StartedTransaction",e,this.currentTransaction)),t}commitTransaction(e){return void 0===e&&(e=""),this.sA(!0,e)}rollbackTransaction(){return this.sA(!1,"")}sA(e,t){if(this.isUndoingRedoing)return!1;this.Fm&&this.transactionLevel<1&&y.ne("Ending transaction without having started a transaction: "+t);const i=1===this.transactionLevel;let s=this.currentTransaction;i&&e&&(this.Dl||this.vl("CommittingTransaction",t,s));let n=0;if(this.transactionLevel>0&&(this.Tl--,this.isEnabled)){const o=this.wn.count;o>0&&(""===t&&(t=this.wn.elt(0)),this.wn.ce(),this.wn.removeAt(o-1),this.wn.k());const r=this.Dc.count;r>0&&(n=this.Dc.elt(r-1),this.Dc.removeAt(r-1))}if(i){if(e){if(this.vm=!1,null===s&&""!==t&&(s=this.currentTransaction),this.isEnabled&&null!==s){const o=s;o.isComplete||(o.isComplete=!0,o.name=t),this.discardHistoryAfterIndex();const r=this.history;r.ce();const a=this.maxHistoryLength;if(a>=0)if(0===a)r.clear();else if(r.count>=a){const l=r.elt(0);null!==l&&l.clear(),r.removeAt(0),this.js--}0!==a&&(0===r.count||r.get(r.count-1)!==o)&&(r.add(o),this.js++),r.k(),s=o}this.Dl||this.vl("CommittedTransaction",t,s)}else{this.qs=!0;try{this.isEnabled&&null!==s&&(s.isComplete=!0,s.undo())}finally{this.Dl||this.vl("RolledBackTransaction",t,s),this.qs=!1}null!==s&&s.clear()}return this.Dm=null,this.Px&&this.clear(),this.Px=!1,this.Sx=!1,!0}return this.isEnabled&&!e&&null!==s&&s.oR(n),!1}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;const e=this.history;e.ce();for(let t=e.count-1;t>this.historyIndex;t--){const i=e.elt(t);null!==i&&i.clear(),e.removeAt(t),this.vm=!0}e.k()}thaw(){this.history.ce()}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToUndo;return!(null===e||!e.canUndo())}undo(){if(!this.canUndo())return;const e=this.transactionToUndo;if(null!==e)try{this.qs=!0,this.vl("StartingUndo","Undo",e),this.js--,e.undo()}catch(t){y.ne("undo error: "+t.toString())}finally{this.vl("FinishedUndo","Undo",e),this.qs=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToRedo;return!(null===e||!e.canRedo())}redo(){if(!this.canRedo())return;const e=this.transactionToRedo;if(null!==e)try{this.qs=!0,this.vl("StartingRedo","Redo",e),this.js++,e.redo()}catch(t){y.ne("redo error: "+t.toString())}finally{this.vl("FinishedRedo","Redo",e),this.qs=!1}}vl(e,t,i){const s=new li;s.change=1,s.propertyName=e,s.object=i,s.oldValue=t;const n=this.models;for(;n.next();){const o=n.value;s.model=o,o.rR(s)}}handleChanged(e){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(e)){let t=this.currentTransaction;null===t&&(t=new hi,this.Dm=t);const i=e.copy(),s=t.changes;if(s.ce(),s.add(i),s.k(),this.Fm&&this.KP>0&&this.transactionLevel<=0&&!this.yx){const n=e.diagram;if(null!==n&&!1===n.Qa)return;y.ne("Change not within a transaction: "+i.toString()),this.KP--}}}skipsEvent(e){if(null===e||1===e.change)return!0;const t=e.object;if(null===t)return!1;if(void 0!==t.layer){const i=t.layer;if(null!==i&&i.isTemporary)return!0}else if(t.isTemporary)return!0;return!1}get models(){return this.mx.iterator}get isEnabled(){return this.Be}set isEnabled(e){this.Be=e}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.qs}get history(){return this.iA}get maxHistoryLength(){return this.GP}set maxHistoryLength(e){this.GP=e}get historyIndex(){return this.js}get currentTransaction(){return this.Dm}get transactionLevel(){return this.Tl}get isInTransaction(){return this.Tl>0}get Fm(){return this.YP}set Fm(e){this.YP=e}get nestedTransactionNames(){return this.wn}get Px(){return this.wx}set Px(e){this.wx=e}get Sx(){return this.xx}set Sx(e){this.xx=e}get Dl(){return this.kx}set Dl(e){this.kx=e}get isJustDiscarded(){return this.vm}}class te{a;Pt;Be;HP;jP;Rm;nA;constructor(){z.Je(this),this.a=U.Om(),this.Pt="",this.Be=!0,this.HP=!1,this.jP=null,this.nA=new xe,this.Rm=-1}get diagram(){return this.a}set diagram(e){e instanceof U&&(this.a=e)}toString(){return""!==this.name?this.name+" Tool":y.Hn(this.constructor)}updateAdornments(e){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){const e=this.diagram;e.currentTool===this&&(e.currentTool=null,e.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,S.z(NaN,NaN)),s=t.getMultiTouchViewPoint(1,S.z(NaN,NaN));if(!i.isReal()||!s.isReal())return S.i(i),void S.i(s);if(this.doCancel(),e.getInputOption("hasGestureZoom")){e.qP=e.scale;const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o);e.WP=r,t.bubbles=!1}S.i(i),S.i(s)}standardPinchZoomMove(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,S.z(NaN,NaN)),s=t.getMultiTouchViewPoint(1,S.z(NaN,NaN));if(!i.isReal()||!s.isReal())return S.i(i),void S.i(s);if(this.doCancel(),e.getInputOption("hasGestureZoom")){const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o)/e.WP,a=new S((Math.min(s.x,i.x)+Math.max(s.x,i.x))/2,(Math.min(s.y,i.y)+Math.max(s.y,i.y))/2),l=e.qP*r,h=e.commandHandler;if(l!==e.scale&&h.canResetZoom(l)){const c=e.zoomPoint;e.zoomPoint=a,h.resetZoom(l),e.zoomPoint=c}t.bubbles=!1}S.i(i),S.i(s)}doKeyDown(){"Escape"===this.diagram.lastInput.code&&this.doCancel()}doKeyUp(){}startTransaction(e){return void 0===e&&(e=this.name),this.transactionResult=null,this.diagram.startTransaction(e)}stopTransaction(){const e=this.diagram;return null===this.transactionResult?e.rollbackTransaction():e.commitTransaction(this.transactionResult)}standardMouseSelect(){const e=this.diagram;if(!e.allowSelect)return;const t=e.lastInput,i=e.findPartAt(t.documentPoint,!1);if(null!==i){if(y.ur?t.meta:t.control){e.T("ChangingSelection",e.selection);let s=i;for(;null!==s&&!s.canSelect();)s=s.containingGroup;null!==s&&(s.isSelected=!s.isSelected),e.T("ChangedSelection",e.selection)}else if(t.shift){if(!i.isSelected){e.T("ChangingSelection",e.selection);let s=i;for(;null!==s&&!s.canSelect();)s=s.containingGroup;null!==s&&(s.isSelected=!0),e.T("ChangedSelection",e.selection)}}else if(!i.isSelected){let s=i;for(;null!==s&&!s.canSelect();)s=s.containingGroup;null!==s&&e.select(s)}}else t.left&&!(y.ur?t.meta:t.control)&&!t.shift&&e.clearSelection()}standardMouseClick(e,t){void 0===e&&(e=null),void 0===t&&(t=o=>!o.layer?.isTemporary);const i=this.diagram,s=i.lastInput,n=i.findObjectAt(s.documentPoint,e,t);return s.targetObject=n,this.oA(n,s,i)}oA(e,t,i){if(t.handled=!1,null!==e&&!e.isEnabledObject())return!1;let s=0;t.left?s=1===t.clickCount?1:2===t.clickCount?2:1:t.right&&1===t.clickCount&&(s=3);let n="ObjectSingleClicked";if(null!==e){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked"}0!==s&&i.T(n,e)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked"}0!==s&&i.T(n)}if(null!==e)for(;null!==e;){let o=null;switch(s){case 1:o=e.click;break;case 2:o=e.doubleClick?e.doubleClick:e.click;break;case 3:o=e.contextClick}if(null!==o&&(o(t,e),t.handled))break;e=e.panel}else{let o=null;switch(s){case 1:o=i.click;break;case 2:o=i.doubleClick?i.doubleClick:i.click;break;case 3:o=i.contextClick}null!==o&&o(t)}return t.handled}standardMouseOver(){const e=this.diagram,t=e.lastInput;if(!0===e.animationManager.ke)return;const i=e.skipsUndoManager;e.skipsUndoManager=!0;let s=e.viewportBounds.containsPoint(t.documentPoint)?e.findObjectAt(t.documentPoint,null,null):null;t.event&&("pointercancel"===t.event.type||"pointerout"===t.event.type)&&(s=null),t.targetObject=s;let n=!1;if(s!==e.vc){let o=e.vc;const r=o;for(e.vc=s,this.rA(o,s),t.handled=!1;null!==o;){const a=o.mouseLeave;if(null!==a&&(s===o||null!==s&&s.isContainedBy(o)||(a(t,o,s),n=!0,t.handled)))break;o=o.panel}for(o=r,t.handled=!1;null!==s;){const a=s.mouseEnter;if(null!==a&&(o===s||null!==o&&o.isContainedBy(s)||(a(t,s,o),n=!0,t.handled)))break;s=s.panel}s=e.vc}if(null!==s){let o=s,r="";for(;null!==o&&(r=o.cursor,""===r);)o=o.panel;for(e.currentCursor=r,t.handled=!1,o=s;null!==o;){const a=o.mouseOver;if(null!==a&&(a(t,o),n=!0,t.handled))break;o=o.panel}}else{this.doUpdateCursor(null);const o=e.mouseOver;null!==o&&(o(t),n=!0)}n&&e.requestUpdate(),e.skipsUndoManager=i}doUpdateCursor(e){const t=this.diagram;t&&(t.currentCursor="")}rA(e,t){}standardMouseWheel(){const e=this.diagram,t=e.lastInput;let i=t.delta;if(0===i||!e.documentBounds.isReal())return;const s=e.commandHandler,n=e.toolManager.mouseWheelBehavior;if(null!==s&&(2===n&&!t.shift||1===n&&t.control)){if(i>0?s.canIncreaseZoom():s.canDecreaseZoom()){const o=e.zoomPoint;e.zoomPoint=t.viewPoint,i>0?s.increaseZoom():s.decreaseZoom(),e.zoomPoint=o}t.bubbles=!1}else if(2===n&&t.shift||1===n&&!t.control){const o=e.position.copy(),r=t.event,a=r.deltaMode;let l=r.deltaX,h=r.deltaY,c="pixel";if(0===l&&0===h||t.shift)!t.shift&&e.allowVerticalScroll?(i=3*i*e.scrollVerticalLineChange,e.scroll(c,i>0?"up":"down",Math.abs(i))):t.shift&&e.allowHorizontalScroll&&(i=3*i*e.scrollHorizontalLineChange,e.scroll(c,i>0?"left":"right",Math.abs(i)));else{switch(a){case 0:c="pixel";break;case 1:c="line";break;case 2:c="page"}0!==l&&e.allowHorizontalScroll&&(l*=e.scrollHorizontalLineChange/16,e.scroll(c,l>0?"right":"left",Math.abs(l))),0!==h&&e.allowVerticalScroll&&(h*=e.scrollVerticalLineChange/16,e.scroll(c,h>0?"down":"up",Math.abs(h)))}this.doWheelChange(e,o,t)}}doWheelChange(e,t,i){(!e.position.equals(t)||0!==i.event.wheelDeltaX)&&(i.bubbles=!1)}standardWaitAfter(e,t){void 0===t&&(t=this.diagram.lastInput),this.cancelWaitAfter();const i=this,s=t.clone(this.nA);this.Rm=y.dn(()=>i.doWaitAfter(s),e)}cancelWaitAfter(){-1!==this.Rm&&y.wc(this.Rm),this.Rm=-1}doWaitAfter(e){}findToolHandleAt(e,t){const i=this.diagram.findObjectAt(e,s=>{for(;null!==s&&!(s.panel instanceof Nt);)s=s.panel;return s});return null===i?null:i.part.category===t?i:null}isBeyondDragSize(e,t){const i=this.diagram;void 0===e&&(e=i.firstInput.viewPoint),void 0===t&&(t=i.lastInput.viewPoint);const s=i.toolManager.dragSize;let n=s.width,o=s.height;return i.firstInput.isTouchEvent&&(n+=6,o+=6),Math.abs(t.x-e.x)>n||Math.abs(t.y-e.y)>o}get name(){return this.Pt}set name(e){y.s(e,"string",te,"name"),this.Pt=e}get isEnabled(){return this.Be}set isEnabled(e){y.s(e,"boolean",te,"isEnabled"),this.Be=e}get isActive(){return this.HP}set isActive(e){y.s(e,"boolean",te,"isActive"),this.HP=e}get transactionResult(){return this.jP}set transactionResult(e){null!==e&&y.s(e,"string",te,"transactionResult"),this.jP=e}}var bs=(m=>(m[m.Scroll=1]="Scroll",m[m.Zoom=2]="Zoom",m[m.None=3]="None",m))(bs||{}),ws=(m=>(m[m.Zoom=1]="Zoom",m[m.Cancel=2]="Cancel",m[m.None=3]="None",m))(ws||{});let Ue=(()=>{class m extends te{lA;aA;hA;JP;$P;ZP;QP;_P;tS;eS;Im;_a;constructor(t){super(),this.name="ToolManager",this.lA=new H,this.aA=new H,this.hA=new H,this.JP=850,this.$P=850,this.ZP=new lt(2,2).kt(),this.QP=5e3,this._P=1,this.tS=1,this.eS=null,this.Im=null,this._a=-1,t&&Object.assign(this,t)}static WheelScroll=1;static WheelZoom=2;static WheelNone=3;static GestureZoom=1;static GestureCancel=2;static GestureNone=3;get mouseWheelBehavior(){return this._P}set mouseWheelBehavior(t){this._P=t}get gestureBehavior(){return this.tS}set gestureBehavior(t){this.tS=t}initializeStandardTools(){return this}updateAdornments(t){const i=this.currentToolTip;if(i instanceof Nt&&this.Im===t){const s=i.adornedObject;(null!==t?null!==s&&s.part===t:null===s)?this.showToolTip(i,s):this.hideToolTip()}}doMouseDown(){const t=this.diagram,i=t.lastInput;if(i.isTouchEvent&&2===this.gestureBehavior&&(i.bubbles=!1),i.isMultiTouch){if(this.cancelWaitAfter(),3===this.gestureBehavior)return void(i.bubbles=!0);if(2===this.gestureBehavior)return;if(t.currentTool.canStartMultiTouch())return void t.currentTool.standardPinchZoomStart()}const n=this.mouseDownTools.length;for(let o=0;o<n;o++){const r=this.mouseDownTools.elt(o);if(r.diagram=this.diagram,r.canStart())return t.doFocus(),t.currentTool=r,void(t.currentTool===r&&(r.isActive||r.doActivate(),r.doMouseDown()))}1===t.lastInput.button&&(1===this.mouseWheelBehavior?this.mouseWheelBehavior=2:2===this.mouseWheelBehavior&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,i)}doMouseMove(){const t=this.diagram,i=t.lastInput;if(i.isMultiTouch){if(3===this.gestureBehavior)return void(i.bubbles=!0);if(2===this.gestureBehavior)return;if(t.currentTool.canStartMultiTouch())return void t.currentTool.standardPinchZoomMove()}if(this.isActive){const n=this.mouseMoveTools.length;for(let o=0;o<n;o++){const r=this.mouseMoveTools.elt(o);if(r.diagram=this.diagram,r.canStart())return t.doFocus(),t.currentTool=r,void(t.currentTool===r&&(r.isActive||r.doActivate(),r.doMouseMove()))}}this.cA(t);const s=i.event;null!==s&&("pointermove"===s.type||!s.cancelable)&&(i.bubbles=!0)}cA(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}rA(t,i){const s=this.currentToolTip;null!==s&&(null!==i&&s instanceof Nt&&(i===s||i.isContainedBy(s))||this.hideToolTip())}doWaitAfter(t){const i=this.diagram;if(!i.lR())return;const s=i.lastInput;if(i.lastInput=t,this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!i.lastInput.handled){const n=t.copy();n.button=2,i.lastInput=n,i.Mx=!0,i.doMouseUp()}i.lastInput=s}doMouseHover(){const t=this.diagram,i=t.lastInput;null===i.targetObject&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(null!==s)for(i.handled=!1;null!==s;){const n=this.isActive?s.mouseHold:s.mouseHover;if(null!==n&&(n(i,s),i.handled))break;s=s.panel}else{const n=this.isActive?t.mouseHold:t.mouseHover;null!==n&&n(i)}}doToolTip(){const t=this.diagram,i=t.lastInput;null===i.targetObject&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(null!==s){const n=this.currentToolTip;if(n instanceof Nt&&(s===n||s.isContainedBy(n)))return;for(;null!==s;){const o=s.toolTip;if(null!==o)return void this.showToolTip(o,s);s=s.panel}this.hideToolTip()}else{const n=t.toolTip;null!==n?this.showToolTip(n,null):this.hideToolTip()}}showToolTip(t,i){null!==i&&y.se(i,st,m,"showToolTip:obj");const s=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof Nt){t.layerName="Tool",t.selectable=!1,t.scale=1/s.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=s.scale);const n=t.diagram;null!==n&&n!==s&&n.remove(t),s.add(t),null!==i?t.adornedObject=i:t.data=s.model,t.ensureBounds(),this.positionToolTip(t,i)}else t instanceof be&&t!==this.currentToolTip&&null!==t.show&&t.show(i,s,this);this.currentToolTip=t,this.extendToolTip(this.toolTipDuration)}positionToolTip(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),r=s.measuredBounds,a=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=r.width),o.x+r.width>a.right&&(o.x-=r.width+5/n.scale),o.x<a.x&&(o.x=a.x),o.y+20/n.scale+r.height>a.bottom?o.y-=r.height+5/n.scale:o.y+=20/n.scale,o.y<a.y&&(o.y=a.y),s.position=o}extendToolTip(t){void 0===t&&(t=3e3),null!==this.currentToolTip&&(-1!==this._a&&(y.wc(this._a),this._a=-1),t>0&&t!==1/0&&(this._a=y.dn(()=>this.hideToolTip(),t)))}hideToolTip(){-1!==this._a&&(y.wc(this._a),this._a=-1);const t=this.diagram,i=this.currentToolTip;null!==i&&(i instanceof Nt?(t.remove(i),null!==this.Im&&this.Im.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof be&&null!==i.hide&&i.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.eS}set currentToolTip(t){this.eS=t,this.Im=null!==t&&t instanceof Nt?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();const t=this.diagram;if(this.isActive){const i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.diagram=this.diagram,n.canStart())return t.doFocus(),t.currentTool=n,void(t.currentTool===n&&(n.isActive||n.doActivate(),n.doMouseUp()))}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){const t=this.diagram;null!==t.commandHandler&&t.commandHandler.doKeyDown()}doKeyUp(){const t=this.diagram;null!==t.commandHandler&&t.commandHandler.doKeyUp()}findTool(t){y.s(t,"string",m,"findTool:name");let i=this.mouseDownTools.length;for(let s=0;s<i;s++){const n=this.mouseDownTools.elt(s);if(n.name===t)return n}i=this.mouseMoveTools.length;for(let s=0;s<i;s++){const n=this.mouseMoveTools.elt(s);if(n.name===t)return n}i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.name===t)return n}return null}replaceTool(t,i){y.s(t,"string",m,"replaceTool:name"),null!==i&&(i.diagram=this.diagram);let s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.name===t)return null!==i?this.mouseDownTools.setElt(n,i):this.mouseDownTools.removeAt(n),o}s=this.mouseMoveTools.length;for(let n=0;n<s;n++){const o=this.mouseMoveTools.elt(n);if(o.name===t)return null!==i?this.mouseMoveTools.setElt(n,i):this.mouseMoveTools.removeAt(n),o}s=this.mouseUpTools.length;for(let n=0;n<s;n++){const o=this.mouseUpTools.elt(n);if(o.name===t)return null!==i?this.mouseUpTools.setElt(n,i):this.mouseUpTools.removeAt(n),o}return null}replaceStandardTool(t,i,s){this.Jt(t,i,s)}Jt(t,i,s){y.s(t,"string",m,"replaceStandardTool:name"),null!==i&&(i.name=t,i.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,i):null!==i&&s.add(i)}get mouseDownTools(){return this.lA}get mouseMoveTools(){return this.aA}get mouseUpTools(){return this.hA}get hoverDelay(){return this.JP}set hoverDelay(t){y.s(t,"number",m,"hoverDelay"),this.JP=t}get holdDelay(){return this.$P}set holdDelay(t){y.s(t,"number",m,"holdDelay"),this.$P=t}get dragSize(){return this.ZP}set dragSize(t){this.ZP=t.N()}get toolTipDuration(){return this.QP}set toolTipDuration(t){y.s(t,"number",m,"toolTipDuration"),this.QP=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.Jt("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.Jt("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.Jt("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.Jt("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.Jt("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.Jt("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.Jt("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.Jt("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.Jt("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.Jt("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.Jt("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.Jt("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.Jt("ClickSelecting",t,this.mouseUpTools)}}return m})();class Ft extends te{iS;sS;xn;nS;oS;rS;lS;Fc;Em;aS;th;kr;fA;hS;Fu;Ru;cS;fS;uS;dS;static Nx=new H;static le=null;static eh=null;constructor(e){super(),this.name="Dragging",this.iS=!0,this.dS=!0,this.sS=!0,this.xn=null,this.nS=null,this.oS=null,this.rS=null,this.lS=!1,this.Fu=!1,this.Fc=new S(NaN,NaN),this.Em=new S,this.aS=!0,this.th=100,this.kr=[],this.fA=(new z).k(),this.hS=new Mi,this.Ru=null,this.cS="copy",this.fS="",this.uS="no-drop",e&&Object.assign(this,e)}get isCopyEnabled(){return this.iS}set isCopyEnabled(e){y.s(e,"boolean",Ft,"isCopyEnabled"),this.iS=e}get copiesEffectiveCollection(){return this.sS}set copiesEffectiveCollection(e){y.s(e,"boolean",Ft,"copiesEffectiveCollection"),this.sS=e}get dragOptions(){return this.hS}set dragOptions(e){this.hS=e}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(e){y.s(e,"boolean",Ft,"isGridSnapEnabled"),this.dragOptions.isGridSnapEnabled=e}get isComplexRoutingRealtime(){return this.aS}set isComplexRoutingRealtime(e){this.aS=e;const t=this.diagram.findRouter("AvoidsLinks");null!==t&&(t.isRealtime=e)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(e){y.s(e,"boolean",Ft,"isGridSnapRealtime"),this.dragOptions.isGridSnapRealtime=e}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(e){this.dragOptions.gridSnapCellSize.equals(e)||(e=e.N(),this.dragOptions.gridSnapCellSize=e)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(e){this.dragOptions.gridSnapCellSpot.equals(e)||(e=e.N(),this.dragOptions.gridSnapCellSpot=e)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(e){this.dragOptions.gridSnapOrigin.equals(e)||(e=e.N(),this.dragOptions.gridSnapOrigin=e)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(e){y.s(e,"boolean",Ft,"dragsLink"),this.dragOptions.dragsLink=e}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(e){y.s(e,"boolean",Ft,"dragsTree"),this.dragOptions.dragsTree=e}get copyCursor(){return this.cS}set copyCursor(e){this.cS=e}get moveCursor(){return this.fS}set moveCursor(e){this.fS=e}get nodropCursor(){return this.uS}set nodropCursor(e){this.uS=e}get currentPart(){return this.nS}set currentPart(e){null!==e&&y.se(e,At,Ft,"currentPart"),this.nS=e}get copiedParts(){return this.rS}set copiedParts(e){this.rS=e}get draggedParts(){return this.oS}set draggedParts(e){this.oS=e}get draggingParts(){return null!==this.copiedParts?this.copiedParts.toKeySet():null!==this.draggedParts?this.draggedParts.toKeySet():this.fA}get draggedLink(){return this.diagram.draggedLink}set draggedLink(e){null!==e&&y.se(e,gt,Ft,"draggedLink"),this.diagram.draggedLink=e}get isDragOutStarted(){return this.lS}set isDragOutStarted(e){this.lS=e}get startPoint(){return this.Em}set startPoint(e){this.Em.equals(e)||this.Em.h(e)}get delay(){return this.th}set delay(e){y.s(e,"number",Ft,"delay"),this.th=e}canStart(){if(!this.isEnabled)return!1;const e=this.diagram;if(null===e||e.isReadOnly&&!e.allowDragOut||!e.allowMove&&!e.allowCopy&&!e.allowDragOut||!e.allowSelect)return!1;const t=e.lastInput;return!(!t.left||e.currentTool!==this&&(!this.isBeyondDragSize()||t.isTouchEvent&&t.timestamp-e.firstInput.timestamp<this.th))&&null!==this.findDraggablePart()}findDraggablePart(){const e=this.diagram;let t=e.findPartAt(e.firstInput.documentPoint,!1);if(null===t)return null;for(;null!==t&&!t.canSelect();)t=t.containingGroup;return null!==t&&(t.canMove()||t.canCopy())?t:null}standardMouseSelect(){const e=this.diagram;if(!e.allowSelect)return;let t=e.findPartAt(e.firstInput.documentPoint,!1);if(null!==t){for(;null!==t&&!t.canSelect();)t=t.containingGroup;if(this.currentPart=t,null!==this.currentPart&&!this.currentPart.isSelected){e.T("ChangingSelection",e.selection);const i=e.lastInput;!(y.ur?i.meta:i.control)&&!i.shift&&e.clearSelection(!0),this.currentPart.isSelected=!0,e.T("ChangedSelection",e.selection)}}}doActivate(){const e=this.diagram;this.Ru=null,null===this.currentPart&&this.standardMouseSelect();const t=this.currentPart;if(null===t||!t.canMove()&&!t.canCopy())return;e.cacheGroupExternalLinks(!0),Ft.le=null,this.isActive=!0,this.Fc.set(e.position),this.gS(e.selection),this.kr.length=0,e.animationManager.stopAnimation();const i=this.computeEffectiveCollection(e.selection,this.dragOptions);this.draggedParts=i,this.dS=!!this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,e.Ou=!0,!0===e.getRenderingHint("temporaryPixelRatio")&&e.avgSpf>30&&e.Cx(),e.uA(this.draggedParts),e.Iu=!0,this.startTransaction("Drag"),this.startPoint=e.firstInput.documentPoint,e.isMouseCaptured=!0,e.allowDragOut&&this.aR()}gS(e){if(!this.dragsLink)return;const t=this.diagram,i=t.model.Um(),s=e.first();i&&1===e.count&&s instanceof gt&&this.mayDragLink(s)?(this.draggedLink=s,this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.xn=t.toolManager.findTool("Relinking"),null===this.xn&&(this.xn=new Ze,this.xn.diagram=t),this.xn.originalLink=this.draggedLink):(this.draggedLink=null,this.xn=null)}mayDragLink(e){const t=this.diagram;return null!==t&&t.allowRelink}computeEffectiveCollection(e,t){return this.diagram.commandHandler.computeEffectiveCollection(e,t)}Ws(e){return new He(void 0===e?S.gn:this.isGridSnapEnabled?new S(Math.round(1e3*e.x)/1e3,Math.round(1e3*e.y)/1e3):e.copy())}doDeactivate(){this.isActive=!1;const e=this.diagram;this.diagram.layout.isRealtime=this.dS,e.Iu=!1,e.Fl=!0,e.cacheGroupExternalLinks(!1),e.stopAutoScroll(),this.mS(),e.pS(this.draggedParts),this.Ru=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.Fu=!1,Ft.hR(),this.dA(),this.Fc.e(NaN,NaN),null!==Ft.eh&&(Ft.eh.currentCursor=""),Ft.eh=null,Ft.le=null,this.Rl(),e.isMouseCaptured=!1,e.currentCursor="",e.Ou=!1,this.stopTransaction(),e.yS(!0)}stopTransaction(){const e=this.diagram,t=super.stopTransaction();return t&&null!==e.undoManager.transactionToUndo&&e.undoManager.transactionToUndo.optimize(),t}mS(){const e=this.diagram,t=e.skipsUndoManager;e.skipsUndoManager=!0,this.gA(e.lastInput,null),e.skipsUndoManager=t,this.kr.length=0}mA(){this.Rl(),this.wS();const e=this.diagram;this.Fc.isReal()&&(e.position=this.Fc),e.stopAutoScroll()}doCancel(){this.Rl(),this.wS();const e=this.diagram;this.Fc.isReal()&&(e.position=this.Fc),this.stopTool()}doKeyDown(){const e=this.diagram;if(!this.isActive)return;const t=e.lastInput,i=e.previousInput;"Escape"===t.code?this.doCancel():(t.code!==i.code||t.modifiers!==i.modifiers)&&this.doMouseMove()}doKeyUp(){this.isActive&&this.doMouseMove()}cR(e,t){let i=1/0,s=1/0,n=-1/0,o=-1/0;const r=e.iterator;for(;r.next();){const a=r.value;if(!a.isVisible())continue;const l=a.location,h=l.x,c=l.y;isNaN(h)||isNaN(c)||(h<i&&(i=h),c<s&&(s=c),h>n&&(n=h),c>o&&(o=c))}return i===1/0?t.e(0,0,0,0):t.e(i,s,n-i,o-s),t}xS(e){if(null!==this.copiedParts)return;const t=this.diagram;if(e&&(t.isReadOnly||t.isModelReadOnly)||null===this.draggedParts)return;const i=t.undoManager;i.isEnabled&&i.isInTransaction?null!==i.currentTransaction&&i.currentTransaction.changes.count>0&&(t.undoManager.rollbackTransaction(),t.startTransaction("Drag")):this.wS(),t.skipsUndoManager=!e,t.partManager.addsToTemporaryLayer=!e,this.startPoint=t.firstInput.documentPoint;const s=this.copiesEffectiveCollection?this.draggedParts.toKeySet():t.selection,n=t.copyParts(s,t,!0),o=new xt,r=this.draggedParts.iterator;for(;r.next();){const l=r.key;if(l.Di()&&l.canCopy()){const h=n.get(l);if(null===h)continue;h.location=l.location,h.ensureBounds(),o.set(h,this.Ws(h.location))}}const a=n.iterator;for(;a.next();){const l=a.value;l instanceof gt&&l.canCopy()&&o.set(l,this.Ws())}if(this.copiedParts=o,this.gS(o.toKeySet()),null!==this.draggedLink){const l=this.draggedLink,h=l.routeBounds;l.Pr(this.startPoint.x-(h.x+h.width/2),this.startPoint.y-(h.y+h.height/2))}this.doUpdateCursor(null)}Rl(){const e=this.diagram;if(null!==this.copiedParts){if(e.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,null!==this.draggedParts){const t=this.draggedParts.iterator;for(;t.next();)t.key instanceof gt&&(t.value.point=new S(0,0))}this.doUpdateCursor(null)}e.skipsUndoManager=!1,e.partManager.addsToTemporaryLayer=!1,this.startPoint=e.firstInput.documentPoint}dA(){null!==this.draggedLink&&(this.dragsLink&&null!==this.xn&&(this.xn.stopDraggingMouseMove(),this.xn.originalLink=null),this.draggedLink=null,this.xn=null)}Rc(e,t){if(null===e)return;const i=this.diagram,s=this.startPoint,n=S.l();n.h(i.lastInput.documentPoint),this.moveParts(e,n.subtract(s),t),S.i(n),!0===i.getRenderingHint("temporaryPixelRatio")&&null===i.Ol&&i.avgSpf>30&&(i.Cx(),i.Eu())}moveParts(e,t,i){void 0===i&&(i=!1);const s=this.diagram;null!==s&&s.Lx(e,t,this.dragOptions,i)}wS(){if(null===this.draggedParts)return;const e=this.diagram;let t=this.draggedParts.iterator;for(;t.next();){const i=t.key;i.Di()&&(i.location=t.value.point)}for(t=this.draggedParts.iterator;t.next();){const i=t.key;if(i instanceof gt&&i.suspendsRouting){const s=t.value.point;this.draggedParts.set(i,this.Ws()),i.Pr(-s.x,-s.y)}}e.maybeUpdate()}fR(e){if(null===e)return!0;const t=e.part;return!!(null===t||t instanceof Nt||t.layer?.isTemporary||this.draggedParts&&this.draggedParts.has(t)||this.copiedParts&&this.copiedParts.has(t))}bS(e){const t=this.diagram;this.dragsLink&&(null!==this.draggedLink&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.pA(!1));const i=this.findDragOverObject(e),s=t.lastInput;s.targetObject=i,this.doUpdateCursor(i);const n=t.skipsUndoManager;let o=!1;try{if(t.skipsUndoManager=!0,o=this.gA(s,i),!this.isActive&&null===Ft.le)return;const r=null!==i?i.part:null;if(null===r||t.handlesDragDropForTopLevelParts&&r.isTopLevel&&!(r instanceof pt)){const a=t.mouseDragOver;null!==a&&(a(s),o=!0)}if(!this.isActive&&null===Ft.le||(this.doDragOver(e,i),!this.isActive&&null===Ft.le))return}finally{t.skipsUndoManager=n,o&&t.maybeUpdate()}this.Ru=i,!t.isReadOnly&&(t.allowMove||t.allowCopy)&&(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(s.viewPoint)}findDragOverObject(e){return this.diagram.kS(e,null,t=>!this.fR(t))}doUpdateCursor(e){const t=this.diagram;(null===e||this.Ru!==e)&&(!this.diagram.currentTool.isActive||this.mayCopy()?t.currentCursor=this.copyCursor:this.mayMove()?t.currentCursor=this.moveCursor:this.mayDragOut()&&(t.currentCursor=this.nodropCursor))}gA(e,t){let i=!1,s=this.kr.length;const n=s>0?this.kr[0]:null;if(t===n)return!1;e.handled=!1;for(let r=0;r<s;r++){const a=this.kr[r],l=a.mouseDragLeave;if(null!==l&&(l(e,a,t),i=!0,e.handled))break}if(this.kr.length=0,!this.isActive&&null===Ft.le||null===t)return i;e.handled=!1;let o=t;for(;null!==o;)this.kr.push(o),o=this.yA(o);s=this.kr.length;for(let r=0;r<s;r++){const a=this.kr[r],l=a.mouseDragEnter;if(null!==l&&(l(e,a,n),i=!0,e.handled))break}return i}FU(e,t){return null!==e&&!!(e===t||e.isContainedBy(t)||t instanceof pt&&!(e instanceof pt)&&t.handlesDragDropForMembers&&e.part?.isMemberOf(t))}yA(e){const t=e.panel;if(null!==t)return t;if(e instanceof At&&!(e instanceof pt)){const i=e.containingGroup;if(null!==i&&i.handlesDragDropForMembers)return i}return null}wA(e,t){const s=this.xn;if(null===s)return null;const o=this.diagram.findObjectsNear(e,s.portGravity,h=>s.findValidLinkablePort(h,t)),r=S.l();let a=1/0,l=null;for(const h=o.iterator;h.next();){const c=h.value;if(null===c.part)continue;const u=c.getDocumentPoint(A.Center,r),d=e.distanceSquaredPoint(u);d<a&&(l=c,a=d)}return S.i(r),l}pA(e){const t=this.draggedLink;if(null!==t){if(t.pointsCount<2)return;const i=this.diagram;if(i.isReadOnly)return;const s=this.xn;if(null===s)return;let n=null,o=null;null===t.fromNode&&(n=this.wA(t.getPoint(0),!1),null!==n&&(o=n.part));let r=null,a=null;null===t.toNode&&(r=this.wA(t.getPoint(t.pointsCount-1),!0),null!==r&&(a=r.part)),s.isValidLink(o,n,a,r)?e?(t.defaultFromPoint=t.getPoint(0),t.defaultToPoint=t.getPoint(t.pointsCount-1),t.suspendsRouting=!1,t.fromNode=o,null!==n&&(t.fromPortId=n.portId),t.toNode=a,null!==r&&(t.toPortId=r.portId),t.fromPort!==i.PS&&i.T("LinkRelinked",t,i.PS),t.toPort!==i.SS&&i.T("LinkRelinked",t,i.SS)):s.doDraggingMouseMove(o,n,a,r):s.doDraggingMouseMove(null,null,null,null)}}doDragOver(e,t){}xA(e){const t=this.diagram;this.dragsLink&&this.pA(!0),this.mS();const i=this.findDragOverObject(e),s=t.lastInput;if(s.targetObject=i,null!==i){s.handled=!1;let a=i;for(;null!==a;){const l=a.mouseDrop;if(null!==l&&(l(s,a),s.handled))break;this.uR(s,a),a=this.yA(a)}}else{const a=t.mouseDrop;null!==a&&a(s)}if(!this.isActive&&null===Ft.le)return;const n=this.copiedParts||this.draggedParts;if(null!==n){const a=n.iterator;for(;a.next();){const l=a.key;l instanceof nt&&l.linksConnected.each(h=>h.suspendsRouting=!1)}}if(this.doDropOnto(e,i),!this.isActive&&null===Ft.le)return;const o=j.l(),r=t.selection.iterator;for(;r.next();){const a=r.value;a instanceof nt&&this.dR(t,a,o)}j.i(o)}uR(e,t){const i=this.diagram,s=t.part;if(i.handlesDragDropForTopLevelParts&&null!==s&&s.isTopLevel&&!(s instanceof pt)){const n=i.mouseDrop;null!==n&&n(e)}}dR(e,t,i){if(!t.canAvoid())return;let s=!1;i=t.getAvoidableRect(i),e.viewportBounds.containsRect(i)&&(s=!0);const n=this.copiedParts||this.draggedParts;if(null===n)return;const o=e.MS(i,a=>a.part,a=>a instanceof gt,!0,a=>a instanceof gt,s);if(0===o.count)return;const r=o.iterator;for(;r.next();){const a=r.value;n.has(a)&&n.has(t)||!a.isMemberOf(t)&&a.isAvoiding&&a.$t()}}doDropOnto(e,t){}doMouseMove(){if(!this.isActive)return;const e=this.diagram,t=e.lastInput;this.simulatedMouseMove(t.event,t.documentPoint,t.targetDiagram)||null!==this.currentPart&&null!==this.draggedParts&&(this.mayCopy()?(this.xS(!1),this.Rc(this.copiedParts,!1)):this.mayMove()?(this.Rl(),this.Rc(this.draggedParts,!0)):this.mayDragOut()?(this.xS(!1),this.Rc(this.copiedParts,!1)):this.Rl(),this.bS(e.lastInput.documentPoint))}doMouseUp(){if(!this.isActive)return;const e=this.diagram,t=e.lastInput;if(this.simulatedMouseUp(t.event,t.documentPoint,t.targetDiagram))return;let i=!1;const s=this.mayCopy();if(s&&null!==this.copiedParts?(this.Rl(),this.xS(!0),this.Rc(this.copiedParts,!1),null!==this.copiedParts&&(e.T("ChangingSelection",e.selection),e.clearSelection(!0),this.copiedParts.iteratorKeys.each(n=>{n.isSelected=!0}))):(i=!0,this.Rl(),this.mayMove()&&(this.Rc(this.draggedParts,!0),this.bS(e.lastInput.documentPoint))),this.Fu=!0,this.xA(e.lastInput.documentPoint),this.isActive){const n=s&&this.copiedParts,o=n?this.copiedParts?.toKeySet():this.draggedParts?this.draggedParts.toKeySet():null;this.copiedParts=null,i&&this.gR(),e.invalidateDocumentBounds(),e.pS(this.draggedParts),this.transactionResult=n?"Copy":"Move",e.T(n?"SelectionCopied":"SelectionMoved",o)}this.stopTool(),s&&e.T("ChangedSelection",e.selection)}simulatedMouseMove(e,t,i){if(null===Ft.le)return!1;const s=Ft.le.diagram;i instanceof U||(i=null);const n=Ft.eh;if(i!==n){if(null!==n&&n!==s){n.stopAutoScroll(),Ft.le.isDragOutStarted=!1;const r=n.toolManager.findTool("Dragging");null!==r&&r.doSimulatedDragLeave()}if(Ft.eh=i,null!==i&&i!==s){Ft.le.mA();const r=i.toolManager.findTool("Dragging");null!==r&&(r.bA(),r.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(null===i||i===s||!i.allowDrop||i.isReadOnly||!i.allowInsert)return!1;const o=i.toolManager.findTool("Dragging");if(null!==o){let r=t;null!==e&&(void 0!==e.targetTouches&&(e.targetTouches.length>0?e=e.targetTouches[0]:e.changedTouches.length>0&&(e=e.changedTouches[0])),r=i.getMouse(e)),i.lastInput.documentPoint=r,i.lastInput.viewPoint=i.transformDocToView(r),i.lastInput.down=!1,i.lastInput.up=!1,o.doSimulatedDragOver()}return!0}simulatedMouseUp(e,t,i){if(null===Ft.le)return!1;const s=Ft.eh,n=Ft.le.diagram;if(null===i)return Ft.le.doCancel(),!0;if(i!==s){if(null!==s){const r=s.toolManager.findTool("Dragging");if(null!==s&&s!==n&&null!==r)return s.stopAutoScroll(),Ft.le.isDragOutStarted=!1,r.doSimulatedDragLeave(),!1}Ft.eh=i;const o=i.toolManager.findTool("Dragging");null!==o&&(Ft.le.mA(),o.bA(),o.doSimulatedDragEnter())}if(i!==this.diagram){let o=t;null!==e?(void 0!==e.targetTouches&&(e.targetTouches.length>0?e=e.targetTouches[0]:e.changedTouches.length>0&&(e=e.changedTouches[0])),o=i.getMouse(e)):null===o&&(o=new S),i.lastInput.documentPoint=o,i.lastInput.viewPoint=i.transformDocToView(o),i.lastInput.down=!1,i.lastInput.up=!0;const r=i.toolManager.findTool("Dragging");null!==r&&r.doSimulatedDrop();const a=Ft.le;if(null!==a){const l=a.mayCopy();a.transactionResult=l?"Copy":"Move",a.stopTool()}return!0}return!1}gR(){if(null===this.draggedParts)return;const e=this.draggedParts.iterator;for(;e.next();){const t=e.key;if(t instanceof nt){const i=t.containingGroup;null!==i&&i.hasPlaceholder()&&!this.draggedParts.has(i)&&i.placeholder.c()}}}mayCopy(){if(!this.isCopyEnabled)return!1;const e=this.diagram;if(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowCopy||!(y.ur?e.lastInput.alt:e.lastInput.control))return!1;const t=e.selection.iterator;for(;t.next();)if(t.value.canCopy())return!0;return!(null===this.draggedLink||!this.dragsLink||!this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;const e=this.diagram;if(!e.allowDragOut||!e.allowCopy||e.allowMove)return!1;const t=e.selection.iterator;for(;t.next();)if(t.value.canCopy())return!0;return!(null===this.draggedLink||!this.dragsLink||!this.draggedLink.canCopy())}mayMove(){const e=this.diagram;if(e.isReadOnly||!e.allowMove)return!1;const t=e.selection.iterator;for(;t.next();)if(t.value.canMove())return!0;return!(null===this.draggedLink||!this.dragsLink||!this.draggedLink.canMove())}bA(){Ft.Nx.has(this)||Ft.Nx.add(this)}static hR(){if(Ft.Nx.count>0){const e=Ft.Nx,t=e.length;for(let i=0;i<t;i++){const s=e.elt(i);s.dA(),s.Rl(),s.mS(),s.diagram.stopAutoScroll()}e.clear()}}mR(e,t,i){return!this.Fu&&null!==this.draggedParts&&!this.draggedParts.has(e)&&(i.h(t),!0)}get draggingSource(){return Ft.le}mayDragIn(){const e=this.diagram;if(!e.allowDrop||e.isReadOnly||e.isModelReadOnly||!e.allowInsert)return!1;const t=Ft.le;return!(null===t||t.diagram.model.dataFormat!==e.model.dataFormat)}doSimulatedDragEnter(){if(!this.mayDragIn())return;const e=this.diagram;e.animationManager.stopAnimation(),e.Sr(),e.animationManager.stopAnimation();const t=Ft.le;null!==t&&(this.diagram.Ou=!0,null===e.lastInput.event&&(e.lastInput.event=t.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){const e=Ft.le;null!==e&&e.doSimulatedDragOut(),this.diagram.Ou=!1,this.doCancel()}doSimulatedDragOver(){const e=this.diagram;e.animationManager.Uu=!0;const t=Ft.le;if(null!==t&&null!==t.draggedParts){if(!this.mayDragIn())return;this.kA(t.draggedParts.toKeySet(),!1,e.firstInput),this.Rc(this.copiedParts,!1),this.bS(e.lastInput.documentPoint)}e.animationManager.Uu=!1}doSimulatedDrop(){const e=this.diagram,t=Ft.le;if(null!==t){const i=t.diagram;if(t.Fu=!0,this.Rl(),null===t.draggedParts||!this.mayDragIn())return;e.animationManager.Uu=!0,e.T("ChangingSelection",e.selection),this.startTransaction("Drop"),this.kA(t.draggedParts.toKeySet(),!0,e.lastInput),this.Rc(this.copiedParts,!1);const s=new z;null!==this.copiedParts&&(e.clearSelection(!0),this.copiedParts.iteratorKeys.each(n=>{n.isSelected=!0,s.add(n)})),this.xA(e.lastInput.documentPoint),e.invalidateDocumentBounds(),null!==this.copiedParts&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,e.doFocus(),e.Ou=!1,e.T("ExternalObjectsDropped",s,i),this.stopTransaction(),e.T("ChangedSelection",e.selection)}e.animationManager.Uu=!1}kA(e,t,i){if(null!==this.copiedParts)return;const s=this.diagram;if(s.isReadOnly||s.isModelReadOnly)return;s.skipsUndoManager=!t,s.partManager.addsToTemporaryLayer=!t,this.startPoint=i.documentPoint;const n=s.copyParts(e,s,!0),o=j.l();this.cR(e,o);const r=o.x+o.width/2,a=o.y+o.height/2;j.i(o);const l=this.Em,h=new xt,c=S.l(),u=e.iterator;for(;u.next();){const f=u.value;if(f instanceof gt&&f.canCopy()){const p=n.get(f);if(null===p)continue;p.points=f.points,p.Pr(l.x-r,l.y-a),p.suspendsRouting=!0,h.set(p,this.Ws())}}const d=e.iterator;for(;d.next();){const f=d.value;if(f.Di()&&f.canCopy()){const p=n.get(f);if(null===p)continue;const g=f.location;c.e(l.x-(r-g.x),l.y-(a-g.y)),p.location=c,p.ensureBounds(),h.set(p,this.Ws(c))}}if(S.i(c),this.copiedParts=h,this.gS(h.toKeySet()),null!==this.draggedLink){const f=this.draggedLink,p=f.routeBounds;f.Pr(this.startPoint.x-(p.x+p.width/2),this.startPoint.y-(p.y+p.height/2))}this.doUpdateCursor(null)}aR(){this.isDragOutStarted=!0,this.Fu=!1,Ft.le=this,Ft.eh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){this.diagram.currentCursor=this.mayCopy()||this.mayMove()?"":this.nodropCursor,this.Ru=null}computeMove(e,t,i,s){const n=this.diagram;return null!==n?n.computeMove(e,t,this.dragOptions,s):new S}}Ue.prototype.doCancel=function(){null!==Ft.le&&Ft.le.doCancel(),te.prototype.doCancel.call(this)};class ce extends te{NS;CS;Il;LS;AS;ih;TS;nh;DS;vS;FS;RS;OS;IS;PA;ES;El;US;constructor(){super(),this.NS=100,this.CS=!1,this.Il="pointer",this.LS=new gt({layerName:"Tool"}).add(new rt({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new rt({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).It(),this.ih=new rt("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:lt.TP}).theme("stroke","tempPort"),this.AS=new nt({selectable:!1,layerName:"Tool"}).add(this.ih).It(),this.nh=new rt("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:lt.TP}).theme("stroke","tempPort"),this.TS=new nt({selectable:!1,layerName:"Tool"}).add(this.nh).It(),this.DS=null,this.vS=null,this.FS=null,this.RS=null,this.OS=null,this.IS=!0,this.PA=new xt,this.ES=null,this.El=null,this.US=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.NS}set portGravity(e){y.s(e,"number",ce,"portGravity"),e>=0&&(this.NS=e)}get isUnconnectedLinkValid(){return this.CS}set isUnconnectedLinkValid(e){y.s(e,"boolean",ce,"isUnconnectedLinkValid"),this.CS=e}get linkingCursor(){return this.Il}set linkingCursor(e){this.Il=e}get temporaryLink(){return this.LS}set temporaryLink(e){e.It(),this.LS=e}get temporaryFromNode(){return this.AS}set temporaryFromNode(e){e.It(),this.AS=e,e&&(this.ih=e.port)}get temporaryFromPort(){return this.ih}set temporaryFromPort(e){if(null!==this.ih){const t=this.ih.panel;if(null!==t){const i=t.D.indexOf(this.ih);t.removeAt(i),t.insertAt(i,e)}}this.ih=e}get temporaryToNode(){return this.TS}set temporaryToNode(e){e.It(),this.TS=e,e&&(this.nh=e.port)}get temporaryToPort(){return this.nh}set temporaryToPort(e){if(null!==this.nh){const t=this.nh.panel;if(null!==t){const i=t.D.indexOf(this.nh);t.removeAt(i),t.insertAt(i,e)}}this.nh=e}get originalLink(){return this.DS}set originalLink(e){null!==e&&y.se(e,gt,ce,"originalLink"),this.DS=e}get originalFromNode(){return this.vS}set originalFromNode(e){null!==e&&y.se(e,nt,ce,"originalFromNode"),this.vS=e}get originalFromPort(){return this.FS}set originalFromPort(e){null!==e&&y.se(e,st,ce,"originalFromPort"),this.FS=e}get originalToNode(){return this.RS}set originalToNode(e){null!==e&&y.se(e,nt,ce,"originalToNode"),this.RS=e}get originalToPort(){return this.OS}set originalToPort(e){null!==e&&y.se(e,st,ce,"originalToPort"),this.OS=e}get isForwards(){return this.IS}set isForwards(e){this.IS=e}get validPortsCache(){return this.PA}get targetPort(){return this.ES}set targetPort(e){null!==e&&y.se(e,st,ce,"targetPort"),this.ES=e}copyPortProperties(e,t,i,s,n){if(null===e||null===t||null===i||null===s)return;const o=t.getDocumentScale(),r=lt.l();r.width=t.naturalBounds.width*o,r.height=t.naturalBounds.height*o,s.desiredSize=r,lt.i(r),n?(s.toSpot=t.toSpot,s.toEndSegmentLength=t.toEndSegmentLength):(s.fromSpot=t.fromSpot,s.fromEndSegmentLength=t.fromEndSegmentLength),i.locationSpot=A.Center;const a=S.l();i.location=t.getDocumentPoint(A.Center,a),S.i(a),s.angle=t.getDocumentAngle(),null!==this.portTargeted&&this.portTargeted(e,t,i,s,n)}setNoTargetPortProperties(e,t,i){null!==t&&(t.desiredSize=lt.TP,t.fromSpot=A.None,t.toSpot=A.None),null!==e&&(e.location=this.diagram.lastInput.documentPoint),null!==this.portTargeted&&this.portTargeted(null,null,e,t,i)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){const e=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),null!==this.targetPort&&this.targetPort.part instanceof nt){const t=this.targetPort.part;this.isForwards?this.copyPortProperties(t,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(t,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(e.allowHorizontalScroll||e.allowVerticalScroll)&&e.doAutoScroll(e.lastInput.viewPoint)}}findValidLinkablePort(e,t){if(null===e)return null;const i=e.part;if(!(i instanceof nt))return null;for(;null!==e;){const s=t?e.toLinkable:e.fromLinkable;if(!0===s&&(null!==e.portId||e instanceof nt)&&(t?this.isValidTo(i,e):this.isValidFrom(i,e)))return e;if(!1===s)return null;e=e.panel}return null}findTargetPort(e){const t=this.diagram,i=t.lastInput.documentPoint;let o=1/0,r=null;const a=t.findObjectsNear(i,this.portGravity,l=>this.findValidLinkablePort(l,e),null,!0).iterator;for(;a.next();){const l=a.value,h=l.part;if(!(h instanceof nt))continue;const c=l.getDocumentPoint(A.Center,S.l()),u=i.x-c.x,d=i.y-c.y;S.i(c);const f=u*u+d*d;if(f<o){const p=this.validPortsCache.get(l);null!==p?p&&(r=l,o=f):e&&this.isValidLink(this.originalFromNode,this.originalFromPort,h,l)||!e&&this.isValidLink(h,l,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(l,!0),r=l,o=f):this.validPortsCache.set(l,!1)}}if(null!==r){const l=r.part;if(l instanceof nt&&(null===l.layer||l.layer.allowLink))return r}return null}isValidFrom(e,t){if(null===e||null===t)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(null!==e.layer&&!e.layer.allowLink||!0!==t.fromLinkable))return!1;const i=t.fromMaxLinks;if(i<1/0){if(null!==this.originalLink&&e===this.originalFromNode&&t===this.originalFromPort)return!0;let s=t.portId;if(null===s&&(s=""),e.findLinksOutOf(s).count>=i)return!1}return!0}isValidTo(e,t){if(null===e||null===t)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(null!==e.layer&&!e.layer.allowLink||!0!==t.toLinkable))return!1;const i=t.toMaxLinks;if(i<1/0){if(null!==this.originalLink&&e===this.originalToNode&&t===this.originalToPort)return!0;let s=t.portId;if(null===s&&(s=""),e.findLinksInto(s).count>=i)return!1}return!0}isInSameNode(e,t){if(null===e||null===t)return!1;if(e===t)return!0;const i=e.part;return null!==i&&i===t.part}isLinked(e,t){if(null===e||null===t)return!1;const i=e.part;if(!(i instanceof nt))return!1;let s=e.portId;null===s&&(s="");const n=t.part;if(!(n instanceof nt))return!1;let o=t.portId;null===o&&(o="");const r=n.findLinksInto(o);for(;r.next();){const a=r.value;if(a.fromNode===i&&a.fromPortId===s)return!0}return!1}isValidLink(e,t,i,s){if(!this.isValidFrom(e,t)||!this.isValidTo(i,s)||null!==t&&null!==s&&((!t.fromLinkableSelfNode||!s.toLinkableSelfNode)&&this.isInSameNode(t,s)||(!t.fromLinkableDuplicates||!s.toLinkableDuplicates)&&this.isLinked(t,s))||null!==this.originalLink&&(null!==e&&this.isLabelDependentOnLink(e,this.originalLink)||null!==i&&this.isLabelDependentOnLink(i,this.originalLink))||null!==e&&null!==i&&(null===e.data&&null!==i.data||null!==e.data&&null===i.data)||!this.isValidCycle(e,i,this.originalLink))return!1;let n;return!(null!==e&&null!==t&&(n=e.linkValidation,null!==n&&!n(e,t,i,s,this.originalLink))||null!==i&&null!==s&&(n=i.linkValidation,null!==n&&!n(e,t,i,s,this.originalLink)))&&(n=this.linkValidation,null===n||n(e,t,i,s,this.originalLink))}isLabelDependentOnLink(e,t){if(null===e)return!1;const i=e.labeledLink;if(null===i)return!1;if(i===t)return!0;const s=new z;return s.add(e),this.VS(i,t,s)}VS(e,t,i){if(e===t)return!0;const s=e.fromNode;if(null!==s&&s.labeledLink&&(i.add(s),this.VS(s.labeledLink,t,i)))return!0;const n=e.toNode;return!(null===n||!n.labeledLink||(i.add(n),!this.VS(n.labeledLink,t,i)))}isValidCycle(e,t,i){if(void 0===i&&(i=null),null===e||null===t)return this.isUnconnectedLinkValid;const s=this.diagram;let n=1;if(s&&(n=s.model.Vm()?s.isTreePathToChildren?5:6:s.validCycle),1===n)return!0;if(5===n){const o=i||this.temporaryLink;if(null!==o&&!o.isTreeLink)return!0;const r=t.linksConnected;for(;r.next();){const a=r.value;if(a!==i&&a.isTreeLink&&a.toNode===t)return!1}return!this.Vu(e,t,i,!0)}if(6===n){const o=i||this.temporaryLink;if(null!==o&&!o.isTreeLink)return!0;const r=e.linksConnected;for(;r.next();){const a=r.value;if(a!==i&&a.isTreeLink&&a.fromNode===e)return!1}return!this.Vu(e,t,i,!0)}return 2===n?!this.pR(e,t,i):3===n?!this.Vu(e,t,i,!1):4!==n||!this.yR(e,t,i)}Vu(e,t,i,s){if(e===t)return!0;if(null===e||null===t)return!1;const n=e.linksConnected;for(;n.next();){const o=n.value;if(o===i||s&&!o.isTreeLink||o.toNode!==e)continue;const r=o.fromNode;if(r!==e&&null!==r&&this.Vu(r,t,i,s))return!0}return!1}pR(e,t,i){if(e===t)return!0;const s=new Set;return s.add(t),this.SA(s,e,t,i)}SA(e,t,i,s){if(t===i)return!0;if(null===t||null===i||e.has(t))return!1;e.add(t);const n=t.linksConnected;for(;n.next();){const o=n.value;if(o===s||o.toNode!==t)continue;const r=o.fromNode;if(r!==t&&null!==r&&this.SA(e,r,i,s))return!0}return!1}yR(e,t,i){if(e===t)return!0;const s=new Set;return s.add(t),this.MA(s,e,t,i)}MA(e,t,i,s){if(t===i)return!0;if(null===t||null===i||e.has(t))return!1;e.add(t);const n=t.linksConnected;for(;n.next();){const o=n.value;if(o===s)continue;const r=o.fromNode,l=r===t?o.toNode:r;if(l!==t&&null!==l&&this.MA(e,l,i,s))return!0}return!1}get linkValidation(){return this.El}set linkValidation(e){null!==e&&y.S(e,ce,"linkValidation"),this.El=e}get portTargeted(){return this.US}set portTargeted(e){null!==e&&y.S(e,ce,"portTargeted"),this.US=e}}var vs=(m=>(m[m.Either=1]="Either",m[m.ForwardsOnly=2]="ForwardsOnly",m[m.BackwardsOnly=3]="BackwardsOnly",m))(vs||{});let Ps=(()=>{class m extends ce{BS;zS;P;XS;constructor(t){super(),this.name="Linking",this.BS={},this.zS=null,this.P=1,this.XS=null,t&&Object.assign(this,t)}static Either=1;static ForwardsOnly=2;static BackwardsOnly=3;get archetypeLinkData(){return this.BS}set archetypeLinkData(t){null!==t&&y.xc(t,m,"archetypeLinkData"),t instanceof st&&y.se(t,gt,m,"archetypeLinkData"),this.BS=t}get archetypeLabelNodeData(){return this.zS}set archetypeLabelNodeData(t){null!==t&&y.xc(t,m,"archetypeLabelNodeData"),t instanceof st&&y.se(t,nt,m,"archetypeLabelNodeData"),this.zS=t}get direction(){return this.P}set direction(t){this.P=t}get startObject(){return this.XS}set startObject(t){null!==t&&y.se(t,st,m,"startObject"),this.XS=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.Ax()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())&&null!==this.findLinkablePort()}findLinkablePort(){const t=this.diagram;let i=this.startObject;if(null===i&&(i=t.findObjectAt(t.firstInput.documentPoint,null,null)),null===i)return null;const s=i.part;if(!(s instanceof nt))return null;const n=this.direction;if(1===n||2===n){const o=this.findValidLinkablePort(i,!1);if(null!==o)return this.isForwards=!0,o;if(this.startObject===s){const r=s.port;if(this.findValidLinkablePort(r,!1))return this.isForwards=!0,r}}if(1===n||3===n){const o=this.findValidLinkablePort(i,!0);if(null!==o)return this.isForwards=!1,o;if(this.startObject===s){const r=s.port;if(this.findValidLinkablePort(r,!0))return this.isForwards=!1,r}}return null}doActivate(){const t=this.diagram,i=this.findLinkablePort();if(null!==i){if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){null!==this.temporaryToNode&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=i;const s=this.originalFromPort.part;s instanceof nt&&(this.originalFromNode=s),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{null!==this.temporaryFromNode&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=i;const s=this.originalToPort.part;s instanceof nt&&(this.originalToNode=s),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),null!==this.temporaryLink&&(null!==this.temporaryFromNode&&(this.temporaryLink.fromNode=this.temporaryFromNode),null!==this.temporaryToNode&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.$t(),t.add(this.temporaryLink)),this.isActive=!0}else this.stopTool()}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=null,s=null,n=null,o=null,r=null;try{this.targetPort=this.findTargetPort(this.isForwards);const a=this.targetPort;if(null!==a){const l=a.part;l instanceof nt&&(this.isForwards?(null!==this.originalFromNode&&(i=this.originalFromNode,s=this.originalFromPort),n=l,o=a):(i=l,s=a,null!==this.originalToNode&&(n=this.originalToNode,o=this.originalToPort)))}else this.isForwards?null!==this.originalFromNode&&this.isUnconnectedLinkValid&&(i=this.originalFromNode,s=this.originalFromPort):null!==this.originalToNode&&this.isUnconnectedLinkValid&&(n=this.originalToNode,o=this.originalToPort);null!==i||null!==n?(r=this.insertLink(i,s,n,o),null!==r?(null===a&&(this.isForwards?r.defaultToPoint=t.lastInput.documentPoint:r.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.T("ChangingSelection",t.selection),t.clearSelection(!0),r.isSelected=!0),this.transactionResult=this.name,t.T("LinkDrawn",r)):this.doNoLink(i,s,n,o)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),r&&t.allowSelect&&t.T("ChangedSelection",t.selection)}}}isNewTreeLink(){const t=this.archetypeLinkData;if(null===t)return!0;if(t instanceof gt)return t.isTreeLink;const i=this.diagram;if(null===i)return!0;const s=i.partManager.getLinkCategoryForData(t),n=i.partManager.findLinkTemplateForCategory(s);return null===n||n.isTreeLink}insertLink(t,i,s,n){return this.diagram.partManager.insertLink(t,i,s,n)}doNoLink(t,i,s,n){}}return m})();class Ze extends ce{NA=null;CA=null;GS=null;YS=null;Ss;KS;constructor(e){super(),this.name="Relinking",this.fromHandleArchetype=new rt("Diamond",{desiredSize:lt.Su,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.toHandleArchetype=new rt("Diamond",{desiredSize:lt.Su,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.KS=new j,e&&Object.assign(this,e)}updateAdornments(e){if(null===e||!(e instanceof gt))return;let t="RelinkFrom",i=null;if(e.isSelected&&!this.diagram.isReadOnly){const s=e.selectionObject;null!==s&&e.canRelinkFrom()&&e.actualBounds.isReal()&&e.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=e.findAdornment(t),null===i&&(i=this.makeAdornment(s,!1),e.addAdornment(t,i)))}if(null===i&&e.removeAdornment(t),t="RelinkTo",i=null,e.isSelected&&!this.diagram.isReadOnly){const s=e.selectionObject;null!==s&&e.canRelinkTo()&&e.actualBounds.isReal()&&e.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=e.findAdornment(t),null===i?(i=this.makeAdornment(s,!0),e.addAdornment(t,i)):i.c())}null===i&&e.removeAdornment(t)}makeAdornment(e,t){let i=t?this.YS:this.GS;return i&&(i=i.copy(),i.adornedObject=e),i}get fromHandleArchetype(){return this.NA}set fromHandleArchetype(e){null!==e&&y.se(e,st,Ze,"fromHandleArchetype"),this.NA=e,this.GS=null!==e?new Nt(J.Link).add(e).It():null}get toHandleArchetype(){return this.CA}set toHandleArchetype(e){null!==e&&y.se(e,st,Ze,"toHandleArchetype"),this.CA=e,this.YS=null!==e?new Nt(J.Link).add(e).It():null}get handle(){return this.Ss}set handle(e){null!==e&&(e.part instanceof Nt||y.o("new handle is not in an Adornment: "+e)),this.Ss=e}canStart(){if(!this.isEnabled)return!1;const e=this.diagram;if(e.isReadOnly||e.isModelReadOnly||!e.allowRelink||!e.model.Ax()||!e.lastInput.left)return!1;let t=this.findToolHandleAt(e.firstInput.documentPoint,"RelinkFrom");return null===t&&(t=this.findToolHandleAt(e.firstInput.documentPoint,"RelinkTo")),null!==t}doActivate(){const e=this.diagram;if(null===this.originalLink){let i=this.handle;if(null===i&&(i=this.findToolHandleAt(e.firstInput.documentPoint,"RelinkFrom"),null===i&&(i=this.findToolHandleAt(e.firstInput.documentPoint,"RelinkTo"))),null===i)return;const s=i.part;if(!(s instanceof Nt&&s.adornedPart instanceof gt))return;this.handle=i,this.isForwards=null===s||"RelinkTo"===s.category,this.originalLink=s.adornedPart}const t=this.originalLink;null!==t&&(this.startTransaction(this.name),e.isMouseCaptured=!0,e.currentCursor=this.linkingCursor,this.originalFromPort=t.fromPort,this.originalFromNode=t.fromNode,this.originalToPort=t.toPort,this.originalToNode=t.toNode,this.KS.set(t.actualBounds),t.pointsCount>0&&(null===t.fromNode&&(null!==this.temporaryFromPort&&(this.temporaryFromPort.desiredSize=lt.bc),null!==this.temporaryFromNode&&(this.temporaryFromNode.location=t.getPoint(0))),null===t.toNode&&(null!==this.temporaryToPort&&(this.temporaryToPort.desiredSize=lt.bc),null!==this.temporaryToNode&&(this.temporaryToNode.location=t.getPoint(t.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),e.add(this.temporaryFromNode),e.add(this.temporaryToNode),null!==this.temporaryLink&&(null!==this.temporaryFromNode&&(this.temporaryLink.fromNode=this.temporaryFromNode),null!==this.temporaryToNode&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(t,this.temporaryLink),this.temporaryLink.$t(),e.add(this.temporaryLink)),this.isActive=!0)}copyLinkProperties(e,t){if(null===e||null===t)return;t.adjusting=e.adjusting,t.corner=e.corner;let i=e.curve;(11===i||10===i)&&(i=0),t.curve=i,t.curviness=e.curviness,t.isTreeLink=e.isTreeLink,t.points=e.points,t.routing=e.routing,t.smoothness=e.smoothness,t.fromSpot=e.fromSpot,t.fromEndSegmentLength=e.fromEndSegmentLength,t.fromShortLength=e.fromShortLength,t.toSpot=e.toSpot,t.toEndSegmentLength=e.toEndSegmentLength,t.toShortLength=e.toShortLength}doDeactivate(){this.isActive=!1;const e=this.diagram;e.remove(this.temporaryLink),e.remove(this.temporaryFromNode),e.remove(this.temporaryToNode),e.isMouseCaptured=!1,e.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){const e=this.diagram;this.transactionResult=null;let t=this.originalFromNode,i=this.originalFromPort,s=this.originalToNode,n=this.originalToPort,o=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),null!==this.targetPort){const r=this.targetPort.part;r instanceof nt&&(this.isForwards?(s=r,n=this.targetPort):(t=r,i=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(s=null,n=null):(t=null,i=null):o=null;null!==o?(this.reconnectLink(o,this.isForwards?s:t,this.isForwards?n:i,this.isForwards),null===this.targetPort&&(this.isForwards?o.defaultToPoint=e.lastInput.documentPoint:o.defaultFromPoint=e.lastInput.documentPoint,o.$t()),this.transactionResult=this.name,e.T("LinkRelinked",o,this.isForwards?this.originalToPort:this.originalFromPort)):null!==this.originalLink&&this.doNoRelink(this.originalLink,this.isForwards),null!==this.originalLink&&this.originalLink.invalidateOtherJumpOvers(this.KS)}finally{this.stopTool()}}}reconnectLink(e,t,i,s){const n=null!==i&&null!==i.portId?i.portId:"";return s?(e.toNode=t,e.toPortId=n):(e.fromNode=t,e.fromPortId=n),!0}doNoRelink(e,t){}doDraggingMouseMove(e,t,i,s){null!==e?(this.copyPortProperties(e,t,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),null!==i?(this.copyPortProperties(i,s,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var ks=(m=>(m[m.None=0]="None",m[m.Horizontal=1]="Horizontal",m[m.Vertical=2]="Vertical",m[m.All=3]="All",m))(ks||{});let Ss=(()=>{class m extends te{Mr;HS;jS;Ss;Tx;qS;Bm;constructor(t){super(),this.name="LinkReshaping",this.Mr=new rt("Rectangle",{desiredSize:lt.RL,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.HS=new rt("Diamond",{desiredSize:lt.Su,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.jS=3,this.Ss=null,this.Tx=null,this.qS=new S,this.Bm=new H,t&&Object.assign(this,t)}static None=0;static Horizontal=1;static Vertical=2;static All=3;getReshapingBehavior(t){return t?t.Nr:0}setReshapingBehavior(t,i){t.Nr=i}updateAdornments(t){if(null===t||!(t instanceof gt))return;let i=null;if(t.isSelected&&!this.diagram.isReadOnly){const s=t.path;null!==s&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(this.name),(null===i||i.WS!==t.pointsCount||i.JS!==t.resegmentable)&&(i=this.makeAdornment(s),null!==i&&(i.WS=t.pointsCount,i.JS=t.resegmentable,t.addAdornment(this.name,i))))}null===i&&t.removeAdornment(this.name)}makeAdornment(t){const i=t.part,o=i.isOrthogonal;let r=null;if(null!==i.points&&i.pointsCount>1){r=new Nt,r.type=J.Link;const a=i.firstPickIndex,l=i.lastPickIndex,h=o?1:0;if(i.resegmentable&&9!==i.computeCurve())for(let c=a+h;c<l-h;c++){const u=this.makeResegmentHandle(t,c);null!==u&&(u.segmentIndex=c,u.segmentFraction=.5,u.fromMaxLinks=999,r.add(u))}for(let c=a+1;c<l;c++){const u=this.makeHandle(t,c);if(null!==u){if(u.segmentIndex=c,c!==a)if(c===a+1&&o){const d=i.getPoint(a);let f=i.getPoint(a+1);L.u(d.x,f.x)&&L.u(d.y,f.y)?(f=i.getPoint(a-1),L.u(d.x,f.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):L.u(d.y,f.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")):L.u(d.x,f.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):L.u(d.y,f.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")}else if(c===l-1&&o){let d=i.getPoint(l-1);const f=i.getPoint(l);L.u(d.x,f.x)&&L.u(d.y,f.y)?(d=i.getPoint(l+1),L.u(d.x,f.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):L.u(d.y,f.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")):L.u(d.x,f.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):L.u(d.y,f.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")}else c===l||(this.setReshapingBehavior(u,3),u.cursor="move");r.add(u)}}r.adornedObject=t}return r}makeHandle(t,i){const s=this.handleArchetype;return null===s?null:s.copy().$S()}get handleArchetype(){return this.Mr}set handleArchetype(t){null!==t&&y.se(t,st,m,"handleArchetype"),this.Mr=t}makeResegmentHandle(t,i){const s=this.midHandleArchetype;return null===s?null:s.copy().$S()}get midHandleArchetype(){return this.HS}set midHandleArchetype(t){null!==t&&y.se(t,st,m,"midHandleArchetype"),this.HS=t}get handle(){return this.Ss}set handle(t){null!==t&&(t.part instanceof Nt||y.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedLink(){return this.Tx}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(t.isReadOnly||!t.allowReshape||!t.lastInput.left)&&null!==this.findToolHandleAt(t.firstInput.documentPoint,this.name)}doActivate(){const t=this.diagram;if(null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null===this.handle)return;const i=this.handle.part.adornedPart;if(i instanceof gt){if(this.Tx=i,t.isMouseCaptured=!0,this.startTransaction(this.name),i.resegmentable&&999===this.handle.fromMaxLinks){const s=i.points.copy(),n=this.getResegmentingPoint();if(s.insertAt(this.handle.segmentIndex+1,n),i.isOrthogonal&&s.insertAt(this.handle.segmentIndex+1,n),i.points=s,i.invalidateAdornments(),i.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),null===this.handle)return void this.doDeactivate()}this.qS=i.getPoint(this.handle.segmentIndex),this.Bm=i.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Tx=null,this.diagram.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.adornedLink;null!==t&&(t.points=this.Bm),this.stopTool()}getResegmentingPoint(){return null===this.handle?this.diagram.lastInput.documentPoint:this.handle.getDocumentPoint(A.Center)}doMouseMove(){if(this.isActive){const i=this.computeReshape(this.diagram.lastInput.documentPoint);this.reshape(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i);const s=this.adornedLink;if(null!==s&&s.resegmentable&&null!==this.handle){const n=this.handle.segmentIndex,o=s.getPoint(n-1),r=s.getPoint(n),a=s.getPoint(n+1);if(s.isOrthogonal){if(n>s.firstPickIndex+1&&n<s.lastPickIndex-1){let l=s.getPoint(n-2);if(this.isWithinResegmentingDistance(o,r)&&(this.isInLineOrtho(l,o,r,a,!0)||this.isInLineOrtho(l,o,r,a,!1))){const h=s.points.copy();this.isInLineOrtho(l,o,r,a,!0)?(h.setElt(n-2,new S(l.x,(a.y+l.y)/2)),h.setElt(n+1,new S(a.x,(a.y+l.y)/2))):(h.setElt(n-2,new S((a.x+l.x)/2,l.y)),h.setElt(n+1,new S((a.x+l.x)/2,a.y))),h.removeAt(n),h.removeAt(n-1),s.points=h,s.invalidateAdornments()}else if(l=s.getPoint(n+2),this.isWithinResegmentingDistance(r,a)&&(this.isInLineOrtho(o,r,a,l,!0)||this.isInLineOrtho(o,r,a,l,!1))){const h=s.points.copy();this.isInLineOrtho(o,r,a,l,!0)?(h.setElt(n-1,new S(o.x,(o.y+l.y)/2)),h.setElt(n+2,new S(l.x,(o.y+l.y)/2))):(h.setElt(n-1,new S((o.x+l.x)/2,o.y)),h.setElt(n+2,new S((o.x+l.x)/2,l.y))),h.removeAt(n+1),h.removeAt(n),s.points=h,s.invalidateAdornments()}}}else{const l=S.l();if(L.Nl(o.x,o.y,a.x,a.y,r.x,r.y,l)&&l.distanceSquaredPoint(r)<this.resegmentingDistance*this.resegmentingDistance){const h=s.points.copy();h.removeAt(n),s.points=h,s.invalidateAdornments()}S.i(l)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("LinkReshaped",this.adornedLink,this.Bm)}this.stopTool()}isWithinResegmentingDistance(t,i){return Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(t.y-i.y)<this.resegmentingDistance}isInLineOrtho(t,i,s,n,o){return o?Math.abs(t.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance&&Math.abs(s.y-n.y)<this.resegmentingDistance:Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance&&Math.abs(s.x-n.x)<this.resegmentingDistance}get resegmentingDistance(){return this.jS}set resegmentingDistance(t){y.s(t,"number",m,"resegmentingDistance"),this.jS=t}reshape(t){const i=this.adornedLink;if(null===i)return;const s=this.handle;if(null===s)return;i.startRoute();let n=s.segmentIndex;const o=this.getReshapingBehavior(s);if(i.isOrthogonal)if(n===i.firstPickIndex+1){const r=i.firstPickIndex+1;2===o?(i.setPointAt(r,i.getPoint(r-1).x,t.y),i.setPointAt(r+1,i.getPoint(r+2).x,t.y)):1===o&&(i.setPointAt(r,t.x,i.getPoint(r-1).y),i.setPointAt(r+1,t.x,i.getPoint(r+2).y))}else if(n===i.lastPickIndex-1){const r=i.lastPickIndex-1;2===o?(i.setPointAt(r-1,i.getPoint(r-2).x,t.y),i.setPointAt(r,i.getPoint(r+1).x,t.y)):1===o&&(i.setPointAt(r-1,t.x,i.getPoint(r-2).y),i.setPointAt(r,t.x,i.getPoint(r+1).y))}else{let r=n;const a=i.getPoint(r);if(!t.equalsApprox(a)){const l=i.getPoint(r-2),h=i.getPoint(r-1),c=i.getPoint(r+1),u=i.getPoint(r+2);L.u(a.x,c.x)&&L.u(c.y,u.y)?i.setPointAt(r+1,t.x,c.y):L.u(a.y,c.y)&&L.u(c.x,u.x)&&i.setPointAt(r+1,c.x,t.y),L.u(a.x,h.x)&&L.u(h.y,l.y)?i.setPointAt(r-1,t.x,h.y):L.u(a.y,h.y)&&L.u(h.x,l.x)&&i.setPointAt(r-1,h.x,t.y)}i.setPointAt(n,t.x,t.y)}else{i.setPointAt(n,t.x,t.y);let r=i.fromNode,a=i.fromPort;if(null!==r){const c=r.findVisibleNode();null!==c&&c!==r&&(r=c,a=r.port)}if(1===n&&null!==a&&i.computeSpot(!0,a).isNoSpot()){const c=a.getDocumentPoint(A.Center,S.l()),u=i.getLinkPointFromPoint(r,a,c,t,!0,S.l());i.setPointAt(0,u.x,u.y),S.i(c),S.i(u)}let l=i.toNode,h=i.toPort;if(null!==l){const c=l.findVisibleNode();null!==c&&c!==l&&(l=c,h=l.port)}if(n===i.pointsCount-2&&null!==h&&i.computeSpot(!1,h).isNoSpot()){const c=h.getDocumentPoint(A.Center,S.l()),u=i.getLinkPointFromPoint(l,h,c,t,!1,S.l());i.setPointAt(i.pointsCount-1,u.x,u.y),S.i(c),S.i(u)}}i.commitRoute()}computeReshape(t){const i=this.adornedLink;if(null===i)return t;const s=this.handle;if(null===s)return t;const n=s.segmentIndex;switch(this.getReshapingBehavior(s)){case 3:return t;case 2:{const o=i.getPoint(n);return new S(o.x,t.y)}case 1:{const o=i.getPoint(n);return new S(t.x,o.y)}default:return i.getPoint(n)}}get originalPoint(){return this.qS}get originalPoints(){return this.Bm}}return m})();class Qe extends te{Cr;Lr;Oo;Oc;ZS;Ms;Mr;Ss;zm;QS;Ic;Dx;vx;Fx;constructor(e){super(),this.name="Resizing",this.Cr=new lt(1,1).k(),this.Lr=new lt(9999,9999).k(),this.Oo=new lt(NaN,NaN).k(),this.Oc=!1,this.ZS=!0,this.Ms=null,this.Mr=new rt("Rectangle",{alignmentFocus:A.Center,desiredSize:lt.RL,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.zm=new S,this.QS=new lt,this.Ic=new S,this.Dx=new lt(0,0),this.vx=new lt(1/0,1/0),this.Fx=new lt(1,1),e&&Object.assign(this,e)}updateAdornments(e){if(null!==e){if(e.Ar()){const t=e.rotateObject;if(t===e||t===e.path||t.isPanelMain)return}if(e.isSelected&&!this.diagram.isReadOnly){const t=e.resizeObject;let i=e.findAdornment(this.name);if(null!==t&&e.canResize()&&e.actualBounds.isReal()&&e.isVisible()&&t.actualBounds.isReal()&&t.isVisibleObject()&&((null===i||i.adornedObject!==t)&&(i=this.makeAdornment(t)),null!==i)){const s=t.getDocumentAngle();return e.Ul()&&this.updateResizeHandles(i,s),void e.addAdornment(this.name,i)}}e.removeAdornment(this.name)}}makeAdornment(e){let t=null;const i=e.part?.resizeAdornmentTemplate;if(i){if(t=i.copy(),null===t)return null}else{t=new Nt,t.type=J.Spot,t.locationSpot=A.Center;const s=new de;s.isPanelMain=!0,t.add(s);let n=this.makeHandle(e,A.TopLeft);null!==n&&t.add(n),n=this.makeHandle(e,A.TopRight),null!==n&&t.add(n),n=this.makeHandle(e,A.BottomRight),null!==n&&t.add(n),n=this.makeHandle(e,A.BottomLeft),null!==n&&t.add(n),n=this.makeHandle(e,A.MiddleTop),null!==n&&t.add(n),n=this.makeHandle(e,A.MiddleRight),null!==n&&t.add(n),n=this.makeHandle(e,A.MiddleBottom),null!==n&&t.add(n),n=this.makeHandle(e,A.MiddleLeft),null!==n&&t.add(n)}return t.adornedObject=e,t}makeHandle(e,t){const i=this.handleArchetype;if(null===i)return null;const s=i.copy().$S();return s.alignment=t,s}updateResizeHandles(e,t){if(null!==e)if(!e.alignment.isDefault()&&("pointer"===e.cursor||e.cursor.indexOf("resize")>0))this.wR(e,t);else if(e instanceof J){const i=e.elements;for(;i.next();)this.updateResizeHandles(i.value,t)}}wR(e,t){let i=e.alignment;i.isNoSpot()&&(i=A.Center);let s=t;if(i.x<=0)s+=i.y<=0?225:i.y>=1?135:180;else if(i.x>=1)i.y<=0?s+=315:i.y>=1&&(s+=45);else if(i.y<=0)s+=270;else{if(!(i.y>=1))return;s+=90}s=L.Ee(s),e.cursor=s<22.5?"e-resize":s<67.5?"se-resize":s<112.5?"s-resize":s<157.5?"sw-resize":s<202.5?"w-resize":s<247.5?"nw-resize":s<292.5?"n-resize":s<337.5?"ne-resize":"e-resize"}get handleArchetype(){return this.Mr}set handleArchetype(e){null!==e&&y.se(e,st,Qe,"handleArchetype"),this.Mr=e}get handle(){return this.Ss}set handle(e){null!==e&&(e.part instanceof Nt||y.o("new handle is not in an Adornment: "+e)),this.Ss=e}get adornedObject(){return this.Ms}set adornedObject(e){null!==e&&e.part instanceof Nt&&y.o("new handle must not be in an Adornment: "+e),this.Ms=e}canStart(){if(!this.isEnabled)return!1;const e=this.diagram;return!(e.isReadOnly||!e.allowResize||!e.lastInput.left)&&null!==this.findToolHandleAt(e.firstInput.documentPoint,this.name)}doActivate(){const e=this.diagram;null===this.handle&&(this.handle=this.findToolHandleAt(e.firstInput.documentPoint,this.name)),null!==this.handle&&(this.adornedObject=this.handle.part.adornedObject,null!==this.adornedObject&&null!==this.adornedObject.part&&(e.isMouseCaptured=!0,e.animationManager.stopAnimation(),e.Iu=!0,this.startTransaction(this.name),this.zm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.Ic.set(this.adornedObject.part.location),this.QS.set(this.adornedObject.desiredSize),this.Fx=this.computeCellSize(),this.Dx=this.computeMinSize(),this.vx=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){const e=this.diagram;e.Iu=!1,e.Fl=!0,this.stopTransaction(),this.handle=null,this.Ms=null,e.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const e=this.diagram,t=super.stopTransaction();return t&&null!==e.undoManager.transactionToUndo&&e.undoManager.transactionToUndo.optimize(),t}doCancel(){null!==this.adornedObject&&null!==this.adornedObject.part&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){const e=this.diagram;if(!this.isActive||null===this.adornedObject||null===this.handle)return;const t=this.Dx,i=this.vx,s=this.Fx,o=this.adornedObject.getLocalPoint(e.lastInput.documentPoint,S.l()),r=this.computeReshape(),a=this.computeResize(o,this.handle.alignment,t,i,s,r);this.resize(a),e.maybeUpdate(),S.i(o)}doMouseUp(){const e=this.diagram;if(this.isActive&&null!==this.adornedObject&&null!==this.handle){const t=this.Dx,i=this.vx,s=this.Fx,n=this.adornedObject.getLocalPoint(e.lastInput.documentPoint,S.l()),o=this.computeReshape(),r=this.computeResize(n,this.handle.alignment,t,i,s,o);this.resize(r),S.i(n),e.invalidateDocumentBounds(),this.transactionResult=this.name,e.T("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(e){const t=this.diagram,i=this.adornedObject;if(null===i)return;i.desiredSize=e.size;const s=i.part;if(null===s||null===this.handle)return;s.ensureBounds();const n=i.getDocumentPoint(this.handle.alignment.opposite());if(s instanceof pt){const o=new H;let r;o.add(s),!this.dragsMembers&&!s.hasPlaceholder()&&(r=new Mi,r.dragsMembers=!1),t.moveParts(o,this.oppositePoint.copy().subtract(n),!0,r)}else s.location=s.location.copy().subtract(n).add(this.oppositePoint);t.maybeUpdate()}computeResize(e,t,i,s,n,o){if(null===this.adornedObject)return j.em;t.isNoSpot()&&(t=A.Center);const r=this.adornedObject.naturalBounds,a=r.x,l=r.y,h=r.x+r.width,c=r.y+r.height;let u=1;if(!o){let p=r.width,g=r.height;p<=0&&(p=1),g<=0&&(g=1),u=g/p}const d=S.l();L.tm(e.x,e.y,a,l,n.width,n.height,d);const f=r.copy();return t.x<=0?t.y<=0?(f.x=Math.max(d.x,h-s.width),f.x=Math.min(f.x,h-i.width),f.width=Math.max(h-f.x,i.width),f.y=Math.max(d.y,c-s.height),f.y=Math.min(f.y,c-i.height),f.height=Math.max(c-f.y,i.height),o||(f.height/f.width>=1?(f.height=Math.max(Math.min(u*f.width,s.height),i.height),f.width=f.height/u):(f.width=Math.max(Math.min(f.height/u,s.width),i.width),f.height=u*f.width),f.x=h-f.width,f.y=c-f.height)):t.y>=1?(f.x=Math.max(d.x,h-s.width),f.x=Math.min(f.x,h-i.width),f.width=Math.max(h-f.x,i.width),f.height=Math.max(Math.min(d.y-l,s.height),i.height),o||(f.height/f.width>=1?(f.height=Math.max(Math.min(u*f.width,s.height),i.height),f.width=f.height/u):(f.width=Math.max(Math.min(f.height/u,s.width),i.width),f.height=u*f.width),f.x=h-f.width)):(f.x=Math.max(d.x,h-s.width),f.x=Math.min(f.x,h-i.width),f.width=h-f.x,o||(f.height=Math.max(Math.min(u*f.width,s.height),i.height),f.width=f.height/u,f.y=l+.5*(c-l-f.height))):t.x>=1?t.y<=0?(f.width=Math.max(Math.min(d.x-a,s.width),i.width),f.y=Math.max(d.y,c-s.height),f.y=Math.min(f.y,c-i.height),f.height=Math.max(c-f.y,i.height),o||(f.height/f.width>=1?(f.height=Math.max(Math.min(u*f.width,s.height),i.height),f.width=f.height/u):(f.width=Math.max(Math.min(f.height/u,s.width),i.width),f.height=u*f.width),f.y=c-f.height)):t.y>=1?(f.width=Math.max(Math.min(d.x-a,s.width),i.width),f.height=Math.max(Math.min(d.y-l,s.height),i.height),o||(f.height/f.width>=1?(f.height=Math.max(Math.min(u*f.width,s.height),i.height),f.width=f.height/u):(f.width=Math.max(Math.min(f.height/u,s.width),i.width),f.height=u*f.width))):(f.width=Math.max(Math.min(d.x-a,s.width),i.width),o||(f.height=Math.max(Math.min(u*f.width,s.height),i.height),f.width=f.height/u,f.y=l+.5*(c-l-f.height))):t.y<=0?(f.y=Math.max(d.y,c-s.height),f.y=Math.min(f.y,c-i.height),f.height=c-f.y,o||(f.width=Math.max(Math.min(f.height/u,s.width),i.width),f.height=u*f.width,f.x=a+.5*(h-a-f.width))):t.y>=1&&(f.height=Math.max(Math.min(d.y-l,s.height),i.height),o||(f.width=Math.max(Math.min(f.height/u,s.width),i.width),f.height=u*f.width,f.x=a+.5*(h-a-f.width))),S.i(d),f}computeReshape(){let e=0;return this.adornedObject instanceof rt&&(e=this.adornedObject._S()),!(6===e||this.diagram.lastInput.shift)}computeMinSize(){if(null===this.adornedObject)return lt.bc;const e=this.adornedObject.minSize.copy(),t=this.minSize;return!isNaN(t.width)&&t.width>e.width&&(e.width=t.width),!isNaN(t.height)&&t.height>e.height&&(e.height=t.height),e}computeMaxSize(){if(null===this.adornedObject)return lt.DP;const e=this.adornedObject.maxSize.copy(),t=this.maxSize;return!isNaN(t.width)&&t.width<e.width&&(e.width=t.width),!isNaN(t.height)&&t.height<e.height&&(e.height=t.height),e}computeCellSize(){const e=new lt(NaN,NaN),t=this.adornedObject?.part;if(t){const n=t.resizeCellSize;!isNaN(n.width)&&n.width>0&&(e.width=n.width),!isNaN(n.height)&&n.height>0&&(e.height=n.height)}let i=this.cellSize;isNaN(e.width)&&!isNaN(i.width)&&i.width>0&&(e.width=i.width),isNaN(e.height)&&!isNaN(i.height)&&i.height>0&&(e.height=i.height);const s=this.diagram;if((isNaN(e.width)||isNaN(e.height))&&s){const n=s.grid;null!==n&&n.visible&&this.isGridSnapEnabled&&(i=n.gridCellSize,isNaN(e.width)&&!isNaN(i.width)&&i.width>0&&(e.width=i.width),isNaN(e.height)&&!isNaN(i.height)&&i.height>0&&(e.height=i.height))}return(isNaN(e.width)||0===e.width||e.width===1/0)&&(e.width=1),(isNaN(e.height)||0===e.height||e.height===1/0)&&(e.height=1),e}get minSize(){return this.Cr}set minSize(e){if(!this.Cr.equals(e)){let t=e.width;isNaN(t)&&(t=0);let i=e.height;isNaN(i)&&(i=0),this.Cr.e(t,i)}}get maxSize(){return this.Lr}set maxSize(e){if(!this.Lr.equals(e)){let t=e.width;isNaN(t)&&(t=1/0);let i=e.height;isNaN(i)&&(i=1/0),this.Lr.e(t,i)}}get cellSize(){return this.Oo}set cellSize(e){this.Oo.equals(e)||this.Oo.h(e)}get isGridSnapEnabled(){return this.Oc}set isGridSnapEnabled(e){y.s(e,"boolean",Qe,"isGridSnapEnabled"),this.Oc=e}get dragsMembers(){return this.ZS}set dragsMembers(e){y.s(e,"boolean",Qe,"dragsMembers"),this.ZS=e}get oppositePoint(){return this.zm}set oppositePoint(e){this.zm.equals(e)||this.zm.h(e)}get originalDesiredSize(){return this.QS}get originalLocation(){return this.Ic}}class Fe extends te{tM;eM;Ms=null;Mr=null;Rx=null;Ss=null;iM;Xm;Ic;sM;nM;constructor(e){super(),this.name="Rotating",this.tM=45,this.eM=2,this.Ic=new S,this.Ms=null,this.handleArchetype=new rt("Ellipse",{desiredSize:lt.Su,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.iM=0,this.Xm=new S(NaN,NaN),this.sM=0,this.nM=50,e&&Object.assign(this,e)}updateAdornments(e){if(null!==e){if(e.Ar()){const t=e.rotateObject;if(t===e||t===e.path||t.isPanelMain)return}if(e.isSelected&&!this.diagram.isReadOnly){const t=e.rotateObject;if(null!==t&&e.canRotate()&&e.actualBounds.isReal()&&e.isVisible()&&t.actualBounds.isReal()&&t.isVisibleObject()){let i=e.findAdornment(this.name);if((null===i||i.adornedObject!==t)&&(i=this.makeAdornment(t)),null!==i)return i.angle=t.getDocumentAngle(),i.hasPlaceholder()||(i.location=this.computeAdornmentLocation(t)),void e.addAdornment(this.name,i)}}e.removeAdornment(this.name)}}makeAdornment(e){let t=null;const i=e.part?.rotateAdornmentTemplate;return i?t=i.copy():null!==this.Rx&&(t=this.Rx.copy()),null===t?null:(t.adornedObject=e,t)}get handleArchetype(){return this.Mr}set handleArchetype(e){null!==e&&y.se(e,st,Fe,"handleArchetype"),this.Mr=e,this.Rx=null!==e?new Nt(J.Position,{locationSpot:A.Center}).add(e).It():null}get handle(){return this.Ss}set handle(e){null!==e&&(e.part instanceof Nt||y.o("new handle is not in an Adornment: "+e)),this.Ss=e}get adornedObject(){return this.Ms}set adornedObject(e){null!==e&&e.part instanceof Nt&&y.o("new handle must not be in an Adornment: "+e),this.Ms=e}canStart(){if(!this.isEnabled)return!1;const e=this.diagram;return!(e.isReadOnly||!e.allowRotate||!e.lastInput.left)&&null!==this.findToolHandleAt(e.firstInput.documentPoint,this.name)}doActivate(){const e=this.diagram;if(null===this.adornedObject){if(null===this.handle&&(this.handle=this.findToolHandleAt(e.firstInput.documentPoint,this.name)),null===this.handle)return;this.adornedObject=this.handle.part.adornedObject}null===this.adornedObject||null===this.adornedObject.part||(e.isMouseCaptured=!0,e.delaysLayout=!0,this.startTransaction(this.name),this.iM=this.adornedObject.angle,this.Xm=this.computeRotationPoint(this.adornedObject),this.Ic=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(e){const t=e.part;if(null!==t){const i=t.locationObject;if(t.rotationSpot.isSpot())return e.getDocumentPoint(t.rotationSpot);if(e===t||e===i)return i.getDocumentPoint(t.locationSpot)}return e.getDocumentPoint(A.Center)}computeAdornmentLocation(e){let t=this.rotationPoint;t.isReal()||(t=this.computeRotationPoint(e));const i=e.getLocalPoint(t);let s=this.handleAngle;s=L.Ee(s),s=Math.round(45*Math.round(s/45));const n=this.handleDistance;return 0===s?i.x=e.naturalBounds.width+n:45===s?(i.x=e.naturalBounds.width+n,i.y=e.naturalBounds.height+n):90===s?i.y=e.naturalBounds.height+n:135===s?(i.x=-n,i.y=e.naturalBounds.height+n):180===s?i.x=-n:225===s?(i.x=-n,i.y=-n):270===s?i.y=-n:315===s&&(i.x=e.naturalBounds.width+n,i.y=-n),e.getDocumentPoint(i)}doDeactivate(){const e=this.diagram;this.stopTransaction(),this.handle=null,this.Ms=null,this.Xm=new S(NaN,NaN),e.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const e=this.diagram,t=super.stopTransaction();return t&&null!==e.undoManager.transactionToUndo&&e.undoManager.transactionToUndo.optimize(),t}doCancel(){this.diagram.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){if(this.isActive){const t=this.computeRotate(this.diagram.lastInput.documentPoint);this.rotate(t)}}doMouseUp(){const e=this.diagram;if(this.isActive){e.delaysLayout=!1;const t=this.computeRotate(e.lastInput.documentPoint);this.rotate(t),e.invalidateDocumentBounds(),this.transactionResult=this.name,e.T("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(e){const t=this.adornedObject;if(null===t||null===t.part)return;t.angle=e;const i=t.part;i.ensureBounds();const s=i.locationObject,n=i.rotateObject;if(s===n||s.isContainedBy(n)){const o=this.Ic.copy();i.location=o.subtract(this.rotationPoint).rotate(e-this.originalAngle).add(this.rotationPoint)}this.diagram.maybeUpdate()}computeRotate(e){let t=this.rotationPoint.directionPoint(e)-this.handleAngle;const i=this.adornedObject?.panel;i&&(t-=i.getDocumentAngle()),t=L.Ee(t);const s=Math.min(Math.abs(this.snapAngleMultiple),180),n=Math.min(Math.abs(this.snapAngleEpsilon),s/2);return!this.diagram.lastInput.shift&&s>0&&n>0&&(t%s<n?t=Math.floor(t/s)*s:t%s>s-n&&(t=(Math.floor(t/s)+1)*s)),L.Ee(t)}get snapAngleMultiple(){return this.tM}set snapAngleMultiple(e){y.s(e,"number",Fe,"snapAngleMultiple"),this.tM=e}get snapAngleEpsilon(){return this.eM}set snapAngleEpsilon(e){y.s(e,"number",Fe,"snapAngleEpsilon"),this.eM=e}get originalAngle(){return this.iM}get rotationPoint(){return this.Xm}set rotationPoint(e){this.Xm=e.copy()}get handleAngle(){return this.sM}set handleAngle(e){y.s(e,"number",Fe,"handleAngle"),this.sM=e}get handleDistance(){return this.nM}set handleDistance(e){y.s(e,"number",Fe,"handleDistance"),this.nM=e}}class Ms extends te{constructor(e){super(),this.name="ClickSelecting",e&&Object.assign(this,e)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class Cs extends te{Ec;constructor(e){super(),this.name="Action",this.Ec=null,e&&Object.assign(this,e)}canStart(){if(!this.isEnabled)return!1;const e=this.diagram,t=e.lastInput,i=e.findObjectAt(t.documentPoint,s=>{for(;null!==s.panel;){if(s.isActionable)return s;s=s.panel}return s});return!(null===i||!i.isActionable||(this.Ec=i,e.vc=e.findObjectAt(t.documentPoint,null,null),0))}doMouseDown(){if(this.isActive){const e=this.diagram.lastInput,t=this.Ec;if(null===t)return;e.targetObject=t,null!==t.actionDown&&t.actionDown(e,t)}else this.canStart()&&this.doActivate()}doMouseMove(){if(this.isActive){const e=this.diagram.lastInput,t=this.Ec;if(null===t)return;e.targetObject=t,null!==t.actionMove&&t.actionMove(e,t)}}doMouseUp(){if(this.isActive){const e=this.diagram.lastInput,t=this.Ec;if(null===t)return;e.targetObject=t,null!==t.actionUp&&t.actionUp(e,t),this.standardMouseClick(i=>{for(;null!==i.panel;){if(i.isActionable&&i===t)return i;i=i.panel}return i},i=>i===t)}this.stopTool()}doCancel(){const e=this.diagram.lastInput,t=this.Ec;null!==t&&(e.targetObject=t,null!==t.actionCancel&&t.actionCancel(e,t),this.stopTool())}doStop(){this.Ec=null}}class _e extends te{Vl;oM;Oc;rM;constructor(e){super(),this.name="ClickCreating",this.Vl=null,this.oM=!0,this.Oc=!1,this.rM=new S(0,0),e&&Object.assign(this,e)}canStart(){if(!this.isEnabled||null===this.archetypeNodeData)return!1;const e=this.diagram;if(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(1===e.lastInput.clickCount&&(this.rM=e.lastInput.viewPoint.copy()),2!==e.lastInput.clickCount||this.isBeyondDragSize(this.rM))return!1}else if(1!==e.lastInput.clickCount)return!1;return!(e.currentTool!==this&&null!==e.findPartAt(e.lastInput.documentPoint,!0))}doMouseUp(){this.isActive&&this.insertPart(this.diagram.lastInput.documentPoint),this.stopTool()}insertPart(e){const t=this.diagram,i=this.archetypeNodeData;if(null===i)return null;let s=null;try{if(t.T("ChangingSelection",t.selection),this.startTransaction(this.name),i instanceof At)i.Di()&&(i.It(),s=i.copy(),null!==s&&t.add(s));else if(null!==i){const n=t.model.copyNodeData(i);t.model.addNodeData(n),s=t.findPartForData(n)}if(null!==s){const n=S.z(e.x,e.y);this.isGridSnapEnabled&&this.diagram.lM(s,e,n),s.location=n,t.allowSelect&&(t.clearSelection(!0),s.isSelected=!0),S.i(n)}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("PartCreated",s)}finally{this.stopTransaction(),t.T("ChangedSelection",t.selection)}return s}get archetypeNodeData(){return this.Vl}set archetypeNodeData(e){null!==e&&y.xc(e,_e,"archetypeNodeData"),this.Vl=e}get isDoubleClick(){return this.oM}set isDoubleClick(e){y.s(e,"boolean",_e,"isDoubleClick"),this.oM=e}get isGridSnapEnabled(){return this.Oc}set isGridSnapEnabled(e){y.s(e,"boolean",_e,"isGridSnapEnabled"),this.Oc=e}}class ci extends te{th;aM;Bl;constructor(e){super(),this.name="DragSelecting",this.th=175,this.aM=!1,this.Bl=new At({layerName:"Tool",selectable:!1}).add(new rt("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).It(),e&&Object.assign(this,e)}canStart(){if(!this.isEnabled)return!1;const e=this.diagram;if(!e.allowSelect)return!1;const t=e.lastInput;return!(!t.left||e.currentTool!==this&&(!this.isBeyondDragSize()||t.timestamp-e.firstInput.timestamp<this.delay||null!==e.findPartAt(t.documentPoint,!0)))}doActivate(){const e=this.diagram;this.isActive=!0,e.isMouseCaptured=!0,e.skipsUndoManager=!0,this.box&&e.add(this.box),this.doMouseMove()}doDeactivate(){const e=this.diagram;e.stopAutoScroll(),this.box&&e.remove(this.box),e.skipsUndoManager=!1,e.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){const e=this.diagram;if(this.isActive&&null!==this.box){const t=this.computeBoxBounds();let i=this.box.findObject("SHAPE");null===i&&(i=this.box.findMainElement());const s=lt.l().e(t.width,t.height);null!==i&&(i.desiredSize=s),this.box.Uc(t.x,t.y,!1),lt.i(s),(e.allowHorizontalScroll||e.allowVerticalScroll)&&e.doAutoScroll(e.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){const e=this.diagram;this.box&&e.remove(this.box);try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),this.selectInRect(this.computeBoxBounds()),e.T("ChangedSelection",e.selection)}finally{e.currentCursor=""}}this.stopTool()}computeBoxBounds(){const e=this.diagram;return new j(e.firstInput.documentPoint,e.lastInput.documentPoint)}selectInRect(e){const t=this.diagram,i=t.lastInput,s=t.findPartsIn(e,this.isPartialInclusion);if(y.ur?i.meta:i.control)if(i.shift){const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected&&(o.isSelected=!1)}}else{const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected=!o.isSelected}}else if(i.shift){const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected||(o.isSelected=!0)}}else{const n=new H,o=t.selection.iterator;for(;o.next();){const l=o.value;s.has(l)||n.add(l)}const r=n.iterator;for(;r.next();)r.value.isSelected=!1;const a=s.iterator;for(;a.next();){const l=a.value;l.isSelected||(l.isSelected=!0)}}}get delay(){return this.th}set delay(e){y.s(e,"number",ci,"delay"),this.th=e}get isPartialInclusion(){return this.aM}set isPartialInclusion(e){y.s(e,"boolean",ci,"isPartialInclusion"),this.aM=e}get box(){return this.Bl}set box(e){null!==e&&e.It(),this.Bl=e}}class ki extends te{Ox;LA;Ro;hM;constructor(e){super(),this.name="Panning",this.Ox=new S,this.LA=new S,this.Ro=!1;const t=this;this.hM=()=>{const i=t.diagram;null!==i&&i.Le(X.document,"scroll",t.hM,!1),t.stopTool()},e&&Object.assign(this,e)}canStart(){if(!this.isEnabled)return!1;const e=this.diagram;return!(!e.allowHorizontalScroll&&!e.allowVerticalScroll||!e.lastInput.left||e.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){const e=this.diagram;this.Ro?(e.lastInput.bubbles=!0,e.Et(X.document,"scroll",this.hM,!1)):(e.currentCursor="move",e.isMouseCaptured=!0,this.Ox.h(e.position)),this.isActive=!0}doDeactivate(){const e=this.diagram;e.currentCursor="",e.isMouseCaptured=!1,this.isActive=!1}doCancel(){const e=this.diagram;e.position=this.Ox,e.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.AA()}doMouseUp(){this.AA(),this.stopTool()}AA(){const e=this.diagram;if(this.isActive&&e){if(this.Ro)return void(e.lastInput.bubbles=!0);const t=e.position,i=e.firstInput.documentPoint,s=e.lastInput.documentPoint;let n=t.x+i.x-s.x,o=t.y+i.y-s.y;e.allowHorizontalScroll||(n=t.x),e.allowVerticalScroll||(o=t.y),e.position=this.LA.e(n,o)}}get bubbles(){return this.Ro}set bubbles(e){y.s(e,"boolean",ki,"bubbles"),this.Ro=e}get originalPosition(){return this.Ox}}class be{Ix;Ex;cM;fM;constructor(e){this.Ix=null,this.Ex=null,this.cM=null,this.fM=null,e&&Object.assign(this,e)}get mainElement(){return this.cM}set mainElement(e){null!==e&&y.se(e,HTMLElement,be,"mainElement"),this.cM=e}get show(){return this.Ix}set show(e){this.Ix!==e&&(null!==e&&y.S(e,be,"show"),this.Ix=e)}get hide(){return this.Ex}set hide(e){this.Ex!==e&&(null!==e&&y.S(e,be,"hide"),this.Ex=e)}get valueFunction(){return this.fM}set valueFunction(e){this.fM=e}}class pe{ue;Ux;Vc;constructor(e,t,i){this.ue=e,this.Ux=t,this.Vc=i}}let ti=(()=>{class m extends te{uM;Vx;dM;gM;Bx;zx;Gm;constructor(t){super(),this.name="ContextMenu",this.uM=null,this.Vx=null,this.dM=null,this.gM=new S,this.Bx=null,this.Gm=!1;const i=this;this.zx=()=>i.stopTool(),t&&Object.assign(this,t)}xR(){const t=new be;t.show=(a,l,h)=>h.showDefaultContextMenu(),t.hide=(a,l)=>l.hideDefaultContextMenu(),m.Bu=t;const i=this;this.zx=()=>i.stopTool();const s=y.Ni("div"),n=y.Ni("div");s.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",n.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";const o=y.Ni("style");X.document.getElementsByTagName("head")[0].appendChild(o),o.sheet.insertRule(".goCXul { list-style: none; }",0),o.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),o.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);const r=this.diagram;null!==r&&(r.Et(s,"contextmenu",m.oh,!1),r.Et(s,"selectstart",m.oh,!1),r.Et(n,"contextmenu",m.oh,!1)),s.className="goCXforeground",n.className="goCXbackground",X.document.body&&(X.document.body.appendChild(s),X.document.body.appendChild(n)),m.Ym=s,m.Km=n,m.mM=!0}static Bu=null;static mM=!1;static Km;static Ym;static oh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(this.isBeyondDragSize()||!t.lastInput.right||t.lastInput.clickCount>1||!(t.lastInput.isTouchEvent&&null!==this.defaultTouchContextMenu||null!==this.findObjectWithContextMenu()))}doStart(){this.gM.set(this.diagram.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.Gm=!1}findObjectWithContextMenu(t){void 0===t&&(t=null);const i=this.diagram;let n=null;if(t instanceof U||(n=t instanceof st?t:i.findObjectAt(i.lastInput.documentPoint,null,o=>!o.layer?.isTemporary)),null!==n){let o=n;for(;null!==o;){if(null!==o.contextMenu)return o;o=o.panel}if(i.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return n.part}else if(null!==i.contextMenu)return i;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof Nt){const t=this.diagram.toolManager.findTool("Action");null!==t&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof Nt){const t=this.diagram.toolManager.findTool("Action");null!==t&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){const t=this.diagram;if(this.isActive){const i=this.currentContextMenu;if(null===i)return;let s=null;i instanceof be||(s=t.findObjectAt(t.lastInput.documentPoint,null,null),null!==s&&s.isContainedBy(i)&&this.standardMouseClick(null,null)),this.maybeStopTool(s)}else this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool())}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,i){if(void 0===i&&(i=null),this.Gm)return;this.Gm=!0;let s=!1;if(i instanceof U){const n=this.diagram.lastInput;n.targetObject=null,s=this.oA(null,n,this.diagram)}else t&&this.standardMouseSelect(),s=this.standardMouseClick();if(this.Gm=!1,!s){this.isActive=!0;const n=m.Bu;if(null===i&&(i=this.findObjectWithContextMenu()),null!==i){const o=i.contextMenu;null!==o?(this.currentObject=i instanceof st?i:null,this.showContextMenu(o,this.currentObject)):null!==n&&this.showContextMenu(n,this.currentObject)}else null!==n&&this.showContextMenu(n,null);this.currentContextMenu instanceof Nt&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){const t=this.diagram.toolManager.findTool("Action");null!==t&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,i){null!==i&&y.se(i,st,m,"showContextMenu:obj");const s=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof Nt){const n=t;n.layerName="Tool",n.selectable=!1,n.scale=1/s.scale,n.category=this.name,n.hasPlaceholder()&&(n.placeholder.scale=s.scale);const o=n.diagram;null!==o&&o!==s&&o.remove(n),s.add(n),null!==i?n.adornedObject=i:n.data=s.model,n.ensureBounds(),this.positionContextMenu(n,i)}else t instanceof be&&null!==t.show&&t.show(i,s,this);this.currentContextMenu=t}positionContextMenu(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),r=s.measuredBounds,a=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=r.width),o.x+r.width>a.right&&(o.x-=r.width+5/n.scale),o.x<a.x&&(o.x=a.x),o.y+r.height>a.bottom&&(o.y-=r.height+5/n.scale),o.y<a.y&&(o.y=a.y),s.position=o}hideContextMenu(){const t=this.diagram,i=this.currentContextMenu;null!==i&&(i instanceof Nt?(t.remove(i),null!==this.Vx&&this.Vx.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof be&&(null!==i.hide?i.hide(t,this):null!==i.mainElement&&(i.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}bR(){const t=this,i=new H;return i.add(new pe("Copy",s=>s.commandHandler.copySelection(),s=>s.commandHandler.canCopySelection())),i.add(new pe("Cut",s=>s.commandHandler.cutSelection(),s=>s.commandHandler.canCutSelection())),i.add(new pe("Delete",s=>s.commandHandler.deleteSelection(),s=>s.commandHandler.canDeleteSelection())),i.add(new pe("Paste",s=>s.commandHandler.pasteSelection(t.mouseDownPoint),s=>s.commandHandler.canPasteSelection(t.mouseDownPoint))),i.add(new pe("Select All",s=>s.commandHandler.selectAll(),s=>s.commandHandler.canSelectAll())),i.add(new pe("Undo",s=>s.commandHandler.undo(),s=>s.commandHandler.canUndo())),i.add(new pe("Redo",s=>s.commandHandler.redo(),s=>s.commandHandler.canRedo())),i.add(new pe("Scroll To Part",s=>s.commandHandler.scrollToPart(),s=>s.commandHandler.canScrollToPart())),i.add(new pe("Zoom To Fit",s=>s.commandHandler.zoomToFit(),s=>s.commandHandler.canZoomToFit())),i.add(new pe("Reset Zoom",s=>s.commandHandler.resetZoom(),s=>s.commandHandler.canResetZoom())),i.add(new pe("Group Selection",s=>s.commandHandler.groupSelection(),s=>s.commandHandler.canGroupSelection())),i.add(new pe("Ungroup Selection",s=>s.commandHandler.ungroupSelection(),s=>s.commandHandler.canUngroupSelection())),i.add(new pe("Edit Text",s=>s.commandHandler.editTextBlock(),s=>s.commandHandler.canEditTextBlock())),i}showDefaultContextMenu(){const t=this.diagram;null===this.Bx&&(this.Bx=this.bR()),m.Ym.innerHTML="",m.Km.addEventListener("pointerdown",this.zx,!1);const i=this,s=y.Ni("ul");s.className="goCXul",m.Ym.appendChild(s),s.innerHTML="";const n=this.Bx.iterator;for(;n.next();){const o=n.value,r=o.Ux,a=o.Vc;if(!y.st(r)||y.st(a)&&!a(t))continue;const l=y.Ni("li");l.className="goCXli";const h=y.Ni("a");h.className="goCXa",h.href="#",h.Ux=r,h.addEventListener("pointerdown",function(c){return this.Ux(t),i.stopTool(),c.preventDefault(),!1},!1),h.textContent=o.ue,l.appendChild(h),s.appendChild(l)}m.Ym.style.display="block",m.Km.style.display="block"}hideDefaultContextMenu(){if(null===this.currentContextMenu||this.currentContextMenu!==m.Bu)return;m.Ym.style.display="none",m.Km.style.display="none";const t=this.diagram;null!==t&&t.Le(m.Km,"pointerdown",this.zx,!1),this.currentContextMenu=null}doMouseWheel(){this.standardMouseWheel()}get currentContextMenu(){return this.uM}set currentContextMenu(t){this.uM=t,this.Vx=t instanceof Nt?t.adornedPart:null}get defaultTouchContextMenu(){return!1===m.mM&&null===m.Bu&&U.isUsingDOM()&&this.xR(),m.Bu}set defaultTouchContextMenu(t){null===t&&(m.mM=!0),m.Bu=t}get currentObject(){return this.dM}set currentObject(t){null!==t&&y.se(t,st,m,"currentObject"),this.dM=t}get mouseDownPoint(){return this.gM}}return m})();var Ns=(m=>(m[m.LostFocus=1]="LostFocus",m[m.MouseDown=2]="MouseDown",m[m.Tab=3]="Tab",m[m.Enter=4]="Enter",m))(Ns||{}),Ts=(m=>(m[m.SingleClick=1]="SingleClick",m[m.SingleClickSelected=2]="SingleClickSelected",m[m.DoubleClick=3]="DoubleClick",m))(Ts||{}),As=(m=>(m[m.None=1]="None",m[m.Active=2]="Active",m[m.Editing=3]="Editing",m[m.Validating=4]="Validating",m[m.Invalid=5]="Invalid",m[m.Validated=6]="Validated",m))(As||{});let Ls=(()=>{class m extends te{vi;pM;yM;zl;Gt;wM;xM;bM;Xx;Gx;constructor(t){super(),this.name="TextEditing",this.vi=new mt,this.pM=null,this.yM=2,this.zl=null,this.Gt=1,this.wM=1,this.xM=!0,this.bM=null,this.Xx=new be,this.Gx=null,this.kR(this.Xx),t&&Object.assign(this,t)}static LostFocus=1;static MouseDown=2;static Tab=3;static Enter=4;static SingleClick=1;static SingleClickSelected=2;static DoubleClick=3;static StateNone=1;static StateActive=2;static StateEditing=3;static StateValidating=4;static StateInvalid=5;static StateValidated=6;kR(t){if(!U.isUsingDOM())return;const i=y.Ni("textarea");this.Gx=i;const s=this;i.addEventListener("input",function(n){if(null===s.textBlock)return;const o=s.measureTemporaryTextBlock(this.value),r=this.textScale;this.style.width=20+Math.max(s.textBlock.measuredBounds.width,o.measuredBounds.width)*r+"px",this.rows=Math.max(s.textBlock.lineCount,o.lineCount)},!1),i.addEventListener("keydown",function(n){if(n.isComposing||null===s.textBlock)return;const o=n.key;return"Enter"===o?(!1===s.textBlock.isMultiline&&n.preventDefault(),void s.acceptText(4)):"Tab"===o?(s.acceptText(3),void n.preventDefault()):void("Escape"===o&&(s.doCancel(),null!==s.diagram&&s.diagram.doFocus()))},!1),i.addEventListener("focus",function(n){s.PR(n)},!1),i.addEventListener("blur",function(n){s.SR(n)},!1),t.valueFunction=()=>i.value,t.mainElement=i,t.show=(n,o,r)=>{if(!(n instanceof mt&&o&&o.div&&r instanceof m))return;if(5===r.state)return i.style.border="3px solid red",void i.focus();const a=n.getDocumentPoint(A.Center),l=o.position,h=o.scale;let c=n.getDocumentScale()*h;c<r.minimumEditorScale&&(c=r.minimumEditorScale);const u=n.naturalBounds.width*c+6,d=n.naturalBounds.height*c+2,f=(a.x-l.x)*h,p=(a.y-l.y)*h,g=n.verticalAlignment,b=(n.lineHeight+n.spacingAbove+n.spacingBelow)*n.lineCount*c,v=g.y*d-g.y*b+g.offsetY-(.5*d-.5*b)-b/2;i.value=n.text,o.div.style.font=n.font,i.style.position="absolute",i.style.zIndex="100",i.style.font="inherit",i.style.fontSize=100*c+"%",i.style.lineHeight="normal",i.style.width=u+"px",i.style.left=(f-u/2|0)-1+"px",i.style.top=(p+v|0)-1+"px",i.style.textAlign=n.textAlign,i.style.margin="0",i.style.padding="1px",i.style.border="0",i.style.outline="none",i.style.whiteSpace="pre-wrap",i.style.overflow="hidden",i.rows=n.lineCount,i.textScale=c,i.className="goTXarea",o.div.appendChild(i),i.focus(),r.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))},t.hide=(n,o)=>{n.div&&n.div.removeChild(i)}}get textBlock(){return this.pM}set textBlock(t){null!==t&&y.se(t,mt,m,"textBlock"),this.pM=t}get currentTextEditor(){return this.bM}set currentTextEditor(t){this.bM=t}get defaultTextEditor(){return this.Xx}set defaultTextEditor(t){this.Xx=t}get starting(){return this.yM}set starting(t){this.yM=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(null===t||t.isReadOnly||m.Bc&&m.Bc!==this&&(m.Bc.acceptText(2),m.Bc&&m.Bc!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;const s=t.findObjectAt(t.lastInput.documentPoint);if(!(null!==s&&s instanceof mt&&s.editable&&null!==s.part&&s.part.canEdit()))return!1;const n=s.part;return!(null===n||2===this.starting&&!n.isSelected||3===this.starting&&t.lastInput.clickCount<2)}doStart(){m.Bc=this,null!==this.textBlock&&this.doActivate()}doActivate(){if(this.isActive)return;const t=this.diagram;if(null===t)return;let i=this.textBlock;if(null===i&&(i=t.findObjectAt(t.lastInput.documentPoint)),null===i||!(i instanceof mt)||(this.textBlock=i,null===i.part))return;t.animationManager.stopAnimation(),this.isActive=!0,this.Gt=2;let s=this.defaultTextEditor;null!==i.textEditor&&(s=i.textEditor),this.vi=this.textBlock.copy();const n=new j(this.textBlock.getDocumentPoint(A.TopLeft),this.textBlock.getDocumentPoint(A.BottomRight));t.scrollToRect(n),null!==s&&null!==s.show&&s.show(i,t,this),this.currentTextEditor=s}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:6===this.Gt?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(2===this.Gt||5===this.Gt||3===this.Gt)&&(this.Gt=4,this.TA());break;case 1:case 4:case 3:if(4===t&&null!==this.textBlock&&!0===this.textBlock.isMultiline)return;(2===this.Gt||5===this.Gt||3===this.Gt)&&(this.Gt=4,this.TA())}}TA(){const t=this.textBlock,i=this.diagram,s=this.currentTextEditor;if(null!==t&&null!==s){const n=t.text;let o="";if(null!==s.valueFunction&&(o=s.valueFunction()),!this.isValidText(t,n,o))return this.Gt=5,void this.doError(n,o);this.startTransaction(this.name),this.Gt=6,this.transactionResult=this.name,t.text=o,this.doSuccess(n,o),null!==i&&i.T("TextEdited",t,n),this.stopTransaction(),this.stopTool(),null!==i&&i.doFocus()}}doError(t,i){const s=this.textBlock;if(null===s)return;null!==s.errorFunction&&s.errorFunction(this,t,i);const n=this.currentTextEditor;null!==n&&null!==n.show&&n.show(s,this.diagram,this)}doSuccess(t,i){const s=this.textBlock;null!==s&&null!==s.textEdited&&s.textEdited(s,t,i)}doDeactivate(){const t=this.diagram;if(null!==t){if(this.Gt=1,null!==this.currentTextEditor){const i=this.currentTextEditor;null!==i&&null!==i.hide&&i.hide(t,this)}this.textBlock=null,this.isActive=!1}}doStop(){m.Bc=null}PR(t){if(null===this.currentTextEditor||1===this.state)return;const i=this.Gx;2===this.Gt&&(this.Gt=3),y.st(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}SR(t){if(null===this.currentTextEditor||1===this.state)return;const i=this.Gx;y.st(i.focus)&&i.focus(),y.st(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}isValidText(t,i,s){const n=this.textValidation;if(null!==n&&!n(t,i,s))return!1;const o=t.textValidation;return!(null!==o&&!o(t,i,s))}get textValidation(){return this.zl}set textValidation(t){null!==t&&y.S(t,m,"textValidation"),this.zl=t}get minimumEditorScale(){return this.wM}set minimumEditorScale(t){null!==t&&y.s(t,"number",m,"minimumEditorScale"),this.wM=t}get selectsTextOnActivate(){return this.xM}set selectsTextOnActivate(t){null!==t&&y.s(t,"boolean",m,"selectsTextOnActivate"),this.xM=t}get state(){return this.Gt}set state(t){this.Gt!==t&&(this.Gt=t)}measureTemporaryTextBlock(t){const i=this.vi;return i.text=t,null!==this.textBlock&&i.ht(this.textBlock.Xl,1/0),i}static Bc=null}return m})();var Ds=(m=>(m[m.Default=1]="Default",m[m.AnimateLocations=2]="AnimateLocations",m[m.None=3]="None",m))(Ds||{});class ue{a;Ae;Be;Tr;_n;Io;kM;PM;Hm;Yx;ke;zc;bn;jm;lh;Kx;qm;Hx;Xc;Uu;Wm;constructor(e){this.a=U.Om(),this.Ae=!1,this.Hm=!1,this.Yx=!1,this.ke=!1,this.zc=!1,this.Hx=!0,this.Xc=1,this.Uu=!1,this.Be=!0,this.Tr=!0,this.Io=600,this.kM=!1,this.PM=!1,this._n=new z,this.bn=new Si,this.jm=new Si,this.bn.Ns=this,this.lh=new z,this.Kx=new z,this.qm=new z,this.Wm=new z,e&&Object.assign(this,e)}Eo(e){this.a=e}RU(){return this.a}canStart(e){return!0}Gl(e){return!(!this.Be||!this.canStart(e)||(this._n.add(e),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.a.Te(),this.ke=!0,0))}getBundleAnimation(){return this.jm}SM(){if(!this.Be||(this.jm.yi.count>0&&this.jm.start(),!this.ke))return;const e=this.bn,t=this.a,i=this._n.has("Model");if(i&&(this.zc=!0,1===this.Xc?(e.isViewportUnconstrained=!0,e.yi.clear(),e.add(t,"position",t.position.copy().offset(0,-200),t.position),e.add(t,"opacity",0,1)):3===this.Xc&&e.yi.clear(),this.Hx=!(2!==this.Xc||!t.jx.equals(t.ct)),t.T("InitialAnimationStarting",this)),i&&!this.Tr||0===e.yi.count)return this._n.clear(),this.ke=!1,e.yi.clear(),e.qx(t),this.zc=!1,void t.C();this._n.clear(),t.Dr=!1;const s=e.yi.get(t);1!==t.autoScale&&null!==s&&(delete s.ae.scale,delete s.Cs.scale);const n=this;X.requestAnimationFrame(()=>{!1===n.ke||e.Ae||(t.getRenderingHint("temporaryPixelRatio")&&t.Cx(),t.MM(),n.ke=!1,e.start(),e.Ae&&(n.zu(),t.invalidateDocumentBounds(),e.DA(0),t.Sr(!0),n.Xu(),t.T("AnimationStarting",n)))})}NM(){return this._n.has("Trigger")&&1===this._n.count}vA(e,t,i,s){this.isTicking||this.NM()||e instanceof gt&&(null!==e.fromNode||null!==e.toNode)||this.bn.add(e,"position",t,i,s)}Wx(e){return this.bn.Wx(e)}CM(e){return this.bn.CM(e)}MR(e){const t=this.lh,i=this;function s(){if(i.qm.count>0&&(t.addAll(i.qm),i.qm.clear(),i.Ae=!0),!1===i.Ae||0===t.count)return void(i.Yx=!1);i.Kx.addAll(t);const n=i.Kx.iterator;for(;n.next();){const o=n.value;!1!==o.Ae&&(o.NR()?o.FA(!1):o.Gc=!0)}i.Kx.clear(),!1!==i.Ae?(i.zu(),i.a.Sr(),i.Xu(),X.requestAnimationFrame(s)):X.requestAnimationFrame(s)}this.Ae?this.RA(e):(this.Ae=!0,this.Yx?this.RA(e):(this.Yx=!0,t.add(e),X.requestAnimationFrame(()=>s())))}RA(e){this.qm.add(e)}CR(){const e=this.lh.iterator;for(;e.next();)e.value.Gc=!1}zu(){if(this.Hm)return;const e=this.a;this.kM=e.skipsUndoManager,this.PM=e.wi,e.skipsUndoManager=!0,e.wi=!0,this.Hm=!0}Xu(){const e=this.a;e.skipsUndoManager=this.kM,e.wi=this.PM,this.Hm=!1}stopAnimation(e){const t=this.bn;if(!0===this.ke&&(this.ke=!1,this.zc=!1,this._n.clear(),t.LR()&&this.a.requestUpdate()),!this.Ae)return t.yi.clear(),void t.qx(this.a);if(t.Gu(!0),t.qx(null),!0===e){const i=this.lh.toArray();for(let s=0;s<i.length;s++)i[s].Gu(!0)}}Gu(e){this.lh.delete(e),0===this.lh.count&&(this.Ae=!1,this.a.requestUpdate()),e===this.defaultAnimation&&this.a.T("AnimationFinished",this)}Yc(e,t){this.ke&&(!this._n.has("Expand Tree")&&!this._n.has("Expand SubGraph")||(this.bn.Yc(e,t),this.OA(e)))}Kc(e,t){this.ke&&(!this._n.has("Collapse Tree")&&!this._n.has("Collapse SubGraph")||(this.bn.Kc(e,t),this.bn.LM(t,"position",t.position,t.position),this.OA(e)))}IA(e,t){!this.ke||e.equals(t)||this.NM()||(this.a.Qa||(e=t.copy()),this.bn.LM(this.a,"position",e,t))}EA(e,t){this.ke&&(this.NM()||this.bn.add(this.a,"scale",e,t))}AM(e,t){e.Fi&&(e.vr=t,this.Wm.add(e))}OA(e){const t=e.findLinksConnected();for(;t.next();){const i=t.value;i.Fi&&(i.vr=i.points.copy(),this.Wm.add(i))}}get isEnabled(){return this.Be}set isEnabled(e){y.s(e,"boolean",ue,"isEnabled"),this.Be=e,e&&this.lh.each(t=>{!t.isAnimating&&t.runCount===1/0&&t.start()})}get duration(){return this.Io}set duration(e){y.s(e,"number",ue,"duration"),e<1&&y.J(e,">= 1",ue,"duration"),this.Io=e}get isAnimating(){return this.Ae}get isTicking(){return this.Hm}get isInitial(){return this.Tr}set isInitial(e){y.s(e,"boolean",ue,"isInitial"),this.Tr=e}get defaultAnimation(){return this.bn}get activeAnimations(){return this.lh}get initialAnimationStyle(){return this.Xc}set initialAnimationStyle(e){this.Xc=e}static Jx=new xt;static defineAnimationEffect(e,t){ue.Jx.set(e,t)}static TM(e,t,i,s,n){null===e&&(e=[0,0,0,0]),null===t&&(t=[0,0,0,0]);let o=e[0],r=e[1];const a=e[2],l=e[3];let h=t[0],c=t[1];const u=t[2],d=t[3];return 0===a||100===a?(o=h,r=c):(0===u||100===u)&&(h=o,c=r),Math.abs(h-o)>180&&(h>o?o+=360:h+=360),"hsla("+n(i,o,h-o,s)%360+", "+n(i,r,c-r,s)+"%, "+n(i,a,u-a,s)+"%, "+n(i,l,d-l,s)+")"}static Default=1;static AnimateLocations=2;static None=3}{const m=ue.Jx,e=(t,i,s,n,o,r)=>{t.position=new S(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))};m.set("position:diagram",e),m.set("position",e),m.set("position:part",(t,i,s,n,o,r)=>{o<r?t.Uc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):t.position=new S(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),m.set("location",(t,i,s,n,o,r)=>{o<r?t.Uc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!0):t.location=new S(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),m.set("position:placeholder",(t,i,s,n,o,r)=>{o<r?t.Uc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):t.position=new S(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),m.set("position:nodeCollapse",(t,i,s,n,o,r)=>{const a=t.actualBounds,l=s.actualBounds,h=l.x+l.width/2-a.width/2,c=l.y+l.height/2-a.height/2;o<r?t.Uc(n(o,i.x,h-i.x,r),n(o,i.y,c-i.y,r),!1):t.position=new S(n(o,i.x,h-i.x,r),n(o,i.y,c-i.y,r))}),m.set("desiredSize",(t,i,s,n,o,r)=>{t.desiredSize=new lt(n(o,i.width,s.width-i.width,r),n(o,i.height,s.height-i.height,r))}),m.set("width",(t,i,s,n,o,r)=>{t.width=n(o,i,s-i,r)}),m.set("height",(t,i,s,n,o,r)=>{t.height=n(o,i,s-i,r)}),m.set("fill",(t,i,s,n,o,r)=>{t.fill=ue.TM(i,s,o,r,n)}),m.set("stroke",(t,i,s,n,o,r)=>{t.stroke=ue.TM(i,s,o,r,n)}),m.set("strokeWidth",(t,i,s,n,o,r)=>{t.strokeWidth=n(o,i,s-i,r)}),m.set("strokeDashOffset",(t,i,s,n,o,r)=>{t.strokeDashOffset=n(o,i,s-i,r)}),m.set("background",(t,i,s,n,o,r)=>{t.background=ue.TM(i,s,o,r,n)}),m.set("opacity",(t,i,s,n,o,r)=>{t.opacity=n(o,i,s-i,r)}),m.set("scale",(t,i,s,n,o,r)=>{t.scale=n(o,i,s-i,r)}),m.set("angle",(t,i,s,n,o,r)=>{t.angle=n(o,i,s-i,r)})}let Si=(()=>{class m{$x;Jm;Ae;Yu;Io;Ls;UA;Hc;yi;Zx;ae;to;Ku;jc;Qx;_x;Gc;DM;tb;Ns;a;vM;FM;RM;constructor(t){this.a=null,this.Ns=null,this.DM=null,this.tb=null,this.vM=!1,this.Ae=!1,this.Gc=!1,this.ae=0,this.to=0,this.$x=m.EaseInOutQuad,this.Jm=m.EaseInOutQuad,this.Ku=!1,this.jc=!1,this.Qx=1,this._x=0,this.Io=NaN,this.Ls=NaN,this.FM=0,this.Yu=null,this.UA=S.gn,this.yi=new xt,this.Zx=new xt,this.Hc=new z,this.RM=1,t&&Object.assign(this,t)}suspend(){this.Gc=!0}advanceTo(t,i){i&&(this.Gc=!1),this.Ku&&t>=this.Ls&&(this.jc=!0,t-=this.Ls),this.FM=t,this.FA(!0),this.Ns.zu(),this.a.Sr(),this.Ns.Xu(),this.a.redraw()}qx(t){if(this.Zx.clear(),this.jc=!1,this._x=0,this.Ls=NaN,this.Hc.count>0&&this.Hc.clear(),null!==t){const i=t.links;for(;i.next();)i.value.vr=null}}LR(){return this.yi.count>0}start(){if(0===this.yi.count)return this;if(this.Ae)return this;let t=this.a;const i=this.yi.iterator;for(;i.next();){const n=i.key;null===t&&(n instanceof U?t=n:n instanceof st&&(t=n.diagram))}if(null===t)return this;this.a=t,this.Ns=t.animationManager;const s=this.Ns;return!1===s.isEnabled||(this.Ls=isNaN(this.Io)?s.duration:this.Io,this.Jm=this.$x,s.zc&&1===s.Xc&&this===s.defaultAnimation&&(this.Jm=m.EaseOutExpo,this.Ls=isNaN(this.Io)?600===s.duration?900:s.duration:this.Io),this.RM=t.scrollMode,this.isViewportUnconstrained&&(t.ah=2),s.zu(),this.Hc.each(n=>{n.data=null,t.add(n)}),s.Xu(),this.Ae=!0,this.ae=+new Date,this.to=this.ae+this.Ls,s.MR(this)),this}addTemporaryPart(t,i){return t.Di()?(this.Hc.add(t),this.a=i,this):this}add(t,i,s,n,o){if(null===this.a&&(t instanceof U?this.a=t:t instanceof st&&null!==t.diagram&&(this.a=t.diagram)),t instanceof At){if(!t.isAnimated)return this;"position"===i&&(i="position:part")}return this.LM(t,i,s,n,o),this}LM(t,i,s,n,o){const r=this.yi;let a,l,h;if(t instanceof U&&"position"===i&&(i="position:diagram"),("fill"===i||"stroke"===i||"background"===i)&&(V.Uo(s),V.OM(),s=[V.ze.n0,V.ze.n1,V.ze.n2,V.ze.n3],V.Uo(n),V.OM(),n=[V.ze.n0,V.ze.n1,V.ze.n2,V.ze.n3]),r.has(t))a=r.get(t),l=a.ae,h=a.Cs,void 0===l[i]&&(l[i]=this.Hu(s)),h[i]=this.Hu(n);else{if("position"===i&&s.equalsApprox(n))return;l={},h={},l[i]=this.Hu(s),h[i]=this.Hu(n),a=new Zn(l,h,o),r.set(t,a)}const c=l[i];c instanceof S&&!c.isReal()&&c.h(this.UA),o&&0===i.indexOf("position:")&&t instanceof At?a.eb.location=this.Hu(t.location):o&&(a.eb[i]=this.Hu(s))}Hu(t){return t instanceof S||t instanceof lt?t.copy():t}AR(t){const i=this.yi;i.has(t)&&(i.get(t).ib=!0)}Wx(t){if(!this.Ae)return!1;const i=this.yi.get(t);return null!==i&&i.ib}CM(t){if(!this.Ae)return!1;const i=this.yi.get(t);return null!==i&&!!(i.ae.position||i.ae["position:part"]||i.ae.location)}NR(){if(this.Hc.count>0)return!0;const t=this.yi.iterator;for(;t.next();){const i=t.key;if(i instanceof st&&null!==i.diagram||i instanceof U)return!0}return!1}FA(t){if(this.Gc&&!t)return;const i=this.Ns;if(!1===this.Ae)return;const s=+new Date;let n=s>this.to?this.Ls:s-this.ae;t&&(n=this.FM,n<this.Ls?(this.ae=+new Date-n,this.to=this.ae+this.Ls):n=this.Ls),i.zu(),this.DA(n),this.a.Sr(!0),i.Xu(),s>this.to&&(this.Ku&&!this.jc?(this.ae=+new Date,this.to=this.ae+this.Ls,this.jc=!0):this.Gu(!1))}DA(t){const i=this.Ls,s=this.yi.iterator,n=this.jc;for(;s.next();){const o=s.key;if(o instanceof st&&null===o.diagram)continue;const r=s.value,a=n?r.Cs:r.ae,l=n?r.ae:r.Cs,h=ue.Jx;for(const c in l)"position"===c&&(l["position:placeholder"]||l["position:nodeCollapse"])||null!==h.get(c)&&h.get(c)(o,a[c],l[c],this.Jm,t,i,this)}}stop(){return this.Ae?(this.Gu(!0),this):this}Gu(t){if(null!==this.tb&&this.tb.TR(this.DM),!this.Ae)return;const i=this.a,s=this.Ns;s.zc=!1,this.Ae=!1,this.Gc=!1,s.zu();const n=this.yi,o=this.Hc.iterator;for(;o.next();)i.remove(o.value);const r=this.Ku,a=n.iterator,l=ue.Jx;for(;a.next();){const c=a.key,u=a.value,d=r?u.Cs:u.ae,f=r?u.ae:u.Cs,p=u.eb;for(const g in f)if(null!==l.get(g)){let b=g;u.sb&&("position:nodeCollapse"===b||"position:placeholder"===b)&&(b="position"),l.get(b)(c,d[g],void 0!==p[g]?p[g]:u.sb?d[g]:f[g],this.Jm,this.Ls,this.Ls,this)}u.sb&&void 0!==p.location&&c instanceof At&&(c.location=p.location),u.ib&&c instanceof At&&c.Xe(!1)}this._x++;const h=!t&&this.Qx>this._x;if(!h&&(this===s.jm||this===s.defaultAnimation)&&this.yi.clear(),i.nb.clear(),i.yS(!1),i.invalidateDocumentBounds(),i.C(),i.Sr(!0),s.defaultAnimation===this){const c=s.Wm.iterator;for(;c.next();)c.value.DR();s.Wm.clear()}if(i.Sr(!0),this.isViewportUnconstrained&&(i.scrollMode=this.RM),s.Xu(),h)return this.jc=!1,void this.start();this.qx(null),i.VA(),s.Gu(this),this.Yu&&this.Yu(this),i.requestUpdate()}Yc(t,i){const s=i.actualBounds;let n=null;if(i instanceof pt&&(n=i.placeholder),null!==n&&n.visible){const o=n.getDocumentPoint(A.TopLeft),r=n.padding;o.x+=r.left,o.y+=r.top,this.add(t,"position",o,t.position,!1)}else this.add(t,"position",new S(s.x+s.width/2,s.y+s.height/2),t.position,!1);this.add(t,"scale",.01,t.scale,!1),t instanceof pt&&this.vR(t,i)}vR(t,i){const s=t.memberParts;for(;s.next();){const n=s.value;n instanceof nt&&this.Yc(n,i)}}Kc(t,i){if(!t.isVisible())return;let s=null;if(i instanceof pt&&(s=i.placeholder),null!==s&&s.visible){const n=s.getDocumentPoint(A.TopLeft),o=s.padding;n.x+=o.left,n.y+=o.top,this.add(t,"position:placeholder",t.position,n,!0)}else this.add(t,"position:nodeCollapse",t.position,i,!0);this.add(t,"scale",t.scale,.01,!0),this.AR(t),t instanceof pt&&this.FR(t,i)}FR(t,i){const s=t.memberParts;for(;s.next();){const n=s.value;n instanceof nt&&this.Kc(n,i)}}get duration(){return this.Io}set duration(t){y.s(t,"number",m,"duration"),t<1&&y.J(t,">= 1",m,"duration"),this.Io=t}get reversible(){return this.Ku}set reversible(t){this.Ku=t}get runCount(){return this.Qx}set runCount(t){t>0?this.Qx=t:y.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Yu}set finished(t){this.Yu!==t&&(null!==t&&y.S(t,m,"finished"),this.Yu=t)}get easing(){return this.$x}set easing(t){this.$x=t}get isViewportUnconstrained(){return this.vM}set isViewportUnconstrained(t){this.vM=t}get isAnimating(){return this.Ae}getTemporaryState(t){let i=this.Zx.get(t);return null===i&&(i={},this.Zx.set(t,i)),i}static EaseLinear=(t,i,s,n)=>s*t/n+i;static EaseInOutQuad=(t,i,s,n)=>(t/=n/2)<1?s/2*t*t+i:-s/2*(--t*(t-2)-1)+i;static EaseInQuad=(t,i,s,n)=>s*(t/=n)*t+i;static EaseOutQuad=(t,i,s,n)=>-s*(t/=n)*(t-2)+i;static EaseInExpo=(t,i,s,n)=>0===t?i:s*Math.pow(2,10*(t/n-1))+i;static EaseOutExpo=(t,i,s,n)=>t===n?i+s:s*(1-Math.pow(2,-10*t/n))+i}return m})();class Zn{ae;Cs;eb;sb;ib;constructor(e,t,i){this.ae=e,this.Cs=t,this.eb={},this.sb=i,this.ib=!1}}var Fs=(m=>(m[m.Default=1]="Default",m[m.Immediate=2]="Immediate",m[m.Bundled=3]="Bundled",m))(Fs||{});let Ri=(()=>{class m{Ti;yn;ju;qc;constructor(t,i,s){this.Ti=null,this.yn=t,this.ju=s||1,this.qc=null,void 0!==i&&(this.qc=i,void 0===s&&(this.ju=2))}copy(){const t=new m(this.yn);t.ju=this.ju;const i=this.qc;if(null!==i){const s={};void 0!==i.duration&&(s.duration=i.duration),void 0!==i.finished&&(s.finished=i.finished),void 0!==i.easing&&(s.easing=i.easing),t.qc=s}return t}get propertyName(){return this.yn}set propertyName(t){this.yn=t}get animationSettings(){return this.qc}set animationSettings(t){this.qc=t}RR(t){const i=this.qc;null!==i&&(i.duration&&(t.duration=i.duration),i.finished&&(t.finished=i.finished),i.easing&&(t.easing=i.easing))}get startCondition(){return this.ju}set startCondition(t){this.ju=t}static Default=1;static Immediate=2;static Bundled=3}return m})();class Gt{a;Pt;Zt;Fr;Yl;Kl;Hl;jl;ql;Wl;Jl;$l;Zl;Ql;_l;ta;Vc;ea;ob;$m;qu;Ct;constructor(e){z.Je(this),this.a=null,this.Ct=new H,this.Pt="",this.Zt=1,this.Fr=!1,this.Yl=!0,this.Kl=!0,this.Hl=!0,this.jl=!0,this.ql=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Vc=!0,this.ea=!0,this.ob=!0,this.$m=!1,this.qu=[],e&&Object.assign(this,e)}OR(){const e=this.Ct;for(let t=0;t<e.length;t++)e.r[t].IM(null);e.clear(),this.qu.length=0}Eo(e){this.a=e}toString(e){void 0===e&&(e=0);const t='Layer "'+this.name+'"';if(e<=0)return t;let i=0,s=0,n=0,o=0,r=0;const a=this.Ct.iterator;for(;a.next();){const h=a.value;h instanceof pt?n++:h instanceof nt?s++:h instanceof gt?o++:h instanceof Nt?r++:i++}let l="";if(i>0&&(l+=i+" Parts "),s>0&&(l+=s+" Nodes "),n>0&&(l+=n+" Groups "),o>0&&(l+=o+" Links "),r>0&&(l+=r+" Adornments "),e>1){const h=this.Ct.iterator;for(;h.next();){const c=h.value;l+="\n    "+c.toString();const u=c.data;null!==u&&z.xs(u)&&(l+=" #"+z.xs(u)),c instanceof nt?l+=" "+y.toString(u):c instanceof gt&&(l+=" "+y.toString(c.fromNode)+" "+y.toString(c.toNode))}}return t+" "+this.Ct.count+": "+l}findObjectAt(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=null),!1===this.ea)return null;let s=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(e)&&(s=!0);const n=S.l(),o=this.Ct.r;for(let a=o.length;a--;){const l=o[a];if(!0===s&&!1===l.Ul()||!l.isVisible())continue;n.h(e),n.Ki(l.Js);let h=l.BA(n,t,i);if(null!==h&&(null!==t&&(h=t(h)),null!==h&&(null===i||i(h))))return S.i(n),h}return S.i(n),null}findObjectsAt(e,t,i,s){if(void 0===t&&(t=null),void 0===i&&(i=null),!(s instanceof H)&&!(s instanceof z)&&(s=new z),!1===this.ea)return s;let n=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(e)&&(n=!0);const o=S.l(),r=this.Ct.r;for(let l=r.length;l--;){const h=r[l];if(!0===n&&!1===h.Ul()||!h.isVisible())continue;o.h(e),o.Ki(h.Js);let c=h;h.zA(o,t,i,s)&&(null!==t&&(c=t(c)),null!==c&&(null===i||i(c))&&s.add(c))}return S.i(o),s}findObjectsIn(e,t,i,s,n){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===s&&(s=!1),!(n instanceof H)&&!(n instanceof z)&&(n=new z),!1===this.ea)return n;let o=!1;null!==this.diagram&&this.diagram.viewportBounds.containsRect(e)&&(o=!0);const r=this.Ct.r;for(let l=r.length;l--;){const h=r[l];if(!0===o&&!1===h.Ul()||!h.isVisible())continue;let c=h;h.Zm(e,t,i,s,n)&&(null!==t&&(c=t(c)),null!==c&&(null===i||i(c))&&n.add(c))}return n}MS(e,t,i,s,n,o,r){if(!1===this.ea)return n;const a=this.Ct.r;for(let h=a.length;h--;){const c=a[h];if(!0===r&&!1===c.Ul()||!o(c)||!c.isVisible())continue;let u=c;c.Zm(e,t,i,s,n)&&(null!==t&&(u=t(u)),null!==u&&(null===i||i(u))&&n.add(u))}return n}findObjectsNear(e,t,i,s,n,o){if(void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),!1!==n&&!0!==n&&((n instanceof H||n instanceof z)&&(o=n),n=!0),!(o instanceof H)&&!(o instanceof z)&&(o=new z),!1===this.ea)return o;let r=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(e)&&(r=!0);const a=S.l(),l=S.l(),h=this.Ct.r;for(let u=h.length;u--;){const d=h[u];if(!0===r&&!1===d.Ul()||!d.isVisible())continue;a.h(e),a.Ki(d.Js),l.e(e.x+t,e.y),l.Ki(d.Js);let f=d;d.XA(a,l,i,s,n,o)&&(null!==i&&(f=i(f)),null!==f&&(null===s||s(f))&&o.add(f))}return S.i(a),S.i(l),o}EM(){return this.Ct.r}As(e,t){if(!this.visible)return;const i=this.Ct.r,s=i.length;if(0===s)return;const n=y.nt(),o=y.nt();for(let r=0;r<s;r++){const a=i[r];if(a.UM=r,a instanceof gt){if(!1===a.Fi)continue}else if(a instanceof Nt&&null!==a.adornedPart)continue;const l=a.actualBounds;a.isVisible()&&l.UL(t,10)?(a.As(!0),n.push(a)):(a.As(!1),null!==a.adornments&&a.adornments.count>0&&o.push(a))}for(let r=0;r<n.length;r++){const a=n[r];a.VM();const l=a.adornments;for(;l.next();){const h=l.value;h.ht(1/0,1/0),h.Ut(),h.As(!0)}}for(let r=0;r<o.length;r++)o[r].VM();y.Z(n),y.Z(o)}Wu(e){let t=1;return 1!==this.Zt&&(t=e.globalAlpha,e.globalAlpha=t*this.Zt),t}GA(e,t){for(let i=0;i<t;i++)e[i].Wc()}Ge(e,t,i){if(!this.visible||0===this.Zt||(void 0===i&&(i=!0),!i&&this.isTemporary))return;const s=this.Ct.r,n=s.length;if(0===n)return;e.Fr&&this.GA(s,n);const o=this.Wu(e),r=this.qu;r.length=0;const a=t.scale,l=j.l();for(let h=0;h<n;h++)this.Qm(e,s[h],t,r,a,l,!0);j.i(l),e.Fr&&this.GA(s,n),e.globalAlpha=o}OU(e,t,i){if(!this.visible||0===this.Zt)return;const s=this.Ct.r,n=s.length;if(0===n)return;const o=this.Wu(e),r=this.qu;r.length=0;const a=t.scale,l=j.l();for(let h=0;h<n;h++){const c=s[h];i.has(c)||this.Qm(e,c,t,r,a,l,!0)}j.i(l),e.globalAlpha=o}IR(e,t,i,s){if(!this.visible||0===this.Zt||!s&&this.isTemporary)return;const n=this.Ct.r,o=n.length;if(0===o)return;const r=this.Wu(e),a=this.qu;a.length=0;const l=t.scale,h=j.l();for(let c=0;c<o;c++){const u=n[c];i.has(u)&&this.Qm(e,u,t,a,l,h,!1)}j.i(h),e.globalAlpha=r}ER(e,t,i,s,n){if(!this.visible||0===this.opacity)return;const o=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&o.layer===this){const r=this.Wu(e);o.Ge(e,i),e.globalAlpha=r}}else{const r=this.Wu(e),a=i.scale,l=j.l(),h=this.Ct.r,c=h.length;for(let u=0;u<c;u++){const d=h[u];!n&&d===o||this.Qm(e,d,i,null,a,l,!1)}j.i(l),e.globalAlpha=r}}IU(e,t,i){if(!this.visible||0===this.Zt)return;const s=this.Wu(e),n=this.qu;n.length=0;const o=t.scale,r=j.l(),a=this.Ct.r,l=a.length,h=i.length;for(let c=0;c<l;c++){const u=a[c],d=u.hh(u.actualBounds);this.UR(d,i,h,o)&&this.Qm(e,u,t,n,o,r,!0)}j.i(r),e.globalAlpha=s}Qm(e,t,i,s,n,o,r){if(r&&!t.Ul())return void e.removePartFromView(t);if(null!==s&&t instanceof gt&&(t.isOrthogonal&&s.push(t),!1===t.Fi))return void e.removePartFromView(t);let a=!1,l=t.containingGroup;for(;null!==l;)a?null!==l.he&&o.intersectRect(l.he):null!==l.he&&(a=!0,o.h(l.he)),l=l.containingGroup;const h=t.actualBounds;let c=!1;if(a&&t.isVisible()){if(!o.intersectsRect(h))return void e.removePartFromView(t);c=!o.containsRect(h)}c&&(e.save(),e instanceof he?e.partClipRect=o.copy():(e.beginPath(),e.rect(o.x,o.y,o.width,o.height),e.clip())),h.width*n>i._m||h.height*n>i._m?t.Ge(e,i):this.VR(e,t,i),c&&(e.restore(),e.clearContextCache(!0))}VR(e,t,i){if(e instanceof he)return void t.Ge(e,i);const s=t.actualBounds,n=t.naturalBounds;if(0===s.width||0===s.height||isNaN(s.x)||isNaN(s.y)||!t.isVisible())return;const o=t.v;if(null===t.background)return t.kn(e,"rgba(0,0,0,0.3)",!0,!1,n,s),void e.fillRect(s.x,s.y,s.width,s.height);if(e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),t.kn(e,t.background,!0,!1,n,s),e.fillRect(0,0,n.width/2,n.height/2),!o.RP()){const r=1/(o.m11*o.m22-o.m12*o.m21);e.transform(o.m22*r,-o.m12*r,-o.m21*r,o.m11*r,r*(o.m21*o.dy-o.m22*o.dx),r*(o.m12*o.dx-o.m11*o.dy))}}UR(e,t,i,s){const n=2/s,o=4/s;for(let r=0;r<i;r++){const a=t[r];if(0!==a.width&&0!==a.height&&e.intersects(a.x-n,a.y-n,a.width+o,a.height+o))return!0}return!1}t(e,t,i,s,n){const o=this.diagram;null!==o&&o.raiseChangedEvent(2,e,this,t,i,s,n)}ch(e,t,i){const s=this.Ct;if(t.IM(this),e>=s.count)e=s.count;else if(s.elt(e)===t)return-1;s.insertAt(e,t),t.tp(i);const n=this.diagram;return null!==n&&(i?n.C():n.ch(t)),this.rb(e,t),e}ri(e,t,i){if(!i&&t.layer!==this&&null!==t.layer)return t.layer.ri(e,t,i);const s=this.Ct;if(e<0||e>=s.length){if((e=s.indexOf(t))<0)return-1}else if(s.elt(e)!==t&&(e=s.indexOf(t))<0)return-1;t.ep(i),s.removeAt(e);const n=this.diagram;return null!==n&&(i?n.C():n.ri(t)),t.IM(null),e}rb(e,t){e=this.BR(e,t),t instanceof pt&&this.zR(e,t),null!==t.svg&&t.svg.remove()}BR(e,t){const i=t.zOrder;if(isNaN(i))return e;const s=this.Ct,n=s.count;if(n<=1)return e;if(e<0&&(e=s.indexOf(t)),e<0)return-1;let o=e-1,r=NaN;for(;o>=0&&(r=s.elt(o).zOrder,isNaN(r));)o--;let a=e+1,l=NaN;for(;a<n&&(l=s.elt(a).zOrder,isNaN(l));)a++;if(!isNaN(r)&&r>i)for(;;){if(-1===o||r<=i)return o++,o===e?e:(s.removeAt(e),s.insertAt(o,t),o);for(r=NaN;--o>=0&&(r=s.elt(o).zOrder,isNaN(r)););}else if(!isNaN(l)&&l<i)for(;;){if(a===n||l>=i)return a--,a===e?e:(s.removeAt(e),s.insertAt(a,t),a);for(l=NaN;++a<n&&(l=s.elt(a).zOrder,isNaN(l)););}return e}zR(e,t){if(null===t||!isNaN(t.zOrder))return;this.XR(e,t);const i=t.containingGroup;null!==i&&this.rb(-1,i)}XR(e,t){if(0===t.memberParts.count)return;let i=-1;const s=this.Ct.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if(r===t&&(e=o,i>=0)||i<0&&r.containingGroup===t&&(i=o,e>=0))break}if(!(i<0)&&i<e){const o=this.Ct;o.removeAt(e),o.insertAt(i,t)}}get parts(){return this.Ct.iterator}get partsBackwards(){return this.Ct.iteratorBackwards}get diagram(){return this.a}get name(){return this.Pt}set name(e){y.s(e,"string",Gt,"name");const t=this.Pt;if(t!==e){const i=this.diagram;if(null!==i){""===t&&y.o("Cannot rename default Layer to: "+e);const n=i.layers;for(;n.next();)n.value.name===e&&y.o("Layer.name is already present in this diagram: "+e)}this.Pt=e,this.t("name",t,e);const s=this.Ct.iterator;for(;s.next();)s.value.layerName=this.Pt}}get opacity(){return this.Zt}set opacity(e){const t=this.Zt;if(t!==e){y.s(e,"number",Gt,"opacity"),(e<0||e>1)&&y.J(e,"0 <= value <= 1",Gt,"opacity"),this.Zt=e;const i=this.diagram;null!==i&&i.C(),this.t("opacity",t,e)}}get isViewportAligned(){return this.$m}set isViewportAligned(e){const t=this.$m;t!==e&&(this.$m=e,this.diagram&&(this.YA(),this.diagram.C()),this.t("isViewportAligned",t,e),e&&(this.isInDocumentBounds=!1))}YA(){if(!this.$m)return;const e=this.diagram;if(null===e)return;const t=this.Ct.r,i=t.length,s=e.wt,n=e.xt;for(let o=0;o<i;o++){const r=t[o],a=r.naturalBounds.width,l=r.naturalBounds.height;let h=r.alignment;(h.isDefault()||!h.isSpot())&&(h=A.BottomRight);let c=r.alignmentFocus;c.isDefault()&&(c=new A(h.x,h.y));const f=S.z(h.x*s+h.offsetX-(c.x*a+c.offsetX),h.y*n+h.offsetY-(c.y*l+c.offsetY));e.GR(f),r.Uc(f.x,f.y,!0),S.i(f),r.it=1/e.scale}}get isTemporary(){return this.Fr}set isTemporary(e){const t=this.Fr;t!==e&&(y.s(e,"boolean",Gt,"isTemporary"),this.Fr=e,this.t("isTemporary",t,e))}get visible(){return this.Vc}set visible(e){const t=this.Vc;if(t!==e){y.s(e,"boolean",Gt,"visible"),this.Vc=e;const i=this.Ct.iterator;for(;i.next();)i.value.Xe(e);const s=this.diagram;null!==s&&s.C(),this.t("visible",t,e)}}get pickable(){return this.ea}set pickable(e){const t=this.ea;t!==e&&(y.s(e,"boolean",Gt,"pickable"),this.ea=e,this.t("pickable",t,e))}get isInDocumentBounds(){return this.ob}set isInDocumentBounds(e){const t=this.ob;t!==e&&(this.ob=e,null!==this.diagram&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",t,e))}get allowCopy(){return this.Yl}set allowCopy(e){const t=this.Yl;t!==e&&(y.s(e,"boolean",Gt,"allowCopy"),this.Yl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.Kl}set allowDelete(e){const t=this.Kl;t!==e&&(y.s(e,"boolean",Gt,"allowDelete"),this.Kl=e,this.t("allowDelete",t,e))}get allowTextEdit(){return this.Hl}set allowTextEdit(e){const t=this.Hl;t!==e&&(y.s(e,"boolean",Gt,"allowTextEdit"),this.Hl=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.jl}set allowGroup(e){const t=this.jl;t!==e&&(y.s(e,"boolean",Gt,"allowGroup"),this.jl=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.ql}set allowUngroup(e){const t=this.ql;t!==e&&(y.s(e,"boolean",Gt,"allowUngroup"),this.ql=e,this.t("allowUngroup",t,e))}get allowLink(){return this.Wl}set allowLink(e){const t=this.Wl;t!==e&&(y.s(e,"boolean",Gt,"allowLink"),this.Wl=e,this.t("allowLink",t,e))}get allowRelink(){return this.Jl}set allowRelink(e){const t=this.Jl;t!==e&&(y.s(e,"boolean",Gt,"allowRelink"),this.Jl=e,this.t("allowRelink",t,e))}get allowMove(){return this.$l}set allowMove(e){const t=this.$l;t!==e&&(y.s(e,"boolean",Gt,"allowMove"),this.$l=e,this.t("allowMove",t,e))}get allowReshape(){return this.Zl}set allowReshape(e){const t=this.Zl;t!==e&&(y.s(e,"boolean",Gt,"allowReshape"),this.Zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Ql}set allowResize(e){const t=this.Ql;t!==e&&(y.s(e,"boolean",Gt,"allowResize"),this.Ql=e,this.t("allowResize",t,e))}get allowRotate(){return this._l}set allowRotate(e){const t=this._l;t!==e&&(y.s(e,"boolean",Gt,"allowRotate"),this._l=e,this.t("allowRotate",t,e))}get allowSelect(){return this.ta}set allowSelect(e){const t=this.ta;t!==e&&(y.s(e,"boolean",Gt,"allowSelect"),this.ta=e,this.t("allowSelect",t,e))}}var Ei=(m=>(m[m.None=1]="None",m[m.Uniform=2]="Uniform",m[m.UniformToFill=3]="UniformToFill",m))(Ei||{}),Os=(m=>(m[m.All=1]="All",m[m.NotDirected=2]="NotDirected",m[m.NotDirectedFast=3]="NotDirectedFast",m[m.NotUndirected=4]="NotUndirected",m[m.DestinationTree=5]="DestinationTree",m[m.SourceTree=6]="SourceTree",m))(Os||{}),Rs=(m=>(m[m.Document=1]="Document",m[m.Infinite=2]="Infinite",m))(Rs||{}),Es=(m=>(m[m.TreeParent=1]="TreeParent",m[m.AllParents=2]="AllParents",m[m.AnyParents=3]="AnyParents",m))(Es||{});class U{Ns;qt;BM;lb;Rr;Ju;ab;hb;cb;fb;ub;db;fh;ah;gb;pb;yb;ia;Jc;Or;ip;wb;xb;$u;eo;Ir;uh;Vo;sp;$c;np;Zc;Zu;Er;io;zM;XM;bb;kb;GM;Pb;YM;KM;HM;Sb;op;Ur;Vr;Br;zr;Xr;Gr;Mb;Yr;Nb;Kr;Hr;jr;qr;Cb;jM;Bo;qM;Lb;Ab;WM;Ce;JM;Qc;$M;js;zo;Be;Tb;Yl;Kl;Db;vb;Hl;jl;ql;Fb;Wl;Jl;$l;Zl;Ql;_l;ta;Rb;Ob;ZM;Qu;_u;Ib;Eb;Ub;Vb;rp;Bb;zb;Xb;Qt;KA;Gb;HA;td;Pn;so;li;no;jA;sa;QM;_M;lp;Yb;ed;ap;Kb;Wr;na;dh;t2;e2;hp;Hb;jb;ls;sd;cp;nd;Xo;_c;fp;Jr;gh;i2;dp;Ht;v;qi;Dr;Ye;Ts;s2;oa;$r;Fl;Zr;mh;tf;o2;od;ph;rd;zt;ra;ct;it;ld;wt;xt;lt;ef;Mx;qb;yh;sf;Wb;Jb;gp;YR;KR;$e;Ol;_m;mp;l2;a2;qA;pp;HR;jR;qR;$b;WR;JR;$R;wh;WA;la;xh;bh;kh;Ph;Eu;oh;Wt;Nt;nf;qP;WP;vc;Zt;static Zb=null;static JA=new xt;static h2;static c2=null;Iu;Qb;_b;ad;t1;e1;yp;f2;wp;xp;bp;jx;u2;d2;of;kp;Pp;constructor(e,t){if(U.qw||(U.OP(),U.qw=!0),z.Je(this),U.$A(this),this.Ht=!0,this.Nt=null,this.wt=0,this.xt=0,this.lt=null,U.isUsingDOM()){const s=this,n=()=>{s.Le(X.document,"DOMContentLoaded",n,!1),s.setRTL()};null!==X.document.body?this.setRTL():s.Et(X.document,"DOMContentLoaded",n,!1)}this.ef=null,U.g2("Model",pi);const i=this;return this.JM=s=>i.partManager.doModelDataChanged(s),this.Qc=s=>i.partManager.doModelChanged(s),this.Wb=null,this.Jb=null,this.ZA(),this.model=bt.m2(),this.themeManager=new $e,this.Bo=!0,this.QA(),this.layout=new se,this.Bo=!1,this.HR=null,this.jR=null,this.qR=null,this.$b=null,this.WR=null,this.JR=null,this.$R=null,this.wh=null,this.WA=null,this.la=null,this.xh=null,this.bh=null,this.kh=null,this.Ph=null,this.Eu=()=>{},this.oh=null,this.nd=!1,this.nf=new Qn(this),void 0!==e&&("string"==typeof e||X.Element&&e instanceof Element?this.p2(e):t=e),t&&this.setProperties(t),this.Ht=!1,this.requestUpdate(),this}lR(){return null!==this.lt}get renderer(){return this._c}set renderer(e){if(this instanceof ui)return;""===e&&(e="default");const t=e.toLowerCase();if(t===this._c)return;this._c=t;let s=null;"default"===t||"canvas"===t?(s=this.Xo.get("svg"),null!==s&&s.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))):"svg"===t?(this.Xo.has("svg")?s=this.Xo.get("svg"):(s=new fi(this,X.document),this.addRenderer("svg",s)),null!==this.div&&(s.bt.role="img",this.div.appendChild(s.bt)),this.lt&&(this.Wt=s._t,this.lt._t.setTransform(this.$e,0,0,this.$e,0,0),this.lt._t.clearRect(0,0,this.wt,this.xt))):"debug"===t&&(this.Xo.has("SVG")||(s=new fi(this,X.document),this.addRenderer("SVG",s),s.bt.style.backgroundColor="whitesmoke",null!==this.div&&this.div.after(s.bt))),this.Ht||this.redraw()}ZA(){if(this.of=new H,this.setupRouters(),this.Ns=new ue,this.Ns.Eo(this),this.qt=17,this.BM=!1,this.ld=!1,this.lb="default",this.zt=new H,this.Xo){const e=this.Xo.get("svg");null!==e&&e.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))}this.Xo=new xt,this._c="default",this.resetRenderingHints(),this.ZR(),this.Zt=1,this.ct=new S(NaN,NaN).k(),this.jx=new S(NaN,NaN),this.it=1,this.dp=1,this.ab=new S(NaN,NaN).k(),this.hb=NaN,this.cb=1e-4,this.fb=100,this.v=new Ot,this.ub=new S(NaN,NaN).k(),this.db=new j(NaN,NaN,NaN,NaN).k(),this.fh=new It(0,0,0,0).kt(),this.ah=1,this.gb=!1,this.pb=null,this.yb=null,this.ia=1,this.Jc=A.Default,this.Or=1,this.ip=A.Default,this.wb=A.None,this.xb=A.None,this.qi=!0,this.$u=!1,this.eo=new Set,this.Ir=new z,this.uh=new z,this.Vo=!1,this.ra=new xt,this.od=!0,this.sp=250,this.$c=-1,this.np=new It(16,16,16,16).kt(),this.Dr=!1,this.Zc=!1,this.Zu=!0,this.fp=new xe,this.fp.diagram=this,this.Jr=new xe,this.Jr.diagram=this,this.gh=new xe,this.gh.diagram=this,this.Er=null,this.io=null,this.Mx=!1,this.QR(),this.Zr=new z,this.bb=!0,this.kb=1,this.GM=!1,this.Pb=1,this.Sb="auto",this.op="auto",this.Ur=null,this.Vr=null,this.Br=null,this.zr=null,this.Xr=null,this.Gr=null,this.Mb=null,this.Yr=null,this.Nb=!1,this.Kr=null,this.Hr=null,this.jr=null,this.qr=null,this.Cb=!1,this.qb={},this.yh=[null,null],this.Bo=!1,this.qM=!1,this.Lb=!1,this.Ab=!1,this.WM=!0,this.Ts=!1,this.ph=!1,this.$M=!0,this.js=-2,this.oa=new xt,this.rd=new H,this.zo=!1,this.Be=!0,this.Tb=!0,this.Yl=!0,this.Kl=!0,this.Db=!1,this.vb=!0,this.Hl=!0,this.jl=!0,this.ql=!0,this.Fb=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Rb=!0,this.Ob=!0,this.ZM=!1,this.sf=!1,this.Qu=!0,this._u=!0,this.Ib=!0,this.Eb=!0,this.Ub=16,this.Vb=16,this.rp=!1,this.Bb=!1,this.zb=0,this.Xb=0,this.Qt=new It(5).kt(),this.KA=(new z).k(),this.Gb=999999999,this.HA=(new z).k(),this.mh=!0,this.td=!0,this.tf=!0,this.Pn=!1,this.so=!1,this.$r=!0,this.Fl=!1,this.no=!1,this.jA=new z,this.o2=new z,this.sa=null,this.QM=new lt(gt._A,gt.tT),this._M=999,this.lp=!1,this.qP=1,this.WP=0,this.Ye={scale:1,position:new S,bounds:new j,canvasSize:new lt,newCanvasSize:new lt,isScroll:!1},this.Ye.canvasSize=this.Ye.canvasSize,this.Ye.newCanvasSize=this.Ye.newCanvasSize,this.Ye.isScroll=!1,this.Yb=new j(NaN,NaN,NaN,NaN).k(),this.ed=new lt(NaN,NaN).k(),this.ap=new j(NaN,NaN,NaN,NaN).k(),this.Kb=!1,this.kp=null,this.Pp=null,this._R(),this.ls=null,this.sd=!1,this.vc=null,this.partManager=new pi,this.toolManager=new Ue,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this._b=null,this.ad=new Mi,this.t1=null,this.e1=null,this.Qb=!1,this.Iu=!1,this.commandHandler=new $t,this.xp=null,this.bp=S.mn,this.u2=!1,this.$e=1,this.Ol=null,this._m=1,this.yp=0,this.f2=[0,0,0,0,0],this.wp=0,this.mp=1,this.l2=0,this.a2=new S,this.qA=500,this.cp=new S,this.pp=!1}static eT=void 0!==X.document;static isUsingDOM(){return U.eT}static setDocument(e){X.document=e}static useDOM(e){U.eT=!!e&&void 0!==X.document}static Wi=new WeakMap;clear(){this.animationManager.stopAnimation(),this.model.clear(),U.iT(),this.sT(!1),this.rd.clear(),this.nT(),this.sa=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.C()}sT(e){this.animationManager.stopAnimation(!0),this.clearSelection(),this.clearHighlighteds();const t=this.skipsUndoManager,i=null!=this.Ce;i&&(this.skipsUndoManager=!0);let s=null;null!==this.ls&&(s=this.ls.part,null!==s&&this.remove(s));const n=[],o=this.zt.length;if(e){for(let r=0;r<o;r++){const a=this.zt.r[r].parts;for(;a.next();){const l=a.value;l!==s&&null===l.data&&n.push(l)}}for(let r=0;r<n.length;r++)this.remove(n[r])}for(let r=0;r<o;r++)this.zt.r[r].OR();return this.partManager.clear(),this.eo.clear(),this.Ir.clear(),this.uh.clear(),this.ra.clear(),this.Zr.clear(),this.vc=null,this.rd.clear(),this.nT(),y.LP=[],null!==s&&(this.add(s),this.partManager.parts.delete(s)),i&&(this.skipsUndoManager=t),n}static Sp=null;static i1="";static iT(){U.Sp=null,U.i1=""}static EU(){return null}reset(){this.clear(),this.Ht=!0,this.ZA(),this.themeManager=new $e,this.aa(),this.Bo=!0,this.QA(),this.layout=new se,this.Bo=!1,this.model=bt.m2(),this.model.undoManager=new Pi,this.nd=!1,this.Ht=!1,this.C()}_R(){this.Wr=new xt,this.t2=(new nt).add(new mt({stroke:"black",font:"10pt sans-serif"}).bind("text","",y.toString).theme("stroke","text").theme("font","normal")),this.Wr.set("",this.t2),this.Wr.set("Comment",(new nt).add(new mt({stroke:"brown",font:"10pt sans-serif"}).bind("text","",y.toString).theme("stroke","comment").theme("font","normal"))),this.Wr.set("LinkLabel",new nt({selectable:!1,avoidable:!1}).add(new rt("Ellipse",{fill:"black",stroke:null,desiredSize:new lt(3,3).kt()}).theme("fill","link"))),this.dh=new xt,this.s2=new pt(J.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new mt({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",y.toString).theme("stroke","text").theme("font","bold"),new J(J.Auto,{name:"GROUPPPANEL"}).add(new rt({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new de({padding:5}).theme("padding","group"))),this.dh.set("",this.s2),this.na=new xt,this.e2=(new gt).add(new rt({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new rt({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this.na.set("",this.e2),this.na.set("Comment",(new gt).add(new rt({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.hp=new Nt(J.Auto).add(new rt({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new de({margin:1.5}).theme("margin","selection","numbers",null,e=>e?new It(e/2):1.5)).freezeBindings(),this.Hb=this.hp,this.jb=new Nt(J.Link).add(new rt({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection")).freezeBindings()}setRTL(e){let t=void 0===e?this.div:e;null===t&&(t=X.document.body);const i=y.Ni("div");i.dir="rtl",i.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",i.textContent="A",t.appendChild(i);let s="reverse";i.scrollLeft>0?s="default":(i.scrollLeft=1,0===i.scrollLeft&&(s="negative")),t.removeChild(i),this.lb=s}setScrollWidth(e){let t=void 0===e?this.div:e;null===t&&(t=X.document.body);let i=0;if(U.isUsingDOM()){let s=U.c2,n=U.h2;null===s&&(U.c2=y.Ni("p"),s=U.c2,s.style.width="100%",s.style.height="200px",s.style.boxSizing="content-box",U.h2=y.Ni("div"),n=U.h2,n.style.position="absolute",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.boxSizing="content-box",n.appendChild(s)),n.style.overflow="hidden",t.appendChild(n);const o=s.offsetWidth;n.style.overflow="scroll";let r=s.offsetWidth;o===r&&(r=n.clientWidth),t.removeChild(n),i=o-r,0===i&&!y.ur&&(i=11)}this.qt=i,this.BM=!0}fe(e){e in Ei?this.autoScale=e:y.dr(this,e)}toString(e){void 0===e&&(e=0);let t="";this.div&&this.div.id&&(t=this.div.id);let i='Diagram "'+t+'"';if(e<=0)return i;const s=this.zt.iterator;for(;s.next();)i+="\n  "+s.value.toString(e-1);return i}static $A(e){U.Zb=e}static Om(){return U.Zb}static fromDiv(e){let t=e;if("string"==typeof e&&(t=X.document.getElementById(e)),t instanceof HTMLDivElement){const i=U.Wi.get(t);if(i)return i}return null}get div(){return this.Nt}set div(e){if(null!==e&&y.se(e,HTMLDivElement,U,"div"),this.Nt!==e){const t=this.Nt;if(null!==t){if(U.Wi.delete(t),t.goDiagram=void 0,t.go=void 0,t.innerHTML="",null!==this.lt){const s=this.lt.bt;this.Le(s,"pointermove",this.xh,!1),this.Le(s,"pointerdown",this.la,!1),this.Le(s,"pointerup",this.bh,!1),this.Le(s,"pointerout",this.kh,!1),this.Le(s,"pointercancel",this.Ph,!1),this.lt.dispose()}this.ef&&(this.ef.disconnect(),this.ef=null);const i=this.toolManager;null!==i&&(i.mouseDownTools.each(s=>s.cancelWaitAfter()),i.mouseMoveTools.each(s=>s.cancelWaitAfter()),i.mouseUpTools.each(s=>s.cancelWaitAfter())),i.cancelWaitAfter(),this.currentTool.doCancel(),this.lt=null,this.Le(X,"resize",this.$b,!1),this.Le(X,"wheel",this.wh,!0),U.Om()===this&&U.$A(null)}else null===this.la&&(this.no=!1);if(this.Nt=null,null!==e){const i=U.Wi.get(e);i&&(i.div=null),this.p2(e),this.Eu(),this.themeManager&&this.themeManager.tO()}else this.themeManager&&this.themeManager.eO()}}setupRouters(){this.of.push(new So)}p2(e){const t=this;if(!U.isUsingDOM())return;null==e&&y.o("Diagram setup requires an argument DIV."),null!==t.Nt&&y.o("Diagram has already completed setup."),"string"==typeof e?t.Nt=X.document.getElementById(e):e instanceof HTMLDivElement?t.Nt=e:y.o("No DIV or DIV id supplied: "+e),null===t.Nt&&y.o("Invalid DIV id; could not get element with id: "+e);const i=U.Wi.get(t.Nt);if(i&&i!==this&&y.o("Invalid div id; div already has a Diagram associated with it."),!t.ef&&X.ResizeObserver){const c=X.ResizeObserver,u=y.CP(()=>t.requestUpdate(),250,!1);t.ef=new c(()=>u()),t.ef.observe(t.Nt)}"static"===X.getComputedStyle(t.Nt,null).position&&(t.Nt.style.position="relative");let s=5;const n="rgba(2"+s+"5, 255, 255, 0)";s--,t.Nt.style["-webkit-tap-highlight-color"]=n,t.Nt.innerHTML="",U.Wi.set(t.Nt,t),t.Nt.goDiagram=t,t.Nt.go=X.go;const o=new Oe(t);void 0!==o.style&&(o.style.position="absolute",o.style.top="0px",o.style.left="0px","rtl"===X.getComputedStyle(t.Nt,null).getPropertyValue("direction")&&(t.ld=!0),o.style.zIndex="2",o.style.userSelect="none",o.style.MozUserSelect="none",o.style.touchAction="none",o.style.letterSpacing="normal !important",o.style.wordSpacing="normal !important",o.style.lang="unknown"),o.bt.setAttribute("role","application"),t.lt=o,t.Wt=o._t;const r=t.Wt;t.$e=t.computePixelRatio(),t.viewSize.isReal()||(t.wt=t.Nt.clientWidth||1,t.xt=t.Nt.clientHeight||1),t.oT(t.wt,t.xt);const a=t;t.Nt.insertBefore(o.bt,t.Nt.firstChild);const l=new Oe(null);if(l.width=1,l.height=1,t.YR=l,t.KR=l._t,U.isUsingDOM()){const c=y.Ni("div"),u=y.Ni("div");c.style.position="absolute",c.style.overflow="auto",c.style.width=t.wt+"px",c.style.height=t.xt+"px",c.style.zIndex="1",u.style.position="absolute",u.style.width="1px",u.style.height="1px",t.Nt.appendChild(c),c.appendChild(u),c.onscroll=U.iO,c.addEventListener("pointerdown",U.sO),c.a=t,c.nO=!0,c.oO=!0,t.Wb=c,t.Jb=u}t.Eu=y.CP(()=>{t.Ol=null,t.C()},300,!1),t.$b=y.CP(()=>{t.MM()},250,!1),t.oh=c=>(c.preventDefault(),!1),t.wh=c=>{if(!a.isEnabled)return;const u=a.rf(c,!0);u.bubbles=!0;let d=0,f=0;u.delta=0,void 0!==c.deltaX?(0!==c.deltaX&&(d=c.deltaX>0?1:-1),0!==c.deltaY&&(f=c.deltaY>0?1:-1),u.delta=Math.abs(c.deltaX)>Math.abs(c.deltaY)?-d:-f):void 0!==c.wheelDeltaX?(0!==c.wheelDeltaX&&(d=c.wheelDeltaX>0?-1:1),0!==c.wheelDeltaY&&(f=c.wheelDeltaY>0?-1:1),u.delta=Math.abs(c.wheelDeltaX)>Math.abs(c.wheelDeltaY)?-d:-f):void 0!==c.wheelDelta&&0!==c.wheelDelta&&(u.delta=c.wheelDelta>0?1:-1),a.doMouseWheel(),a.Sh(u,c)},t.WA=c=>{if(!a.isEnabled)return;t.sf=!1,a.rf(c,!0);const u=a.currentTool;u.cancelWaitAfter(),u.standardMouseOver()},t.la=c=>{if(!a.isEnabled)return;t.sf=!0;const u=a.qb;void 0===u[c.pointerId]&&(u[c.pointerId]=c);const d=a.yh;let f=!1;if(null===d[0]||d[0].pointerId!==c.pointerId&&d[0].pointerType===c.pointerType)if(null!==d[1]&&d[1].pointerId===c.pointerId)d[1]=c,f=!0;else if(null===d[0])d[0]=c;else{if(null!==d[1])return void c.preventDefault();d[1]=c,f=!0}else d[0]=c;const p="touch"===c.pointerType||"pen"===c.pointerType;p&&(a.Mx=!1,a.pp=!0);const g=a.rO(c,c,f),b=a.a2,x=p?25:10;c.timeStamp-a.l2<a.qA&&!(Math.abs(b.x-c.screenX)>x||Math.abs(b.y-c.screenY)>x)?a.mp++:a.mp=1,g.clickCount=a.mp,a.l2=c.timeStamp,a.a2.setTo(c.screenX,c.screenY),a.doMouseDown(),1!==c.button?a.Sh(g,c):c.preventDefault()},t.xh=c=>{if(!a.isEnabled)return;t.sf=!0;const u=a.yh;if(null===u[0]||u[0].pointerId!==c.pointerId&&u[0].pointerType===c.pointerType){if(null!==u[1]&&u[1].pointerId===c.pointerId)return void(u[1]=c);if(null!==u[0])return;u[0]=c}else u[0]=c;if(u[0].pointerId!==c.pointerId)return;const d=a.lO(c,c,null!==u[1]);a.doMouseMove(),a.Sh(d,c)},t.bh=c=>{if(!a.isEnabled)return;t.sf=!0;const u="touch"===c.pointerType||"pen"===c.pointerType;if(u&&a.Mx)return delete a.qb[c.pointerId],void c.preventDefault();const f=a.yh;if(null===f[0]||f[0].pointerId!==c.pointerId&&f[0].pointerType===c.pointerType)return null!==f[1]&&f[1].pointerId===c.pointerId?void(f[1]=null):void 0;f[0]=null;const p=a.w2(c,!1,!0,!1,!0,!1);let g=X.document.elementFromPoint(c.clientX,c.clientY)||null;null!==g&&g.shadowRoot&&(g=g.shadowRoot.elementFromPoint(c.clientX,c.clientY)||null),null!==g&&g.a instanceof U&&g.a!==a&&g.a.Mp(c,p),null===g&&(g=c.target),a.Mp(c,p),p.clickCount=a.mp,p.targetDiagram=a.s1(c,g),p.targetObject=null,a.doMouseUp(),a.Sh(p,c),u&&(a.pp=!1)},t.kh=c=>{if(!a.isEnabled)return;t.sf=!1;const u=a.qb;u[c.pointerId]&&delete u[c.pointerId];const d=a.yh;if(null!==d[0]&&d[0].pointerId===c.pointerId&&(d[0]=null),null!==d[1]&&d[1].pointerId===c.pointerId&&(d[1]=null),"touch"===c.pointerType||"pen"===c.pointerType)return;const f=a.currentTool;f.cancelWaitAfter(),f.standardMouseOver()},t.Ph=c=>{const u=a.yh;null!==u[0]&&u[0].pointerId===c.pointerId?(u[0]=null,a.pp=!1):null!==u[1]&&u[1].pointerId===c.pointerId&&(u[1]=null)};const h=r;if(t.gp=h.F[y.We("7eba17a4ca3b1a8346")][y.We("78a118b7")](h.F,U.Mh,s,s),r.clearContextCache(!0),t.aO(),"svg"===this._c){const c=this.Xo.get("svg");this.Nt&&this.Nt.appendChild(c.bt),this.Wt=c._t}}addEventListener(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}Et(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}removeEventListener(e,t,i,s){e.removeEventListener(t,i,{capture:s})}Le(e,t,i,s){e.removeEventListener(t,i,{capture:s})}aO(){const e=this;let t=this.lt.bt;t instanceof HTMLCanvasElement||(t=e.div),this.Et(t,"pointerdown",e.la,!1),this.Et(t,"pointermove",e.xh,!1),this.Et(t,"pointerup",e.bh,!1),this.Et(t,"pointerout",e.kh,!1),this.Et(t,"pointercancel",e.Ph,!1),this.Et(t,"pointerenter",e.hO,!1),this.Et(t,"pointerleave",e.cO,!1),this.Et(t,"wheel",e.wh,!1),this.Et(t,"keydown",e.fO,!1),this.Et(t,"keyup",e.uO,!1),this.Et(t,"blur",e.dO,!1),this.Et(t,"focus",e.gO,!1),this.Et(t,"selectstart",i=>(i.preventDefault(),!1),!1),this.Et(t,"contextmenu",i=>(i.preventDefault(),!1),!1),this.Et(X,"resize",e.$b,!1)}Cx(){this.yp>30&&(this.Ol=1)}yS(e){null!==this.Ol&&(this.Ol=null,e&&this.Eu(),this.yp=0,this.f2=[0,0,0,0,0],this.wp=0)}computePixelRatio(){return null!==this.Ol?this.Ol:X.devicePixelRatio||1}get avgSpf(){return this.yp}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){const e=this.commandHandler;if(!this.toggleKeyboardControl()){if((e.isFocusEnabled||e.isVirtualPointerEnabled)&&e.doVirtualFocusKeyDown()){const t=this.lastInput;t.bubbles=!1;const i=t.event;return void(i&&(i.stopPropagation&&i.stopPropagation(),!1!==i.cancelable&&i.preventDefault()))}this.currentTool.doKeyDown()}}toggleKeyboardControl(){const e=this.lastInput,t=e.commandKey;if((e.control||e.meta)&&e.alt&&("Enter"===t||"NumpadEnter"===t)){const i=this.commandHandler,s=i.isFocusEnabled||i.isVirtualPointerEnabled;return i.isFocusEnabled=!s,i.isVirtualPointerEnabled=!s,i.focus=i.findFirstFocus(),this.T("FocusOrVirtualPointerEnabledChanged"),!0}return!1}doKeyUp(){const e=this.commandHandler;if((e.isFocusEnabled||e.isVirtualPointerEnabled)&&e.doVirtualFocusKeyUp()){const t=this.lastInput;t.bubbles=!1;const i=t.event;return void(i&&(i.stopPropagation&&i.stopPropagation(),!1!==i.cancelable&&i.preventDefault()))}this.currentTool.doKeyUp()}doFocus(){this.focus()}focus(){if(this.lt)if(this.scrollsPageOnFocus)this.lt.focus();else{const e=X.scrollX,t=X.scrollY;this.lt.focus(),X.scrollTo(e,t)}}gO(e){const t=U.Wi.get(this);t&&t.T("GainedFocus")}dO(e){const t=U.Wi.get(this);t&&t.T("LostFocus")}MM(){if(null===this.lt)return;const e=this.Nt;if(null===e||0===e.clientWidth||0===e.clientHeight)return;this.BM||this.setScrollWidth();const t=this.so?this.qt:0,i=this.Pn?this.qt:0,s=this.$e;if(this.$e=this.computePixelRatio(),this.$e!==s&&(this.$u=!0,this.requestUpdate()),e.clientWidth!==this.wt+t||e.clientHeight!==this.xt+i){this.Nh(),this.qi=!0;const n=this.layout;null!==n&&n.isViewportSized&&1===this.autoScale&&(this.Zc=!0,n.p()),this.Ts||this.requestUpdate()}}QA(){let e=0,t=new Gt;t.name="Grid",t.allowSelect=!1,t.pickable=!1,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Qr(t,e++),t=new Gt,t.name="ViewportBackground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Qr(t,e++),t=new Gt,t.name="Background",this.Qr(t,e++),t=new Gt,t.name="",this.Qr(t,e++),t=new Gt,t.name="Foreground",this.Qr(t,e++),t=new Gt,t.name="ViewportForeground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Qr(t,e++),t=new Gt,t.name="Adornment",t.isTemporary=!0,t.isInDocumentBounds=!1,this.Qr(t,e++),t=new Gt,t.name="Tool",t.isTemporary=!0,t.isInDocumentBounds=!0,this.Qr(t,e++)}rT(){const e=new J(J.Grid,{name:"GRID"}).add(new rt("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new rt("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new rt("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new rt("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new rt("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new rt("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),t=new At({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(e);return this.add(t),this.partManager.parts.delete(t),e.visible=!1,e}static iO(){const e=U.Wi.get(this.parentElement||this);if(e){if(e.Bb)return void(e.Bb=!1);if(!e.isEnabled)return void e.lT();e.diagramScroll(this)}}static sO(e){this.a.isEnabled?(this.a.zb=e.target.scrollTop,this.a.Xb=e.target.scrollLeft):this.a.updateScroll()}diagramScroll(e){if(null===this.lt)return;const t=this.Wb,i=this.Jb;this.rp=!0;let s=this.documentBounds,n=this.viewportBounds;const o=this.fh;let r=s.x-o.left,a=s.y-o.top;const l=s.width+o.left+o.right,h=s.height+o.top+o.bottom;let c=s.right+o.right,u=s.bottom+o.bottom,d=n.x,f=n.y;const p=n.width,g=n.height;let b=n.right,x=n.bottom;const v=this.scale;let P,w=e.scrollLeft;if(this.ld)switch(this.lb){case"negative":w=w+e.scrollWidth-e.clientWidth;break;case"reverse":w=e.scrollWidth-w-e.clientWidth}const M=w;if(p<l||g<h)return P=S.z(this.position.x,this.position.y),this.allowHorizontalScroll&&this.Xb!==M&&(P.x=M/v+r,this.Xb=M),this.allowVerticalScroll&&this.zb!==e.scrollTop&&(P.y=e.scrollTop/v+a,this.zb=e.scrollTop),this.position=P,S.i(P),this.rp=!1,void(this.td=!1);P=S.l(),e.nO&&this.allowHorizontalScroll&&(r<d&&(this.position=P.e(M+r,this.position.y)),c>b)&&(this.position=P.e(-(t.scrollWidth-this.wt)+M-this.wt/v+c,this.position.y)),e.oO&&this.allowVerticalScroll&&(a<f&&(this.position=P.e(this.position.x,e.scrollTop+a)),u>x)&&(this.position=P.e(this.position.x,-(t.scrollHeight-this.xt)+e.scrollTop-this.xt/v+u)),S.i(P),this.ha(),this.rp=!1,this.td=!1,s=this.documentBounds,n=this.viewportBounds,c=s.right,b=n.right,u=s.bottom,x=n.bottom,r=s.x,d=n.x,a=s.y,f=n.y,p>=l&&r>=d&&c<=b&&(i.style.width="1px"),g>=h&&a>=f&&u<=x&&(i.style.height="1px")}computeBounds(e){return void 0===e&&(e=new j),this.Te(),this.aT(e)}aT(e){if(this.fixedBounds.isReal())return e.h(this.fixedBounds),e.addMargin(this.Qt),e;let t=!0;const i=this.zt.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if(!o.visible||!o.isInDocumentBounds)continue;const r=o.Ct.r,a=r.length;for(let l=0;l<a;l++){const h=r[l];if(!h.isInDocumentBounds||!h.isVisible())continue;const c=h.actualBounds;c.isReal()&&(t?(t=!1,e.h(c)):e.unionRect(c))}}return t&&e.e(0,0,0,0),e.addMargin(this.Qt),e}computePartsBounds(e,t){let i;if(void 0===t&&(t=!1),Array.isArray(e))for(let s=0;s<e.length;s++){const n=e[s];!t&&n instanceof gt||(n.ensureBounds(),void 0===i?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}else{const s=e.iterator;for(;s.next();){const n=s.value;!t&&n instanceof gt||(n.ensureBounds(),void 0===i?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}}return void 0===i?new j(NaN,NaN,0,0):i}$s(e){if(!e&&!this.no||this.Ht||null===this.lt||!this.documentBounds.isReal())return;if(this.Ht=!0,e){const u=this.initialPosition;if(u.isReal())return this.Ht=!1,void(this.position=u);let d=this.initialDocumentSpot,f=this.initialViewportSpot;d.isNoSpot()&&(d=A.TopLeft),f.isNoSpot()&&(f=A.TopLeft);const p=S.l();p.setRectSpot(this.documentBounds,d);const g=this.viewportBounds,b=j.z(0,0,g.width,g.height),x=S.l();x.setRectSpot(b,f),x.e(p.x-x.x,p.y-x.y),this.Ht=!1,this.position=x,j.i(b),S.i(x)}let t=this.ia;e&&1!==this.Or&&(t=this.Or);const i=1!==t?this.hd(t):this.scale,s=this.ct.x,n=this.ct.y,o=this.wt/i,r=this.xt/i;let a=this.Jc;const l=this.ip;if(e&&!a.isSpot()&&(l.isSpot()||l.isDefault())){const u=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();a=l.isDefault()&&!u?A.Center:l}this.b2(this.documentBounds,o,r,a,e);const h=this.scale;this.scale=i,this.Ht=!1;const c=this.viewportBounds;c.equalsApproxTo(s,n,o,r)||this.onViewportBoundsChanged(new j(s,n,o,r),c,h,!1)}hd(e){const t=this.dp;if(null===this.lt)return t;if(1===e)return this.scale;this.ensureBounds();const i=this.documentBounds;if(!i.isReal())return t;const s=i.width,n=i.height,o=this.wt+(this.so?this.qt:0),r=this.xt+(this.Pn?this.qt:0);let a=o/s,l=r/n;const h=this.fh;(h.left+h.right!==0||h.top+h.bottom!==0)&&(l===a?(l=(r-this.qt)/n,a=(o-this.qt)/s):l>a?l=(r-this.qt)/n:a=(o-this.qt)/s);let d=0;return 2===e?d=Math.min(l,a):3===e&&(d=l>a?(r-this.qt)/n:(o-this.qt)/s),d>t&&(d=t),d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),d}zoomToFit(){const e=this.ah;this.ah=1,this.scale=this.hd(2),this.alignDocument(A.Center,A.Center),1!==e&&(this.$s(!1),this.b2(this.documentBounds,this.wt/this.it,this.xt/this.it,this.Jc,!1)),this.ah=e}zoomToRect(e,t){void 0===t&&(t=2);const i=e.width,s=e.height;if(0===i||0===s||isNaN(i)&&isNaN(s))return;let n=1;if(2===t||3===t)if(isNaN(i))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/i;else{const o=this.wt,r=this.xt;n=3===t?r/s>o/i?(r-(this.Pn?this.qt:0))/s:(o-(this.so?this.qt:0))/i:Math.min(r/s,o/i)}this.scale=n,this.position=new S(e.x,e.y)}get mO(){return this.Ht}set mO(e){this.Ht=e}alignDocument(e,t){this.ensureBounds();const i=this.documentBounds,s=this.viewportBounds;this.position=new S(i.x+(e.x*i.width+e.offsetX)-(t.x*s.width-t.offsetX),i.y+(e.y*i.height+e.offsetY)-(t.y*s.height-t.offsetY))}focusObject(e){if(e instanceof st){this.xp=e;const t=S.l();this.bp=this.transformDocToView(e.getDocumentPoint(A.TopLeft,t)),S.i(t)}else this.xp=null,this.bp=S.mn}b2(e,t,i,s,n){const o=S.z(this.ct.x,this.ct.y);let r=o.x,a=o.y;if(null!==this.xp){let l=S.l();l=this.xp.getDocumentPoint(A.TopLeft,l),r=l.x-this.bp.x/this.scale,a=l.y-this.bp.y/this.scale,s=A.None,S.i(l)}if(n||1===this.scrollMode){s.isSpot()&&(t>e.width&&(r=e.x+(s.x*e.width+s.offsetX)-(s.x*t-s.offsetX)),i>e.height&&(a=e.y+(s.y*e.height+s.offsetY)-(s.y*i-s.offsetY)));const l=this.fh,h=t-e.width;if(t<e.width+l.left+l.right){let u=r+t/2;u=Math.min(u,e.right+Math.max(h,l.right)-t/2),u=Math.max(u,e.left-Math.max(h,l.left)+t/2),r=u-t/2}else r>e.left?r=e.left:r<e.right-t&&(r=e.right-t);const c=i-e.height;if(i<e.height+l.top+l.bottom){let u=a+i/2;u=Math.min(u,e.bottom+Math.max(c,l.bottom)-i/2),u=Math.max(u,e.top-Math.max(c,l.top)+i/2),a=u-i/2}else a>e.top?a=e.top:a<e.bottom-i&&(a=e.bottom-i)}if(o.x=isFinite(r)?r:-this.Qt.left,o.y=isFinite(a)?a:-this.Qt.top,null!==this.positionComputation){const l=this.positionComputation(this,o);o.x=l.x,o.y=l.y}this.Ns.IA(this.ct,o),this.ct.e(o.x,o.y),this.Np(),this.aa(),this.pO(),S.i(o)}findPartAt(e,t){if(void 0===t&&(t=!0),t){const i=this.kS(e,s=>s.part,s=>s.canSelect());if(i instanceof At)return i}else{const i=this.kS(e,s=>s.part);if(i instanceof At)return i}return null}findObjectAt(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.Te();const s=this.zt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible)continue;const o=n.findObjectAt(e,t,i);if(null!==o)return o}return null}kS(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.Te();const s=this.zt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible||n.isTemporary)continue;const o=n.findObjectAt(e,t,i);if(null!==o)return o}return null}findPartsAt(e,t,i){return void 0===t&&(t=!0),this.yO(e,s=>s.part,t?s=>s instanceof At&&s.canSelect():null,i)}yO(e,t,i,s){void 0===t&&(t=null),void 0===i&&(i=null),!(s instanceof H)&&!(s instanceof z)&&(s=new z),this.Te();const n=this.zt.iteratorBackwards;for(;n.next();){const o=n.value;!o.visible||o.isTemporary||o.findObjectsAt(e,t,i,s)}return s}findObjectsAt(e,t,i,s){void 0===t&&(t=null),void 0===i&&(i=null),!(s instanceof H)&&!(s instanceof z)&&(s=new z),this.Te();const n=this.zt.iteratorBackwards;for(;n.next();){const o=n.value;o.visible&&o.findObjectsAt(e,t,i,s)}return s}findPartsIn(e,t,i,s){return void 0===t&&(t=!1),void 0===i&&(i=!0),this.wO(e,null,n=>n instanceof At&&(!i||n.canSelect()),t,s)}findObjectsIn(e,t,i,s,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===s&&(s=!1),!(n instanceof H)&&!(n instanceof z)&&(n=new z),this.Te();const o=this.zt.iteratorBackwards;for(;o.next();){const r=o.value;r.visible&&r.findObjectsIn(e,t,i,s,n)}return n}MS(e,t,i,s,n,o){const r=new z;this.Te();const a=this.zt.iteratorBackwards;for(;a.next();){const l=a.value;l.visible&&l.MS(e,t,i,s,r,n,o)}return r}wO(e,t,i,s,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===s&&(s=!1),!(n instanceof H)&&!(n instanceof z)&&(n=new z),this.Te();const o=this.zt.iteratorBackwards;for(;o.next();){const r=o.value;!r.visible||r.isTemporary||r.findObjectsIn(e,t,i,s,n)}return n}findPartsNear(e,t,i,s,n){return void 0===i&&(i=!0),void 0===s&&(s=!0),this.xO(e,t,null,o=>o instanceof At&&(!s||o.canSelect()),i,n)}findObjectsNear(e,t,i,s,n,o){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),!1!==n&&!0!==n&&((n instanceof H||n instanceof z)&&(o=n),n=!0),!(o instanceof H)&&!(o instanceof z)&&(o=new z),this.Te();const r=this.zt.iteratorBackwards;for(;r.next();){const a=r.value;a.visible&&a.findObjectsNear(e,t,i,s,n,o)}return o}xO(e,t,i,s,n,o){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),!1!==n&&!0!==n&&((n instanceof H||n instanceof z)&&(o=n),n=!0),!(o instanceof H)&&!(o instanceof z)&&(o=new z),this.Te();const r=this.zt.iteratorBackwards;for(;r.next();){const a=r.value;!a.visible||a.isTemporary||a.findObjectsNear(e,t,i,s,n,o)}return o}acceptEvent(e){return this.rf(e,e instanceof MouseEvent)}rf(e,t){const i=this.Jr;this.Jr=this.gh,this.gh=i,i.diagram=this,i.event=e,t?this.Mp(e,i):(i.viewPoint=this.Jr.viewPoint,i.documentPoint=this.Jr.documentPoint);let s=0;const n=e;return n.ctrlKey&&(s+=1),n.altKey&&(s+=2),n.shiftKey&&(s+=4),n.metaKey&&(s+=8),i.modifiers=s,i.button=n.button,void 0!==n.buttons&&(i.buttons=n.buttons),y.ur&&0===n.button&&n.ctrlKey&&(i.button=2),i.down=!1,i.up=!1,i.clickCount=1,i.delta=0,i.handled=!1,i.bubbles=!1,i.timestamp=e.timeStamp,i.isMultiTouch=!1,i.targetDiagram=this.s1(e,e.target),i.targetObject=null,i}s1(e,t){if(null===t)return null;const i=U.Wi.get(t);if(i)return i;let s=e.path;if(!s&&y.st(e.composedPath)&&(s=e.composedPath()),s&&s[0]){const n=U.Wi.get(s[0]);if(n)return n}return null}rO(e,t,i){const s=this.w2(e,!0,!1,!1,!0,i);return this.Mp(t,s),s.targetDiagram=this.s1(e,e.target),s.targetObject=null,i||s.clone(this.fp),s}lO(e,t,i){const s=this.w2(e,!1,!1,!1,!1,i);let n=X.document.elementFromPoint(t.clientX,t.clientY)||null;null!==n&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(t.clientX,t.clientY)||null);let o=this,r=e;if(n){const a=this.s1(e,n);a&&(r=t,o=a)}return s.targetDiagram=o,this.Mp(r,s),s.targetObject=null,s}w2(e,t,i,s,n,o){const r=this.Jr;this.Jr=this.gh,this.gh=r,r.diagram=this,r.clickCount=1,r.delta=0;let a=0;return e.ctrlKey&&(a+=1),e.altKey&&(a+=2),e.shiftKey&&(a+=4),e.metaKey&&(a+=8),r.modifiers=a,r.event=e,r.timestamp=e.timeStamp,r.button=i?this.firstInput.button:e.button,r.buttons=e.buttons,y.ur&&0===e.button&&e.ctrlKey&&(r.button=2),r.down=t,r.up=i,r.handled=s,r.bubbles=n,r.isMultiTouch=o,r}Sh(e,t){return!!e.bubbles||(void 0!==t.stopPropagation&&t.stopPropagation(),!1!==t.cancelable&&t.preventDefault(),t.cancelBubble=!0,!1)}fO(e){const t=U.Wi.get(this);if(!t||!t.isEnabled)return!1;const i=t.rf(e,!1);return i.key=e.key,i.code=e.code,i.down=!0,t.doKeyDown(),t.Sh(i,e)}uO(e){const t=U.Wi.get(this);if(!t||!t.isEnabled)return!1;const i=t.rf(e,!1);return i.key=e.key,i.code=e.code,i.up=!0,t.doKeyUp(),t.Sh(i,e)}hO(e){const t=U.Wi.get(this);if(!t||!t.isEnabled)return!1;const i=t.rf(e,!0);return null!==t.mouseEnter&&t.mouseEnter(i),t.currentTool.standardMouseOver(),t.Sh(i,e)}cO(e){const t=U.Wi.get(this);if(!t||!t.isEnabled)return!1;const i=t.rf(e,!0);return null!==t.mouseLeave&&t.mouseLeave(i),t.Sh(i,e)}getMouse(e){const t=this.lt;if(null===t)return new S(0,0);const i=t.getBoundingClientRect();return new S(this.wt/i.width*(e.clientX-i.left),this.xt/i.height*(e.clientY-i.top)).Ki(this.v)}Mp(e,t){const i=this.lt;let s=0,n=0;if(null!==i){const r=i.getBoundingClientRect();s=this.wt/r.width*(e.clientX-r.left),n=this.xt/r.height*(e.clientY-r.top)}t.viewPoint.e(s,n);const o=S.z(s,n);this.v.Ci(o),t.documentPoint.h(o),S.i(o)}_L(e,t,i){let s;if(null===this.yh[0])return;s=this.yh[t];const n=this.lt;if(null!==n){const o=n.getBoundingClientRect();i.e(this.wt/o.width*(s.clientX-o.left),this.xt/o.height*(s.clientY-o.top))}}invalidateDocumentBounds(){this.mh||(this.mh=!0,this.requestUpdate(!1))}bO(){this.Ts||this.Te(),this.ensureBounds()}redraw(){this.Ht||this.Ts||(this.C(),this.maybeUpdate())}isUpdateRequested(){return this.Dr}delayInitialization(e){void 0===e&&(e=null);const t=this.animationManager,i=t.isEnabled;t.stopAnimation(),t.isEnabled=!1,this.Sr(),this.no=!1,this.jx=new S(NaN,NaN),t.isEnabled=i,this.Ts=!0;const s=this;null!==e&&y.dn(()=>{s.Ts=!1,t.Gl("Model"),e(s)},1)}requestUpdate(e){if(void 0===e&&(e=!1),!0===this.Dr||this.Ht||!1===e&&this.Ts)return;this.Dr=!0;const t=this;X.requestAnimationFrame(()=>{t.Dr&&t.maybeUpdate()})}maybeUpdate(){this.Zu&&!this.Dr||(this.Zu&&(this.Zu=!1),this.Sr())}k2(e,t){!this.td||this.Ht||this.animationManager.defaultAnimation.isAnimating||this.lT()||(e&&this.Te(),t&&this.$s(!1))}Sr(e){if(this.Ts||(this.Dr=!1,null===this.Nt&&!this.ed.isReal()))return;this.Ts=!0;const t=this.animationManager,i=this.rd;if(!t.isAnimating&&0!==i.length){const c=i.r,u=c.length;for(let d=0;d<u;d++){const f=c[d];f.xi(!1),f.c()}i.clear()}const s=this.o2;s.count>0&&(s.each(c=>c.P2()),s.clear());let n=!1,o=!1;t.defaultAnimation.isAnimating&&(o=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),t.ke||this.MM(),e||this.k2(!1,!0);const r=!this.undoManager.isUndoingRedoing&&(this.Fl||0!==this.of.count&&0!==this.Ir.size),a=!this.no||this.$r;this.Te(!0);let l=!1;(a||r)&&(this.no?this.S2(!this.Zc,r):(this.startTransaction("Initial Layout"),!1===t.isEnabled&&t.stopAnimation(),this.S2(!1,r)),l=a),this.Zc=!1,this.Fl=!1,this.Te(),null!==this.ls&&(this.ls.visible&&!this.sd&&(this.ca(),this.sd=!0),!this.ls.visible&&this.sd&&(this.sd=!1)),this.Lb||this.bO(),e||this.k2(!0,!1);let h=!1;if(l){const c=j.l();c.h(this.viewportBounds),this.no||(this.no=!0,h=!0,this.skipsUndoManager||(this.undoManager.Px=!0),this.undoManager.Sx=!0,this.kO()),this.PO(),this.Te(!1),e||this.k2(!0,!0),j.i(c)}else if(t.zc&&t.Hx){if(1!==this.Or)this.scale=this.hd(this.Or);else if(1!==this.ia)this.scale=this.hd(this.ia);else{const c=this.initialScale;isFinite(c)&&c>0&&(this.scale=c)}this.$s(!0)}l&&h&&this.commitTransaction("Initial Layout"),e||this.Ge(this.Wt),o&&(this.skipsUndoManager=n),this.Ts=!1}get Qa(){return this.no}kO(){if(1!==this.Or)this.scale=this.hd(this.Or);else if(1!==this.ia)this.scale=this.hd(this.ia);else{const t=this.initialScale;isFinite(t)&&t>0&&(this.scale=t)}this.$s(!0);const e=this.zt.r;this.As(e,e.length,this,this.viewportBounds),this.T("InitialLayoutCompleted"),this.jx.h(this.ct),this.ca()}PO(){this.T("LayoutCompleted")}Cp(e){this.eo.add(e)}addInvalidRoute(e){this.Vo?this.uh.add(e):this.Ir.add(e)}Te(e){if(0!==this.eo.size&&(this.Ts||!this.animationManager.isTicking)){if(this.Ts||(this.Fl=!0),e)return void this.hT(this.eo);for(let t=0;t<23&&0!==this.eo.size;t++){const i=new Set(this.eo);this.eo.clear(),this.P2(i,this.eo)}this.nodes.each(t=>{t instanceof pt&&t.cT(!1)})}}hT(e,t){for(const i of e)!i.Di()||i instanceof pt||(i._r()?(i.ht(1/0,1/0),i.Ut()):t&&t.add(i));for(const i of e)if(i instanceof pt){if(!i.isVisible())continue;this.o1(i)}}P2(e,t){this.hT(e,t);for(const i of e){if(!(i instanceof gt))continue;const s=i;s.isVisible()&&(s._r()?(s.ht(1/0,1/0),s.Ut()):t.add(s))}for(const i of e)i instanceof Nt&&i.isVisible()&&(i._r()?(i.ht(1/0,1/0),i.Ut()):t.add(i))}cd(e){const t=e instanceof U,i=t?e.links:e.memberParts,s=this.eo;if(t)this.Te(!0);else{for(;i.next();){const n=i.value;s.has(n)&&(!n.Di()||n instanceof pt||n._r()&&(n.ht(1/0,1/0),n.Ut()))}for(i.reset();i.next();){const n=i.value;if(s.has(n)&&n instanceof pt){if(!n.isVisible())continue;this.o1(n)}}i.reset()}for(;i.next();){const n=i.value;n instanceof gt&&s.has(n)&&n.isVisible()&&n._r()&&(n.ht(1/0,1/0),n.Ut())}}o1(e){const t=y.nt(),i=y.nt(),s=e.memberParts;for(;s.next();){const o=s.value;o.isVisible()&&(o instanceof pt?(o.Go()||o.as()||o.fa())&&this.o1(o):o instanceof gt?o.fromNode===e||o.toNode===e?i.push(o):t.push(o):(o.ht(1/0,1/0),o.Ut()))}let n=t.length;for(let o=0;o<n;o++){const r=t[o];r.ht(1/0,1/0),r.Ut()}y.Z(t),e.ht(1/0,1/0),e.Ut(),n=i.length;for(let o=0;o<n;o++){const r=i[o];r.ht(1/0,1/0),r.Ut()}y.Z(i)}As(e,t,i,s){if(this.tf||this.animationManager.isAnimating){for(let n=0;n<t;n++)e[n].As(i,s);this.Te()}}Ge(e){null!==this.Nt&&(null===this.lt&&y.o("No canvas specified"),"svg"===this._c?this.SO(e):this.MO(e))}MO(e){const t=this.animationManager;if(t.ke||t.isAnimating&&!t.isTicking)return;const i=new Date;if(this.Lp(),this.Nt&&"0"===this.Nt.style.opacity)return;const s=e!==this.Wt,n=this.zt.r,o=n.length,r=this;if(this.As(n,o,r,r.viewportBounds),s)e.clearContextCache(!0),this.ha();else if(!this.qi&&!t.isAnimating)return;const a=this.v,l=this.$e;e.setTransform(l,0,0,l,0,0),e.clearRect(0,0,this.wt,this.xt),1!==this.Zt&&(e.globalAlpha=this.Zt),this.M2(e);for(let f=0;f<o;f++)e.setTransform(l,0,0,l,0,0),e.transform(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),e.commitTransform(),n[f].Ge(e,r);let h=!1;this.nf?this.nf.Mh(this,e)&&(h=this.gp()):h=!0,h&&(Ot.prototype.Ci=Ot.prototype.Mu),s?(this.Wt.clearContextCache(!0),this.ha()):(this.tf=!1,this.qi=!1);const d=this.f2;if(null===this.Ol){d[this.wp]=+new Date-+i,this.wp=(this.wp+1)%d.length;let f=0;for(let p=0;p<d.length;p++)f+=d[p];this.yp=f/d.length}1!==this.Zt&&(e.globalAlpha=1)}SO(e){if(null===this.Nt)return;const t=this.animationManager;if(t.ke||t.isAnimating&&!t.isTicking)return;this.Lp();const i=this.wt,s=this.xt;e.surface.resize(i,s,i,s);const n=this.zt.r,o=n.length,r=this;if(this.As(n,o,r,r.viewportBounds),!this.qi&&!t.isAnimating)return;const a=this.v;e.lastDrawnPart=null,e.setDiagramPosScale(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),1!==this.Zt&&(e.globalAlpha=this.Zt),this.M2(e);const l=this.$e,h=this.lt._t;h.setTransform(l,0,0,l,0,0),h.clearRect(0,0,this.wt,this.xt);for(let u=0;u<o;u++)n[u].Ge(e,r);let c=!1;this.nf?this.nf.Mh(this,h)&&(c=this.gp()):c=!0,c&&(Ot.prototype.Ci=Ot.prototype.Mu),this.tf=!1,this.qi=!1}l1(e,t,i,s,n,o,r,a,l){void 0===o&&(o=null),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===l&&(l=!1),this.Lp(),e.clearContextCache(!0),this.ha(),this.ph=!0;const h=this.it;this.it=s;const c=this,u=this.zt.r,d=u.length;try{const f=new j(n.x,n.y,i.width/s,i.height/s),p=f.copy();p.addMargin(t),this.ca(p),this.Te(),this.As(u,d,c,f),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height),null!==r&&""!==r&&(e.fillStyle=r,e.fillBackground(0,0,i.width,i.height));const g=Ot.l();g.Ue(),g.Gs(t.left,t.top),g.it(s),(0!==n.x||0!==n.y)&&g.Gs(-n.x,-n.y),e.setTransform(g.m11,g.m12,g.m21,g.m22,g.dx,g.dy),e.commitTransform(),e instanceof he&&e.setDiagramPosScale(g.m11,g.m12,g.m21,g.m22,g.dx,g.dy),Ot.i(g),this.M2(e),e.globalAlpha=this.Zt;const b=this.findLayer("Grid");if(o){const x=new z,v=o.iterator;for(v.reset();v.next();){const P=v.value;P instanceof At&&(!l&&P.layer===b||(P.Wc(),x.add(P)))}for(let P=0;P<d;P++)u[P].IR(e,c,x,a);x.each(P=>P.Wc())}else for(let x=0;x<d;x++){const v=u[x];v===b?l&&v.Ge(e,c,!0):v.Ge(e,c,a)}this.ph=!1,this.nf&&this.Wt&&this.nf.Mh(this,this.Wt)&&this.gp()}finally{this.it=h,e.clearContextCache(!0),this.ha(),this.As(u,d,c,c.viewportBounds),this.ca(),this.Wt instanceof he&&(this.Wt.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(e){return this.Rr[e]}setRenderingHint(e,t){"minDrawingLength"===e&&(this._m=t),this.Rr[e]=t,this.redraw()}resetRenderingHints(){this.Rr=new R,this.Rr.drawShadows=!0,this.Rr.textGreeking=!0,this.Rr.viewportOptimizations=!y.ur,this.Rr.temporaryPixelRatio=!0,this.Rr.pictureRatioOptimization=!0,this.Rr.minDrawingLength=1,this._m=1}M2(e){const t=this.Rr;if(null===t)return;void 0!==t.imageSmoothingEnabled&&e.setImageSmoothingEnabled(!!t.imageSmoothingEnabled);const i=t.defaultFont;null!=i&&(e.font=i)}getInputOption(e){return this.Ju[e]}setInputOption(e,t){this.Ju[e]=t}ZR(){this.Ju=new R,this.Ju.extraTouchArea=10,this.Ju.extraTouchThreshold=10,this.Ju.hasGestureZoom=!0}set(e){return e?(Object.assign(this,e),this):this}attach(e){return this.setProperties(e)}setProperties(e){return U.Ap(this,e),this}static Ap(e,t){if(!t)return;const i=e instanceof J,s=e instanceof U;for(const n in t){""===n&&y.o("Setting properties requires non-empty property names");let o=e,r=n;if(i||s){const l=n.indexOf(".");if(l>0){const h=n.substring(0,l);i?o=e.findObject(h):(o=e[h],null==o&&(o=e.toolManager[h])),y.$(o)?r=n.substring(l+1):y.o("Unable to find object named: "+h+" in "+e.toString()+" when trying to set property: "+n)}}if("_"!==r[0]&&!y.jw(o,r)){if(s&&"ModelChanged"===r){e.addModelChangedListener(t[r]);continue}if(s&&"Changed"===r){e.addChangedListener(t[r]);continue}if(s&&y.jw(e.toolManager,r))o=e.toolManager;else{if(s&&e.fT(r)){e.addDiagramListener(r,t[r]);continue}if(e instanceof bt&&"Changed"===r){e.addChangedListener(t[r]);continue}y.o('Trying to set undefined property "'+r+'" on object: '+o.toString())}}o[r]=t[n],"_"===r[0]&&o instanceof st&&o.addCopyProperty(r)}}VA(){if(0!==this.ra.count&&!(this.undoManager.transactionLevel>1)){for(;this.ra.count>0;){const e=this.ra;this.ra=new xt;const t=e.iterator;for(;t.next();){const i=t.key;i.invalidateOtherJumpOvers(t.value),i.ai()}}this.C()}}C(e){if(void 0===e)this.qi=!0,this.requestUpdate();else{const t=this.viewportBounds;e.isReal()&&t.intersectsRect(e)&&(this.qi=!0,this.requestUpdate())}this.T("InvalidateDraw")}invalidateViewport(e,t){if(!0!==this.qi){if(this.qi=!0,"svg"===this._c)return void this.maybeUpdate();!0===this.getRenderingHint("temporaryPixelRatio")?(this.Cx(),this.maybeUpdate(),this.yS(!0)):this.maybeUpdate()}}Nh(){this.td=!0}ha(){this.tf=!0}Lp(){!1!==this.$u&&(this.$u=!1,this.oT(this.wt,this.xt))}oT(e,t){this.aa();const i=this.$e;this.lt.resize(e*i,t*i,e,t)&&(this.qi=!0,this.Wt.clearContextCache(!0))}lT(){const e=this.lt;if(null===e||this.ed.isReal())return!0;const t=this.wt,i=this.xt,s=this.Nt;let n=!1,o=this.so?this.qt:0,r=this.Pn?this.qt:0,a=s.clientWidth||t+o,l=s.clientHeight||i+r;const h=this.viewportBounds,c=h.x,u=h.y,d=h.width,f=h.height;if((a!==t+o||l!==i+r)&&(this.so=!1,this.Pn=!1,o=0,r=0,this.wt=a,this.xt=l,this.$u=!0,n=!0,this.aa()),!this.no||!this.viewportBounds.isReal())return!0;const p=this.Wb,g=this.Jb;if(this.td=!1,!(n||this.so||this.Pn||this.Qu||this._u))return!0;const b=this.documentBounds;let x=0,v=0,P=0,w=0;const M=h.width,C=h.height,N=this.fh;this.contentAlignment.isSpot()?(b.width>M&&(x=N.left,v=N.right),b.height>C&&(P=N.top,w=N.bottom)):(x=N.left,v=N.right,P=N.top,w=N.bottom);const I=b.width+x+v,T=b.height+P+w,D=this.scale,F=D;let E=I>a/D,B=T>l/D;if(!(n||this.so||this.Pn||E||B))return!0;const Y=b.x-x,W=h.x,$=b.right+v;let K=h.right+o;const Z=b.y-P,it=h.y,yt=b.bottom+w;let ot=h.bottom+r,at="1px",ft="1px";if(1===this.scrollMode&&(E||B)){if(E&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let et=1;Y+1<W&&(et=Math.max((W-Y)*D+this.wt,et)),$>K+1&&(et=Math.max(($-K)*D+this.wt,et)),M+o+1<I&&(et=Math.max((I-M)*D+this.wt,et)),at=et.toString()+"px"}if(B&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let et=1;Z+1<it&&(et=Math.max((it-Z)*D+this.xt,et)),yt>ot+1&&(et=Math.max((yt-ot)*D+this.xt,et)),C+r+1<T&&(et=Math.max((T-C)*D+this.xt,et)),ft=et.toString()+"px"}}let ut="1px"!==at,kt="1px"!==ft;if((!ut||!kt)&&(ut||kt)){if(E=!(I<M+o),B=!(T<C+r),kt&&(K-=this.qt),ut&&(ot-=this.qt),E&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let Pt=1;Y+1<W&&(Pt=Math.max((W-Y)*D+this.wt,Pt)),$>K+1&&(Pt=Math.max(($-K)*D+this.wt,Pt)),M+1<I&&(Pt=Math.max((I-M)*D+this.wt,Pt)),at=Pt.toString()+"px"}ut="1px"!==at;let et=this.xt;if(ut!==this.Pn&&(et=ut?this.xt-this.qt:this.xt+this.qt),B&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let Pt=1;Z+1<it&&(Pt=Math.max((it-Z)*D+et,Pt)),yt>ot+1&&(Pt=Math.max((yt-ot)*D+et,Pt)),C+1<T&&(Pt=Math.max((T-C)*D+et,Pt)),ft=Pt.toString()+"px"}kt="1px"!==ft}if(this.rp&&ut===this.Pn&&kt===this.so)return(t!==this.wt||i!==this.xt)&&this.maybeUpdate(),!1;if(ut!==this.Pn&&(this.xt="1px"===at?this.xt+this.qt:Math.max(this.xt-this.qt,1),n=!0),this.Pn=ut,g.style.width=at,kt!==this.so&&(this.wt="1px"===ft?this.wt+this.qt:Math.max(this.wt-this.qt,1),n=!0,this.ld)){const et=S.l();kt?(e.style.left=this.qt+"px",this.position=et.e(this.ct.x+this.qt/this.scale,this.ct.y)):(e.style.left="0px",this.position=et.e(this.ct.x-this.qt/this.scale,this.ct.y)),S.i(et)}n&&this.aa(),this.so=kt,g.style.height=ft,this.Bb=!0,n&&(this.$u=!0);let Mt=p.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(M+1<I?Mt=(this.position.x-Y)*D:Y+1<W?Mt=p.scrollWidth-p.clientWidth:$>K+1&&(Mt=this.position.x*D)),this.ld)switch(this.lb){case"negative":Mt=-(p.scrollWidth-Mt-p.clientWidth);break;case"reverse":Mt=p.scrollWidth-Mt-p.clientWidth}if(p.scrollLeft=Mt,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(C+1<T?p.scrollTop=(this.position.y-Z)*D:Z+1<it?p.scrollTop=p.scrollHeight-p.clientHeight:yt>ot+1&&(p.scrollTop=this.position.y*D)),a=this.wt,l=this.xt,p.style.width=a+(this.so?this.qt:0)+"px",p.style.height=l+(this.Pn?this.qt:0)+"px",t!==a||i!==l||this.animationManager.ke){const et=j.z(c,u,d,f);return this.onViewportBoundsChanged(et,this.viewportBounds,F,n),j.i(et),!1}return!0}add(e){const t=e.diagram;if(t===this)return;null!==t&&y.o("Cannot add part "+e.toString()+" to "+this.toString()+". It is already a part of "+t.toString());let i=this.findLayer(e.layerName);if(null===i&&(i=this.findLayer("")),null===i&&y.o('Cannot add a Part when unable find a Layer named "'+e.layerName+'" and there is no default Layer'),e.layer===i)return;const s=i.ch(99999999,e,e.diagram===this);s>=0&&this.raiseChangedEvent(3,"parts",i,null,e,null,s),i.isTemporary||this.invalidateDocumentBounds(),e.invalidateLayout(1);const n=e.layerChanged;null!==n&&n(e,null,i)}ch(e){this.partManager.ch(e);const t=this;U.isUsingDOM()&&e.Sn(i=>t.uT(i)),e.data||e.Yo(),e.hasPlaceholder()&&e.c(),null!==e.data&&e.Sn(i=>t.partManager.N2(i,null)),(!0===e.as()||!0===e.fa())&&this.Cp(e),e.dT(!0,this),e instanceof nt&&e.canAvoid()&&this.fd(e),e.gT()?(e.actualBounds.isReal()&&this.C(e.hh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.C(e.hh(e.actualBounds)),null!==this.kp&&this.kp(this,e),this.requestUpdate()}ri(e){e.clearAdornments(),this.partManager.ri(e);const t=this;null!==e.data&&e.Sn(i=>t.partManager.C2(i,t)),this.eo.delete(e),e instanceof gt?this.Ir.delete(e):e instanceof nt&&e.canAvoid()&&this.fd(e),e.gT()?(e.actualBounds.isReal()&&this.C(e.hh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.C(e.hh(e.actualBounds)),null!==this.Pp&&this.Pp(this,e),this.requestUpdate()}remove(e){this.L2(e,!0)}L2(e,t){const i=e.layer;if(null===i||i.diagram!==this)return;e.isSelected=!1,e.isHighlighted=!1,e.invalidateLayout(2),t&&e.lf();const s=i.ri(-1,e,!1);s>=0&&this.raiseChangedEvent(4,"parts",i,e,null,s,null);const n=e.layerChanged;null!==n&&n(e,i,null)}removeParts(e,t){if(void 0===t&&(t=!1),Array.isArray(e)){const i=e.length;for(let s=0;s<i;s++){const n=e[s];t&&!n.canDelete()||this.remove(n)}}else{const i=new z;i.addAll(e);const s=i.iterator;for(;s.next();){const n=s.value;t&&!n.canDelete()||this.remove(n)}}}copyParts(e,t,i){void 0===i&&(i=!1);let s=null;const n=t||this,o=n.model;let r=!1,a=!1;try{o.Vm()&&(r=o.copiesParentKeyOfNodeData,o.copiesParentKeyOfNodeData=n.commandHandler.copiesParentKey),(o.Um()||o.a1())&&(a=o.copiesGroupKeyOfNodeData,o.copiesGroupKeyOfNodeData=n.commandHandler.copiesGroupKey),s=this.partManager.copyParts(e,t,i)}finally{o.Vm()&&(o.copiesParentKeyOfNodeData=r),(o.Um()||o.a1())&&(o.copiesGroupKeyOfNodeData=a)}return s}moveParts(e,t,i,s){if(void 0===i&&(i=!1),void 0===s&&(s=this.Tp()),null===this.toolManager)return;const n=new xt;if(null!==e)if(Array.isArray(e))for(let o=0;o<e.length;o++)this.tl(n,e[o],i,s);else{const o=e.iterator;for(;o.next();)this.tl(n,o.value,i,s)}else{let o=this.parts;for(;o.next();)this.tl(n,o.value,i,s);for(o=this.nodes;o.next();)this.tl(n,o.value,i,s);for(o=this.links;o.next();)this.tl(n,o.value,i,s)}this.Lx(n,t,s,i)}tl(e,t,i,s,n){if(!e.has(t)&&(void 0===n&&(n=!1),!i||n||t.canMove()||t.canCopy()))if(void 0===s&&(s=this.Tp()),t instanceof nt){if(e.set(t,this.Ws(s,t,t.location)),t instanceof pt&&(t.hasPlaceholder()||s.dragsMembers)){const r=t.memberParts;for(;r.next();)this.tl(e,r.value,i,s,s.groupsAlwaysMove)}const o=t.linksConnected;for(;o.next();){const r=o.value;if(e.has(r))continue;const a=r.fromNode,l=r.toNode;null!==a&&e.has(a)&&null!==l&&e.has(l)&&this.tl(e,r,i,s)}if(s.dragsTree){const r=t.findTreeChildrenNodes();for(;r.next();)this.tl(e,r.value,i,s)}}else if(t instanceof gt){e.set(t,this.Ws(s,t));const o=t.labelNodes;for(;o.next();)this.tl(e,o.value,i,s)}else t instanceof Nt||e.set(t,this.Ws(s,t,t.location))}Lx(e,t,i,s){if(null===e||0===e.count)return;const n=S.l(),o=S.l();o.h(t),isNaN(o.x)&&(o.x=0),isNaN(o.y)&&(o.y=0);const r=this.Qb;r||this.uA(e);const a=y.nt(),l=y.nt(),h=e.iterator;let c=S.l();for(;h.next();){const g=h.key,b=h.value;if(g.Di()){const x=this.mT(g,e);if(null!==x)a.push(new _n(g,b,x));else if(!s||g.canMove()){const v=b.point;n.h(v),this.computeMove(g,n.add(o),i,c),g.location=c,void 0===b.shifted&&(b.shifted=new S),b.shifted.h(c.subtract(v))}}else h.key instanceof gt&&l.push(new Vt(h.key,h.value))}S.i(c);const u=a.length;for(let g=0;g<u;g++){const b=a[g];n.h(b.pT.point),void 0===b.h1.shifted&&(b.h1.shifted=new S),b.Ri.location=n.add(b.h1.shifted)}const d=S.l(),f=S.l(),p=l.length;for(let g=0;g<p;g++){const b=l[g],x=b.key;if(x instanceof gt)if(x.suspendsRouting){x.vr=null;const v=x.fromNode,P=x.toNode;if(null!==this.draggedLink&&i.dragsLink){const w=b.value.point;if(null===x.dragComputation)e.set(x,this.Ws(i,x,o)),x.Pr(o.x-w.x,o.y-w.y);else{const M=S.z(0,0),C=x.getPoint(0);C&&C.isReal()&&M.h(C),c=S.l().h(M).add(o);let N=c;i.isGridSnapEnabled&&(i.isGridSnapRealtime||this.lastInput.up)&&(N=S.l(),this.lM(x,c,N,i)),c.h(x.dragComputation(x,c,N)).subtract(M),e.set(x,this.Ws(i,x,c)),x.Pr(c.x-w.x,c.y-w.y),S.i(M),S.i(c),N!==c&&S.i(N)}}else{if(null!==v){d.h(v.location);const w=e.get(v);null!==w&&d.subtract(w.point)}if(null!==P){f.h(P.location);const w=e.get(P);null!==w&&f.subtract(w.point)}if(null!==v&&null!==P)if(d.equalsApprox(f)){const w=b.value.point,M=n;M.h(d),M.subtract(w),e.set(x,this.Ws(i,x,d)),x.Pr(M.x,M.y)}else x.suspendsRouting=!1,x.$t();else{const w=b.value.point;let M;M=null!==v?d:null!==P?f:o,e.set(x,this.Ws(i,x,M)),x.Pr(M.x-w.x,M.y-w.y)}}}else if(null===x.fromNode||null===x.toNode){const v=b.value.point;e.set(x,this.Ws(i,x,o)),x.Pr(o.x-v.x,o.y-v.y)}}S.i(n),S.i(o),S.i(d),S.i(f),y.Z(a),y.Z(l),r||(this.Te(),this.pS(e))}computeMove(e,t,i,s){if(void 0===s&&(s=new S),s.h(t),null===e)return s;let n=t;const o=i.isGridSnapEnabled;o&&(i.isGridSnapRealtime||this.lastInput.up)&&(n=S.l(),this.lM(e,t,n,i));const r=null!==e.dragComputation?e.dragComputation(e,t,n):n,a=e.minLocation;let l=a.x;isNaN(l)&&(l=o?Math.round(1e3*e.location.x)/1e3:e.location.x);let h=a.y;isNaN(h)&&(h=o?Math.round(1e3*e.location.y)/1e3:e.location.y);const c=e.maxLocation;let u=c.x;isNaN(u)&&(u=o?Math.round(1e3*e.location.x)/1e3:e.location.x);let d=c.y;return isNaN(d)&&(d=o?Math.round(1e3*e.location.y)/1e3:e.location.y),s.e(Math.max(l,Math.min(r.x,u)),Math.max(h,Math.min(r.y,d))),n!==t&&S.i(n),s}Tp(){const e=this.toolManager.findTool("Dragging");return e instanceof Ft?e.dragOptions:this.ad}lM(e,t,i,s){if(void 0===s&&(s=this.Tp()),i.h(t),null===e)return i;const n=this.grid,o=s.gridSnapCellSize;let r=o.width,a=o.height;const l=s.gridSnapOrigin;let h=l.x,c=l.y;const u=s.gridSnapCellSpot;if(null!==n){const f=n.gridCellSize;isNaN(r)&&(r=f.width),isNaN(a)&&(a=f.height);const p=n.gridOrigin;isNaN(h)&&(h=p.x),isNaN(c)&&(c=p.y)}const d=S.z(0,0);return d.setSpot(0,0,r,a,u),L.tm(t.x,t.y,h+d.x,c+d.y,r,a,i),S.i(d),i}uA(e){if(null===e)return;this.Qb=!0;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof gt&&(i.suspendsRouting=!0)}}pS(e){if(null===e)return;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof gt&&(i.suspendsRouting=!1,i.yT()&&i.$t())}this.Qb=!1}get draggedLink(){return this._b}set draggedLink(e){this._b!==e&&(this._b=e,null!==e&&(this.t1=e.fromPort,this.e1=e.toPort))}get PS(){return this.t1}set PS(e){this.t1=e}get SS(){return this.e1}set SS(e){this.e1=e}mT(e,t){const i=e.containingGroup;if(null!==i){let s=this.mT(i,t);if(null!==s||(s=t.get(i),null!==s))return s}return null}Ws(e,t,i){if(void 0===i)return new He(S.gn);let s=e.isGridSnapEnabled;return!e.groupsSnapMembers&&null!==t.containingGroup&&(s=!1),new He(s?new S(Math.round(1e3*i.x)/1e3,Math.round(1e3*i.y)/1e3):i.copy())}A2(e,t){if(null!==e.diagram&&e.diagram!==this&&y.o("Cannot share a Layer with another Diagram: "+e+" of "+e.diagram),null===t?null!==e.diagram&&y.o("Cannot add an existing Layer to this Diagram again: "+e):(t.diagram!==this&&y.o("Existing Layer must be in this Diagram: "+t+" not in "+t.diagram),e===t&&y.o("Cannot move a Layer before or after itself: "+e)),e.diagram===this)return;const i=e.name,s=this.zt,n=s.count;for(let o=0;o<n;o++)s.elt(o).name===i&&y.o("Cannot add Layer with the name '"+i+"'; a Layer with the same name is already present in this Diagram.")}addLayer(e){this.A2(e,null),e.Eo(this);const t=this.zt;let i=t.count-1;if(!e.isTemporary)for(;i>=0&&t.elt(i).isTemporary;)i--;return t.insertAt(i+1,e),null!==this.Ce&&this.raiseChangedEvent(3,"layers",this,null,e,null,i+1),this.C(),this.invalidateDocumentBounds(),this}addLayerBefore(e,t){this.A2(e,t),e.Eo(this);const i=this.zt,s=i.indexOf(e);s>=0&&(i.delete(e),null!==this.Ce&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o,e);break}return null!==this.Ce&&this.raiseChangedEvent(3,"layers",this,null,e,null,o),this.C(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(e,t){this.A2(e,t),e.Eo(this);const i=this.zt,s=i.indexOf(e);s>=0&&(i.delete(e),null!==this.Ce&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o+1,e);break}return null!==this.Ce&&this.raiseChangedEvent(3,"layers",this,null,e,null,o+1),this.C(),s<0&&this.invalidateDocumentBounds(),this}Qr(e,t){e.Eo(this),this.zt.insertAt(t,e)}wT(e){this.zt.removeAt(e)}removeLayer(e){if(e.diagram!==this&&y.o("Cannot remove a Layer from another Diagram: "+e+" of "+e.diagram),""===e.name)return;const t=this.zt,i=t.indexOf(e);if(t.delete(e)){const s=e.Ct.copy().iterator;for(;s.next();){const n=s.value,o=n.layerName;n.layerName=o!==e.name?o:""}null!==this.Ce&&this.raiseChangedEvent(4,"layers",this,e,null,i,null),this.C(),this.invalidateDocumentBounds()}}findLayer(e){const t=this.layers;for(;t.next();){const i=t.value;if(i.name===e)return i}return null}findRouter(e){for(const t of this.of)if(t.name===e)return t;return null}addModelChangedListener(e){return y.S(e,U,"addModelChangedListener:listener"),null===this.io&&(this.io=new H),this.io.add(e),this.model&&this.model.addChangedListener(e),this}removeModelChangedListener(e){y.S(e,U,"removeModelChangedListener:listener"),null!==this.io&&(this.io.delete(e),0===this.io.count&&(this.io=null)),this.model.removeChangedListener(e)}addChangedListener(e){return y.S(e,U,"addChangedListener:listener"),null===this.Er&&(this.Er=new H),this.Er.add(e),this}removeChangedListener(e){y.S(e,U,"removeChangedListener:listener"),null!==this.Er&&(this.Er.delete(e),0===this.Er.count&&(this.Er=null))}T2(e){if(!this.skipsUndoManager&&!this.model.skipsUndoManager&&this.model.undoManager.handleChanged(e),1!==e.change&&(this.isModified=!0),null!==this.Er){const t=this.Er,i=t.length;for(let s=0;s<i;s++)t.elt(s)(e)}}raiseChangedEvent(e,t,i,s,n,o,r){void 0===o&&(o=null),void 0===r&&(r=null);const a=new li;a.diagram=this,a.change=e,a.propertyName=t,a.object=i,a.oldValue=s,a.oldParam=o,a.newValue=n,a.newParam=r,this.T2(a)}raiseChanged(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}t(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}get partAdded(){return this.kp}set partAdded(e){this.partAdded!==e&&(this.kp=e)}get partRemoved(){return this.Pp}set partRemoved(e){this.partRemoved!==e&&(this.Pp=e)}get animationManager(){return this.Ns}get undoManager(){return this.Ce.undoManager}get skipsUndoManager(){return this.Bo}set skipsUndoManager(e){y.s(e,"boolean",U,"skipsUndoManager"),this.Bo=e,this.Ce.skipsUndoManager=e}get delaysLayout(){return this.Ab}set delaysLayout(e){this.Ab=e}tA(e,t){if(null===e||e.diagram!==this)return;const i=this.wi;try{this.wi=!0;const s=e.change;if(2===s){const n=e.object,o=e.propertyName,r=e.getValue(t);if(e.diagram.model.et(n,o,r),n instanceof st){const a=n.part;null!==a&&(a.invalidateAdornments(),a instanceof gt&&(a.fromNode?.Ze(a.fromPort),a.toNode?.Ze(a.toPort)))}this.isModified=!0}else if(3===s){const n=e.object,o=e.newParam,r=e.newValue;if(n instanceof J)if("number"==typeof o&&r instanceof st){t?n.ri(o):n.insertAt(o,r);const a=n.part;null!==a&&a.invalidateAdornments()}else"number"==typeof o&&r instanceof ee&&(r.isRow?n.xT(o,t?void 0:r):n.bT(o,t?void 0:r));else if(n instanceof Gt){const a=!0===e.oldParam;"number"==typeof o&&r instanceof At&&(t?(a||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.ri(a?o:-1,r,a)):n.ch(o,r,a))}else n instanceof U?"number"==typeof o&&r instanceof Gt&&(t?this.wT(o):this.Qr(r,o)):y.o("unknown ChangeType.Insert object: "+e.toString());this.isModified=!0}else if(4===s){const n=e.object,o=e.oldParam,r=e.oldValue;if(n instanceof J)"number"==typeof o&&r instanceof st?t?n.insertAt(o,r):n.ri(o):"number"==typeof o&&r instanceof ee&&(r.isRow?n.xT(o,t?r:void 0):n.bT(o,t?r:void 0));else if(n instanceof Gt){const a=!0===e.newParam;"number"==typeof o&&r instanceof At&&(t?n.Ct.indexOf(r)<0&&n.ch(o,r,a):(a||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.ri(a?o:-1,r,a)))}else n instanceof U?"number"==typeof o&&r instanceof Gt&&(t?this.Qr(r,o):this.wT(o)):y.o("unknown ChangeType.Remove object: "+e.toString());this.isModified=!0}else 1===s||y.o("unknown ChangedEvent: "+e.toString())}finally{this.wi=i}}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;void 0===i&&(i="");const s=this.skipsUndoManager;null===i&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(e){this.partManager.updateAllTargetBindings(e)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),null!==this.ls){const e=this.ls.part;null!==e&&e.Yo()}}setDivBackground(e){this.div&&(this.div.style.backgroundColor=e)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}Np(){const e=this.v,t=this.it,i=this.ct;e.Ue(),1!==t&&e.it(t),(0!==i.x||0!==i.y)&&e.Gs(-i.x,-i.y)}kT(e,t){const i=this.animationManager;if(this.Ht||this.Ts)return this.it=t,this.aa(),this.C(),this.Nh(),i.EA(e,this.it),void this.Np();if(null===this.lt)return this.it=t,void this.Np();this.Ht=!0;const s=this.viewportBounds.copy(),n=this.wt,o=this.xt;let r=this.zoomPoint.x,a=this.zoomPoint.y;const l=this.contentAlignment;isNaN(r)&&(l.isSide()?l.includesSide(A.LeftSide)?r=0:l.includesSide(A.RightSide)&&(r=n-1):r=l.isSpot()?l.x*(n-1):n/2),isNaN(a)&&(l.isSide()?l.includesSide(A.TopSide)?a=0:l.includesSide(A.BottomSide)&&(a=o-1):a=l.isSpot()?l.y*(o-1):o/2),null!==this.scaleComputation&&!this.animationManager.defaultAnimation.isAnimating&&(t=this.scaleComputation(this,t)),t<this.minScale&&(t=this.minScale),t>this.maxScale&&(t=this.maxScale);const h=S.z(this.ct.x+r/e-r/t,this.ct.y+a/e-a/t);this.position=h,S.i(h),this.it=t,this.Np(),this.aa(),this.Ht=!1,this.onViewportBoundsChanged(s,this.viewportBounds,e,!1),this.$s(!1),i.EA(e,this.it),this.C()}pO(){const e=this.zt.r;for(let t=0;t<e.length;t++)e[t].YA()}onViewportBoundsChanged(e,t,i,s){if(e.equals(t))return;void 0===s&&(s=!1),s||this.Nh(),this.ha();const n=this.layout;null!==n&&n.isViewportSized&&1===this.autoScale&&(e.width!==t.width||e.height!==t.height)&&n.p();const o=this.currentTool;!0===this.sf&&o instanceof Ue&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),o.cA(this)),this.Ht||this.invalidateViewport(e,t),this.ca(),this.Ye.scale=i,this.Ye.position.x=e.x,this.Ye.position.y=e.y,this.Ye.bounds.h(e),this.Ye.canvasSize.width=Math.round(e.width*i),this.Ye.canvasSize.height=Math.round(e.height*i),this.Ye.newCanvasSize.width=this.wt,this.Ye.newCanvasSize.height=this.xt,this.Ye.isScroll=s,this.T("ViewportBoundsChanged",this.Ye,e),this.isVirtualized&&this.links.each(r=>{r.isAvoiding&&r.actualBounds.intersectsRect(t)&&r.$t()})}ca(e){const t=this.ls;if(null===t||!t.visible||null===t.part||null===t.layer)return;const i=void 0!==e?e:this.Yb;if(!i.isReal())return;const s=i.width,n=i.height;if(t.scale=1,t.angle=0,t.layer.isViewportAligned)t.width=s*this.scale,t.height=n*this.scale,t.part.alignment=A.TopLeft;else{null===t.Pe&&(t.Pe=new ii);const o=t.Pe.af;if(!o.isReal())return;t.width=s+2*o.width,t.height=n+2*o.height;const r=S.l();L.tm(i.x,i.y,0,0,o.width,o.height,r),r.offset(-o.width,-o.height),t.part.location=r,S.i(r)}}clearSelection(e){void 0===e&&(e=!1);const t=this.selection;if(0===t.count)return;e||this.T("ChangingSelection",t);const i=t.toArray(),s=i.length;for(let n=0;n<s;n++)i[n].isSelected=!1;t.ce(),t.clear(),t.k(),e||this.T("ChangedSelection",t)}select(e){null!==e&&e.diagram===this&&(!e.isSelected||this.selection.count>1)&&(this.T("ChangingSelection",this.selection),this.clearSelection(!0),e.isSelected=!0,this.T("ChangedSelection",this.selection))}selectCollection(e){if(this.T("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];s instanceof At||y.o("Diagram.selectCollection given something that is not a Part: "+s),s.isSelected=!0}}else{const t=e.iterator;for(;t.next();){const i=t.value;i instanceof At||y.o("Diagram.selectCollection given something that is not a Part: "+i),i.isSelected=!0}}this.T("ChangedSelection",this.selection)}clearHighlighteds(){const e=this.highlighteds;if(e.count>0){const t=e.toArray(),i=t.length;for(let s=0;s<i;s++)t[s].isHighlighted=!1;e.ce(),e.clear(),e.k()}}highlight(e){null!==e&&e.diagram===this&&(!e.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),e.isHighlighted=!0)}highlightCollection(e){const t=(new z).addAll(e),i=this.highlighteds.copy().removeAll(t).iterator;for(;i.next();)i.value.isHighlighted=!1;const s=t.iterator;for(;s.next();){const n=s.value;n instanceof At||y.o("Diagram.highlightCollection given something that is not a Part: "+n),n.isHighlighted=!0}}scroll(e,t,i){void 0===i&&(i=1);const s="up"===t||"down"===t;let n=0;const o=S.l();if("pixel"===e)n=i;else if("line"===e)n=i*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if("page"===e){let a=s?this.viewportBounds.height:this.viewportBounds.width;a*=this.scale,0!==a&&(n=i*Math.max(a-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0))}else{if("document"===e){const a=this.documentBounds,l=this.viewportBounds;return"up"===t?this.position=o.e(l.x,a.y):"left"===t?this.position=o.e(a.x,l.y):"down"===t?this.position=o.e(l.x,a.bottom-l.height):"right"===t&&(this.position=o.e(a.right-l.width,l.y)),void S.i(o)}y.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+e)}n/=this.scale;const r=this.position;"up"===t?this.position=o.e(r.x,r.y-n):"down"===t?this.position=o.e(r.x,r.y+n):"left"===t?this.position=o.e(r.x-n,r.y):"right"===t?this.position=o.e(r.x+n,r.y):y.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+t),S.i(o)}scrollToRect(e){const t=this.viewportBounds;if(t.containsRect(e))return;const i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}centerRect(e){const t=this.viewportBounds,i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}transformDocToView(e){return e.copy().v(this.v)}transformViewToDoc(e){return e.copy().Ki(this.v)}GR(e){return e.Ki(this.v)}static None=1;static Uniform=2;static UniformToFill=3;static CycleAll=1;static CycleNotDirected=2;static CycleNotDirectedFast=3;static CycleNotUndirected=4;static CycleDestinationTree=5;static CycleSourceTree=6;static DocumentScroll=1;static InfiniteScroll=2;static TreeParentCollapsed=1;static AllParentsCollapsed=2;static AnyParentsCollapsed=3;get opacity(){return this.Zt}set opacity(e){const t=this.Zt;t!==e&&(y.s(e,"number",U,"opacity"),(e<0||e>1)&&y.J(e,"0 <= value <= 1",U,"opacity"),this.Zt=e,this.t("opacity",t,e),this.C())}get validCycle(){return this.Pb}set validCycle(e){const t=this.Pb;t!==e&&(this.Pb=e,this.t("validCycle",t,e))}get layers(){return this.zt.iterator}get isModelReadOnly(){const e=this.Ce;return null!==e&&e.isReadOnly}set isModelReadOnly(e){const t=this.Ce;null!==t&&(t.isReadOnly=e)}get isReadOnly(){return this.zo}set isReadOnly(e){const t=this.zo;t!==e&&(y.s(e,"boolean",U,"isReadOnly"),this.zo=e,this.t("isReadOnly",t,e))}get isEnabled(){return this.Be}set isEnabled(e){const t=this.Be;t!==e&&(y.s(e,"boolean",U,"isEnabled"),this.Be=e,this.t("isEnabled",t,e))}get allowClipboard(){return this.Tb}set allowClipboard(e){const t=this.Tb;t!==e&&(y.s(e,"boolean",U,"allowClipboard"),this.Tb=e,this.t("allowClipboard",t,e))}get allowCopy(){return this.Yl}set allowCopy(e){const t=this.Yl;t!==e&&(y.s(e,"boolean",U,"allowCopy"),this.Yl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.Kl}set allowDelete(e){const t=this.Kl;t!==e&&(y.s(e,"boolean",U,"allowDelete"),this.Kl=e,this.t("allowDelete",t,e))}get allowDragOut(){return this.Db}set allowDragOut(e){const t=this.Db;t!==e&&(y.s(e,"boolean",U,"allowDragOut"),this.Db=e,this.t("allowDragOut",t,e))}get allowDrop(){return this.vb}set allowDrop(e){const t=this.vb;t!==e&&(y.s(e,"boolean",U,"allowDrop"),this.vb=e,this.t("allowDrop",t,e))}get allowTextEdit(){return this.Hl}set allowTextEdit(e){const t=this.Hl;t!==e&&(y.s(e,"boolean",U,"allowTextEdit"),this.Hl=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.jl}set allowGroup(e){const t=this.jl;t!==e&&(y.s(e,"boolean",U,"allowGroup"),this.jl=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.ql}set allowUngroup(e){const t=this.ql;t!==e&&(y.s(e,"boolean",U,"allowUngroup"),this.ql=e,this.t("allowUngroup",t,e))}get allowInsert(){return this.Fb}set allowInsert(e){const t=this.Fb;t!==e&&(y.s(e,"boolean",U,"allowInsert"),this.Fb=e,this.t("allowInsert",t,e))}get allowLink(){return this.Wl}set allowLink(e){const t=this.Wl;t!==e&&(y.s(e,"boolean",U,"allowLink"),this.Wl=e,this.t("allowLink",t,e))}get allowRelink(){return this.Jl}set allowRelink(e){const t=this.Jl;t!==e&&(y.s(e,"boolean",U,"allowRelink"),this.Jl=e,this.t("allowRelink",t,e))}get allowMove(){return this.$l}set allowMove(e){const t=this.$l;t!==e&&(y.s(e,"boolean",U,"allowMove"),this.$l=e,this.t("allowMove",t,e))}get allowReshape(){return this.Zl}set allowReshape(e){const t=this.Zl;t!==e&&(y.s(e,"boolean",U,"allowReshape"),this.Zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Ql}set allowResize(e){const t=this.Ql;t!==e&&(y.s(e,"boolean",U,"allowResize"),this.Ql=e,this.t("allowResize",t,e))}get allowRotate(){return this._l}set allowRotate(e){const t=this._l;t!==e&&(y.s(e,"boolean",U,"allowRotate"),this._l=e,this.t("allowRotate",t,e))}get allowSelect(){return this.ta}set allowSelect(e){const t=this.ta;t!==e&&(y.s(e,"boolean",U,"allowSelect"),this.ta=e,this.t("allowSelect",t,e))}get allowUndo(){return this.Rb}set allowUndo(e){const t=this.Rb;t!==e&&(y.s(e,"boolean",U,"allowUndo"),this.Rb=e,this.t("allowUndo",t,e))}get allowZoom(){return this.Ob}set allowZoom(e){const t=this.Ob;t!==e&&(y.s(e,"boolean",U,"allowZoom"),this.Ob=e,this.t("allowZoom",t,e))}get hasVerticalScrollbar(){return this._u}set hasVerticalScrollbar(e){const t=this._u;t!==e&&(y.s(e,"boolean",U,"hasVerticalScrollbar"),this._u=e,this.Nh(),this.C(),this.t("hasVerticalScrollbar",t,e),this.$s(!1))}get hasHorizontalScrollbar(){return this.Qu}set hasHorizontalScrollbar(e){const t=this.Qu;t!==e&&(y.s(e,"boolean",U,"hasHorizontalScrollbar"),this.Qu=e,this.Nh(),this.C(),this.t("hasHorizontalScrollbar",t,e),this.$s(!1))}get allowHorizontalScroll(){return this.Ib}set allowHorizontalScroll(e){const t=this.Ib;t!==e&&(y.s(e,"boolean",U,"allowHorizontalScroll"),this.Ib=e,this.t("allowHorizontalScroll",t,e),this.$s(!1))}get allowVerticalScroll(){return this.Eb}set allowVerticalScroll(e){const t=this.Eb;t!==e&&(y.s(e,"boolean",U,"allowVerticalScroll"),this.Eb=e,this.t("allowVerticalScroll",t,e),this.$s(!1))}get scrollHorizontalLineChange(){return this.Ub}set scrollHorizontalLineChange(e){const t=this.Ub;t!==e&&(y.s(e,"number",U,"scrollHorizontalLineChange"),e<0&&y.J(e,">= 0",U,"scrollHorizontalLineChange"),this.Ub=e,this.t("scrollHorizontalLineChange",t,e))}get scrollVerticalLineChange(){return this.Vb}set scrollVerticalLineChange(e){const t=this.Vb;t!==e&&(y.s(e,"number",U,"scrollVerticalLineChange"),e<0&&y.J(e,">= 0",U,"scrollVerticalLineChange"),this.Vb=e,this.t("scrollVerticalLineChange",t,e))}get lastInput(){return this.gh}set lastInput(e){this.gh=e}get previousInput(){return this.Jr}set previousInput(e){this.Jr=e}get firstInput(){return this.fp}set firstInput(e){this.fp=e}get currentCursor(){return this.Sb}set currentCursor(e){if(""===e&&(e=this.op),this.Sb!==e){y.s(e,"string",U,"currentCursor");const t=this.lt,i=this.Nt;if(null===t||null===i)return;this.Sb=e;const s=t.style.cursor;t.style.cursor=e,i.style.cursor=e,t.style.cursor===s&&(t.style.cursor="-webkit-"+e,i.style.cursor="-webkit-"+e,t.style.cursor===s&&(t.style.cursor="-moz-"+e,i.style.cursor="-moz-"+e,t.style.cursor===s&&(t.style.cursor=e,i.style.cursor=e)))}}get defaultCursor(){return this.op}set defaultCursor(e){""===e&&(e="auto");const t=this.op;t!==e&&(y.s(e,"string",U,"defaultCursor"),this.op=e,this.t("defaultCursor",t,e))}get click(){return this.Ur}set click(e){const t=this.Ur;t!==e&&(null!==e&&y.S(e,U,"click"),this.Ur=e,this.t("click",t,e))}get doubleClick(){return this.Vr}set doubleClick(e){const t=this.Vr;t!==e&&(null!==e&&y.S(e,U,"doubleClick"),this.Vr=e,this.t("doubleClick",t,e))}get contextClick(){return this.Br}set contextClick(e){const t=this.Br;t!==e&&(null!==e&&y.S(e,U,"contextClick"),this.Br=e,this.t("contextClick",t,e))}get mouseOver(){return this.zr}set mouseOver(e){const t=this.zr;t!==e&&(null!==e&&y.S(e,U,"mouseOver"),this.zr=e,this.t("mouseOver",t,e))}get mouseHover(){return this.Xr}set mouseHover(e){const t=this.Xr;t!==e&&(null!==e&&y.S(e,U,"mouseHover"),this.Xr=e,this.t("mouseHover",t,e))}get mouseHold(){return this.Gr}set mouseHold(e){const t=this.Gr;t!==e&&(null!==e&&y.S(e,U,"mouseHold"),this.Gr=e,this.t("mouseHold",t,e))}get mouseDragOver(){return this.Mb}set mouseDragOver(e){const t=this.Mb;t!==e&&(null!==e&&y.S(e,U,"mouseDragOver"),this.Mb=e,this.t("mouseDragOver",t,e))}get mouseDrop(){return this.Yr}set mouseDrop(e){const t=this.Yr;t!==e&&(this.Yr=e,this.t("mouseDrop",t,e))}get handlesDragDropForTopLevelParts(){return this.Nb}set handlesDragDropForTopLevelParts(e){const t=this.Nb;t!==e&&(y.s(e,"boolean",U,"handlesDragDropForTopLevelParts"),this.Nb=e,this.t("handlesDragDropForTopLevelParts",t,e))}get mouseEnter(){return this.Kr}set mouseEnter(e){const t=this.Kr;t!==e&&(null!==e&&y.S(e,U,"mouseEnter"),this.Kr=e,this.t("mouseEnter",t,e))}get mouseLeave(){return this.Hr}set mouseLeave(e){const t=this.Hr;t!==e&&(null!==e&&y.S(e,U,"mouseLeave"),this.Hr=e,this.t("mouseLeave",t,e))}get toolTip(){return this.jr}set toolTip(e){const t=this.jr;t!==e&&(this.jr=e,this.t("toolTip",t,e))}get contextMenu(){return this.qr}set contextMenu(e){const t=this.qr;t!==e&&(this.qr=e,this.t("contextMenu",t,e))}get commandHandler(){return this.jM}set commandHandler(e){const t=this.jM;t!==e&&(t&&t.doStop(),this.jM=e,e.Eo(this),e.doStart())}get toolManager(){return this.YM}set toolManager(e){this.YM!==e&&(this.YM=e,e.diagram=this)}get defaultTool(){return this.KM}set defaultTool(e){const t=this.KM;t!==e&&(this.KM=e,e.diagram=this,this.currentTool===t&&(this.currentTool=e))}get currentTool(){return this.HM}set currentTool(e){const t=this.HM;t&&(t.isActive&&t.doDeactivate(),t.cancelWaitAfter(),t.doStop()),null===e&&(e=this.defaultTool),null!==e&&(this.HM=e,e.diagram=this,e.doStart())}get selection(){return this.KA}get maxSelectionCount(){return this.Gb}set maxSelectionCount(e){const t=this.Gb;if(t!==e)if(y.s(e,"number",U,"maxSelectionCount"),e>=0&&!isNaN(e)){if(this.Gb=e,this.t("maxSelectionCount",t,e),!this.undoManager.isUndoingRedoing){const i=this.selection.count-e;if(i>0){this.T("ChangingSelection",this.selection);const s=this.selection.toArray();for(let n=0;n<i;n++)s[n].isSelected=!1;this.T("ChangedSelection",this.selection)}}}else y.J(e,">= 0",U,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this.hp}set nodeSelectionAdornmentTemplate(e){const t=this.hp;t!==e&&(this.hp=e.It(),this.t("nodeSelectionAdornmentTemplate",t,e))}get groupSelectionAdornmentTemplate(){return this.Hb}set groupSelectionAdornmentTemplate(e){const t=this.Hb;t!==e&&(this.Hb=e.It(),this.t("groupSelectionAdornmentTemplate",t,e))}get linkSelectionAdornmentTemplate(){return this.jb}set linkSelectionAdornmentTemplate(e){const t=this.jb;t!==e&&(this.jb=e.It(),this.t("linkSelectionAdornmentTemplate",t,e))}get highlighteds(){return this.HA}get isModified(){const e=this.undoManager;return e.isEnabled?null!==e.currentTransaction||this.nd&&this.js!==e.historyIndex:this.nd}set isModified(e){if(this.nd!==e){y.s(e,"boolean",U,"isModified"),this.nd=e;const t=this.undoManager;!e&&t.isEnabled&&(this.js=t.historyIndex),e||this.PT()}}PT(){const e=this.isModified;this.$M!==e&&(this.$M=e,this.T("Modified"))}get model(){return this.Ce}set model(e){const t=this.Ce;if(t!==e){this.currentTool.doCancel(),t&&t.undoManager!==e.undoManager&&t.undoManager.isInTransaction&&y.o("Do not replace a Diagram.model while a transaction is in progress.");const i=this.sT(!0);this.no=!1,this.Zu=!0,this.js=-2,this.Dr=!1;const s=this.Ht;this.Ht=!0,this.animationManager.Gl("Model"),t&&(null!==this.io&&this.io.each(n=>t.removeChangedListener(n)),t.removeChangedListener(this.Qc)),this.Ce=e,this.partManager=this.NO(this.Ce.type),this.initializePartManager(this.partManager);for(let n=0;n<i.length;n++)this.add(i[n]);e.addChangedListener(this.JM),this.partManager.D2(),e.removeChangedListener(this.JM),e.addChangedListener(this.Qc),null!==this.io&&this.io.each(n=>e.addChangedListener(n)),this.Ht=s,this.invalidateDocumentBounds(),this.Ht||this.C(),t&&e.undoManager.copyProperties(t.undoManager)}}get themeManager(){return this.d2}set themeManager(e){const t=this.d2;t!==e&&(t&&t.removeDiagram(this),this.d2=e,null!==e&&e.addDiagram(this))}initializePartManager(e){}static g2(e,t){U.JA.set(e,t)}static get licenseKey(){return U.v2.last()}static set licenseKey(e){U.v2.add(e.replace(/\s/g,""))}static get version(){return U.CO}static v2=new H;static CO="3.1.3";NO(e){const t=U.JA.get(e);return null!==t?new t:new pi}get G(){return this.WM}set G(e){this.WM=e}get nb(){return this.jA}LO(e){if(e.model!==this.model)return;const t=e.change,i=e.propertyName;if(1!==t||"S"!==i[0]){if(this.G){this.G=!1;try{if(""===e.modelChange&&1===t){("FinishedUndo"===i||"FinishedRedo"===i)&&(this.T("ChangedSelection",this.selection),this.Te());const s=this.animationManager;"RolledBackTransaction"===i&&s.stopAnimation(),this.VA(),this.Zc=!0,this.maybeUpdate(),(0===this.undoManager.transactionLevel||1===this.undoManager.transactionLevel)&&s.SM(),"CommittedTransaction"===i&&this.undoManager.isJustDiscarded&&(this.js=Math.min(this.js,this.undoManager.historyIndex-1)),("CommittedTransaction"===i||"RolledBackTransaction"===i)&&this.undoManager.Sx&&y.dn(()=>{this.isModified=!1},1);const n=e.isTransactionFinished;if(n&&(this.PT(),this.nb.clear(),this.animationManager.CR()),!this.Cb&&n&&this.lastInput.targetDiagram){this.Cb=!0;const o=this;y.dn(()=>{o.currentTool.standardMouseOver(),o.Cb=!1},10)}}}finally{this.G=!0}}}else if("StartingFirstTransaction"===i){const s=this,n=this.toolManager;n.mouseDownTools.each(o=>o.diagram=s),n.mouseMoveTools.each(o=>o.diagram=s),n.mouseUpTools.each(o=>o.diagram=s),this.routers.each(o=>o.diagram=s),!this.Ts&&!this.no&&(this.Zc=!0,this.Zu&&(this.Dr=!0))}else if("StartingUndo"===i||"StartingRedo"===i){const s=this.animationManager;this.skipsUndoManager||(s.defaultAnimation.isAnimating&&s.stopAnimation(),s.getBundleAnimation().isAnimating&&s.getBundleAnimation().stop()),this.T("ChangingSelection",this.selection)}else if("StartedTransaction"===i){const s=this.animationManager;s.defaultAnimation.isAnimating&&!this.skipsUndoManager&&s.stopAnimation()}}get wi(){return this.qM}set wi(e){this.qM=e}get Ou(){return this.Lb}set Ou(e){this.Lb=e}uT(e){const t=e.D.r;for(const i of t)i instanceof Kt&&this.F2(i)}F2(e){const t=e.element;if(!(null!==t&&X.HTMLImageElement&&t instanceof HTMLImageElement&&(t.hs instanceof z&&t.hs.add(this),e.AO(),t.Dp)))return;const i=t.getAttribute("src")||"",s=this.oa.get(i);if(null===s){Kt.ST(e,t);const n=[];n.push(e),this.oa.set(i,n)}else{for(let n=0;n<s.length;n++)if(s[n]===e)return;s.push(e)}}TO(e){const t=e.D.r,i=t.length;for(let s=0;s<i;s++)this.R2(t[s])}R2(e){if(!(e instanceof Kt))return;const t=e.element;if(!(null!==t&&X.HTMLImageElement&&t instanceof HTMLImageElement&&t.Dp))return;const i=t.getAttribute("src")||"",s=this.oa.get(i);if(null!==s)for(let n=0;n<s.length;n++)if(s[n]===e)return s.splice(n,1),void(0===s.length&&(this.oa.delete(i),Kt.DO(t),t.hs instanceof z&&t.hs.delete(this)))}nT(){Kt.clearCache(),this.oa.clear()}rebuildParts(){this.partManager.rebuildParts()}Kc(e,t){this.Ns.Kc(e,t)}Yc(e,t){this.Ns.Yc(e,t)}findPartForKey(e){return this.partManager.findPartForKey(e)}findNodeForKey(e){return this.partManager.findNodeForKey(e)}findLinkForKey(e){return this.partManager.findLinkForKey(e)}findPartForData(e){return this.partManager.findPartForData(e)}findNodeForData(e){return this.partManager.findNodeForData(e)}findLinkForData(e){return this.partManager.findLinkForData(e)}findNodesByExample(...e){return this.partManager.findNodesByExample(...e)}findLinksByExample(...e){return this.partManager.findLinksByExample(...e)}get nodeTemplate(){return this.Wr.get("")}set nodeTemplate(e){const t=this.Wr.get("");t!==e&&(this.Wr.set("",e),this.t("nodeTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.Wr}set nodeTemplateMap(e){const t=this.Wr;t!==e&&(this.Wr=e,this.t("nodeTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.dh.get("")}set groupTemplate(e){const t=this.dh.get("");t!==e&&(this.dh.set("",e),this.t("groupTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.dh}set groupTemplateMap(e){const t=this.dh;t!==e&&(this.dh=e,this.t("groupTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.na.get("")}set linkTemplate(e){const t=this.na.get("");t!==e&&(this.na.set("",e),this.t("linkTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.na}set linkTemplateMap(e){const t=this.na;t!==e&&(this.na=e,this.t("linkTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.ZM}set isMouseCaptured(e){const t=this.lt;if(null===t)return;const i=t.bt;i instanceof SVGElement||(e?(this.lastInput.bubbles=!1,this.Le(i,"pointermove",this.xh,!1),this.Le(i,"pointerdown",this.la,!1),this.Le(i,"pointerup",this.bh,!1),this.Le(i,"pointerout",this.kh,!1),this.Le(i,"pointercancel",this.Ph,!1),this.Et(X,"pointermove",this.xh,!0),this.Et(X,"pointerdown",this.la,!0),this.Et(X,"pointerup",this.bh,!0),this.Et(X,"pointerout",this.kh,!0),this.Et(X,"pointercancel",this.Ph,!0),this.Le(i,"wheel",this.wh,!1),this.Et(X,"wheel",this.wh,!0),this.Et(X,"selectstart",this.oh,!1)):(this.Le(X,"pointermove",this.xh,!0),this.Le(X,"pointerdown",this.la,!0),this.Le(X,"pointerup",this.bh,!0),this.Le(X,"pointerout",this.kh,!0),this.Le(X,"pointercancel",this.Ph,!0),this.Et(i,"pointermove",this.xh,!1),this.Et(i,"pointerdown",this.la,!1),this.Et(i,"pointerup",this.bh,!1),this.Et(i,"pointerout",this.kh,!1),this.Et(i,"pointercancel",this.Ph,!1),this.Le(X,"wheel",this.wh,!0),this.Le(X,"selectstart",this.oh,!1),this.Et(i,"wheel",this.wh,!1)),this.ZM=e)}get position(){return this.ct}set position(e){if(this.ct.equals(e))return;const t=S.l().h(this.ct),i=this.viewportBounds.copy();if(this.ct.h(e),this.animationManager.IA(t,this.ct),this.Ht||null===this.lt&&!this.ed.isReal())this.aa(),this.Np();else{this.Ht=!0;const s=this.scale;this.b2(this.ap,this.wt/s,this.xt/s,this.Jc,!1),this.Ht=!1}this.Ht||this.onViewportBoundsChanged(i,this.viewportBounds,this.it,!1),S.i(t)}get initialPosition(){return this.ab}set initialPosition(e){this.ab.equals(e)||(this.ab=e.N())}get initialScale(){return this.hb}set initialScale(e){this.hb!==e&&(y.s(e,"number",U,"initialScale"),this.hb=e)}get grid(){return null===this.ls&&(this.ls=this.rT()),this.ls}set grid(e){let t=this.ls;if(t!==e){null===t&&(this.ls=this.rT(),t=this.ls),e.type!==J.Grid&&y.o("Diagram.grid must be a Panel of type Panel.Grid");const i=t.panel;null!==i&&i.remove(t),this.ls=e,e.name="GRID",null!==i&&i.add(e),this.sd=!1,this.C(),this.t("grid",t,e)}}get viewportBounds(){return this.Yb}aa(){const t=this.ct,i=this.it;this.Yb.e(t.x,t.y,Math.max(this.wt,0)/i,Math.max(this.xt,0)/i),this.ha()}get viewSize(){return this.ed}set viewSize(e){const t=this.viewSize;if(!t.equals(e)){e=e.N(),this.ed=e;let i=0,s=0;e.isReal()?(i=e.width,s=e.height):null!==this.Nt&&(i=this.Nt.clientWidth||1,s=this.Nt.clientHeight||1),this.wt=i,this.xt=s,this.aa(),this.invalidateDocumentBounds(),this.t("viewSize",t,e),this.C()}}get fixedBounds(){return this.db}set fixedBounds(e){const t=this.db;t.equals(e)||((e.width===-1/0||e.height===1/0||e.height===-1/0)&&y.o("fixedBounds width/height must not be Infinity"),e=e.N(),this.db=e,this.invalidateDocumentBounds(),this.t("fixedBounds",t,e))}get scrollMargin(){return this.fh}set scrollMargin(e){"number"==typeof e&&(e=new It(e));const t=this.fh;t.equals(e)||(e=e.N(),this.fh=e,this.t("scrollMargin",t,e),this.Eu())}get scrollMode(){return this.ah}set scrollMode(e){const t=this.ah;t!==e&&(this.ah=e,1===e&&this.$s(!1),this.t("scrollMode",t,e),this.Nh(),this.C())}get scrollsPageOnFocus(){return this.gb}set scrollsPageOnFocus(e){const t=this.gb;t!==e&&(y.s(e,"boolean",U,"scrollsPageOnFocus"),this.gb=e,this.t("scrollsPageOnFocus",t,e))}get positionComputation(){return this.pb}set positionComputation(e){const t=this.pb;t!==e&&(null!==e&&y.S(e,U,"positionComputation"),this.pb=e,this.$s(!1),this.t("positionComputation",t,e))}get scaleComputation(){return this.yb}set scaleComputation(e){const t=this.yb;t!==e&&(null!==e&&y.S(e,U,"scaleComputation"),this.yb=e,this.kT(this.scale,this.scale),this.t("scaleComputation",t,e))}get documentBounds(){return this.ap}MT(e){this.mh=!1;let t=this.ap;t.equals(e)||(t=t.copy(),this.ap.h(e),this.$s(!1),this.T("DocumentBoundsChanged",void 0,t),this.Nh(),this.C())}ensureBounds(){if(this.mh){const e=j.l();this.MT(this.computeBounds(e)),j.i(e)}}get isVirtualized(){return this.Kb}set isVirtualized(e){const t=this.Kb;t!==e&&(y.s(e,"boolean",U,"isVirtualized"),this.Kb=e,this.t("isVirtualized",t,e))}get scale(){return this.it}set scale(e){const t=this.it;t!==e&&this.kT(t,e)}get defaultScale(){return this.dp}set defaultScale(e){this.dp=e}get autoScale(){return this.ia}set autoScale(e){const t=this.ia;t!==e&&(this.ia=e,this.t("autoScale",t,e),1!==e&&this.$s(!1))}get initialAutoScale(){return this.Or}set initialAutoScale(e){const t=this.Or;t!==e&&(this.Or=e,this.t("initialAutoScale",t,e))}get initialViewportSpot(){return this.xb}set initialViewportSpot(e){const t=this.xb;t!==e&&(e.isSpot()||y.o("initialViewportSpot must be a specific Spot: "+e),this.xb=e,this.t("initialViewportSpot",t,e))}get initialDocumentSpot(){return this.wb}set initialDocumentSpot(e){const t=this.wb;t!==e&&(e.isSpot()||y.o("initialViewportSpot must be a specific Spot: "+e),this.wb=e,this.t("initialDocumentSpot",t,e))}get minScale(){return this.cb}set minScale(e){const t=this.cb;t!==e&&(e>0?(this.cb=e,this.t("minScale",t,e),e>this.scale&&(this.scale=e)):y.J(e,"> 0",U,"minScale"))}get maxScale(){return this.fb}set maxScale(e){const t=this.fb;t!==e&&(e>0?(this.fb=e,this.t("maxScale",t,e),e<this.scale&&(this.scale=e)):y.J(e,"> 0",U,"maxScale"))}get zoomPoint(){return this.ub}set zoomPoint(e){this.ub.equals(e)||(e=e.N(),this.ub=e)}get contentAlignment(){return this.Jc}set contentAlignment(e){const t=this.Jc;t.equals(e)||(e=e.N(),this.Jc=e,this.t("contentAlignment",t,e),this.$s(!1))}get initialContentAlignment(){return this.ip}set initialContentAlignment(e){const t=this.ip;t.equals(e)||(e=e.N(),this.ip=e,this.t("initialContentAlignment",t,e))}get padding(){return this.Qt}set padding(e){"number"==typeof e&&(e=new It(e));const t=this.Qt;t.equals(e)||(e=e.N(),this.Qt=e,this.invalidateDocumentBounds(),this.t("padding",t,e))}get partManager(){return this.i2}set partManager(e){const t=this.i2;t!==e&&(null!==e.diagram&&y.o("Cannot share PartManagers between Diagrams: "+e.toString()),t&&t.Eo(null),this.i2=e,e.Eo(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){const e=new z,t=this.nodes;for(;t.next();){const s=t.value;s.isTopLevel&&e.add(s)}const i=this.links;for(;i.next();){const s=i.value;s.isTopLevel&&e.add(s)}return e.iterator}findTopLevelGroups(){return this.Zr.iterator}get routers(){return this.of}doLinkRouting(e){this.Vo=!0;const t=this.of.r;for(let i=0;i<t.length;i++)t[i].canRoute(e)&&t[i].routeLinks(this.Ir,e);this.Vo=!1}get layout(){return this.li}set layout(e){const t=this.li;t!==e&&(this.li=e,e.diagram=this,e.group=null,this.$r=!0,this.t("layout",t,e),this.requestUpdate())}layoutDiagram(e){this.Te(),e&&this.c1(!0),this.Ts?this.S2(!1,this.Fl||0!==this.of.count&&0!==this.eo.size):(this.Zc=!0,this.Sr())}c1(e){const t=this.Zr.iterator;for(;t.next();)this.NT(t.value,e);this.layout&&(e?this.layout.isValidLayout=!1:this.layout.p())}NT(e,t){if(null===e)return;const i=e.Ch.iterator;for(;i.next();)this.NT(i.value,t);null!==e.layout&&(t?e.layout.isValidLayout=!1:e.layout.p())}S2(e,t){if(this.Ab)return;const i=this.G;this.G=!0;const s="Layout",n=this.undoManager.transactionLevel,o=this.layout,r=this.animationManager;try{0===n&&(this.undoManager.Dl=!0,this.startTransaction(s)),n<=1&&!r.defaultAnimation.isAnimating&&!r.ke&&(e||r.Gl(s)),this.$r=!1;let a=this.Zr.iterator;for(;a.next();)this.cd(a.value),this.CT(a.value,e,n,t);let l=!1;if(o.isValidLayout||(!e||o.isRealtime||null===o.isRealtime||0===n?(o.doLayout(this),this.cd(this),l=!0,o.isValidLayout=!0):this.$r=!0),l||this.cd(this),this.doLinkRouting(this),this.Ir.clear(),0!==this.uh.size){for(let h=0;h<23&&0!==this.uh.size;h++){for(a=this.Zr.iterator;a.next();)this.LT(a.value);const c=this.Ir;this.Ir=this.uh,this.uh=c,this.cd(this),this.doLinkRouting(this)}this.Ir.clear(),this.uh.clear()}}finally{const a=this.undoManager.Dl;0===n&&(this.commitTransaction(s),this.undoManager.Dl=!1),a&&(0===n||1===n)&&r.SM(),this.$r&&(this.$r=!o.isValidLayout),this.G=i}}CT(e,t,i,s){const n=e.Ch.iterator;for(;n.next();)this.CT(n.value,t,i,s);const o=e.layout;null===o||o.isValidLayout?s&&this.doLinkRouting(e):!t||o.isRealtime||0===i?(e.Lh=!e.location.isReal(),o.doLayout(e),e.invalidateLayout(32),this.o1(e),this.cd(e),this.doLinkRouting(e),o.isValidLayout=!0):(this.doLinkRouting(e),this.$r=!0)}LT(e){const t=e.Ch.iterator;for(;t.next();)this.LT(t.value);this.cd(e),this.doLinkRouting(e)}get isTreePathToChildren(){return this.bb}set isTreePathToChildren(e){const t=this.bb;if(t!==e&&(y.s(e,"boolean",U,"isTreePathToChildren"),this.bb=e,this.t("isTreePathToChildren",t,e),!this.undoManager.isUndoingRedoing)){const i=this.nodes;for(;i.next();)i.value.vp()}}findTreeRoots(){const e=new H,t=this.nodes;for(;t.next();){const i=t.value;i.isTopLevel&&null===i.findTreeParentLink()&&e.add(i)}return e.iterator}get treeCollapsePolicy(){return this.kb}set treeCollapsePolicy(e){const t=this.kb;t!==e&&(1!==e&&2!==e&&3!==e&&y.o("Unknown Diagram.treeCollapsePolicy: "+e),this.kb=e,this.t("treeCollapsePolicy",t,e))}get isCollapsingExpanding(){return this.GM}set isCollapsingExpanding(e){this.GM=e}QR(){const e=new xt,t=new xt;function i(s){const n=s.toLowerCase(),o=new H;e.set(s,o),e.set(n,o),t.set(s,s),t.set(n,s)}i("InitialAnimationStarting"),i("AnimationStarting"),i("AnimationFinished"),i("BackgroundSingleClicked"),i("BackgroundDoubleClicked"),i("BackgroundContextClicked"),i("ClipboardChanged"),i("ClipboardPasted"),i("DocumentBoundsChanged"),i("ExternalObjectsDropped"),i("FocusOrVirtualPointerEnabledChanged"),i("GainedFocus"),i("InitialLayoutCompleted"),i("LayoutCompleted"),i("LinkDrawn"),i("LinkRelinked"),i("LinkReshaped"),i("LostFocus"),i("Modified"),i("ObjectSingleClicked"),i("ObjectDoubleClicked"),i("ObjectContextClicked"),i("PartCreated"),i("PartResized"),i("PartRotated"),i("SelectionMoved"),i("SelectionCopied"),i("SelectionDeleting"),i("SelectionDeleted"),i("SelectionGrouped"),i("SelectionUngrouped"),i("ChangingSelection"),i("ChangedSelection"),i("SubGraphCollapsed"),i("SubGraphExpanded"),i("TextEdited"),i("ThemeChanged"),i("TreeCollapsed"),i("TreeExpanded"),i("ViewportBoundsChanged"),i("InvalidateDraw"),this.zM=e,this.XM=t}fT(e){const t=this.XM.get(e);return null!==t?t:this.XM.get(e.toLowerCase())}O2(e){let t=this.zM.get(e);if(null!==t)return t;const i=e.toLowerCase();if(t=this.zM.get(i),null!==t)return t;y.o("Unknown DiagramEvent name: "+e)}addDiagramListener(e,t){y.s(e,"string",U,"addDiagramListener:name"),y.S(t,U,"addDiagramListener:listener");const i=this.O2(e);return null!==i&&i.add(t),this}removeDiagramListener(e,t){y.s(e,"string",U,"removeDiagramListener:name"),y.S(t,U,"addDiagramListener:listener");const i=this.O2(e);null!==i&&i.delete(t)}raiseDiagramEvent(e,t,i){this.T(e,t,i)}T(e,t,i){const s=this.O2(e),n=new vi;n.diagram=this;const o=this.fT(e);null!==o&&(n.name=o),void 0!==t&&(n.subject=t),void 0!==i&&(n.parameter=i);const r=s.length;if(1===r)s.elt(0)(n);else if(0!==r){const a=s.toArray();for(let l=0;l<r;l++)(0,a[l])(n)}}isUnoccupied(e,t){return this.getPositions(!1,null,t||null).isUnoccupied(e.x,e.y,e.width,e.height)}computeOccupiedArea(e){return this.isVirtualized?this.viewportBounds.copy():this.mh?this.aT(e):e.h(this.documentBounds)}getPositions(e,t,i){let s=this.sa;null===s&&(this.sa=s=new jt(this.avoidanceCellSize));let n=t;if(s.Ko||s.Ah!==n||s.I2!==i){if(s.E2=Math.max(s.hf+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.U2=Math.max(s.hf+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),null!==n&&(n=this.AT(n)),null===n){const o=j.l();this.computeOccupiedArea(o),o.inflate(100,100),s.f1(o);const r=this.nodes;for(;r.next();){const a=r.value,l=a.layer;null===l||!l.visible||l.isTemporary||this.V2(a,i,o)}j.i(o)}else{if(n.memberParts.count>0){const a=this.computePartsBounds(n.memberParts,!1);a.inflate(20,20),s.f1(a)}const o=j.l(),r=n.memberParts;for(;r.next();){const a=r.value;a instanceof nt&&this.V2(a,i,o)}j.i(o)}s.Ah=n,s.I2=i,s.Ko=!1}else e&&s.TT();return s}get avoidanceCellSize(){return this.QM}set avoidanceCellSize(e){this.sa=null,this.QM=new lt(Math.max(1,e.width),Math.max(1,e.height))}get avoidanceLimit(){return this._M}set avoidanceLimit(e){this._M=Math.max(1,e)}AT(e){return e.canAvoid()?e:null!==e.containingGroup?this.AT(e.containingGroup):null}V2(e,t,i){if(e===t||!e.isVisible())return;const s=e.canAvoid();if(s){const n=e.getAvoidableRect(i);this.sa.vO(n.x,n.y,n.width,n.height)}if(e instanceof pt&&(!s||e.avoidableMembers)){const n=e.memberParts;for(;n.next();){const o=n.value;o instanceof nt&&this.V2(o,t,i)}}}fd(e){null!==this.sa&&!this.sa.Ko&&(void 0===e||e.canAvoid())&&(this.sa.Ko=!0)}get autoScrollInterval(){return this.sp}set autoScrollInterval(e){const t=this.sp;t!==e&&(this.sp=e,this.t("autoScrollInterval",t,e))}get autoScrollRegion(){return this.np}set autoScrollRegion(e){"number"==typeof e&&(e=new It(e));const t=this.np;t.equals(e)||(e=e.N(),this.np=e,this.invalidateDocumentBounds(),this.t("autoScrollRegion",t,e))}doAutoScroll(e){this.cp.h(e);const t=S.l();this.computeAutoScrollPosition(this.cp,t).equalsApprox(this.position)?this.stopAutoScroll():this.DT(),S.i(t)}DT(){if(-1!==this.$c)return;const t=this;this.$c=y.dn(()=>{if(-1===t.$c||(t.stopAutoScroll(),null===t.lastInput.event))return;const i=S.l(),s=t.computeAutoScrollPosition(t.cp,i);if(!s.equalsApprox(t.position)){t.position=s,t.lastInput.documentPoint=t.transformViewToDoc(t.cp),t.doMouseMove(),t.mh=!0;const n=j.l();t.computeBounds(n),n.unionRect(t.documentBounds),t.MT(n),j.i(n),t.qi=!0,t.maybeUpdate(),t.DT()}S.i(i)},this.sp)}stopAutoScroll(){-1!==this.$c&&(y.wc(this.$c),this.$c=-1)}computeAutoScrollPosition(e,t){let i=this.position;void 0===t&&(t=new S),t.h(i);const s=this.np;if(s.top<=0&&s.left<=0&&s.right<=0&&s.bottom<=0)return t;const n=this.viewportBounds,o=this.scale,r=j.z(0,0,n.width*o,n.height*o),a=S.z(0,0);if(e.x>=r.x&&e.x<r.x+s.left&&this.allowHorizontalScroll){let l=Math.max(this.scrollHorizontalLineChange,1);l|=0,a.x-=l,e.x<r.x+s.left/2&&(a.x-=l),e.x<r.x+s.left/4&&(a.x-=4*l)}else if(e.x<=r.x+r.width&&e.x>r.x+r.width-s.right&&this.allowHorizontalScroll){let l=Math.max(this.scrollHorizontalLineChange,1);l|=0,a.x+=l,e.x>r.x+r.width-s.right/2&&(a.x+=l),e.x>r.x+r.width-s.right/4&&(a.x+=4*l)}if(e.y>=r.y&&e.y<r.y+s.top&&this.allowVerticalScroll){let l=Math.max(this.scrollVerticalLineChange,1);l|=0,a.y-=l,e.y<r.y+s.top/2&&(a.y-=l),e.y<r.y+s.top/4&&(a.y-=4*l)}else if(e.y<=r.y+r.height&&e.y>r.y+r.height-s.bottom&&this.allowVerticalScroll){let l=Math.max(this.scrollVerticalLineChange,1);l|=0,a.y+=l,e.y>r.y+r.height-s.bottom/2&&(a.y+=l),e.y>r.y+r.height-s.bottom/4&&(a.y+=4*l)}return a.equalsApprox(S.gn)||(t.x=i.x+a.x/o,t.y=i.y+a.y/o),j.i(r),S.i(a),t}makeSvg(e){this.Xo.has("SVG")||this.addRenderer("SVG",new fi(this,X.document));const t=new fi(this,X.document,!0);void 0===e&&(e={});const i=this;return this.FT(function s(n,o){const r=i.vT(n,"SVG",t),a=null!==r?r.svg:null,l=n.svgFinished;return a&&l&&l(a),y.st(o)?(o(a),null):a},e)}makeSVG(e){return this.makeSvg(e)}addRenderer(e,t){this.Xo.set(e,t)}removeRenderer(e){this.Xo.delete(e)}cacheGroupExternalLinks(e){this.u2=e,e||this.nodes.each(t=>{t instanceof pt&&(t.Fp=null)})}FT(e,t){const i=t.callback;let s=!0;const n=this.oa.iterator;for(;n.next();)if(!n.value[0].Mn){s=!1;break}if(!y.st(i)||s)return e(t,i,this);const o=this;function r(){const h=+new Date;for(s=!0,n.reset();n.next();)if(!n.value[0].Mn){s=!1;break}s||h-l>a?e(t,i,o):X.requestAnimationFrame(r)}const a=t.callbackTimeout||300,l=+new Date;return X.requestAnimationFrame(()=>r()),null}makeImage(e){return U.isUsingDOM()?(void 0===e&&(e={}),e.returnType="Image",this.makeImageData(e)):null}makeImageData(e){return void 0===e&&(e={}),this.FT(this.FO,e)}static img="image";FO(e,t,i){const s=i.vT(e,"canvas",null);if(null===s)return null;const n=s.F.canvas;let o=null;if(null!==n){let r=e.returnType;switch(r=void 0===r?"string":r.toLowerCase(),r){case U.img+"data":o=s.getImageData(0,0,n.width,n.height);break;case U.img:const a=(e.document||document).createElement("img");a.src=n.toDataURL(e.type,e.details),o=a;break;case"blob":{const l=n;return y.st(t)||(o="",y.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),y.st(l.toBlob)?(l.toBlob(t,e.type,e.details),"toBlob"):(t(null),null)}default:o=n.toDataURL(e.type,e.details)}}return y.st(t)?(t(o),null):o}static RO=!1;vT(e,t,i){this.animationManager.stopAnimation(),this.maybeUpdate(),y.$(e)||y.o("properties argument must be an Object.");let s=!1,n=e.size||null,o=e.scale||null;void 0!==e.scale&&isNaN(e.scale)&&(o="NaN");let r=e.maxSize;void 0===e.maxSize&&(!0,r="SVG"===t?new lt(1/0,1/0):new lt(2e3,2e3));const a=e.position||null;let l=e.parts||null;Array.isArray(l)&&(l=new H(l));let h=void 0===e.padding?1:e.padding;const c=e.background||null;let u=e.omitTemporary;void 0===u&&(u=!0);const d=e.document||X.document,f=e.elementFinished||null;let p=e.showTemporary;void 0===p&&(p=!u);let g=e.showGrid;void 0===g&&(g=p),null!==n&&isNaN(n.width)&&isNaN(n.height)&&(n=null),"number"==typeof h?h=new It(h):h instanceof It||y.o("MakeImage padding must be a Margin or a number."),h.left=Math.max(h.left,0),h.right=Math.max(h.right,0),h.top=Math.max(h.top,0),h.bottom=Math.max(h.bottom,0),this.Wt&&this.Wt.clearContextCache(!0);const b=new Oe(null,d,void 0,!0),x=b._t;if(!(n||o||l||a))return b.width=this.wt+Math.ceil(h.left+h.right),b.height=this.xt+Math.ceil(h.top+h.bottom),"SVG"===t?null===i?null:(i.resize(b.width,b.height,b.width,b.height),i.el=d,i.ud=f,this.l1(i._t,h,new lt(b.width,b.height),this.it,this.ct,l,c,p,g),i._t):(this.od=!1,this.l1(x,h,new lt(b.width,b.height),this.it,this.ct,l,c,p,g),this.od=!0,b._t);const v=this.dp,P=this.documentBounds.copy();if(P.subtractMargin(this.Qt),p){const F=this.zt.r,E=F.length;for(let B=0;B<E;B++){const Y=F[B];if(!Y.visible||!Y.isTemporary)continue;const W=Y.Ct.r,$=W.length;for(let K=0;K<$;K++){const Z=W[K];if(!Z.isInDocumentBounds||!Z.isVisible())continue;const it=Z.actualBounds;it.isReal()&&P.unionRect(it)}}}let w=new S(P.x,P.y);if(null!==l){const F=new j(0,0,0,0);let E=!0;const B=l.iterator;for(B.reset();B.next();){const Y=B.value;if(!(Y instanceof At))continue;const W=Y.layer;if(null!==W&&!W.visible||null!==W&&!p&&W.isTemporary||!Y.isVisible())continue;const $=Y.actualBounds;$.isReal()&&(E?(E=!1,F.h($)):F.unionRect($))}P.width=F.width,P.height=F.height,w.x=F.x,w.y=F.y}null!==a&&a.isReal()&&(w=a,o||(o=v));let M=0,C=0;null!==h&&(M=h.left+h.right,C=h.top+h.bottom);let N=0,I=0;null!==n&&(N=n.width,I=n.height,isFinite(N)&&(N=Math.max(0,N-M)),isFinite(I)&&(I=Math.max(0,I-C)));let T=0,D=0;if(null!==n&&null!==o?("NaN"===o&&(o=v),n.isReal()?(T=N,D=I):isNaN(I)?(T=N,D=P.height*o):(T=P.width*o,D=I)):null!==n?n.isReal()?(o=Math.min(N/P.width,I/P.height),T=N,D=I):isNaN(I)?(o=N/P.width,T=N,D=P.height*o):(o=I/P.height,T=P.width*o,D=I):null!==o?"NaN"===o&&r.isReal()?(o=Math.min((r.width-M)/P.width,(r.height-C)/P.height),o>v?(o=v,T=P.width,D=P.height):(T=r.width,D=r.height)):(T=P.width*o,D=P.height*o):(o=v,T=P.width,D=P.height),null!==h?(T+=M,D+=C):h=new It(0),null!==r){let F=r.width,E=r.height;isNaN(F)&&(F=2e3),isNaN(E)&&(E=2e3),isFinite(F)&&(T=Math.min(T,F)),isFinite(E)&&(D=Math.min(D,E))}return b.width=Math.ceil(T),b.height=Math.ceil(D),"SVG"===t?null===i?null:(i.resize(b.width,b.height,b.width,b.height),i.el=d,i.ud=f,this.l1(i._t,h,new lt(Math.ceil(T),Math.ceil(D)),o,w,l,c,p,g),i._t):(this.od=!1,this.l1(x,h,new lt(Math.ceil(T),Math.ceil(D)),o,w,l,c,p,g),this.od=!0,b._t)}static Mh=null;static B2="5da73c80a36555d5038e4972187c3cae51fd22";static OO="5da73c80a36555d503aa5c72106c30b35bb2006b9cd041b259";static qw=!1;static OP=()=>{if(void 0===U.B2[5]&&(Ot.prototype.Ci=Ot.prototype.Mu),!U.isUsingDOM())return;const e=y.Ni("canvas");e.width=350;const t=e.getContext("2d"),i=y.We("7ca11abfd022028846"),s="7ca11abfd7330390",n=[U.B2,y.qw+"4ae6247590da4bb21c324ba3a84e385776",Ot.OP+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",L.za];t.scale(2,2);for(let r=1;r<5;r++)t[y.We(s)](y.We(n[r-1]),8,15*r);t[i]=y.We("39f046ebb36e4b");for(let r=1;r<5;r++)t[y.We(s)](y.We(n[r-1]),8,15*r);(4!==n.length||"5"!==n[0][0]||"7"!==n[3][0])&&(Ot.prototype.Ci=Ot.prototype.Mu),U.Mh=e};static IO=()=>{if(void 0===U.B2[5]&&(Ot.prototype.Ci=Ot.prototype.Mu),!U.isUsingDOM())return;const e=y.Ni("canvas"),t=e.getContext("2d"),i=y.We("7ca11abfd022028846"),s="7ca11abfd7330390",n=[U.OO,L.za];t.scale(2,2);for(let r=1;r<3;r++)t[y.We(s)](y.We(n[r-1]),5,11*r);t[i]=y.We("39f046ebb36e4b");for(let r=1;r<3;r++)t[y.We(s)](y.We(n[r-1]),5,11*r);(2!==n.length||"5"!==n[0][0])&&(Ot.prototype.Ci=Ot.prototype.Mu),U.Mh=e}}class Qn{RT;OT;z2;bi;constructor(e){if(this.RT=null,this.OT="63ad05bbe23a1786468a4c741b6d2",this.z2="@onz",this.OT===this._tk)return this.z2=!0,void(this.bi=this.z2);this.bi=null}EO(e,t){let i="f";const s=X[y.We("76a715b2f73f148a")][y.We("72ba13b5")]||"",n=y.We;if(this.bi=!0,!U.isUsingDOM())return;let o=U[n("76a115b6ed251eaf4692")];if(!o){const a=s[n("76ad18b4f73e")];for(let h=s[n("73a612b6fb191d")](n("35e7"))+2;h<a;h++)i+=s[h];const l=i[n("73a612b6fb191d")](n("7da71ca0ad381e90"));return void(this.bi=!(l>=0&&l<i[n("73a612b6fb191d")](n("35"))))}const r=U.v2.iterator;for(;r.next();){o=r.value;const a=n(o).split(n("39e9")),l=7===a.length?1:0;if(1===a.length&&o.includes(n("5b8b3797c61b32a7"))){if(U.IO(),!e.lt)return;e.gp=e.lt._t.F[y.We("7eba17a4ca3b1a8346")][y.We("78a118b7")](e.lt._t.F,U.Mh,4,4)}if(a.length<6)return;const h=n(a[1+l]).split(".");if("7da71ca0"!==a[4+l])return;const c=n(y[n("6cae19")]).split(".");if(!(h[0]>c[0]||h[0]===c[0]&&h[1]>=c[1]))continue;const u="73a612b6fb191d",d=X[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),f=d[n(u)](n("3aad1ab6e022098b4dc4")),p=n(a[2+l]);if(f>-1){const T=d[n(u)](p.toLowerCase()+"/");if(this.bi=!(T>-1&&T<f),!this.bi)return}const g=s[n("76ad18b4f73e")];for(let T=s[n(u)](n("35e7"))+2;T<g;T++)i+=s[T];let b=i[n(u)](p);if(b<0&&p!==n("7da71ca0ad381e90")&&(b=i[n(u)](n("76a715b2ef3e149757"))),b<0&&(b=i[n(u)](n("76a715b2ef3e149757"))),b<0&&(b=i[n(u)](n("2bfa41fdb3784bca12"))),b<0&&(b=s[n(u)](n("7baa19a6f76c1988428554"))),b<0&&(b=s[n(u)](n("7ea902b2b9221e9c57c45767196566"))),this.bi=!(b>=0&&b<i[n(u)](n("35"))||-1===i[n(u)](n("35"))),!this.bi||s[n(u)](n("7fb002b6ed25128b4da25b2e"))&&(this.bi=!(s[n(u)](p)>-1),!this.bi))return;const x=X[y.We("76a715b2f73f148a")][y.We("69ad17a1e03e")],v=x[n(u)](n("7fb002b6ed25128b4da25b2e"));if(v>-1&&(this.bi=!(x[n(u)](p)>v),!this.bi))return;const P=p;if("#"!==P[0])continue;const w=y.Ni("div");let M=a[0+l].replace(/[A-Za-z]/g,"");for(;M.length<4;)M+="9";const C=M;M=M.substring(M.length-4);const N=parseInt(c[0]),I=parseInt(c[1]);if(N>3||3===N&&I>=1){const T=parseInt(C)%40+30,D=parseInt(P.substring(1,5),16);if(gt.IT===T+D)return void(this.bi=!1)}else{let T="";const F=["Header","Background","Display","Feedback"];if(T+=["gsh","gsf"][parseInt(M.substring(0,1),10)%2],T+=F[parseInt(M.substring(0,1),10)%4],w[n("79a417a0f0181a8946")]=T,X.document[n("78a712aa")]){X.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](w);const E=X.getComputedStyle(w).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),B=X.getComputedStyle(w).getPropertyValue(n("75b817b0ea2202"));if(X.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](w),!E)continue;const Y=X[n("77a902b0eb1b1e804a8a")];if(B==="0."+parseInt(C,10)%100||-1!==E.indexOf(parseInt(P[1]+P[2],16).toString())&&-1!==E.indexOf(parseInt(P[3]+P[4],16).toString()))return void(this.bi=!1);if(Y&&Y(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){T="."+T;for(let $=0;$<X.document.styleSheets.length;$++){const K=X.document.styleSheets[$].rules||X.document.styleSheets[$].cssRules;for(const Z in K)if(T===K[Z].selectorText)return void(this.bi=!1)}}}else this.bi=null,t&&(this.bi=!1)}}}Mh(e,t){return t.setTransform(e.$e/2,0,0,e.$e/2,0,0),t.commitTransform(),null===this.bi&&this.EO(e,!0),0<this.bi&&this!==this.RT}}class He{X2;G2;constructor(e){this.X2=void 0===e?new S:e,this.G2=new S}get point(){return this.X2}set point(e){this.X2=e}get shifted(){return this.G2}set shifted(e){this.G2=e}}class _n{Ri;pT;h1;constructor(e,t,i){this.Ri=e,this.pT=t,this.h1=i}}class Mi{isGridSnapEnabled;isGridSnapRealtime;gridSnapCellSize;gridSnapCellSpot;gridSnapOrigin;dragsLink;dragsTree;groupsSnapMembers;groupsAlwaysMove;dragsMembers;constructor(e){this.Ue(),e&&Object.assign(this,e)}Ue(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new lt(NaN,NaN).k(),this.gridSnapCellSpot=A.TopLeft,this.gridSnapOrigin=new S(NaN,NaN).k(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class ui extends U{u1;d1;g1;m1;Rp;cf;Bl;Y2;K2;p1;H2;constructor(e,t){let i;return void 0===e||"string"==typeof e||X.Element&&e instanceof Element?i=e:y.$(e)&&(t=e),super(i),this.animationManager.isEnabled=!1,this.Ht=!0,this.u1=null,this.Qu=!1,this._u=!1,this.d1=!0,this.g1=!0,this.m1=0,this.Rp=!1,this.cf=null,this.setRenderingHint("drawShadows",!1),this.Bl=new At({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new rt({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).It(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new It(0,0,0,0),this.ct.e(0,0),this.toolManager.Jt("Dragging",new eo,this.toolManager.mouseMoveTools),this.click=()=>{const s=this.observed;if(null===s)return;const n=s.viewportBounds,o=this.lastInput.documentPoint;s.position=new S(o.x-n.width/2,o.y-n.height/2)},this.Y2=s=>{this.invalidateDocumentBounds(),this.Op()},this.K2=s=>{null!==this.observed&&(this.invalidateDocumentBounds(),this.C())},this.p1=s=>{this.updateDelay<1?this.C():this.Rp||(this.Rp=!0,y.dn(()=>this.redraw(),this.updateDelay))},this.H2=s=>{null!==this.observed&&this.Op()},this.autoScale=2,this.Ht=!1,t&&this.setProperties(t),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.Rp&&this.updateDelay>=1&&(this.Rp=!1,this.UO()),super.redraw()}Ge(){if(null===this.Nt&&y.o("No div specified"),null===this.lt&&y.o("No canvas specified"),this.lt instanceof fi||(this.box.VM(),!this.qi))return;const e=this.observed;if(null===e||e.animationManager.defaultAnimation.isAnimating||!e.Qa)return;this.Lp();const t=this.lt,i=this.Wt;if(i.clearContextCache(!0),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,t.width,t.height),this.updateDelay<1)this.UT();else if(null!==this.cf){i.drawImage(this.cf.bt,0,0);const o=this.v;i.scale(this.$e,this.$e),i.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),i.commitTransform()}const s=this.zt.r,n=s.length;for(let o=0;o<n;o++)s[o].Ge(i,this);this.tf=!1,this.qi=!1}UO(){const e=this.lt,t=this.Wt;if(null!==e&&null!==t){if(this.Lp(),null===this.cf){const i=new Oe(null);i.width=e.width,i.height=e.height,this.cf=i}try{this.lt=this.cf,this.Wt=this.lt._t,this.Wt.clearContextCache(!0),this.Wt.setTransform(1,0,0,1,0,0),this.Wt.clearRect(0,0,this.lt.width,this.lt.height),this.UT()}finally{this.lt=e,this.Wt=t}}}UT(){const e=this.observed;if(null===e)return;const t=this.drawsTemporaryLayers,i=this.drawsGrid&&t,s=e.grid;if(i&&null!==s&&s.visible&&!isNaN(s.width)&&!isNaN(s.height)){const c=j.l().h(this.viewportBounds).unionRect(e.viewportBounds);e.ca(c),j.i(c),e.Te()}const n=this.v,o=this.Wt;o.scale(this.$e,this.$e),o.transform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),o.commitTransform();const r=this.viewportBounds,a=e.zt.r,l=a.length,h=this.zt.r;this.As(h,h.length,this,this.viewportBounds);for(let c=0;c<l;c++)a[c].ER(o,r,this,t,i)}get observed(){return this.u1}set observed(e){const t=this.u1;if(null!==e&&y.se(e,U,ui,"observed"),e instanceof ui&&y.o("Overview.observed Diagram may not be an Overview itself: "+e),t!==e){if(null!==t&&this.VO(t),this.u1=e,null!==e&&this.BO(e),this.invalidateDocumentBounds(),null===e){this.cf=null;const i=this.lt,s=this.Wt;i&&s&&(s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height))}else this.p1(null),this.Op(),this.C();this.t("observed",t,e)}}get box(){return this.Bl}set box(e){const t=this.Bl;t!==e&&(e.It(),this.Bl=e,this.remove(t),this.add(this.Bl),this.Op(),this.t("box",t,e))}get drawsTemporaryLayers(){return this.d1}set drawsTemporaryLayers(e){this.d1!==e&&(this.d1=e,this.redraw())}get drawsGrid(){return this.g1}set drawsGrid(e){this.g1!==e&&(this.g1=e,this.redraw())}get updateDelay(){return this.m1}set updateDelay(e){e<0&&(e=0),this.m1!==e&&(this.m1=e)}BO(e){null!==e&&(e.addDiagramListener("ViewportBoundsChanged",this.Y2),e.addDiagramListener("DocumentBoundsChanged",this.K2),e.addDiagramListener("InvalidateDraw",this.p1),e.addDiagramListener("AnimationFinished",this.H2),this.add(this.box))}VO(e){null!==e&&(this.remove(this.box),e.removeDiagramListener("ViewportBoundsChanged",this.Y2),e.removeDiagramListener("DocumentBoundsChanged",this.K2),e.removeDiagramListener("InvalidateDraw",this.p1),e.removeDiagramListener("AnimationFinished",this.H2))}Op(){const e=this.box,t=this.observed;if(null===t)return;this.qi=!0;const i=t.viewportBounds,s=e.selectionObject,n=lt.l();n.e(i.width,i.height),s.desiredSize=n,lt.i(n);const o=2/this.scale;s instanceof rt&&(s.strokeWidth=o),e.location=new S(i.x-o/2,i.y-o/2),e.isSelected=!0}computeBounds(){const e=this.observed;if(null===e)return j.em;const t=e.documentBounds.copy();return t.unionRect(e.viewportBounds),t}invalidateViewport(e,t){!0!==this.qi&&(this.qi=!0,this.requestUpdate())}onViewportBoundsChanged(e,t,i,s){this.Ht||(this.ha(),this.C(),this.Nh(),this.invalidateDocumentBounds(),this.Op(),this.Ye.scale=i,this.Ye.position.x=e.x,this.Ye.position.y=e.y,this.Ye.bounds.h(e),this.Ye.isScroll=s,this.T("ViewportBoundsChanged",this.Ye,e))}}class eo extends Ft{ua;constructor(){super(),this.ua=S.mn}canStart(){if(!this.isEnabled)return!1;const e=this.diagram;if(null===e||!e.allowMove||!e.allowSelect)return!1;const t=e.observed;if(null===t)return!1;const i=e.lastInput;if(!i.left||e.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-e.firstInput.timestamp<this.delay))return!1;if(null===this.findDraggablePart()){const s=t.viewportBounds;this.ua=new S(s.width/2,s.height/2);const n=e.firstInput.documentPoint;t.position=new S(n.x-this.ua.x,n.y-this.ua.y)}return!0}doActivate(){this.ua=S.mn,super.doActivate()}doUpdateCursor(e){const t=this.diagram,i=t.box;null!==i&&i.cursor&&(t.currentCursor=i.cursor)}moveParts(e,t,i){void 0===i&&(i=!1);const s=this.diagram,n=s.observed;if(null===n)return;const o=s.box;if(null===o)return;if(!this.ua.isReal()){const a=s.firstInput.documentPoint,l=o.location;this.ua=new S(a.x-l.x,a.y-l.y)}const r=s.lastInput.documentPoint;n.position=new S(r.x-this.ua.x,r.y-this.ua.y)}}class $t{a;w1="go._clipboard";b1="go._clipboardFormat";j2;q2;W2;J2;$2;Z2;Q2;_2;tN;da;eN;k1;P1;S1;M1;iN;Ho;sN;nN;Ip;oN;N1;rN;C1;lN;aN;dd;Ep;Up;hN;Qc;cN;fN;uN;dN;gN;gd;mN;Oi;Ps;L1;Vp;static md=["Ctrl","Shft","Alt","Meta"];static VT=$t.pN(230,40,15);static zO=$t.pN(270,40,15);static XO=$t.pN(310,40,15);constructor(e){z.Je(this),this.a=U.Om(),this.j2=!0,this.q2=!0,this.W2=!0,this.J2=!1,this.$2=!1,this.Z2=!1,this.Q2=!1,this._2="memory",this.tN=null,this.da=null,this.eN=1.05,this.k1=NaN,this.P1=S.mn,this.S1=NaN,this.M1=j.em,this.iN=!1,this.Ho=null,this.sN=200,this.nN=!1,this.Ip=new Nt("Auto",{layerName:"Tool",pickable:!1,selectable:!1}).add(new J("Spot").add(new rt({name:"SHAPE",fill:null,stroke:"lime",strokeWidth:4}).bindObject("stroke","adornedPart",t=>t.isSelected?"darkcyan":"lime"),new rt({name:"SHAPE2",stretch:2,fill:null,stroke:"magenta",strokeWidth:4,strokeDashArray:[4,4]})),new de({padding:4})),this.oN=null,this.N1="",this.rN="",this.C1=y.ur,this.lN=!1,this.aN=!1,this.dd=new At({layerName:"Tool",isInDocumentBounds:!1,locationObjectName:"CIRCLE",locationSpot:A.Center,pickable:!1,selectable:!1}).add(new rt("Circle",{isGeometryPositioned:!0,width:30,height:30,fill:null,stroke:"darkcyan",strokeWidth:6,visible:!1}).bind("visible","down"),new rt({isGeometryPositioned:!0,geometryString:"M15 0L15 30",stroke:"magenta"}),new rt({isGeometryPositioned:!0,geometryString:"M0 15L30 15",stroke:"magenta"}),new rt("Circle",{name:"CIRCLE",isGeometryPositioned:!0,width:20,height:20,fill:null,stroke:"magenta",position:new S(5,5)}),new rt({isGeometryPositioned:!0,geometry:$t.VT,fill:null,stroke:"cyan",strokeWidth:4}).bind("geometry","button",$t.GO),new mt({position:new S(12,0),font:"bold 10pt sans-serif"}).bind("text","clickCount",t=>t>1?t.toString():""),new mt({position:new S(0,16)}).bind("text","modifiers",$t.YO)).freezeBindings(),this.Ep=10,this.Up=1,this.hN=null,this.Qc=t=>this.KO(t),this.cN=t=>this.HO(t),this.fN=t=>this.jO(t),this.uN=t=>this.qO(t),this.dN=null,this.gN="distance",this.gd=null,this.mN=0,this.Oi={},this.Ps=null,this.L1=!1,this.Vp=null,this.yN(),this.dd.data=this.Oi,e&&Object.assign(this,e)}toString(){return"CommandHandler"}get diagram(){return this.a}Eo(e){this.a=e}doStart(){const e=this.a;e&&(e.addModelChangedListener(this.Qc),e.addDiagramListener("ViewportBoundsChanged",this.cN),e.addDiagramListener("GainedFocus",this.fN),e.addDiagramListener("LostFocus",this.uN))}doStop(){const e=this.a;e&&(e.removeDiagramListener("ViewportBoundsChanged",this.cN),e.removeDiagramListener("GainedFocus",this.fN),e.removeDiagramListener("LostFocus",this.uN),e.removeModelChangedListener(this.Qc))}doKeyDown(){const e=this.a,t=e.lastInput,i=t.control||t.meta,s=t.shift,n=t.alt,o=t.commandKey;!i||"Insert"!==o&&"c"!==o?i&&"x"===o||s&&"Delete"===o?this.canCutSelection()&&this.cutSelection():i&&"v"===o||s&&"Insert"===o?this.canPasteSelection()&&this.pasteSelection():i&&"y"===o||i&&s&&"z"===o||n&&s&&"Backspace"===o?this.canRedo()&&this.redo():i&&"z"===o||n&&"Backspace"===o?this.canUndo()&&this.undo():"Delete"===o||"Backspace"===o?this.canDeleteSelection()&&this.deleteSelection():i&&"a"===o?this.canSelectAll()&&this.selectAll():"Escape"===o?this.canStopCommand()&&this.stopCommand():this.BT.indexOf(o)>=0?this.WO(o,i,s):"PageUp"===o?s&&e.allowHorizontalScroll?e.scroll("page","left"):e.allowVerticalScroll&&e.scroll("page","up"):"PageDown"===o?s&&e.allowHorizontalScroll?e.scroll("page","right"):e.allowVerticalScroll&&e.scroll("page","down"):"Home"===o?i&&e.allowVerticalScroll?e.scroll("document","up"):!i&&e.allowHorizontalScroll&&e.scroll("document","left"):"End"===o?i&&e.allowVerticalScroll?e.scroll("document","down"):!i&&e.allowHorizontalScroll&&e.scroll("document","right"):"Space"===o?this.canScrollToPart()&&this.scrollToPart():"Minus"===o||"NumpadSubtract"===o?this.canDecreaseZoom()&&this.decreaseZoom():"Equal"===o||"NumpadAdd"===o?this.canIncreaseZoom()&&this.increaseZoom():i&&"Digit0"===o?this.canResetZoom()&&this.resetZoom():s&&"z"===o?this.canZoomToFit()&&this.zoomToFit():i&&!s&&"g"===o?this.canGroupSelection()&&this.groupSelection():i&&s&&"g"===o?this.canUngroupSelection()&&this.ungroupSelection():"F2"===o?this.canEditTextBlock()&&this.editTextBlock():"ContextMenu"===o||s&&"F10"===o||i&&s&&"Backslash"===o?this.canShowContextMenu()&&this.showContextMenu():t.bubbles=!0:this.canCopySelection()&&this.copySelection()}doKeyUp(){this.a.lastInput.bubbles=!0}stopCommand(){const e=this.a,t=e.currentTool;if(t instanceof Ue){if(null!==t.currentToolTip)return void t.hideToolTip();e.allowSelect&&e.clearSelection()}null!==t&&t.doCancel()}canStopCommand(){return!0}selectAll(){const e=this.a;e.C();try{e.currentCursor="wait",e.T("ChangingSelection",e.selection);const t=e.parts;for(;t.next();){const n=t.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const i=e.nodes;for(;i.next();){const n=i.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const s=e.links;for(;s.next();){const n=s.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}}finally{e.T("ChangedSelection",e.selection),e.currentCursor=""}}canSelectAll(){return this.a.allowSelect}deleteSelection(){const e=this.a;try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Delete"),e.T("SelectionDeleting",e.selection);const t=new z,i=e.selection.iterator;for(;i.next();)At.ga(t,i.value,!0,this.deletesTree?1/0:0,!!this.deletesConnectedLinks&&null,n=>n.canDelete());e.removeParts(t,!0),e.T("SelectionDeleted",t)}finally{e.commitTransaction("Delete"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canDeleteSelection(){const e=this.a;return!(e.isReadOnly||e.isModelReadOnly||!e.allowDelete||0===e.selection.count)}copySelection(){const e=this.a;try{const t=new z,i=e.selection.iterator;for(;i.next();)At.ga(t,i.value,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,n=>n.canCopy());this.copyToClipboard(t)}finally{}}canCopySelection(){const e=this.a;return!(!e.allowCopy||!e.allowClipboard||0===e.selection.count)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){const e=this.a;return!(e.isReadOnly||e.isModelReadOnly||!e.allowCopy||!e.allowDelete||!e.allowClipboard||0===e.selection.count)}copyToClipboard(e){const t=this.a,i="systemClipboard"===this.storageLocation;if(i||"memory"!==this.storageLocation)try{if(null===e)if(i&&X.navigator.clipboard)X.navigator.clipboard.writeText("");else{const n=X[this.storageLocation];if(!n)return;n.setItem(this.w1,""),n.setItem(this.b1,"")}else{const n=new U;if(n.isTreePathToChildren=t.isTreePathToChildren,n.toolManager.draggingTool.dragsLink=t.toolManager.draggingTool.dragsLink,n.model=t.model.copy(),t.copyParts(e,n,!1),i&&X.navigator.clipboard)X.navigator.clipboard.writeText(n.model.toJson());else{const o=X[this.storageLocation];if(!o)return;o.setItem(this.w1,n.model.toJson()),o.setItem(this.b1,n.model.dataFormat)}}return void t.T("ClipboardChanged",e)}catch{return}let s=null;if(null===e)U.iT();else{let n=null;try{n=t.copyParts(e,null,!0)}finally{s=new H,null!==n&&s.addAll(n.iteratorValues),U.Sp=s,U.i1=t.model.dataFormat}}t.T("ClipboardChanged",s)}pasteFromClipboard(){const e=this.a;if("memory"!==this.storageLocation){const n=new z;try{const o=X[this.storageLocation];if(!o)return n;const r=o.getItem(this.w1),a=o.getItem(this.b1);if(null===r||""===r||a!==e.model.dataFormat)return n;{const l=new U;l.model=bt.fromJson(r);const h=new z;h.addAll(l.parts).addAll(l.nodes).addAll(l.links);const c=e.copyParts(h,e,!1);return(new z).addAll(c.iteratorValues)}}catch{return n}}const t=new z,i=U.Sp;if(null===i||U.i1!==e.model.dataFormat)return t;let s=null;try{s=e.copyParts(i,e,!1)}finally{if(null!==s){const n=s.iterator;for(;n.next();){const o=n.value,r=n.key;o.location.isReal()||(r.location.isReal()?o.location=r.location:!o.position.isReal()&&r.position.isReal()&&(o.position=r.position)),t.add(o)}}}return t}pasteSelectionAsync(e){var t=this;return(0,ge.A)(function*(){const i=t.a;if(void 0!==X.navigator.clipboard)try{i.currentCursor="wait",i.T("ChangingSelection",i.selection),i.startTransaction("Paste");let s=null;const n=yield X.navigator.clipboard.readText();try{const r=n;if(null!==r&&""!==r){const a=new U;a.model=bt.fromJson(r);const l=new z;l.addAll(a.parts).addAll(a.nodes).addAll(a.links);const h=i.copyParts(l,i,!1);s=(new z).addAll(h.iteratorValues)}}catch{}if(null===s)return;s.count>0&&i.clearSelection(!0);const o=s.iterator;for(;o.next();)o.value.isSelected=!0;if(e){const r=i.computePartsBounds(i.selection);if(r.isReal()){const a=t.computeEffectiveCollection(i.selection,i.ad);i.Lx(a,new S(e.x-r.centerX,e.y-r.centerY),i.ad,!1)}}i.T("ClipboardPasted",s)}finally{i.commitTransaction("Paste"),i.T("ChangedSelection",i.selection),i.currentCursor=""}else y.ne('Cannot paste with storageLocation "clipboard", window.isSecureContext may be false.')})()}pasteSelection(e){if("systemClipboard"===this.storageLocation)return void this.pasteSelectionAsync(e);const t=this.a;try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Paste");const i=this.pasteFromClipboard();i.count>0&&t.clearSelection(!0);const s=i.iterator;for(;s.next();)s.value.isSelected=!0;if(e){const n=t.computePartsBounds(t.selection);if(n.isReal()){const o=this.computeEffectiveCollection(t.selection,t.ad);t.Lx(o,new S(e.x-n.centerX,e.y-n.centerY),t.ad,!1)}}t.T("ClipboardPasted",i)}finally{t.commitTransaction("Paste"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canPasteSelection(e){const t=this.a;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowClipboard)return!1;if("systemClipboard"===this.storageLocation)return!0;if("memory"!==this.storageLocation)try{const i=X[this.storageLocation];if(!i)return!1;const s=i.getItem(this.w1),n=i.getItem(this.b1);return!(null===s||""===s||n!==t.model.dataFormat)}catch{return!1}return!(null===U.Sp||0===U.Sp.count||U.i1!==t.model.dataFormat)}undo(){this.a.undoManager.undo()}canUndo(){const e=this.a;return!e.isReadOnly&&!e.isModelReadOnly&&e.allowUndo&&e.undoManager.canUndo()}redo(){this.a.undoManager.redo()}canRedo(){const e=this.a;return!e.isReadOnly&&!e.isModelReadOnly&&e.allowUndo&&e.undoManager.canRedo()}decreaseZoom(e){void 0===e&&(e=1/this.zoomFactor);const t=this.a;if(1!==t.autoScale)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canDecreaseZoom(e){void 0===e&&(e=1/this.zoomFactor);const t=this.a;if(1!==t.autoScale)return!1;const i=t.scale*e;return!(i<t.minScale||i>t.maxScale)&&t.allowZoom}increaseZoom(e){void 0===e&&(e=this.zoomFactor);const t=this.a;if(1!==t.autoScale)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canIncreaseZoom(e){void 0===e&&(e=this.zoomFactor);const t=this.a;if(1!==t.autoScale)return!1;const i=t.scale*e;return!(i<t.minScale||i>t.maxScale)&&t.allowZoom}resetZoom(e){void 0===e&&(e=this.defaultScale);const t=this.a;e<t.minScale||e>t.maxScale||(t.scale=e)}canResetZoom(e){void 0===e&&(e=this.defaultScale);const t=this.a;return!(e<t.minScale||e>t.maxScale)&&t.allowZoom}zoomToFit(e){const t=this.a,i=t.animationManager;i.stopAnimation(),t.redraw();const s=t.position.copy(),n=t.scale;if(i.Gl("Zoom To Fit"),!e&&this.isZoomToFitRestoreEnabled&&n===this.S1&&!isNaN(this.k1)&&this.P1.isReal()&&t.documentBounds.equals(this.M1))t.scale=this.k1,t.position=this.P1,this.S1=NaN,this.M1=j.em;else{if(this.k1=n,this.P1=s,e){const o=e.copy();if(o.width>0&&o.height>0){const r=t.viewportBounds,a=r.width*n,l=r.height*n,h=Math.min(a/o.width,l/o.height),c=a/h,u=l/h;o.width<c&&(o.x-=(c-o.width)/2),o.height<u&&(o.y-=(u-o.height)/2)}t.zoomToRect(o,2)}else t.zoomToFit();this.S1=t.scale,this.M1=t.documentBounds.copy()}i.SM()}canZoomToFit(e){return this.a.allowZoom}WO(e,t,i){const s=this.a;"ArrowUp"===e?s.allowVerticalScroll&&s.scroll(t?"pixel":"line","up"):"ArrowDown"===e?s.allowVerticalScroll&&s.scroll(t?"pixel":"line","down"):"ArrowLeft"===e?s.allowHorizontalScroll&&s.scroll(t?"pixel":"line","left"):"ArrowRight"===e&&s.allowHorizontalScroll&&s.scroll(t?"pixel":"line","right")}scrollToPart(e){void 0===e&&(e=null),null!==e&&y.se(e,At,$t,"part");const t=this.a;if(t.ensureBounds(),null===e){try{null!==this.Ho&&(this.Ho.next()?e=this.Ho.value:this.Ho=null)}catch{this.Ho=null}null===e&&(t.highlighteds.count>0?this.Ho=t.highlighteds.iterator:t.selection.count>0&&(this.Ho=t.selection.iterator),null!==this.Ho&&this.Ho.next()&&(e=this.Ho.value))}if(null!==e){const i=t.animationManager;i.Gl("Scroll To Part");const s=this.scrollToPartPause;if(s>0){const n=this.ff(e,[e]);if(1===n.length)t.startTransaction(),t.centerRect(e.actualBounds),t.commitTransaction("Scroll To Part");else{const o=()=>{t.startTransaction();let a=n.pop();for(;n.length>0&&a instanceof nt&&a.isTreeExpanded&&(!(a instanceof pt)||a.isSubGraphExpanded);)a=n.pop();n.length>0?(a instanceof At&&t.scrollToRect(a.actualBounds),a instanceof nt&&!a.isTreeExpanded&&(a.isTreeExpanded=!0),a instanceof pt&&!a.isSubGraphExpanded&&(a.isSubGraphExpanded=!0)):(a instanceof At&&t.centerRect(a.actualBounds),t.removeDiagramListener("LayoutCompleted",r)),t.commitTransaction("Scroll To Part")},r=()=>{y.dn(o,(i.isEnabled?i.duration:0)+s)};t.addDiagramListener("LayoutCompleted",r),o()}}else{const n=t.position.copy();t.centerRect(e.actualBounds),n.equalsApprox(t.position)&&i.stopAnimation()}}}ff(e,t){if(e.isVisible())return t;if(e instanceof Nt){const i=e.adornedPart;null!==i&&this.ff(i,t)}else if(e instanceof gt){const i=e.fromNode;null!==i&&this.ff(i,t);const s=e.toNode;null!==s&&this.ff(s,t)}else{if(e instanceof nt){const s=e.labeledLink;null!==s&&this.ff(s,t);const n=e.findTreeParentNode();null!==n&&(!n.isTreeExpanded&&!n.wasTreeExpanded&&t.push(n),this.ff(n,t))}const i=e.containingGroup;null!==i&&(!i.isSubGraphExpanded&&!i.wasSubGraphExpanded&&t.push(i),this.ff(i,t))}return t}canScrollToPart(e){if(void 0===e&&(e=null),null!==e&&!(e instanceof At))return!1;const t=this.a;return(0!==t.selection.count||0!==t.highlighteds.count)&&t.allowHorizontalScroll&&t.allowVerticalScroll}collapseTree(e){void 0===e&&(e=null);const t=this.a,i="Collapse Tree";try{t.startTransaction(i),t.animationManager.Gl(i);const s=new H;if(null!==e&&e.isTreeExpanded)e.collapseTree(),s.add(e);else if(null===e){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof nt&&o.isTreeExpanded&&(o.collapseTree(),s.add(o))}}t.T("TreeCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseTree(e){void 0===e&&(e=null);const t=this.a;if(t.isReadOnly)return!1;if(null!==e){if(!(e instanceof nt&&e.isTreeExpanded))return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof nt){if(!s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(e){void 0===e&&(e=null);const t=this.a,i="Expand Tree";try{t.startTransaction(i),t.animationManager.Gl(i);const s=new H;if(null===e||e.isTreeExpanded){if(null===e){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof nt&&(o.isTreeExpanded||(o.expandTree(),s.add(o)))}}}else e.expandTree(),s.add(e);t.T("TreeExpanded",s)}finally{t.commitTransaction(i)}}canExpandTree(e){void 0===e&&(e=null);const t=this.a;if(t.isReadOnly)return!1;if(null!==e){if(!(e instanceof nt)||e.isTreeExpanded)return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof nt){if(s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){const e=this.a,t=e.model;if(!t.uf())return;const i=this.archetypeGroupData;if(null===i)return;let s=null;try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Group");const n=new H,o=e.selection.iterator;for(;o.next();){const h=o.value;h.Di()&&h.canGroup()&&n.add(h)}const r=new H,a=n.iterator;for(;a.next();){const h=a.value;let c=!1;const u=n.iterator;for(;u.next();)if(h.isMemberOf(u.value)){c=!0;break}c||r.add(h)}const l=r.first();if(null!==l){let h=l.containingGroup;if(null!==h)for(;null!==h;){let c=!1;const u=r.iterator;for(;u.next();)if(!u.value.isMemberOf(h)){c=!0;break}if(!c)break;h=h.containingGroup}if(i instanceof pt)i.It(),s=i.copy(),null!==s&&e.add(s);else if(t.isGroupForData(i)){const c=t.copyNodeData(i);t.addNodeData(c),s=e.findNodeForData(c)}if(null!==s){null!==h&&this.isValidMember(h,s)&&(s.containingGroup=h);const c=r.iterator;for(;c.next();){const u=c.value;this.isValidMember(s,u)&&(u.containingGroup=s)}e.clearSelection(!0),s.isSelected=!0}}e.T("SelectionGrouped",s)}finally{e.commitTransaction("Group"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canGroupSelection(){const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowGroup||!e.model.uf()||null===this.archetypeGroupData)return!1;const t=e.selection.iterator;for(;t.next();){const i=t.value;if(i.Di()&&i.canGroup())return!0}return!1}wN(e){const t=y.nt();if(Array.isArray(e))e.forEach(n=>{n instanceof gt||n instanceof At&&t.push(n)});else{const n=e.iterator;for(;n.next();){const o=n.value;o instanceof gt||o instanceof At&&t.push(o)}}const i=new z,s=t.length;for(let n=0;n<s;n++){const o=t[n];let r=!0;for(let a=0;a<s;a++)if(o.isMemberOf(t[a])){r=!1;break}r&&i.add(o)}return y.Z(t),i}isValidMember(e,t){if(null===t||e===t||t instanceof gt)return!1;let i;return(null===e||!(e===t||e.isMemberOf(t)||(i=e.memberValidation,null!==i&&!i(e,t))||null===e.data&&null!==t.data||null!==e.data&&null===t.data))&&(i=this.memberValidation,null===i||i(e,t))}ungroupSelection(e){void 0===e&&(e=null);const t=this.a,i=t.model;if(i.uf())try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Ungroup");const s=new H;if(null!==e)s.add(e);else{const o=t.selection.iterator;for(;o.next();){const r=o.value;r instanceof pt&&r.canUngroup()&&s.add(r)}}const n=new H;if(s.count>0){t.clearSelection(!0);const o=s.iterator;for(;o.next();){const r=o.value;r.expandSubGraph();const a=r.containingGroup,l=null!==a&&null!==a.data?i.getKeyForNodeData(a.data):void 0;n.addAll(r.memberParts);const h=n.iterator;for(;h.next();){const c=h.value;if(c.isSelected=!0,c instanceof gt)continue;const u=c.data;null!==u?i.setGroupForData(u,l):c.containingGroup=a}t.remove(r)}}t.T("SelectionUngrouped",s,n)}finally{t.commitTransaction("Ungroup"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canUngroupSelection(e){void 0===e&&(e=null);const t=this.a;if(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||!t.allowUngroup||!t.model.uf())return!1;if(null!==e){if(!(e instanceof pt))return!1;if(e.canUngroup())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof pt&&s.canUngroup())return!0}}return!1}addTopLevelParts(e,t){let s=!0;const n=this.wN(e).iterator;for(;n.next();){const o=n.value;null!==o.containingGroup&&(!t||this.isValidMember(null,o)?o.containingGroup=null:s=!1)}return s}collapseSubGraph(e){void 0===e&&(e=null);const t=this.a,i="Collapse SubGraph";try{t.startTransaction(i),t.animationManager.Gl(i);const s=new H;if(null!==e&&e.isSubGraphExpanded)e.collapseSubGraph(),s.add(e);else if(null===e){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof pt&&o.isSubGraphExpanded&&(o.collapseSubGraph(),s.add(o))}}t.T("SubGraphCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseSubGraph(e){void 0===e&&(e=null);const t=this.a;if(t.isReadOnly)return!1;if(null!==e)return!!(e instanceof pt&&e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof pt&&s.isSubGraphExpanded)return!0}}return!1}expandSubGraph(e){void 0===e&&(e=null);const t=this.a,i="Expand SubGraph",s=new H;try{if(t.startTransaction(i),t.animationManager.Gl(i),null===e||e.isSubGraphExpanded){if(null===e){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof pt&&(o.isSubGraphExpanded||(o.expandSubGraph(),s.add(o)))}}}else e.expandSubGraph(),s.add(e);t.T("SubGraphExpanded",s)}finally{for(const n of s)this.zT(t,n);e&&this.zT(t,e),t.commitTransaction(i)}}zT(e,t){for(const i of t.memberParts)i instanceof nt&&e.Yc(i,t)}canExpandSubGraph(e){void 0===e&&(e=null);const t=this.a;if(t.isReadOnly)return!1;if(null!==e)return!(!(e instanceof pt)||e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof pt&&!s.isSubGraphExpanded)return!0}}return!1}editTextBlock(e){void 0===e&&(e=null),null!==e&&y.se(e,mt,$t,"editTextBlock");const t=this.a,i=t.toolManager.findTool("TextEditing");if(null!==i){if(null===e){let s=null;const n=t.selection.iterator;for(;n.next();){const o=n.value;if(o.canEdit()){s=o;break}}if(null===s)return;e=s.findInVisualTree(o=>o instanceof mt&&o.editable)}null!==e&&(t.currentTool=null,i.textBlock=e,t.currentTool=i)}}canEditTextBlock(e){void 0===e&&(e=null);const t=this.a;if(t.isReadOnly||t.isModelReadOnly||!t.allowTextEdit||null===t.toolManager.findTool("TextEditing"))return!1;if(null!==e){if(!(e instanceof mt))return!1;const i=e.part;if(null!==i&&i.canEdit())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s.canEdit()&&null!==(e=s.findInVisualTree(n=>n instanceof mt&&n.editable)))return!0}}return!1}showContextMenu(e){const t=this.a,i=t.toolManager.findTool("ContextMenu");if(null===i)return;void 0===e&&(e=null),null===e&&(e=t.selection.count>0?t.selection.first():t);const s=i.findObjectWithContextMenu(e);if(null!==s){const n=t.lastInput;let o;if(o=s instanceof st?s.getDocumentPoint(A.Center):t.viewportBounds.containsPoint(n.documentPoint)?S.mn:t.viewportBounds.center,o.isReal()){const r=new xe;r.diagram=t,r.viewPoint=t.transformDocToView(o),r.documentPoint=o,r.button=2,r.up=!0,t.lastInput=r}t.currentTool=i,i.openMenu(!1,s)}}canShowContextMenu(e){const t=this.a,i=t.toolManager.findTool("ContextMenu");return!(null===i||(void 0===e&&(e=null),null===e&&(e=t.selection.count>0?t.selection.first():t),null===i.findObjectWithContextMenu(e)))}downloadSvg(e){const t=this.a,i={scale:1,background:t.div?t.div.style.backgroundColor:"white",name:this.JO("svg")};e&&Object.assign(i,e);const s=t.makeSvg(i);if(null!==s){const n=(new XMLSerializer).serializeToString(s);this.$O(i.name,"image/svg+xml",n)}}downloadSVG(e){this.downloadSvg(e)}canDownloadSvg(e){return null!==this.a}$O(e,t,i){let s=null,n=null;try{const o=new Blob([i],{type:t});s=X.URL.createObjectURL(o),n=y.Ni("a"),n.style.display="none",n.href=s,n.download=e,X.document.body.appendChild(n),requestAnimationFrame(()=>{try{null!==n&&n.click()}finally{null!==s&&X.URL.revokeObjectURL(s),null!==n&&X.document.body.removeChild(n)}})}catch{null!==s&&X.URL.revokeObjectURL(s),null!==n&&X.document.body.removeChild(n)}}JO(e){const t="."+e;let i=this.diagram.model.name;return i?i.endsWith(t)&&(i=i.substring(0,i.length-t.length)):i="diagram",i+=t,i}get copiesClipboardData(){return this.j2}set copiesClipboardData(e){this.j2=!!e}get copiesConnectedLinks(){return this.q2}set copiesConnectedLinks(e){this.q2=!!e}get deletesConnectedLinks(){return this.W2}set deletesConnectedLinks(e){this.W2=!!e}get copiesTree(){return this.J2}set copiesTree(e){this.J2=!!e}get deletesTree(){return this.$2}set deletesTree(e){this.$2=!!e}get copiesParentKey(){return this.Z2}set copiesParentKey(e){this.Z2=!!e}get copiesGroupKey(){return this.Q2}set copiesGroupKey(e){this.Q2=!!e}get storageLocation(){return this._2}set storageLocation(e){e||(e="memory"),"memory"!==e&&"sessionStorage"!==e&&"localStorage"!==e&&"systemClipboard"!==e&&y.o("Invalid new value for CommandHandler.storageLocation: "+e),this._2=e}get archetypeGroupData(){return this.tN}set archetypeGroupData(e){null!==e&&y.xc(e,$t,"archetypeGroupData"),this.tN=e}get memberValidation(){return this.da}set memberValidation(e){null!==e&&y.S(e,$t,"memberValidation"),this.da=e}get defaultScale(){return this.diagram.defaultScale}set defaultScale(e){this.diagram.defaultScale=e}get zoomFactor(){return this.eN}set zoomFactor(e){e>1||y.o("zoomFactor must be larger than 1.0, not: "+e),this.eN=e}get isZoomToFitRestoreEnabled(){return this.iN}set isZoomToFitRestoreEnabled(e){this.iN=!!e}get scrollToPartPause(){return this.sN}set scrollToPartPause(e){this.sN=e}computeEffectiveCollection(e,t){const i=this.a,s=i.toolManager.findTool("Dragging"),n=i.currentTool===s;void 0===t&&(t=i.Tp());const o=new xt;if(null===e)return o;let r=e.iterator;for(;r.next();)i.tl(o,r.value,n,t);if(null!==i.draggedLink&&t.dragsLink)return o;for(r=e.iterator;r.next();){const a=r.value;if(a instanceof gt){const l=a.fromNode;if(null===l||o.has(l)){const h=a.toNode;null!==h&&!o.has(h)&&o.delete(a)}else o.delete(a)}}return o}static getModifierNames(){return $t.md}static setModifierNames(e){$t.md=e}static YO(e){let t="";return 1&e&&(t+=$t.md[0]||""),4&e&&(t+=$t.md[1]||""),2&e&&(t+=$t.md[2]||""),8&e&&(t+=$t.md[3]||""),t}static GO(e){return 1===e?$t.zO:2===e?$t.XO:$t.VT}static pN(e,t,i){var s=new S(i,0).rotate(e-t/2),n=(new Ct).add(new Ht(-i,-i)).add(new Ht(i,i)).add(new Ht(s.x,s.y).add(new St(5,e-t/2,t,0,0,i,i)));return n.offset(i,i),n}KO(e){e.isTransactionFinished&&this.updateFocusBox()}HO(e){if(e.subject.scale===this.diagram.scale)return;const t=4/this.diagram.scale,i=this.focusBox.findObject("SHAPE");null!==i&&(i.strokeWidth=t);const s=this.focusBox.findObject("SHAPE2");null!==s&&(s.strokeWidth=t,s.strokeDashArray=[t,t]);const n=this.focusBox.placeholder;null!==n&&(n.padding=t)}jO(e){null===this.focus?y.dn(()=>{this.focus=this.findFirstFocus()},500):this.onFocusChanged(this.focus,this.focus)}qO(e){this.isVirtualPointerShown=!1}get isFocusEnabled(){return this.nN}set isFocusEnabled(e){(e=!!e)!==this.isFocusEnabled&&(e||(this.isVirtualPointerShown=!1,this.dN=this.focus,this.focus=null),this.nN=e,e&&(this.focus=this.dN,this.updateFocusBox()))}get focusBox(){return this.Ip}set focusBox(e){if(!(e instanceof Nt))return;const t=this.Ip;if(e!==t&&(this.Ip=e,null!==t.adornedObject)){const i=t.adornedPart;null!==i&&i.removeAdornment("Focus"),e.adornedObject=t.adornedObject,null!==i&&i.addAdornment("Focus",e)}}get focus(){return this.Ip.adornedObject}set focus(e){const t=this.focus;if(e!==t){const i=this.a;if(!i||!this.isFocusEnabled||null!==e&&e.diagram!==i)return;i.currentTool instanceof ti||this.cancelVirtualPointer();const s=this.focusBox.adornedPart;s&&s.removeAdornment("Focus"),null===e?(this.gd=null,this.virtualPointerLocation=i.viewportBounds.center,this.focusBox.adornedObject=null):(this.virtualPointerLocation=e.getDocumentPoint(A.Center),this.focusBox.adornedObject=e,this.updateFocusBox()),this.onFocusChanged(t,e)}}onFocusChanged(e,t){const i=this.a;if(i&&(null!==this.focusChanged?this.focusChanged(e,t,this):this.ZO(this.describe(e,t)),null!==t&&null!==t.part)){const s=t.getDocumentBounds();i.viewportBounds.containsRect(s)||(t instanceof At?i.commandHandler.scrollToPart(t):i.scrollToRect(s))}}get focusChanged(){return this.oN}set focusChanged(e){null!==e&&y.S(e,$t,"focusChanged"),this.oN=e}get liveElementId(){return this.N1||this.rN}set liveElementId(e){e!==this.N1&&(this.N1=e,this.xN())}xN(){const e=this.diagram;if(!e||!U.isUsingDOM())return;const t=e.lt?.bt;if(!t)return;const i=this.liveElementId,s=X.document.getElementById(i);this.isUsingAriaLive?(t.removeAttribute("aria-labelledby"),s&&s.setAttribute("aria-live","polite")):(i&&t.setAttribute("aria-labelledby",i),s&&s.removeAttribute("aria-live"))}get isUsingAriaLive(){return this.C1}set isUsingAriaLive(e){e!==this.C1&&(this.C1=e,this.xN())}ZO(e){const t=this.diagram;if(!t||!U.isUsingDOM()||!t.div)return;let i=this.liveElementId;if(!i){const n=y.Ni("span"),o=n.style;for(o.opacity="0",o.position="absolute",o.right="-9999px",o.bottom="-9999px",o.width="0px",o.height="0px",o.overflow="hidden",o.border="0",i=(t.div.id||"diagram")+"_aria";X.document.getElementById(i);)i+=Math.floor(10*Math.random());n.id=i,this.rN=i,t.div.appendChild(n),this.xN()}const s=X.document.getElementById(i);s&&(s.textContent=e)}describe(e,t){let i="";t instanceof nt?i=t instanceof pt?"Group":"Node":t instanceof gt?i="Link":t instanceof At?i="Part":t&&(t.click?i="button":t instanceof mt&&t.editable&&(i="editable"),null!==t.portId&&(i&&(i+=" "),i+="port",t.portId&&(i+=" "+t.portId)));const s=this.bN(t);s&&(i+=" "+s);const n=t;if(e&&n instanceof gt&&n.fromNode&&n.toNode)if(e instanceof nt&&e.part===n.fromNode||e instanceof gt&&e.fromNode===n.fromNode){i+=" to "+this.bN(n.toNode,!0);const o=n.toPort?.portId;o&&(i+=" port "+o)}else if(e instanceof nt&&e.part===n.toNode||e instanceof gt&&e.toNode===n.toNode){i+=" from "+this.bN(n.fromNode,!0);const o=n.fromPort?.portId;o&&(i+=" port "+o)}return i}bN(e,t){if(void 0===t&&(t=!1),!e)return"";if(e instanceof mt&&e.text)return e.text;if(e instanceof J){let i="";return e instanceof At&&e.text&&(i=e.text),t&&i||e.walkVisualTreeFrom(e,(s,n)=>{n.isVisibleObject()&&n instanceof mt&&n.text&&(!t||!i)&&i!==n.text&&(i+=" "+n.text)}),i}return""}updateFocusBox(){const e=this.focus;if(null!==e)if(null!==e.diagram&&(e instanceof At?e.isVisible():e.isVisibleObject()&&e.part?.isVisible()))this.focusBox.adornedObject=e,e.part?.addAdornment("Focus",this.focusBox);else{let t=null;if(e instanceof At||(t=e.part),t instanceof At&&t.isVisible())this.focus=t;else{if(t instanceof nt&&!t.isVisible()){const i=t.findTreeParentNode();if(null!==i)t=i;else{const s=t.labeledLink;null!==s&&(t=s)}}for(;t instanceof At&&!t.isVisible();)t=t.containingGroup;this.focus=t instanceof At&&t.isVisible()?t:null}}}findFirstFocus(){const e=this.a;if(null===e||!e.isEnabled)return null;if(null!==this.focus)return this.focus;if(this.isFocusEnabled)if(e.selection.count>0)this.focus=e.selection.first();else{const t=this.XT(e.isTreePathToChildren).first();if(null!==t)return t}return null}get isVirtualPointerEnabled(){return this.lN}set isVirtualPointerEnabled(e){if((e=!!e)!==this.isVirtualPointerEnabled&&(this.lN=e,e)){const i=this.Vp;i&&(this.Vp=null,i.commandHandler.Ps=null,i.commandHandler.cancelVirtualPointer())}}get isVirtualPointerShown(){return this.aN}set isVirtualPointerShown(e){if((e=!!e)!==this.isVirtualPointerShown){const i=this.a;if(!i||!this.isVirtualPointerEnabled)return;this.aN=e;const s=this.focus;e?null===this.virtualPointerBox.diagram&&(this.virtualPointerLocation.isReal()||(this.virtualPointerLocation=null!==s?s.getDocumentPoint(A.Center):i.viewportBounds.center),i.add(this.virtualPointerBox),this.ma()):null!==this.virtualPointerBox.diagram&&(i.remove(this.virtualPointerBox),this.ma())}}cancelVirtualPointer(){const e=this.a;e&&(this.yN(),this.isVirtualPointerShown=!1,e.currentTool.doCancel(),this.isVirtualPointerDown=!1,this.kN())}kN(){const e=this.Ps;if(null!==e){this.Ps=null;const t=e.commandHandler;t.Ps=null,t.Vp=null,t.isVirtualPointerShown=!1,t.isVirtualPointerDown=!1,t.yN(),this.L1&&(t.isVirtualPointerEnabled=!1),this.L1=!1}}yN(){this.Oi.button=0,this.Oi.modifiers=0,this.Oi.clickCount=1,this.Oi.down=!1,this.ma()}ma(){null!==this.virtualPointerChanged&&this.virtualPointerChanged(this.virtualPointerBox,this),this.updateVirtualPointer()}updateVirtualPointer(){const e=this.virtualPointerBox.diagram;e&&(this.virtualPointerBox.scale=1/e.scale),this.virtualPointerBox.updateTargetBindings()}get virtualPointerBox(){return this.dd}set virtualPointerBox(e){if(!(e instanceof At))return;const t=this.dd;e!==t&&(null!==t&&(e.location=t.location,null!==t.diagram&&t.diagram.remove(t)),this.dd=e,this.isVirtualPointerShown&&this.diagram&&(this.diagram.add(e),e.data=t.data),this.ma())}get virtualPointerChanged(){return this.hN}set virtualPointerChanged(e){null!==e&&y.S(e,$t,"virtualPointerChanged"),this.hN=e}get virtualPointerLocation(){return this.virtualPointerBox.location}set virtualPointerLocation(e){this.virtualPointerLocation.equals(e)||this.GT(e.x,e.y)}get isVirtualPointerDown(){return!!this.virtualPointerBox.data&&this.virtualPointerBox.data.down}set isVirtualPointerDown(e){if((e=!!e)!==this.isVirtualPointerDown){const i=this.a;if(!i||!this.isVirtualPointerEnabled||(null===this.virtualPointerBox.data&&(this.dd.data=this.Oi),this.virtualPointerBox.data.down=e,this.ma(),!this.isVirtualPointerShown))return;const s=i.lastInput,n=new xe;n.diagram=i,this.YT(n,e),e?n.down=!0:n.up=!0,n.clickCount=1,n.button=this.Oi.button,n.modifiers=this.Oi.modifiers,e&&(i.firstInput=n.copy()),this.pd(n,!0),e||2===this.Oi.clickCount&&(n.clickCount=2,n.down=!0,n.up=!1,this.pd(n,!0),n.down=!1,n.up=!0,this.pd(n,!0),this.KT(1)),i.lastInput=s}}get virtualPointerShiftMove(){return this.Ep}set virtualPointerShiftMove(e){this.Ep=e}get virtualPointerControlMove(){return this.Up}set virtualPointerControlMove(e){this.Up=e}Bp(e,t){this.GT(this.virtualPointerLocation.x+e,this.virtualPointerLocation.y+t)}GT(e,t){this.virtualPointerBox.moveTo(e,t,!0);const i=this.a;if(!i||!this.isVirtualPointerEnabled||!this.isVirtualPointerShown)return;i.ensureBounds();const s=i.lastInput,n=new xe;n.diagram=i,this.YT(n,this.isVirtualPointerDown),n.button=this.Oi.button,n.modifiers=this.Oi.modifiers,this.pd(n,!0),i.lastInput=s,this.isVirtualPointerDown&&(i.remove(this.virtualPointerBox),i.add(this.virtualPointerBox)),this.ma()}YT(e,t){const i=this.a;if(i){if(e.targetDiagram=i,e.documentPoint=this.virtualPointerLocation,i.allowDragOut){const s=i.div.getBoundingClientRect(),n=i.transformDocToView(this.virtualPointerLocation),o=s.x+n.x,r=s.y+n.y;let a=X.document.elementFromPoint(o,r)||null;a instanceof HTMLCanvasElement&&(a=a.parentElement),null!==a&&a.shadowRoot&&(a=a.shadowRoot.elementFromPoint(o,r)||null,a instanceof HTMLCanvasElement&&(a=a.parentElement));let l=null;if(a instanceof HTMLElement&&(l=U.Wi.get(a))&&l!==i&&l.div){const h=l.div.getBoundingClientRect(),c=new S(n.x-(h.x-s.x),n.y-(h.y-s.y));null!==this.Ps&&this.Ps!==l&&this.kN(),e.targetDiagram=l,e.viewPoint=c,e.documentPoint=l.transformViewToDoc(c),e.viewPoint=l.transformDocToView(e.documentPoint),this.Ps=l;const u=l.commandHandler;return this.L1=!u.isVirtualPointerEnabled,u.isVirtualPointerEnabled=!0,u.isVirtualPointerDown=t,u.virtualPointerLocation=e.documentPoint,u.isVirtualPointerShown=!0,void(u.Vp=i)}}null!==this.Ps&&this.kN(),e.viewPoint=i.transformDocToView(e.documentPoint)}}pd(e,t){this.doVirtualPointerEvent(e,t)}doVirtualPointerEvent(e,t){const i=this.a;i&&(e.timestamp=Date.now(),i.lastInput=e,t&&(e.up?i.doMouseUp():e.down?i.doMouseDown():i.doMouseMove()),this.onVirtualPointerEvent(e,t))}onVirtualPointerEvent(e,t){const i=this.a;i&&e.up&&this.isVirtualPointerDown&&!i.viewportBounds.containsPoint(this.virtualPointerLocation)&&(this.virtualPointerLocation=this.focus instanceof st?this.focus.getDocumentPoint(A.Center):i.viewportBounds.center)}doVirtualFocusKeyDown(){const e=this.a;if(!e)return!1;const t=e.lastInput,i=t.commandKey;if(this.isVirtualPointerEnabled&&("ShiftLeft"===i||"ShiftRight"===i))return this.isVirtualPointerShown=!0,!0;if(this.BT.indexOf(i)>=0)if(t.shift&&this.isVirtualPointerShown){const s=this.A1(i),n=t.control||t.meta?this.Up:this.Ep;270===s?this.Bp(0,-n):90===s?this.Bp(0,n):this.Bp(180===s?-n:n,0)}else this.QO();else if(t.shift&&this.isVirtualPointerShown&&("Numpad1"===i||"Numpad2"===i||"Numpad3"===i||"Numpad4"===i||"Numpad6"===i||"Numpad7"===i||"Numpad8"===i||"Numpad9"===i)){const s=t.control||t.meta?this.Up:this.Ep;let n=0;"Numpad1"===i||"Numpad4"===i||"Numpad7"===i?n=-s:("Numpad3"===i||"Numpad6"===i||"Numpad9"===i)&&(n=s);let o=0;"Numpad7"===i||"Numpad8"===i||"Numpad9"===i?o=-s:("Numpad1"===i||"Numpad2"===i||"Numpad3"===i)&&(o=s),this.Bp(n,o)}else if("Enter"===i||"NumpadEnter"===i||"Numpad5"===i)t.shift&&this.isVirtualPointerShown?this.isVirtualPointerDown=!this.isVirtualPointerDown:this._O();else if("Escape"===i)this.tI();else if("Space"===i)this.eI();else if("ContextMenu"===i||t.shift&&"F10"===i||(t.control||t.meta)&&t.shift&&"Backslash"===i)this.iI();else if(t.shift&&"c"===i)this.T1(1);else if(t.shift&&"a"===i)this.T1(2);else if(t.shift&&"KeyS"===i)this.T1(4);else if(t.shift&&"KeyM"===i)this.T1(8);else if(t.shift&&"Digit1"===i)this.D1(0);else if(t.shift&&"Digit2"===i)this.D1(1);else if(t.shift&&"Digit3"===i)this.D1(2);else if(t.shift&&"Numpad0"===i)this.D1(2===this.Oi.button?0:2);else if(!t.shift||"KeyD"!==i&&"NumpadDecimal"!==i)if(t.shift&&"KeyF"===i)this.nextFocusFormula="distance"===this.nextFocusFormula?"linear":"distance";else{if(!t.shift||"y"!==i)return!1;this.isUsingAriaLive=!this.isUsingAriaLive}else this.KT(2===this.Oi.clickCount?1:2);return!0}doVirtualFocusKeyUp(){const e=this.a;if(!e)return!1;const t=e.lastInput.commandKey;return this.isVirtualPointerEnabled&&("ShiftLeft"===t||"ShiftRight"===t)&&(this.isVirtualPointerShown=!1),!0}A1(e){switch(e){case"ArrowDown":return 90;case"ArrowLeft":return 180;case"ArrowUp":return 270;default:return 0}}BT=["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"];T1(e){const t=this.Oi.modifiers;this.Oi.modifiers=t&e?t&~e:t|e,this.ma()}KT(e){this.Oi.clickCount=e,this.ma()}D1(e){this.Oi.button=e,this.ma()}QO(){const e=this.a;if(!e)return;const t=e.lastInput,i=this.focus;if(null===i){const s=this.XT(e.isTreePathToChildren).first();null!==s&&(this.focus=s)}else if(i instanceof gt)this.sI(i);else if(i instanceof nt)this.nI(i);else{i instanceof At&&(this.gd=null);const s=this.A1(t.commandKey);this.focus=this.findNextFocus(270===s?270:90===s?90:180===s?180:0)}}sI(e){const t=this.a;if(!t)return;const s=this.A1(t.lastInput.commandKey);let n=null;const o=this.gd;if(null!==o){const r=this.mN;if(s===r)n=e.getOtherNode(o);else if(s===L.Ee(r+180))n=o;else{let l=0===r||180===r?270:180;if(s===(0===r||180===r?90:0)){const h=this.PN(o,r,!0),c=h.indexOf(e);c>=0&&c<h.count-1&&(this.focus=h.elt(c+1))}else if(s===l){const h=this.PN(o,r,!0),c=h.indexOf(e);c>0&&(this.focus=h.elt(c-1))}}}else{const r=e.fromNode,a=e.toNode;if(!r||!a)return;n=270===s?r.location.y<a.location.y?r:a:90==s?r.location.y>a.location.y?r:a:180===s?r.location.x<a.location.x?r:a:r.location.x>a.location.x?r:a}for(;null!==n&&!n.isVisible();)n=n.containingGroup;null!==n&&(this.focus=n)}nI(e){const t=this.a;if(!t)return;const i=t.lastInput,s=this.A1(i.commandKey);if(i.control||i.meta){const n=this.PN(e,s,!0).first();n&&(this.gd=e,this.mN=s,this.focus=n)}else this.gd=null,this.focus=this.findNextFocus(s)}PN(e,t,i){if(null===e)return new H;const s=e.actualBounds;if(!s.isReal())return new H;const n=new Set;(e instanceof pt?e.findExternalLinksConnected():e.findLinksConnected()).each(r=>{if(!r.isVisible())return;let a=null;if(r.fromNode===e?a=r.toNode:r.toNode===e?a=r.fromNode:e instanceof pt&&(r.fromNode?.isMemberOf(e)?a=r.toNode:r.toNode?.isMemberOf(e)&&(a=r.fromNode)),null===a||a.isMemberOf(e))return;for(;null!==a&&!a.isVisible();)a=a.containingGroup;if(null===a)return;const l=a.location;if(l.isReal()&&(270!==t||!(a!==e?l.y>=s.top:r.midPoint.y>=s.top))){if(90===t&&(a!==e?l.y<=s.bottom:r.midPoint.y<=s.bottom)||180===t&&(a!==e?l.x>=s.left:r.midPoint.x>=s.left)||0===t&&(a!==e?l.x<=s.right:r.midPoint.x<=s.right))return;i&&r.actualBounds.isReal()?n.add(r):n.add(a)}});const o=new H(n);return o.sort(90===t||270===t?(r,a)=>r.actualBounds.centerX-a.actualBounds.centerX:(r,a)=>r.actualBounds.centerY-a.actualBounds.centerY),o}findNextFocus(e){e=L.Ee(e);const t=this.focus,i=t instanceof nt?t.location:t.getDocumentPoint(A.Center);let s=1/0,n=t;const o=(r,a,l,h)=>{if("linear"===this.nextFocusFormula){let c=1/0;0===e&&l>i.x||180===e&&l<i.x?c=Math.abs(l-i.x):(90===e&&h>i.y||270===e&&h<i.y)&&(c=Math.abs(h-i.y)),c<s&&(s=c,n=r)}else{if(0===e&&(a.right<i.x||(a.centerX-i.x)**2>s)||90===e&&(a.bottom<i.y||(a.centerY-i.y)**2>s)||180===e&&(a.x>i.x||(i.x-a.centerX)**2>s)||270===e&&(a.y>i.y||(i.y-a.centerY)**2>s))return;const c=i.direction(l,h),u=L.jF(e,c);if(90===e||270===e?u<=45:u<45){const d=i.distanceSquared(l,h);d<s&&(s=d,n=r)}}};if(t instanceof At&&null!==t.diagram){const r=t.containingGroup;null!==r?r.memberParts.each(a=>{a===t||a instanceof gt||!a.isVisible()||o(a,a.actualBounds,a.location.x,a.location.y)}):(t.diagram.nodes.each(a=>{a===t||!a.isTopLevel||!a.isVisible()||o(a,a.actualBounds,a.location.x,a.location.y)}),t.diagram.parts.each(a=>{a===t||!a.isTopLevel||!a.isVisible()||o(a,a.actualBounds,a.location.x,a.location.y)}))}else if(null!==t.part){const r=new j;this.SN(t.part).each(a=>{a!==t&&(a.getDocumentBounds(r),o(a,r,r.centerX,r.centerY))})}return n}get nextFocusFormula(){return this.gN}set nextFocusFormula(e){this.gN=e}_O(){const e=this.a;if(!e)return;const t=e.currentTool;if(t instanceof ti){const n=t.currentObject;return this.v1(this.focus),t.maybeStopTool(this.focus),void(e.currentTool instanceof ti||(this.focus=n))}const i=this.focus,s=e.lastInput;if(null===i)s.control||s.meta?this.v1(null):this.focus=this.findFirstFocus();else if(i instanceof At)if(s.control||s.meta)this.v1(i);else{const n=this.SN(i);if(n.count>0)this.focus=n.first();else if(i instanceof gt&&i.isLabeledLink){const o=i.labelNodes.first();null!==o&&o.isVisible()&&(this.focus=o)}else if(i instanceof pt&&i.isSubGraphExpanded){const o=i.memberParts.first();null!==o&&o.isVisible()&&(this.focus=o)}}else this.v1(i)}XT(e){const t=new H,i=this.a;if(!i)return t;let s=0;for(;0===t.count&&s<i.nodes.count;){const n=i.nodes;for(;n.next();){const o=n.value;o.isTopLevel&&o.isVisible()&&(e?o.findNodesInto():o.findNodesOutOf()).count===s&&t.add(o)}s++}return t}SN(e){return e instanceof At?this.Sn(e,new H):new H}Sn(e,t){return!(e instanceof At)&&e.isVisibleObject()&&e.isEnabledObject()&&(e.contextMenu||e.click||e instanceof mt&&e.editable||e.part instanceof nt&&null!==e.portId&&(""!==e.portId||e.part.ports.count>1)||e.toolTip)&&t.add(e),e instanceof J&&e.elements.each(i=>this.Sn(i,t)),t}v1(e){const t=this.a;if(!t)return;const i=t.lastInput,s=e instanceof st?e:t;if(s.click){const n=new xe;n.diagram=t,n.documentPoint=e instanceof st?e.getDocumentPoint(A.Center):t.viewportBounds.center,n.viewPoint=t.transformDocToView(n.documentPoint),n.button=0,n.clickCount=1,n.targetObject=e,this.pd(n,!1),s instanceof st?s.click(n,s):s.click(n),t.lastInput=i}else s instanceof mt&&s.editable?this.editTextBlock(s):this.HT(e)}tI(){const e=this.a;if(!e)return;const t=e.currentTool;if(t instanceof Ue&&null!==t.currentToolTip)t.hideToolTip();else{if(t instanceof ti){const i=t.currentObject;return t.doKeyDown(),void(this.focus=i)}if(this.focus instanceof At){const i=this.focus;this.focus=i instanceof nt&&null!==i.labeledLink?i.labeledLink:null!==i.containingGroup?i.containingGroup:null}else if(this.focus instanceof st){const i=this.focus.part;if(i instanceof gt&&i.isLabeledLink){const s=i.labelNodes.first();if(null!==s&&s.isVisible())return void(this.focus=s)}else if(i instanceof pt&&i.isSubGraphExpanded){const s=i.memberParts.first();if(null!==s&&s.isVisible())return void(this.focus=s)}this.focus=i}else this.cancelVirtualPointer(),this.stopCommand()}}eI(){const e=this.a;if(e)if(e.lastInput.shift&&this.isVirtualPointerShown){const t=e.findPartAt(this.virtualPointerLocation);null!==t&&(t===this.focus?this.jT():this.focus=t)}else this.jT()}jT(){const e=this.a;if(!e)return;const t=e.lastInput,i=this.focus;if(i instanceof At){let s=i.part;if(t.control||t.meta){for(e.raiseDiagramEvent("ChangingSelection",e.selection);null!==s&&!s.canSelect();)s=s.containingGroup;null!==s&&(s.isSelected=!s.isSelected),e.raiseDiagramEvent("ChangedSelection",e.selection)}else if(t.shift){if(null!==s&&!s.isSelected){for(e.raiseDiagramEvent("ChangingSelection",e.selection);null!==s&&!s.canSelect();)s=s.containingGroup;null!==s&&(s.isSelected=!0),e.raiseDiagramEvent("ChangedSelection",e.selection)}}else if(null!==s&&!s.isSelected){for(;null!==s&&!s.canSelect();)s=s.containingGroup;null!==s&&e.select(s)}}this.HT(i),this.onFocusChanged(i,i)}HT(e){const t=this.a;if(!t)return;t.toolManager.hideToolTip();const i=t.lastInput;let s=e instanceof st?e:t;for(;s instanceof st&&!s.toolTip;)s=s.panel;if(s&&s.toolTip){const n=new xe;n.diagram=t,n.documentPoint=null!==e?e.getDocumentPoint(A.Center):t.viewportBounds.center,n.viewPoint=t.transformDocToView(n.documentPoint),n.targetObject=e,this.pd(n,!1),t.toolManager.showToolTip(s.toolTip,e),t.lastInput=i}}iI(){const e=this.a;if(!e)return;const t=this.focus;if(this.canShowContextMenu(t)){this.showContextMenu(t);const i=e.toolManager.contextMenuTool.currentContextMenu;if(i instanceof Nt){const s=this.SN(i);s.count>0&&(this.focus=s.first())}}}}var Ii=(m=>(m[m.None=0]="None",m[m.Default=1]="Default",m[m.Vertical=4]="Vertical",m[m.Horizontal=5]="Horizontal",m[m.Fill=2]="Fill",m))(Ii||{}),Bi=(m=>(m[m.None=0]="None",m[m.Along=21]="Along",m[m.Plus90=22]="Plus90",m[m.Minus90=23]="Minus90",m[m.Opposite=24]="Opposite",m[m.Upright=25]="Upright",m[m.Plus90Upright=26]="Plus90Upright",m[m.Minus90Upright=27]="Minus90Upright",m[m.Upright45=28]="Upright45",m))(Bi||{}),Is=(m=>(m[m.None=0]="None",m[m.Vertical=1]="Vertical",m[m.Horizontal=2]="Horizontal",m[m.Both=3]="Both",m))(Is||{});class st{n;zp;Xp;pa;w;ya;ft;ct;hi;Zt;Gp;Zs;Lt;cs;il;wa;Se;Th;it;Xt;sl;De;Ke;yd;de;wd;Ot;he;nl;F1;xa;df;constructor(){z.Je(this),this.n=30723,this.Zt=1,this.Gp="",this.Zs=null,this.Lt=null,this.ct=new S(NaN,NaN).k(),this.cs=lt.Zw,this.il=new Ot,this.wa=new Ot,this.Se=null,this.Th=1,this.it=1,this.Xt=0,this.sl=It.im,this.hi=new j(NaN,NaN,NaN,NaN).k(),this.De=new j(NaN,NaN,NaN,NaN).k(),this.Ke=new j(0,0,NaN,NaN).k(),this.yd=null,this.zp=null,this.ft=null,this.de=A.Default,this.wd=A.Default,this.Xp=0,this.pa=0,this.Ot=null,this.w=null,this.ya=null,this.he=null,this.F1=null,this.xa=null,this.nl=null,this.df=null}cloneProtected(e){e.n=-32769&this.n|6144,e.Zt=this.Zt,e.Gp=this.Gp,e.Lt=this.Lt,e.ct.h(this.ct),e.cs=this.cs.N(),e.Se=null!==this.Se?this.Se.copy():null,e.it=this.it,e.Xt=this.Xt,e.sl=this.sl.N(),e.hi.h(this.hi),e.De.h(this.De),e.Ke.h(this.Ke),e.zp=this.zp,null!==this.ft&&(e.ft=this.ft.copy()),e.de=this.de.N(),e.wd=this.wd.N(),e.Xp=this.Xp,e.pa=this.pa,null!==this.Ot&&(e.Ot=this.Ot.copy()),null!==this.w&&(e.w=this.w.me?this.w:this.w.copy()),null!==this.ya&&(e.ya=this.ya.slice()),null!==this.he&&(e.he=this.he.copy())}addCopyProperty(e){let t=this.ya;if(Array.isArray(t)){for(let i=0;i<t.length;i++)if(t[i]===e)return}else t=[],this.ya=t;t.push(e)}jo(e){e.yd=null,e.nl=null,e.c()}clone(){const e=new this.constructor;if(this.cloneProtected(e),null!==this.ya)for(let t=0;t<this.ya.length;t++){const i=this.ya[t];e[i]=this[i]}return e}copy(){return this.clone()}$S(){const e=this.ve;if(null!==e){this.ve=null;for(const t of e)t.xd()&&(t.isToData?this.themeData(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):t.isToObject?this.themeObject(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter,t.sourceName):t.isToModel?this.themeModel(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):this.theme(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter))}return this}fe(e){e in Bi?this.segmentOrientation=e:e in Ii?this.stretch=e:y.dr(this,e)}toString(){return y.Hn(this.constructor)+"#"+z.xs(this)}static None=0;static Default=1;static Fill=2;static Vertical;static Horizontal;static Uniform=6;static UniformToFill=7;static FlipVertical=1;static FlipHorizontal=2;static FlipBoth=3;ba(){null!==this.w&&(this.w.me=!0)}Yt(){return null===this.w?this.w=new qe:this.w.me&&(this.w=this.w.copy()),this.w}Ji(){if(null===this.ft){const e=new Ti;e.Dh=A.None,e.vh=A.None,e.Fh=10,e.Rh=10,e.Oh=0,e.Ih=0,this.ft=e}return this.ft}raiseChangedEvent(e,t,i,s,n,o,r){const a=this.part;if(null!==a){a.gf(e,t,i,s,n,o,r),i===this&&2===e&&this.mf()&&this.Eh(a,t);const l=this.diagram;if(null!==this.Ds&&null!==l&&l.Qa&&!l.undoManager.isUndoingRedoing&&!l.animationManager.Uu){const h=this.Ds.get(t);if(null!==h&&l.animationManager.isEnabled&&!l.animationManager.isTicking){null===this.df&&(this.df=new xt);let c=0===l.undoManager.transactionLevel;if(2===h.startCondition?c=!0:3===h.startCondition&&(c=!1),c){const u=new Si;h.RR(u);const d=this.df.get(h);null!==d&&d.stop(),this.df.set(h,u),u.tb=this,u.DM=h,u.add(this,t,s,n),u.start()}else l.animationManager.getBundleAnimation().add(this,t,s,n)}}if(this instanceof J&&i===a&&a.MN()&&null!==a.data){const h=this.D.r,c=h.length;for(let u=0;u<c;u++){const d=h[u];d instanceof J&&d.Sn(f=>{null!==f.data&&f.MN()&&f.updateTargetBindings(t)})}}}}TR(e){this.df&&this.df.delete(e)}Yo(){if(null!==this.diagram&&null===this.findBindingPanel()&&null!==this.ve){const e=this.diagram.model,t=this.ve.iterator;for(;t.next();){const i=t.value;if(!i.isToTheme)continue;let s=null;const n=i.sourceName;i.isToObject&&(s=this.qT(n));let o=this;const r=i.targetId;-1!==r&&(o=this.Yp(r),null===o)||("/"===n?s=o.part:"."===n?s=o:".."===n&&(s=o.panel),i.updateTarget(o,s,void 0,e))}}}Eh(e,t){const i=this.findBindingPanel();if(null!==i){const s=e.diagram,n=this.ve.iterator;for(;n.next();){const o=n.value;let r=null;if(o.isToObject){if(r=o.WT(i,this),null===r)continue;o.updateSource(this,r,t,null)}else if(o.isToModel)null!==s&&!s.wi&&o.updateSource(this,s.model.modelData,t,i);else if(!o.isToTheme){const a=i.data;if(null===a)continue;null!==s&&!s.wi&&o.updateSource(this,a,t,i)}if(r===this){const l=i.Yp(o.targetId);null!==l&&o.updateTarget(l,r,t,s?.model)}}}}Yp(e){return this.oo===e?this:null}qT(e){let t;return t=""===e||"/"===e||"."===e||".."===e?this:this.part.findObject(e),t}get oo(){return null!==this.w?this.w.oo:-1}set oo(e){this.oo!==e&&(null===this.w&&(this.w=new qe),this.w.oo=e)}get ve(){return null!==this.w?this.w.ve:null}set ve(e){this.ve!==e&&(null===this.w&&(this.w=new qe),this.w.ve=e)}get ro(){return null!==this.w?this.w.ro:null}set ro(e){this.ro!==e&&(null===this.w&&(this.w=new qe),this.w.ro=e)}raiseChanged(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}t(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}lo(e,t,i,s){const n=this.hi;if(n.e(e,t,i,s),1!==this.it||0!==this.Xt){null===this.Se&&(this.Se=new Ot);const o=this.Se;o.Ue(),this.Kp(o,e,t,i,s),o.sm(n)}}JT(e,t,i){return!1!==this.pickable&&(i.kc(this.v),t?this.intersectsRect(e,i):this.containedInRect(e,i))}$T(e,t,i){if(!1===this.pickable)return!1;const s=this.naturalBounds,n=e.distanceSquaredPoint(t);return i?S.distanceLineSegmentSquared(e.x,e.y,0,0,0,s.height)<=n||S.distanceLineSegmentSquared(e.x,e.y,0,s.height,s.width,s.height)<=n||S.distanceLineSegmentSquared(e.x,e.y,s.width,s.height,s.width,0)<=n||S.distanceLineSegmentSquared(e.x,e.y,s.width,0,0,0)<=n:e.distanceSquared(0,0)<=n&&e.distanceSquared(0,s.height)<=n&&e.distanceSquared(s.width,0)<=n&&e.distanceSquared(s.width,s.height)<=n}Nn(){return!0}containsPoint(e){const t=S.l();t.h(e),this.v.gt(t);const i=this.actualBounds;if(!i.isReal())return S.i(t),!1;const s=this.diagram;if(null!==s&&s.pp){const o=s.getInputOption("extraTouchThreshold"),r=s.getInputOption("extraTouchArea"),a=r/2,l=this.naturalBounds,h=this.getDocumentScale()*s.scale,c=1/h;if(l.width*h<o&&l.height*h<o){const u=j.contains(i.x-a*c,i.y-a*c,i.width+r*c,i.height+r*c,t.x,t.y);return S.i(t),u}}let n=!1;return(this instanceof Nt||this instanceof rt?j.contains(i.x-5,i.y-5,i.width+10,i.height+10,t.x,t.y):i.containsPoint(t))&&(n=!(this.he&&!this.he.containsPoint(t))&&(!(null===this.Lt||!this.Ke.containsPoint(e))||this.ka(e))),S.i(t),n}ka(e){const t=this.naturalBounds;return j.contains(0,0,t.width,t.height,e.x,e.y)}containsRect(e){if(0===this.angle)return this.actualBounds.containsRect(e);const t=this.naturalBounds,i=j.z(0,0,t.width,t.height),s=this.v;let n=!1;const o=S.z(e.x,e.y);return i.containsPoint(s.Ci(o))&&(o.e(e.x,e.bottom),i.containsPoint(s.Ci(o))&&(o.e(e.right,e.bottom),i.containsPoint(s.Ci(o))&&(o.e(e.right,e.y),i.containsPoint(s.Ci(o))&&(n=!0)))),S.i(o),j.i(i),n}containedInRect(e,t){if(void 0===t)return e.containsRect(this.actualBounds);const i=this.naturalBounds,s=t;let n=!1;const o=S.z(0,0);return e.containsPoint(s.gt(o))&&(o.e(0,i.height),e.containsPoint(s.gt(o))&&(o.e(i.width,i.height),e.containsPoint(s.gt(o))&&(o.e(i.width,0),e.containsPoint(s.gt(o))&&(n=!0)))),S.i(o),n}intersectsRect(e,t){if(void 0===t&&(t=this.v,0===this.angle))return e.intersectsRect(this.actualBounds);const i=this.naturalBounds,s=t,n=S.z(0,0),o=S.z(0,i.height),r=S.z(i.width,i.height),a=S.z(i.width,0);let l=!1;if(e.containsPoint(s.gt(n))||e.containsPoint(s.gt(o))||e.containsPoint(s.gt(r))||e.containsPoint(s.gt(a)))l=!0;else{const h=j.z(0,0,i.width,i.height),c=S.z(e.x,e.y);h.containsPoint(s.Ci(c))?l=!0:(c.e(e.x,e.bottom),h.containsPoint(s.Ci(c))?l=!0:(c.e(e.right,e.bottom),h.containsPoint(s.Ci(c))?l=!0:(c.e(e.right,e.y),h.containsPoint(s.Ci(c))&&(l=!0)))),S.i(c),j.i(h),l||(L.lx(e,n,o)||L.lx(e,o,r)||L.lx(e,r,a)||L.lx(e,a,n))&&(l=!0)}return S.i(n),S.i(o),S.i(r),S.i(a),l}getDocumentPoint(e,t){if(void 0===t&&(t=new S),e instanceof A){const s=this.naturalBounds;return t.e(e.x*s.width+e.offsetX,e.y*s.height+e.offsetY),this.Js.gt(t),t}return t.set(e),this.Js.gt(t),t}getDocumentBounds(e){void 0===e&&(e=new j);const t=this.naturalBounds,i=this.Js,s=S.z(0,0).v(i);return e.e(s.x,s.y,0,0),s.e(t.width,0).v(i),e.re(s.x,s.y,0,0),s.e(t.width,t.height).v(i),e.re(s.x,s.y,0,0),s.e(0,t.height).v(i),e.re(s.x,s.y,0,0),S.i(s),e}getDocumentAngle(){return this.Js.YF()}getDocumentScale(){if(!1===this.Hp())return this.Th;const e=this.it;return null!==this.panel?e*this.panel.getDocumentScale():e}getLocalPoint(e,t){return void 0===t&&(t=new S),t.h(e),this.Js.Ci(t),t}getNearestIntersectionPoint(e,t,i){return this.pf(e.x,e.y,t.x,t.y,i)}pf(e,t,i,s,n){const o=this.v,r=1/(o.m11*o.m22-o.m12*o.m21),a=o.m22*r,l=-o.m12*r,h=-o.m21*r,c=o.m11*r,u=r*(o.m21*o.dy-o.m22*o.dx),d=r*(o.m12*o.dx-o.m11*o.dy),f=e*a+t*h+u,p=e*l+t*c+d,g=i*a+s*h+u,b=i*l+s*c+d;n.e(0,0);const x=this.naturalBounds,v=L.Cl(0,0,x.width,x.height,f,p,g,b,n);return n.v(o),v}ht(e,t,i,s){if(!1===this.Go())return;const n=this.sl,o=n.right+n.left,r=n.top+n.bottom;e=Math.max(e-o,0),t=Math.max(t-r,0),i=i||0,s=s||0,i=Math.max(i-o,0),s=Math.max(s-r,0);const a=this.angle;let l=0;const h=this.desiredSize,c=this.jp();90===a||270===a?(e=isFinite(h.height)?h.height+c:e,t=isFinite(h.width)?h.width+c:t):(e=isFinite(h.width)?h.width+c:e,t=isFinite(h.height)?h.height+c:t);let u=i||0,d=s||0;const f=this instanceof J;switch(this.Qs(!0)){case 0:u=0,d=0,f&&(e=1/0,t=1/0);break;case 2:isFinite(e)&&e>i&&(u=e),isFinite(t)&&t>s&&(d=t);break;case 5:isFinite(e)&&e>i&&(u=e),d=0,f&&(t=1/0);break;case 4:isFinite(t)&&t>s&&(d=t),u=0,f&&(e=1/0)}const p=this.maxSize,g=this.minSize;u>p.width&&g.width<p.width&&(u=p.width),d>p.height&&g.height<p.height&&(d=p.height),i=Math.max(u,g.width),s=Math.max(d,g.height),p.width<i&&(i=Math.min(g.width,i)),p.height<s&&(s=Math.min(g.height,s)),e=Math.min(p.width,e),t=Math.min(p.height,t),e=Math.max(i,e),t=Math.max(s,t),(90===a||270===a)&&(l=e,e=t,t=l,l=i,i=s,s=l),this.hi.ce(),this.bd(e,t,i,s),this.hi.k(),this.hi.isReal()||y.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.hi.toString()),this.xi(!1)}bd(e,t,i,s){}_s(){return!1}Ut(e,t,i,s,n){this.yf();const o=j.l();o.h(this.De),this.De.ce(),!1===this.as()?this.De.e(e,t,i,s):this.Pa(e,t,i,s),this.De.k(),this.he=void 0===n?null:n;let r=!1;if(void 0!==n)r=!0;else{let a=this.panel;if(null!==a&&a.ol()&&(a=a.panel),null!==a){const l=a.Ke,h=this.measuredBounds;if(r=!(0<=e+.05&&e+h.width<=l.width+.05&&0<=t+.05&&t+h.height<=l.height+.05),this instanceof mt){const d=this.naturalBounds;(this.qp>d.height||this.pe>d.width)&&(r=!0)}}}r?this.n|=256:this.n&=-257,this.De.isReal()||y.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.De.toString()),this.kd(o,this.De),this.ao(!1),j.i(o)}Pa(e,t,i,s){}commonArrange(e,t,i,s){if(this.De.e(e,t,i,s),this.desiredSize.isReal())return;const n=this.hi,o=this.sl,r=o.right+o.left,a=o.top+o.bottom,l=n.width+r,h=n.height+a;i+=r,s+=a;let c=this.Qs(!0);switch(l===i&&h===s&&(c=0),c){case 0:(l>i||h>s)&&(this.xi(!0),this.ht(l>i?i:l,h>s?s:h,0,0));break;case 2:this.xi(!0),this.ht(i,s,0,0);break;case 5:this.xi(!0),this.ht(i,h,0,0);break;case 4:this.xi(!0),this.ht(l,s,0,0)}}kd(e,t){const i=this.part;null!==i&&null!==i.diagram&&((i.selectionObject===this||i.resizeObject===this||i.rotateObject===this)&&i.NN(!0),this.C(),!e.equalsApproxClose(t)&&(i.Sa(),this.Wp(i)))}Wp(e){null!==this.portId&&(e.NN(!0),e instanceof nt&&e.invalidateConnectedLinks(void 0,this))}get shadowVisible(){return null!==this.w?this.w.Jp:null}set shadowVisible(e){const t=this.shadowVisible;t!==e&&(this.Yt().Jp=e,this.$i(!0),this.C(),this.t("shadowVisible",t,e))}oI(e,t){const i=this.naturalBounds,s=this.wa,n=s.m11,o=s.m21,r=s.dx,a=s.m12,l=s.m22,h=s.dy;let c=0,u=0,d=c,f=u;c=d*n+f*o+r,u=d*a+f*l+h;let p=c,g=u,b=0,x=0;d=i.width+t,f=0,c=d*n+f*o+r,u=d*a+f*l+h;let v=Math.min(p,c),P=Math.min(g,u);b=Math.max(p+b,c)-v,x=Math.max(g+x,u)-P,p=v,g=P,d=i.width+t,f=i.height+t,c=d*n+f*o+r,u=d*a+f*l+h,v=Math.min(p,c),P=Math.min(g,u),b=Math.max(p+b,c)-v,x=Math.max(g+x,u)-P,p=v,g=P,d=0,f=i.height+t,c=d*n+f*o+r,u=d*a+f*l+h,v=Math.min(p,c),P=Math.min(g,u),b=Math.max(p+b,c)-v,x=Math.max(g+x,u)-P,p=v,g=P;const w=e.viewportBounds,M=w.x,C=w.y;return p>w.width+M||M>b+p||g>w.height+C||C>x+g}Ge(e,t){if(this.rI(e,t)||!this.visible)return;const i=this.opacity;if(0===i)return;let s=1;1!==i&&(s=e.globalAlpha,e.globalAlpha=s*i);let n="";""!==this.filter&&(n=e.filter,e.filter=this.filter);const o=this.v,r=this.panel;!0===this.Hp()&&this.R1();const a=this.part;let l=!1,h=0;if(a&&t.getRenderingHint("drawShadows")&&(l=a.isShadowed,l)){const g=a.shadowOffset;h=Math.max(g.y,g.x)*t.scale*t.$e}const c=this instanceof J&&this.ol(),u=this.De;if(c&&(this.ZT(l,e,!1,r),this.lI(e,t),this.QT(l,e,!1,r),this._T(l,e,!1)),c||!c&&(0===u.width||0===u.height||isNaN(u.x)||isNaN(u.y)))return 1!==i&&(e.globalAlpha=s),void(""!==this.filter&&(e.filter=n));const d=this._s();if(!t.ph&&d&&this.oI(t,h))return 1!==i&&(e.globalAlpha=s),void(""!==this.filter&&(e.filter=n));let f=!!(256&this.n);if(e.clipInsteadOfFill&&(f=!1),this instanceof mt&&(e.font=this.font),f){const g=r.Nn()?r.naturalBounds:r.actualBounds;let b=Math.max(u.x,g.x),x=Math.max(u.y,g.y),v=Math.min(u.right,g.right)-b,P=Math.min(u.bottom,g.bottom)-x;const w=this.he;if(null!==w&&(b=w.x,x=w.y,v=w.width,P=w.height),b>u.width+u.x||u.x>g.width+g.x)return 1!==i&&(e.globalAlpha=s),void(""!==this.filter&&(e.filter=n));e.save(),e.beginPath(),e.rect(b,x,v,P),e.clip()}if(d){if(!a.isVisible())return 1!==i&&(e.globalAlpha=s),void(""!==this.filter&&(e.filter=n));if(l){const g=a.shadowOffset;e.shadowsSet(g.x*t.scale*this.scale*t.$e,g.y*t.scale*this.scale*t.$e,a.shadowBlur),e.shadowsOn(),e.shadowColor=a.shadowColor}}const p=this.naturalBounds;if(e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.ZT(l,e,d,r),null!==this.Lt&&(e.commitTransform(),this.O1(e,p,u)),this.QT(l,e,d,r),this.Ma(e,t),this._T(l,e,d),f&&(e.restore(),e.clearContextCache(this instanceof J)),!o.RP()){const g=1/(o.m11*o.m22-o.m12*o.m21);e.transform(o.m22*g,-o.m12*g,-o.m21*g,o.m11*g,g*(o.m21*o.dy-o.m22*o.dx),g*(o.m12*o.dx-o.m11*o.dy))}1!==i&&(e.globalAlpha=s),""!==this.filter&&(e.filter=n)}ZT(e,t,i,s){e&&!0===this.shadowVisible?t.shadowsOn():e&&!1===this.shadowVisible&&t.shadowsOff(),e&&this.I1(s)&&null===this.shadowVisible&&t.shadowsOff()}QT(e,t,i,s){e&&(null!==this.Lt||this.I1(s))?(this.E1(!0),null===this.shadowVisible&&t.shadowsOff()):this.E1(!1)}_T(e,t,i){e&&!0===this.CN()&&t.shadowsOn(),i&&e&&t.shadowsOff()}aI(e,t,i){const s=this.part;let n=!1;s&&e.getRenderingHint("drawShadows")&&(n=s.isShadowed),t.clipInsteadOfFill&&(n=!1),this._s()&&n&&t.shadowsOn(),n&&!0===this.shadowVisible?t.shadowsOn():n&&!1===this.shadowVisible&&t.shadowsOff();const o=this.panel;if(n&&this.I1(o)&&null===this.shadowVisible&&t.shadowsOff(),t.rl){const r=e.computePixelRatio();null!==this.background&&i.Lt.setAttributeNS(null,"filter",`drop-shadow(${t.shadowOffsetX/r}px ${t.shadowOffsetY/r}px ${t.shadowBlur/r/2}px ${t.shadowColor})`)}return n&&(null!==this.Lt||this.I1(o))?(this.E1(!0),null===this.shadowVisible&&t.shadowsOff()):this.E1(!1),n}hI(e,t,i,s){if(i.rl){const n=t.computePixelRatio();this.LN(e,`drop-shadow(${i.shadowOffsetX/n}px ${i.shadowOffsetY/n}px ${i.shadowBlur/n/2}px ${i.shadowColor})`)}s&&!0===this.CN()&&i.shadowsOn(),this._s()&&i.shadowsOff()}I1(e){return null!==e&&(e.ol()&&(e=e.panel),e.CN()||(e.type===J.Auto||e.type===J.Spot)&&e.findMainElement()!==this)}LN(e,t){}O1(e,t,i){const s=this.jp(),n=t.x,o=t.y,r=t.width+s,a=t.height+s;this.kn(e,this.Lt,!0,!1,t,i),this.Lt instanceof V&&3===this.Lt.type?(e.beginPath(),e.rect(n-s/2,o-s/2,r,a),e.fillContext(this.Lt,!1,null)):e.fillRect(n-s/2,o-s/2,r,a)}tD(e,t){let i=e.cI(this);const s=null!==e.xa?e.xa:e.svg;if(null!==s&&-1!==i){for(;0!==i&&!e.elt(i-1).isVisibleObject();)i--;if(0===i)this.fI(e,t,s);else{const n=e.elt(i-1).svg;null!==n?n.after(t):s.appendChild(t)}}}fI(e,t,i){if(e.type===J.Table){const s=i.getElementsByClassName("gojs-ts"),n=0!==s.length?s[0]:null;null!==n&&n.after(t)}else i.Lt?i.Lt.after(t):i.prepend(t)}rI(e,t){if(!(e instanceof he))return!1;if(!this.visible||0===this.opacity)return null!==this.svg&&null!==this.svg.parentNode&&this.svg.remove(),!0;const i=this.De;if(this._s()&&(!this.isVisible()||0===i.width||0===i.height||isNaN(i.x)||isNaN(i.y)))return null!==this.svg&&null!==this.svg.parentNode&&this.svg.remove(),!0;e.setCurrentTransform(1,0,0,1,0,0);const s=this.panel,n=this.Pd(e);if(this.wf(e,t,n))return this.eD(this.svg),null!==this.svg.parentElement?(this._s()&&(e.lastDrawnPart=this.svg),!0):(this._s()?(null!==e.lastDrawnPart?e.lastDrawnPart.after(this.svg):e.diagramGroup.prepend(this.svg),e.lastDrawnPart=this.svg):s&&this.tD(s,this.svg),!0);if(this.$i(!1),this._s()&&this.isShadowed){const p=this.shadowOffset;e.shadowsSet(p.x*t.scale*this.scale*t.$e,p.y*t.scale*this.scale*t.$e,this.shadowBlur),e.shadowsOn(),e.shadowColor=this.shadowColor}this instanceof mt&&(e.font=this.font),e.currentElement=null;const o=this.v,r=this instanceof J,a=this instanceof J&&this.ol(),l=this.svg;if(!0===this.Hp()&&this.R1(),e.outerGroup=!1,n)if(e.outerGroup=!0,r&&a)e.newGroup(1,0,0,1,0,0),this.svg=e.lastCreatedElement;else if(r&&this.isClipping){const p=this.findMainElement();let g=0,b=0;null!==p&&(g=p.actualBounds.x,b=p.actualBounds.y),e.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx+g,o.dy+b),this.svg=e.lastCreatedElement,null!==p&&e.createOrUpdateClipGroup(this,p.actualBounds),e.currentElement=e.lastCreatedElement}else r?(e.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.svg=e.lastCreatedElement):e.newGroup(1,0,0,1,0,0);const h=this.naturalBounds;r||e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),null!==this.background&&(r?(a&&e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(e,h,i),a&&e.setCurrentTransform(1,0,0,1,0,0)):(e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(e,h,i)),e.currentElement.Lt=e.lastCreatedElement,e.currentElement.prepend(e.lastCreatedElement));const c=this.aI(t,e,e.currentElement);this.Ma(e,t),r&&e.endGroup(),e.outerGroup&&e.endGroup();const u=e.surface.ud,d=r?this.svg:e.currentElement;if(null!==l&&null!==l.parentNode&&d!==l&&(null===this.panel||l.parentNode===this.panel.svg)){const p=this.svg.getAttribute("filter");return null!==p&&d.setAttribute("filter",p),""!==this.filter&&d.setAttributeNS(null,"filter",this.filter),l.replaceWith(d),this.svg=d,null!==d&&this.$p(e,s,i,d),!0}if(this.svg=d,null!==u&&null===d&&e.dummyGroup(),null===d)return!0;this.$p(e,s,i,d),this.hI(d,t,e,c);const f=this._s()?this.opacity*e.globalAlpha:this.opacity;if(1!==f&&d.setAttributeNS(null,"opacity",f.toString()),""!==this.filter&&d.setAttributeNS(null,"filter",this.filter),this._s()){if(null!==l&&d!==l&&l.parentNode===e.diagramGroup){const p=l.getAttribute("filter");null!==p&&d.setAttribute("filter",p),l.replaceWith(d)}else e.lastDrawnPart?e.lastDrawnPart.after(d):e.diagramGroup.prepend(d);e.lastDrawnPart=d}else null!==s&&this.tD(s,d);return null!==u&&u(this,d),this.eD(d),!0}eD(e){const t=this,i=e.dataset;t instanceof st&&(null!==t.portId&&(i.portId=t.portId),t instanceof J&&(isNaN(t.itemIndex)||(i.itemIndex=t.itemIndex.toString()),t instanceof At&&(i.className=y.Hn(t),void 0!==t.key&&(i.key=t.key.toString()),null!==t.containingGroup&&(i.group=t.containingGroup.key.toString()),t instanceof gt&&(null!==t.fromNode&&void 0!==t.fromNode.key&&(i.fromKey=t.fromNode.key.toString()),""!==t.fromPortId&&(i.fromPortId=t.fromPortId),null!==t.toNode&&void 0!==t.toNode.key&&(i.toKey=t.toNode.key.toString()),""!==t.toPortId&&(i.toPortId=t.toPortId)))))}$p(e,t,i,s){let n=!!(256&this.n);if(e.clipInsteadOfFill&&(n=!1),!n)return void s.removeAttributeNS(null,"clip-path");const o=t.Nn()?t.naturalBounds:t.actualBounds;let r=Math.max(i.x,o.x),a=Math.max(i.y,o.y),l=Math.min(i.right,o.right)-r,h=Math.min(i.bottom,o.bottom)-a;const c=this.he;null!==c&&(r=c.x,a=c.y,l=c.width,h=c.height);const u=j.z(r,a,Math.max(l,0),Math.max(h,0));if(this instanceof J){const d=Ot.l();d.set(this.v),d.ex(),d.sm(u),Ot.i(d)}s.setAttributeNS(null,"clip-path",`path('      M ${u.x},${u.y}       L ${u.width+u.x} ${u.y}       L ${u.width+u.x} ${u.height+u.y}       L ${u.x} ${u.height+u.y} z') view-box`),j.i(u)}uI(){if(null===this.svg)return;const e=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),t=this.svg.ownerDocument;if(null!==e)for(const i of e){const s=t.getElementById(i.split("#")[1].slice(0,-1));null!==s&&s.remove()}this.svg.remove()}lI(e,t){const i=this.De,s=this.Ke,n=this.Lt;null!==n&&e.commitTransform(),null!==n&&(this.kn(e,n,!0,!1,s,i),n instanceof V&&3===n.type?(e.beginPath(),e.rect(i.x,i.y,i.width,i.height),e.fillContext(n,!1,null)):e.fillRect(i.x,i.y,i.width,i.height)),this.Ma(e,t)}Ma(e,t){}xf(){this.$i(!0)}wf(e,t,i){const s=this.svg;if(this.dI()){if(this.xf(),this.$i(!1),null===s)return!1;const c=s.getAttribute("clip-path");if(null!==c&&c.includes("url")){const u=e.svg.getElementById(c.split("#")[1].slice(0,-1));null!==u&&u.remove()}return s.getAttribute("filter")&&s.removeAttribute("filter"),!1}if(null===s)return!1;if(!this.visible)return s.remove(),!1;if("g"!==s.nodeName&&i||"g"===s.nodeName&&!i)return!1;const n=this.v,o="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",r=this instanceof J,a=!!r&&this.ol();if(!r||!a)if(this instanceof Kt){const c=this.U1;e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),null!==c&&e.amendImageTransform(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]),i?s.lastElementChild.setAttributeNS(null,"transform",e.getCurrentTransform()):s.setAttributeNS(null,"transform",e.getCurrentTransform())}else if(i&&!r)if(this instanceof rt){const c=s.getElementsByTagName("path");for(let u=0;u<c.length;u++)c[u].setAttributeNS(null,"transform",o)}else if(this instanceof mt){const c=s.getElementsByTagName("text"),u="string"==typeof this.stroke?this.stroke:null;for(let d=0;d<c.length;d++)c[d].setAttributeNS(null,"transform",o),u&&c[d].setAttributeNS(null,"fill",u)}else(s.lastElementChild||s).setAttributeNS(null,"transform",o);else if(r&&this.isClipping&&this.xa){const c=this.findMainElement(),u=null!==c?c.actualBounds.x:0,d=null!==c?c.actualBounds.y:0;this.xa.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-u+", "+-d+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+u)+", "+(n.dy+d)+")")}else s.setAttributeNS(null,"transform",o);const l=this._s()?this.opacity*e.globalAlpha:this.opacity;1===l?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",l.toString()),e.setCurrentTransform(1,0,0,1,0,0);const h=this.xa?this.xa:this.F1;if(null!==this.background||void 0!==h.Lt){const c=h.Lt;if(null===this.background)e.removeOldGradient(this,h.Lt,"fill"),h.Lt.remove(),h.Lt=void 0;else{if((a||i&&!(this instanceof J))&&e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.O1(e,this.naturalBounds,this.actualBounds),h.Lt){e.removeOldGradient(this,h.Lt,"fill");const u=h.Lt.getAttribute("filter");null!==u&&e.lastCreatedElement.setAttribute("filter",u),h.Lt.replaceWith(e.lastCreatedElement)}else h.prepend(e.lastCreatedElement);h.Lt=e.lastCreatedElement}c&&e.removeOldGradient(this,c,"fill")}return this.$p(e,this.panel,this.actualBounds,s),!0}Pd(e){if(null!==this.background)return!0;let t=!!(256&this.n);return e.clipInsteadOfFill&&(t=!1),!!t}static UU(e,t,i,s,n,o,r){let a=.001;const l=o.length;e.moveTo(t,i);let h=s-t;const c=n-i;0===h&&(h=.001);const u=c/h;let d=Math.sqrt(h*h+c*c),f=0,p=!0;a=o[f%l];let g=0!==r;for(;d>=.1;){if(g){for(a=o[f++%l],a-=r;a<0;)a+=o[f++%l],p=!p;g=!1}else a=o[f++%l];a>d&&(a=d);let b=Math.sqrt(a*a/(1+u*u));h<0&&(b=-b),t+=b,i+=u*b,p?e.lineTo(t,i):e.moveTo(t,i),d-=a,p=!p}}kn(e,t,i,s,n,o){let l,r=1,a=1;if("string"==typeof t)return void(i?e.fillStyle=t:e.strokeStyle=t);if(1===t.type)return void(i?e.fillStyle=t.color:e.strokeStyle=t.color);const h=this.jp();r=n.width,a=n.height,s?(r=o.width,a=o.height):i||(r+=h,a+=h);const c=e instanceof gi;if(c&&t.Cn&&(4===t.type||t.bf===r&&t.V1===a))l=t.Cn;else{let u=0,d=0,f=0,p=0,g=0,b=0,x=0,v=0;if(s?(x=o.x,v=o.y):i||(x-=h/2,v-=h/2),u=t.start.x*r+t.start.offsetX+x,d=t.start.y*a+t.start.offsetY+v,f=t.end.x*r+t.end.offsetX+x,p=t.end.y*a+t.end.offsetY+v,2===t.type)l=e.createLinearGradient(u,d,f,p);else if(3===t.type)b=isNaN(t.endRadius)?Math.max(r,a)/2:t.endRadius,isNaN(t.startRadius)?(g=0,b=Math.max(r,a)/2):g=t.startRadius,l=e.createRadialGradient(u,d,g,f,p,b);else if(4===t.type)try{l=e.createPattern(t.pattern,"repeat")}catch{l=null}else y.si(t.type,"Brush type");if(4!==t.type){const P=t.colorStops;if(null!==P){const w=P.iterator;for(;w.next();)l.addColorStop(w.key,w.value)}}if(c&&(t.Cn=l,null!==l&&(t.bf=r,t.V1=a),null===l&&4===t.type&&-1!==t.bf)){t.bf=-1;const P=this.diagram;null!==P&&-1===t.bf&&y.dn(()=>{P.redraw()},600)}}i?e.fillStyle=l:e.strokeStyle=l}isContainedBy(e){return e instanceof J&&this.gI(this,e)}gI(e,t){if(e===t||null===t)return!1;let i=e.panel;for(;null!==i;){if(i===t)return!0;i=i.panel}return!1}isVisibleObject(){if(!this.visible)return!1;const e=this.panel;return null===e||e.isVisibleObject()}isEnabledObject(){let e=this instanceof J?this:this.panel;for(;null!==e&&e.isEnabled;)e=e.panel;return null===e}get enabledChanged(){return null!==this.w?this.w.Zp:null}set enabledChanged(e){const t=this.enabledChanged;t!==e&&(null!==e&&y.S(e,st,"enabledChanged"),this.Yt().Zp=e,this.t("enabledChanged",t,e))}R1(){if(!0===this.B1()){const e=this.il;if(e.Ue(),!this.De.isReal()||!this.hi.isReal())return void this.Sd(!1);if(e.Gs(this.De.x-this.hi.x,this.De.y-this.hi.y),1!==this.scale||0!==this.angle){const t=this.naturalBounds;this.Kp(e,t.x,t.y,t.width,t.height)}this.Sd(!1),this.Uh(!0)}if(!0===this.Hp()){const e=this.panel;if(null===e)this.wa.set(this.il),this.Th=this.scale;else if(null!==e.Js){const t=this.wa;t.Ue(),e.Nn()?t.kc(e.wa):null!==e.panel&&t.kc(e.panel.wa),t.kc(this.il),this.Th=this.scale*e.Th}this.Uh(!1)}}Kp(e,t,i,s,n){if(1!==this.it&&e.it(this.it),0===this.Xt)return;const o=S.l();o.setSpot(t,i,s,n,A.Center),e.ks(this.Xt,o.x,o.y),S.i(o)}c(e){if(this.Go())return;void 0===e&&(e=!1),this.xi(!0),this.ao(!0);const t=this.panel;null!==t&&!e&&t.c()}kf(){this.Go()||(this.xi(!0),this.ao(!0))}Pf(e){if(this.as())return;const t=this.panel;!e&&null!==t&&t.c(),this.ao(!0)}yf(){!1===this.B1()&&(this.Sd(!0),this.Uh(!0))}AN(){this.Uh(!0)}C(){const e=this.part;null!==e&&e.C()}Qs(e){const t=this.stretch,i=this.panel;if(null===i)return this.qo(1===t?0:t,e);if(i.type===J.Table)return this.Qp(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),e);if(i.type===J.Auto&&i.findMainElement()===this)return this.qo(2,e);if(1===t){if(i.type===J.Spot&&i.findMainElement()===this)return this.qo(2,e);const s=i.defaultStretch;return this.qo(1===s?0:s,e)}return this.qo(t,e)}Qp(e,t,i){const s=this.stretch;if(1!==s)return this.qo(s,i);let n=null,o=null;switch(e.stretch){case 1:case 5:break;case 4:case 2:o=!0}switch(t.stretch){case 1:case 4:break;case 5:case 2:n=!0}const r=this.panel.defaultStretch;return null===n&&(n=5===r||2===r),null===o&&(o=4===r||2===r),this.qo(!0===n&&!0===o?2:!0===n?5:!0===o?4:0,i)}qo(e,t){if(t)return e;if(0===e)return 0;const i=this.desiredSize;if(i.isReal())return 0;const s=!isNaN(i.width),n=!isNaN(i.height),o=this.angle;if(s)if(90!==o&&270!==o){if(5===e)return 0;if(2===e)return 4}else{if(4===e)return 0;if(2===e)return 5}if(n)if(90!==o&&270!==o){if(4===e)return 0;if(2===e)return 5}else{if(5===e)return 0;if(2===e)return 4}return e}get segmentOrientation(){return null!==this.Ot?this.Ot._p:0}set segmentOrientation(e){const t=this.segmentOrientation;t!==e&&(null===this.Ot&&(this.Ot=new Ee),this.Ot._p=e,this.c(),this.t("segmentOrientation",t,e),0===e&&(this.angle=0))}mI(){this.segmentOrientation=21}get segmentIndex(){return null!==this.Ot?this.Ot.t0:-1/0}set segmentIndex(e){e=Math.round(e);const t=this.segmentIndex;t!==e&&(null===this.Ot&&(this.Ot=new Ee),this.Ot.t0=e,this.c(),this.t("segmentIndex",t,e))}get segmentFraction(){return null!==this.Ot?this.Ot.e0:0}set segmentFraction(e){e<0?e=0:e>1&&(e=1);const t=this.segmentFraction;t!==e&&(null===this.Ot&&(this.Ot=new Ee),this.Ot.e0=e,this.c(),this.t("segmentFraction",t,e))}get segmentOffset(){return null!==this.Ot?this.Ot.i0:S.gn}set segmentOffset(e){const t=this.segmentOffset;t.equals(e)||(e=e.N(),null===this.Ot&&(this.Ot=new Ee),this.Ot.i0=e,this.c(),this.t("segmentOffset",t,e))}get stretch(){return null!==this.w?this.w.ho:1}set stretch(e){const t=this.stretch;t!==e&&(this.Yt().ho=e,this.c(),this.t("stretch",t,e))}get name(){return null!==this.w?this.w.Pt:""}set name(e){const t=this.name;t!==e&&(this.Yt().Pt=e,null!==this.part&&this.part.s0(),this.t("name",t,e))}get opacity(){return this.Zt}set opacity(e){e<0?e=0:e>1&&(e=1);const t=this.opacity;if(t!==e){this.Zt=e,this.t("opacity",t,e);const i=this.diagram,s=this.part;null!==i&&null!==s&&i.C(s.hh(s.actualBounds))}}get filter(){return this.Gp}set filter(e){const t=this.filter;if(t!==e){this.Gp=e,this.$i(!0),this.t("filter",t,e);const i=this.diagram,s=this.part;null!==i&&null!==s&&i.C(s.hh(s.actualBounds))}}get visible(){return!!(1&this.n)}set visible(e){const t=!!(1&this.n);if(t!==e){this.n=1^this.n,this.xf(),this.t("visible",t,e);const i=this.panel;null!==i?i.c():this._s()&&this.Xe(e),this.C(),this.iD()}}get pickable(){return!!(2&this.n)}set pickable(e){const t=!!(2&this.n);t!==e&&(this.n=2^this.n,this.t("pickable",t,e))}get fromLinkableDuplicates(){return!!(4&this.n)}set fromLinkableDuplicates(e){const t=!!(4&this.n);t!==e&&(this.n=4^this.n,this.t("fromLinkableDuplicates",t,e))}get fromLinkableSelfNode(){return!!(8&this.n)}set fromLinkableSelfNode(e){const t=!!(8&this.n);t!==e&&(this.n=8^this.n,this.t("fromLinkableSelfNode",t,e))}get toLinkableDuplicates(){return!!(16&this.n)}set toLinkableDuplicates(e){const t=!!(16&this.n);t!==e&&(this.n=16^this.n,this.t("toLinkableDuplicates",t,e))}get toLinkableSelfNode(){return!!(32&this.n)}set toLinkableSelfNode(e){const t=!!(32&this.n);t!==e&&(this.n=32^this.n,this.t("toLinkableSelfNode",t,e))}get isPanelMain(){return!!(64&this.n)}set isPanelMain(e){const t=!!(64&this.n);t!==e&&(this.n=64^this.n,this.c(),this.t("isPanelMain",t,e))}get isActionable(){return!!(128&this.n)}set isActionable(e){const t=!!(128&this.n);t!==e&&(this.n=128^this.n,this.t("isActionable",t,e))}get background(){return this.Lt}set background(e){const t=this.background;t!==e&&(null!==e&&V.Md(e,"GraphObject.background"),e instanceof V&&e.k(),this.Lt=e,this.C(),this.t("background",t,e))}CN(){return!!(512&this.n)}E1(e){e?this.n|=512:this.n&=-513}mf(){return!!(1024&this.n)}TN(e){e?this.n|=1024:this.n&=-1025}B1(){return!!(2048&this.n)}Sd(e){e?this.n|=2048:this.n&=-2049}Hp(){return!!(4096&this.n)}Uh(e){e?this.n|=4096:this.n&=-4097}Go(){return!!(8192&this.n)}xi(e){e?this.n|=8192:this.n&=-8193}as(){return!!(16384&this.n)}ao(e){e?this.n|=16384:this.n&=-16385}dI(){return!!(32768&this.n)}$i(e){e?this.n|=32768:this.n&=-32769}get part(){if(this._s())return this;if(null!==this.nl)return this.nl;let e=this;for(e=e.panel;e;){if(e instanceof At)return this.nl=e,e;e=e.panel}return null}get svg(){return this.F1}set svg(e){this.F1=e}Wc(){this.svg=null}get panel(){return this.Zs}Vh(e){this.Zs=e,null!==this.svg&&this.svg.remove()}get layer(){const e=this.part;return null!==e?e.layer:null}get diagram(){const e=this.part;return null!==e?e.diagram:null}get position(){return this.ct}set position(e){const t=e.x,i=e.y,s=this.position,n=s.x,o=s.y;(n===t||isNaN(n)&&isNaN(t))&&(o===i||isNaN(o)&&isNaN(i))?this.vN():(e=e.copy(),this.DN(e,n,o)&&this.t("position",new S(n,o),e.copy()))}vN(){}DN(e,t,i){return this.ct=e,this.Pf(),!0}Uc(e,t,i){this.ct.x===e&&this.ct.y===t||(this.ct.e(e,t),this.yf())}get actualBounds(){return this.De}get scale(){return this.it}set scale(e){const t=this.scale;t!==e&&(e<=0&&y.o("GraphObject.scale for "+this+" must be greater than zero, not: "+e),this.it=e,this.c(),this.t("scale",t,e))}get angle(){return this.Xt}set angle(e){const t=this.angle;if(t!==e){if((e%=360)<0&&(e+=360),t===e)return;this.Xt=e,this.iD(),this.c(),this.t("angle",t,e)}}get desiredSize(){return this.cs}set desiredSize(e){const t=e.width,i=e.height,s=this.desiredSize,n=s.width,o=s.height;if((n!==t&&(!isNaN(n)||!isNaN(t))||o!==i&&(!isNaN(o)||!isNaN(i)))&&(e=e.N(),this.cs=e,this.c(),this instanceof rt&&this.ai(),this.t("desiredSize",s,e),this.mf())){const r=this.part;null!==r&&(this.Eh(r,"width"),this.Eh(r,"height"))}}get width(){return this.cs.width}set width(e){const t=this.cs.width;if(!(t===e||isNaN(t)&&isNaN(e))){const i=this.cs,s=new lt(e,this.cs.height).k();if(this.cs=s,this.c(),this instanceof rt&&this.ai(),this.t("desiredSize",i,s),this.mf()){const n=this.part;null!==n&&this.Eh(n,"width")}}}get height(){return this.cs.height}set height(e){const t=this.cs.height;if(!(t===e||isNaN(t)&&isNaN(e))){const i=this.cs,s=new lt(this.cs.width,e).k();if(this.cs=s,this.c(),this instanceof rt&&this.ai(),this.t("desiredSize",i,s),this.mf()){const n=this.part;null!==n&&this.Eh(n,"height")}}}get minSize(){return null!==this.w?this.w.Cr:lt.bc}set minSize(e){const t=this.minSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=0),isNaN(e.height)&&(e.height=0),e.k(),this.Yt().Cr=e,this.c(),this.t("minSize",t,e))}get maxSize(){return null!==this.w?this.w.Lr:lt.DP}set maxSize(e){const t=this.maxSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=1/0),isNaN(e.height)&&(e.height=1/0),e.k(),this.Yt().Lr=e,this.c(),this.t("maxSize",t,e))}get measuredBounds(){return this.hi}get naturalBounds(){return this.Ke}jp(){return 0}get margin(){return this.sl}set margin(e){"number"==typeof e&&(e=new It(e));const t=this.sl;t.equals(e)||(e=e.N(),this.sl=e,this.c(),this.t("margin",t,e))}get v(){return!0===this.B1()&&this.R1(),this.il}get Js(){return!0===this.Hp()&&this.R1(),this.wa}trigger(e,t,i){let s=null;return s="string"==typeof e?new Ri(e,t,i):e,s.Ti=this,null===this.Ds&&(this.Ds=new xt),this.Ds.set(s.propertyName,s),this}get Ds(){return null!==this.w?this.w.Ds:null}set Ds(e){this.Ds!==e&&(this.Yt().Ds=e)}get Nr(){return null!==this.w?this.w.Nr:0}set Nr(e){this.Nr!==e&&(this.Yt().Nr=e)}get alignment(){return this.de}set alignment(e){const t=this.alignment;t.equals(e)||(e.isNoSpot()&&!e.isDefault()&&y.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+e),e=e.N(),this.de=e,this.Pf(),this.t("alignment",t,e))}get column(){return this.pa}set column(e){e=Math.round(e);const t=this.column;t!==e&&(e<0&&y.J(e,">= 0",st,"column"),this.pa=e,this.c(),this.t("column",t,e),null!==this.svg&&this.svg.remove())}get columnSpan(){return null!==this.w?this.w.o0:1}set columnSpan(e){e=Math.round(e);const t=this.columnSpan;t!==e&&(e<1&&y.J(e,">= 1",st,"columnSpan"),this.Yt().o0=e,this.c(),this.t("columnSpan",t,e))}get row(){return this.Xp}set row(e){e=Math.round(e);const t=this.row;t!==e&&(e<0&&y.J(e,">= 0",st,"row"),this.Xp=e,this.c(),this.t("row",t,e),null!==this.svg&&this.svg.remove())}get rowSpan(){return null!==this.w?this.w.r0:1}set rowSpan(e){e=Math.round(e);const t=this.rowSpan;t!==e&&(e<1&&y.J(e,">= 1",st,"rowSpan"),this.Yt().r0=e,this.c(),this.t("rowSpan",t,e))}get spanAllocation(){return null!==this.w?this.w.l0:null}set spanAllocation(e){const t=this.spanAllocation;t!==e&&(null!==e&&y.S(e,st,"spanAllocation"),this.Yt().l0=e,this.c(),this.t("spanAllocation",t,e))}get alignmentFocus(){return this.wd}set alignmentFocus(e){const t=this.alignmentFocus;t.equals(e)||(e=e.N(),this.wd=e,this.c(),this.t("alignmentFocus",t,e))}get portId(){return this.zp}set portId(e){const t=this.portId;if(t!==e){const i=this.part;null!==i&&!(i instanceof nt)&&y.o("Cannot set portID on a Link: "+e);const s=i;null!==t&&null!==s&&s.FN(this),this.zp=e,null!==e&&null!==s&&(s.Ln=!0,s.sD(this)),this.t("portId",t,e)}}Bh(){const e=this.part;if(e instanceof nt&&(null!==this.portId||this===e.port)){const t=e.diagram;null!==t&&!t.undoManager.isUndoingRedoing&&e.invalidateConnectedLinks(void 0,this)}}iD(){const e=this.diagram;null===e||e.undoManager.isUndoingRedoing||(this instanceof J?this instanceof nt?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,t=>{t.Bh()}):this.Bh())}get toSpot(){return null!==this.ft?this.ft.vh:A.None}set toSpot(e){const t=this.toSpot;t.equals(e)||(e=e.N(),this.Ji().vh=e,this.t("toSpot",t,e),this.Bh())}get toEndSegmentLength(){return null!==this.ft?this.ft.Rh:10}set toEndSegmentLength(e){const t=this.toEndSegmentLength;t!==e&&(e<0&&y.J(e,">= 0",st,"toEndSegmentLength"),this.Ji().Rh=e,this.t("toEndSegmentLength",t,e),this.Bh())}get toShortLength(){return null!==this.ft?this.ft.Ih:0}set toShortLength(e){const t=this.toShortLength;t!==e&&(this.Ji().Ih=e,this.t("toShortLength",t,e),this.Bh())}get toLinkable(){return null!==this.ft?this.ft.a0:null}set toLinkable(e){const t=this.toLinkable;t!==e&&(this.Ji().a0=e,this.t("toLinkable",t,e))}get toMaxLinks(){return null!==this.ft?this.ft.h0:1/0}set toMaxLinks(e){const t=this.toMaxLinks;t!==e&&(e<0&&y.J(e,">= 0",st,"toMaxLinks"),this.Ji().h0=e,this.t("toMaxLinks",t,e))}get fromSpot(){return null!==this.ft?this.ft.Dh:A.None}set fromSpot(e){const t=this.fromSpot;t.equals(e)||(e=e.N(),this.Ji().Dh=e,this.t("fromSpot",t,e),this.Bh())}get fromEndSegmentLength(){return null!==this.ft?this.ft.Fh:10}set fromEndSegmentLength(e){const t=this.fromEndSegmentLength;t!==e&&(e<0&&y.J(e,">= 0",st,"fromEndSegmentLength"),this.Ji().Fh=e,this.t("fromEndSegmentLength",t,e),this.Bh())}get fromShortLength(){return null!==this.ft?this.ft.Oh:0}set fromShortLength(e){const t=this.fromShortLength;t!==e&&(this.Ji().Oh=e,this.t("fromShortLength",t,e),this.Bh())}get fromLinkable(){return null!==this.ft?this.ft.c0:null}set fromLinkable(e){const t=this.fromLinkable;t!==e&&(this.Ji().c0=e,this.t("fromLinkable",t,e))}get fromMaxLinks(){return null!==this.ft?this.ft.f0:1/0}set fromMaxLinks(e){const t=this.fromMaxLinks;t!==e&&(e<0&&y.J(e,">= 0",st,"fromMaxLinks"),this.Ji().f0=e,this.t("fromMaxLinks",t,e))}get cursor(){return null!==this.w?this.w.Il:""}set cursor(e){const t=this.cursor;t!==e&&(y.s(e,"string",st,"cursor"),this.Yt().Il=e,this.t("cursor",t,e))}get click(){return null!==this.w?this.w.Ur:null}set click(e){const t=this.click;t!==e&&(null!==e&&y.S(e,st,"click"),this.Yt().Ur=e,this.t("click",t,e))}get doubleClick(){return null!==this.w?this.w.Vr:null}set doubleClick(e){const t=this.doubleClick;t!==e&&(null!==e&&y.S(e,st,"doubleClick"),this.Yt().Vr=e,this.t("doubleClick",t,e))}get contextClick(){return null!==this.w?this.w.Br:null}set contextClick(e){const t=this.contextClick;t!==e&&(null!==e&&y.S(e,st,"contextClick"),this.Yt().Br=e,this.t("contextClick",t,e))}get mouseEnter(){return null!==this.w?this.w.Kr:null}set mouseEnter(e){const t=this.mouseEnter;t!==e&&(null!==e&&y.S(e,st,"mouseEnter"),this.Yt().Kr=e,this.t("mouseEnter",t,e))}get mouseLeave(){return null!==this.w?this.w.Hr:null}set mouseLeave(e){const t=this.mouseLeave;t!==e&&(null!==e&&y.S(e,st,"mouseLeave"),this.Yt().Hr=e,this.t("mouseLeave",t,e))}get mouseOver(){return null!==this.w?this.w.zr:null}set mouseOver(e){const t=this.mouseOver;t!==e&&(null!==e&&y.S(e,st,"mouseOver"),this.Yt().zr=e,this.t("mouseOver",t,e))}get mouseHover(){return null!==this.w?this.w.Xr:null}set mouseHover(e){const t=this.mouseHover;t!==e&&(null!==e&&y.S(e,st,"mouseHover"),this.Yt().Xr=e,this.t("mouseHover",t,e))}get mouseHold(){return null!==this.w?this.w.Gr:null}set mouseHold(e){const t=this.mouseHold;t!==e&&(null!==e&&y.S(e,st,"mouseHold"),this.Yt().Gr=e,this.t("mouseHold",t,e))}get mouseDragEnter(){return null!==this.w?this.w.u0:null}set mouseDragEnter(e){const t=this.mouseDragEnter;t!==e&&(null!==e&&y.S(e,st,"mouseDragEnter"),this.Yt().u0=e,this.t("mouseDragEnter",t,e))}get mouseDragLeave(){return null!==this.w?this.w.d0:null}set mouseDragLeave(e){const t=this.mouseDragLeave;t!==e&&(null!==e&&y.S(e,st,"mouseDragLeave"),this.Yt().d0=e,this.t("mouseDragLeave",t,e))}get mouseDrop(){return null!==this.w?this.w.Yr:null}set mouseDrop(e){const t=this.mouseDrop;t!==e&&(null!==e&&y.S(e,st,"mouseDrop"),this.Yt().Yr=e,this.t("mouseDrop",t,e))}get actionDown(){return null!==this.w?this.w.g0:null}set actionDown(e){const t=this.actionDown;t!==e&&(null!==e&&y.S(e,st,"actionDown"),this.Yt().g0=e,this.t("actionDown",t,e))}get actionMove(){return null!==this.w?this.w.m0:null}set actionMove(e){const t=this.actionMove;t!==e&&(null!==e&&y.S(e,st,"actionMove"),this.Yt().m0=e,this.t("actionMove",t,e))}get actionUp(){return null!==this.w?this.w.p0:null}set actionUp(e){const t=this.actionUp;t!==e&&(null!==e&&y.S(e,st,"actionUp"),this.Yt().p0=e,this.t("actionUp",t,e))}get actionCancel(){return null!==this.w?this.w.y0:null}set actionCancel(e){const t=this.actionCancel;t!==e&&(null!==e&&y.S(e,st,"actionCancel"),this.Yt().y0=e,this.t("actionCancel",t,e))}get toolTip(){return null!==this.w?this.w.jr:null}set toolTip(e){const t=this.toolTip;t!==e&&(this.Yt().jr=e,this.t("toolTip",t,e))}get contextMenu(){return null!==this.w?this.w.qr:null}set contextMenu(e){const t=this.contextMenu;t!==e&&(this.Yt().qr=e,this.t("contextMenu",t,e))}findBindingPanel(){let e=this instanceof J?this:this.panel;for(;null!==e;){if(e.RN())return e;e=e.panel}return null}bind(e,t,i,s){return this.Sf(e,t,i,s),this}bindTwoWay(e,t,i,s){return this.Sf(e,t,i,s).makeTwoWay(),this}bindModel(e,t,i,s){return this.Sf(e,t,i,s).ofModel(),this}bindObject(e,t,i,s,n){return this.Sf(e,t,i,s).ofObject(n),this}theme(e,t,i,s,n){return this.Na(e,t,i,s,n),this}themeData(e,t,i,s,n){return this.Na(e,t,i,s,n).ofData(),this}themeObject(e,t,i,s,n,o){return this.Na(e,t,i,s,n).ofObject(o),this}themeModel(e,t,i,s,n){return this.Na(e,t,i,s,n).ofModel(),this}Sf(e,t,i,s){let n=null;return n="string"==typeof e?new We(e,t,i,s):e,this.w0(n),n}Na(e,t,i,s,n){let o=null;return o="string"==typeof e?new ni(e,t,i,s,n):e,this.w0(o),o}w0(e){e.Ti=this;const t=this.findBindingPanel();null!==t&&t.nD()&&y.o("Cannot add a Binding to a template that has already been copied: "+e),null===this.ve&&(this.ve=new H),this.ve.add(e)}set(e){return e?(Object.assign(this,e),this):this}attach(e){return st.ON(this,e),this}apply(e,...t){return e.apply(this,[this,...t]),this}setProperties(e){return U.Ap(this,e),this}static make(e,...t){let i=arguments,s=null,n=null;if(y.st(e))n=e;else if("string"==typeof e){const r=st.z1.get(e);y.st(r)?(i=Array.prototype.slice.call(i),s=r(i),y.$(s)||y.o('GraphObject.make invoked object builder "'+e+'", but it did not return an Object')):n=X.go[e]}null===s&&((null==n||!n.constructor)&&y.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+e),s=new n);let o=1;if(s instanceof U&&i.length>1){const a=i[1];("string"==typeof a||a instanceof HTMLDivElement)&&(s.p2(a),o++)}for(let r=o;r<i.length;r++){const a=i[r];void 0===a?y.o("Undefined value at argument "+r+" for object being constructed by GraphObject.make: "+s):s&&st.ON(s,a)}return s}static ON(e,t){if("number"==typeof t)st.pI(e,t);else if("string"==typeof t)st.yI(e,t);else if(t instanceof st)e instanceof J||y.o("A GraphObject can only be added to a Panel, not to: "+e),e.add(t);else if(t instanceof ee){let i=null;t.isRow&&y.st(e.getRowDefinition)?i=e.getRowDefinition(t.index):!t.isRow&&y.st(e.getColumnDefinition)&&(i=e.getColumnDefinition(t.index)),i instanceof ee?i.X1(t):y.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+e)}else if(t instanceof Rt)e.type=t;else if(t instanceof We)e instanceof st||e instanceof ee?e.bind(t):y.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+e);else if(t instanceof Ri)e instanceof st?e.trigger(t):y.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+e);else if(t instanceof Ht)e instanceof Ct&&4===e.type?e.figures.add(t):y.o("A PathFigure can only be added to a Path Geometry, not to: "+e);else if(t instanceof St)e instanceof Ht?e.segments.add(t):y.o("A PathSegment can only be added to a PathFigure, not to: "+e);else if(t instanceof se)e instanceof U||e instanceof pt?e.layout=t:y.o("A Layout can only be assigned to a Diagram or a Group, not to: "+e);else if(Array.isArray(t))for(let i=0;i<t.length;i++)st.ON(e,t[i]);else y.$(t)?st.wI(e,t):y.o('Unknown initializer "'+t+'" for object being constructed by GraphObject.make: '+e)}static yI(e,t){if(e instanceof mt)e.text=t;else if(e instanceof rt)e.figure=t;else if(e instanceof Kt)e.source=t;else if(e instanceof J){const i=Rt.fs.get(t);null!==i&&(e.type=i)}else if(e instanceof V){const i=y.$a(Re,t);null!==i?e.type=i:y.o("Unknown Brush type as an argument to GraphObject.make: "+t)}else if(e instanceof Ct){const i=y.$a(Ke,t);null!==i&&(e.type=i)}else if(e instanceof St){const i=y.$a(ai,t);null!==i&&(e.type=i)}}static pI(e,t){y.st(e.fe)?e.fe(t):y.dr(e,t)}static wI(e,t){if(e instanceof V){const i=new R;for(const s in t){const n=parseFloat(s);isNaN(n)?i[s]=t[s]:e.addColorStop(n,t[s])}U.Ap(e,i)}else if(e instanceof ee){if(void 0!==t.row){const s=t.row;(null==s||s===1/0||isNaN(s)||s<0)&&y.o("Must specify non-negative integer row for RowColumnDefinition "+t+", not: "+s),e.isRow=!0,e.index=s}else if(void 0!==t.column){const s=t.column;(null==s||s===1/0||isNaN(s)||s<0)&&y.o("Must specify non-negative integer column for RowColumnDefinition "+t+", not: "+s),e.isRow=!1,e.index=s}const i=new R;for(const s in t)"row"===s||"column"===s||(i[s]=t[s]);U.Ap(e,i)}else U.Ap(e,t)}static build(e,t,...i){const s=st.z1.get(e);if(y.st(s)){const n=s([e].concat(i));if(n instanceof st)return t&&n.setProperties(t),n}y.o('GraphObject.build invoked object builder "'+e+'", but it did not return an Object')}static defineBuilder(e,t){y.s(e,"string",st,"defineBuilder:name"),y.S(t,st,"defineBuilder:func"),e.toLowerCase(),st.z1.set(e,t)}static isBuilderDefined(e){return st.z1.has(e)}static takeBuilderArgument(e,t,i){void 0===i&&(i=null);const s=e[1];return(y.st(i)?i(s):"string"==typeof s)?(e.splice(1,1),s):(void 0===t&&y.o("no "+(y.st(i)?"satisfactory":"string")+" argument for GraphObject builder "+e[0]),t)}static z1=new xt}st.Vertical=4,st.Horizontal=5,st.defineBuilder("Button",m=>{const o=2.76142374915397,r=2.761423749153969,a=new J(J.Auto,{isActionable:!0,enabledChanged:(l,h)=>{if(l instanceof J){const c=l.findObject("ButtonBorder");if(null!==c)if(void 0===l._buttonFillNormal&&(l._buttonFillNormal=c.fill),h){let u=null;null!==l.layer&&null!==l.diagram&&l.isVisibleObject()&&(u=l.layer.findObjectAt(l.diagram.lastInput.documentPoint)),c.fill=u===l||null!==u&&u.isContainedBy(l)?l._buttonFillOver:l._buttonFillNormal}else c.fill=l._buttonFillDisabled}},cursor:"pointer"}).attach({_buttonFillNormal:void 0,_buttonStrokeNormal:void 0,_buttonFillOver:"#d4d4d4",_buttonStrokeOver:"#737373",_buttonFillDisabled:"#a3a3a3"}).add(new rt("RoundedRectangle",{name:"ButtonBorder",spot1:new A(0,0,o,r),spot2:new A(1,1,-o,-r),parameter1:2,fill:"#f5f5f5",stroke:"#737373"}));return a.mouseEnter=(l,h,c)=>{if(!(h.isEnabledObject()&&h instanceof J))return;const u=h.findObject("ButtonBorder");u instanceof rt&&(void 0===h._buttonFillNormal&&(h._buttonFillNormal=u.fill),u.fill=h._buttonFillOver,void 0===h._buttonStrokeNormal&&(h._buttonStrokeNormal=u.stroke),u.stroke=h._buttonStrokeOver)},a.mouseLeave=(l,h,c)=>{if(!(h.isEnabledObject()&&h instanceof J))return;const u=h.findObject("ButtonBorder");u instanceof rt&&(void 0!==h._buttonFillNormal&&(u.fill=h._buttonFillNormal),void 0!==h._buttonStrokeNormal&&(u.stroke=h._buttonStrokeNormal))},a}),st.defineBuilder("TreeExpanderButton",m=>{const e=st.build("Button");return e.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),e.add(new rt("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:lt.Su}).bindObject("figure","isTreeExpanded",(t,i)=>{const s=i.panel;return t?s._treeExpandedFigure:s._treeCollapsedFigure})),e.bindObject("visible","isTreeLeaf",t=>!t),e.click=(t,i)=>{let s=i.part;if(s instanceof Nt&&(s=s.adornedPart),!(s instanceof nt))return;const n=s.diagram;if(null===n)return;const o=n.commandHandler;if(s.isTreeExpanded){if(!o.canCollapseTree(s))return}else if(!o.canExpandTree(s))return;t.handled=!0,s.isTreeExpanded?o.collapseTree(s):o.expandTree(s)},e}),st.defineBuilder("SubGraphExpanderButton",m=>{const e=st.build("Button");return e.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),e.add(new rt("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:lt.Su}).bindObject("figure","isSubGraphExpanded",(t,i)=>{const s=i.panel;return t?s._subGraphExpandedFigure:s._subGraphCollapsedFigure})),e.click=(t,i)=>{let s=i.part;if(s instanceof Nt&&(s=s.adornedPart),!(s instanceof pt))return;const n=s.diagram;if(null===n)return;const o=n.commandHandler;if(s.isSubGraphExpanded){if(!o.canCollapseSubGraph(s))return}else if(!o.canExpandSubGraph(s))return;t.handled=!0,s.isSubGraphExpanded?o.collapseSubGraph(s):o.expandSubGraph(s)},e}),st.defineBuilder("ToolTip",m=>new Nt(J.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new S(0,2),mouseOver:(e,t)=>{const i=e.diagram.toolManager;i.extendToolTip(i.toolTipDuration)}}).add(new rt("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new A(0,0,4,6),spot2:new A(1,1,-4,-4)}))),st.defineBuilder("ContextMenu",m=>new Nt(J.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new S(0,2)}).bindObject("background","",e=>null!==e.adornedPart&&e.hasPlaceholder()?null:"#f5f5f5")),st.defineBuilder("ContextMenuButton",m=>{const e=st.build("Button");e.stretch=5;const t=e.findObject("ButtonBorder");return t instanceof rt&&(t.figure="Rectangle",t.strokeWidth=0,t.spot1=new A(0,0,4,6),t.spot2=new A(1,1,-4,-4)),e}),st.defineBuilder("PanelExpanderButton",m=>{const e=st.takeBuilderArgument(m,"COLLAPSIBLE"),t=st.build("Button");t.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8","ButtonBorder.fill":"rgba(0, 0, 0, 0)",_buttonFillNormal:"rgba(0, 0, 0, 0)","ButtonBorder.stroke":null,_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),t.add(new rt({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",s=>s?t._buttonExpandedFigure:t._buttonCollapsedFigure,void 0,e));const i=t.findObject("ButtonBorder");return i instanceof rt&&(i.stroke=null,i.fill="rgba(0, 0, 0, 0)"),t.click=(s,n)=>{if(!(n instanceof J))return;const o=n.diagram;if(null===o||o.isReadOnly)return;let r=n.findBindingPanel();if(null===r&&(r=n.part),null!==r){const a=r.findObject(e);null!==a&&(s.handled=!0,o.startTransaction("Collapse/Expand Panel"),a.visible=!a.visible,o.commitTransaction("Collapse/Expand Panel"))}},t}),st.defineBuilder("CheckBoxButton",m=>{const e=st.takeBuilderArgument(m),t=st.build("Button",{desiredSize:new lt(14,14)});t.attach({"ButtonBorder.spot1":new A(0,0,1,1),"ButtonBorder.spot2":new A(1,1,-1,-1)});const i=new rt({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return""!==e&&i.bindTwoWay("visible",e),t.add(i),t.click=(s,n)=>{if(!(n instanceof J))return;const o=s.diagram;if(null===o||o.isReadOnly||""!==e&&o.model.isReadOnly)return;s.handled=!0;const r=n.findObject("ButtonIcon");o.startTransaction("checkbox"),null!==r&&(r.visible=!r.visible),y.st(n._doClick)&&n._doClick(s,n),o.commitTransaction("checkbox")},t}),st.defineBuilder("CheckBox",m=>{const e=st.takeBuilderArgument(m),t=st.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new It(0,1,0,0)},e),i=new J("Horizontal",{isActionable:!0,cursor:t.cursor,margin:new It(1),mouseEnter:t.mouseEnter,mouseLeave:t.mouseLeave,click:t.click}).attach({_buttonFillNormal:t._buttonFillNormal,_buttonStrokeNormal:t._buttonStrokeNormal,_buttonFillOver:t._buttonFillOver,_buttonStrokeOver:t._buttonStrokeOver,_buttonFillDisabled:t._buttonFillDisabled,_buttonClick:t.click});return i.add(t),t.mouseEnter=null,t.mouseLeave=null,t.click=null,i}),st.defineBuilder("AutoRepeatButton",m=>{const e=st.takeBuilderArgument(m,50,r=>"number"==typeof r),t=st.takeBuilderArgument(m,500,r=>"number"==typeof r);function i(r,a){n(0,a),a.click&&(a.Nd=y.dn(()=>s(r,a),t))}function s(r,a){a.Nd&&y.wc(a.Nd),a.click&&(a.Nd=y.dn(()=>{a.click&&(a.click(r,a),s(r,a))},e))}function n(r,a){a.Nd&&(y.wc(a.Nd),a.Nd=void 0)}const o=st.build("Button");return o.actionDown=(r,a)=>i(r,a),o.actionUp=(r,a)=>n(0,a),o.actionCancel=(r,a)=>n(0,a),o}),st.defineBuilder("ToggleSwitch",function(m){const e=st.takeBuilderArgument(m);e||y.o("ToggleSwitch must be data-bound to a property name, not: "+e);const t=st.takeBuilderArgument(m,!1,r=>"boolean"==typeof r),i="gray",s="transparent",n="white",o=new J("Auto",{width:t?15:28,height:t?28:15}).attach({_buttonFillOff:i,_buttonBorderOff:s,_buttonIconFillOff:n,_buttonFillOn:"green",_buttonBorderOn:"transparent",_buttonIconFillOn:"white"}).add(new rt("Capsule",{name:"ButtonBorder",fill:i,stroke:s,strokeWidth:1}).bind("fill",e,(r,a)=>r?a.panel._buttonFillOn:a.panel._buttonFillOff).bind("stroke",e,(r,a)=>r?a.panel._buttonBorderOn:a.panel._buttonBorderOff)).add(new rt("Circle",{name:"ButtonIcon",width:11,height:11,fill:n,stroke:null,alignment:t?A.Bottom:A.Left}).bind("fill",e,(r,a)=>r?a.panel._buttonIconFillOn:a.panel._buttonIconFillOff).bind("alignment",e,r=>r?t?A.Top:A.Right:t?A.Bottom:A.Left));return o.click=function(r,a){if(!a.isEnabledObject())return;const l=r.diagram;if(null===l||l.isReadOnly||""!==e&&l.model.isReadOnly)return;r.handled=!0;const h=a.findBindingPanel();null!==h&&(l.startTransaction("toggle switch"),l.model.set(h.data,e,!h.data[e]),"function"==typeof a._doClick&&a._doClick(r,a),l.commitTransaction("toggle switch"))},o}),st.defineBuilder("Toggle",function(m){const e=st.takeBuilderArgument(m),t=st.build("ToggleSwitch",{name:"Button"},e),i=new J("Horizontal",{cursor:t.cursor,margin:1,mouseEnter:t.mouseEnter,mouseLeave:t.mouseLeave,click:t.click}).attach({_buttonClick:t.click}).add(t);return t.mouseEnter=null,t.mouseLeave=null,t.click=null,i});class qe{me;Pt;oo;ve;ro;vs;Il;Ur;Vr;Br;Kr;Hr;zr;Xr;Gr;u0;d0;Yr;g0;m0;p0;y0;jr;qr;Zp;l0;Ds;Cr;Lr;ho;r0;o0;Nr;Jp;x0;b0;constructor(){this.me=!1,this.Pt="",this.oo=-1,this.ve=null,this.ro=null,this.vs=null,this.Il="",this.Ur=null,this.Vr=null,this.Br=null,this.Kr=null,this.Hr=null,this.zr=null,this.Xr=null,this.Gr=null,this.u0=null,this.d0=null,this.Yr=null,this.g0=null,this.m0=null,this.p0=null,this.y0=null,this.jr=null,this.qr=null,this.Zp=null,this.l0=null,this.Ds=null,this.Cr=lt.bc,this.Lr=lt.DP,this.ho=1,this.r0=1,this.o0=1,this.Nr=0,this.Jp=null,this.x0=null,this.b0="category"}copy(){const e=new qe;return e.Pt=this.Pt,e.oo=this.oo,e.ve=this.ve,e.vs=this.vs,e.Il=this.Il,e.Ur=this.Ur,e.Vr=this.Vr,e.Br=this.Br,e.Kr=this.Kr,e.Hr=this.Hr,e.zr=this.zr,e.Xr=this.Xr,e.Gr=this.Gr,e.u0=this.u0,e.d0=this.d0,e.Yr=this.Yr,e.g0=this.g0,e.m0=this.m0,e.p0=this.p0,e.y0=this.y0,e.jr=this.jr,e.qr=this.qr,e.Zp=this.Zp,e.l0=this.l0,e.Ds=this.Ds,e.Cr=this.Cr.N(),e.Lr=this.Lr.N(),e.ho=this.ho,e.r0=this.r0,e.o0=this.o0,e.Nr=this.Nr,e.Jp=this.Jp,e.x0=this.x0,e.b0=this.b0,e}}class Ci{m;constructor(){this.m=[1,0,0,1,0,0]}copy(){const e=new Ci;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}translate(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}scale(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}rotate(e,t,i){if(0===(e=L.Ee(e)))return;this.translate(t,i);let s=0,n=0;if(90===e)s=0,n=1;else if(180===e)s=-1,n=0;else if(270===e)s=0,n=-1;else{const h=e*Math.PI/180;s=Math.cos(h),n=Math.sin(h)}const r=this.m[1]*s+this.m[3]*n,a=this.m[0]*-n+this.m[2]*s,l=this.m[1]*-n+this.m[3]*s;this.m[0]=this.m[0]*s+this.m[2]*n,this.m[1]=r,this.m[2]=a,this.m[3]=l,this.translate(-t,-i)}}class di{type;x1;y1;r1;x2;y2;r2;colors;pattern;constructor(e){this.type=e,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(e,t){this.colors.push({offset:e,color:t})}}class fi{bt;_t;el;ud;IN;constructor(e,t,i){const s=void 0===t?X.document:t;this.el=s,this.IN="http://www.w3.org/2000/svg";const n="http://www.w3.org/2000/xmlns/";void 0!==s&&(this.bt=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",i||(this.style.position="absolute"),this.bt.setAttributeNS(n,"xmlns",this.IN),this.bt.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.ud=null,this._t=new he(this,i)}resize(e,t,i,s){return(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",this.bt.setAttributeNS(null,"width",i+"px"),this.bt.setAttributeNS(null,"height",s+"px"),this.bt.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this._t.EN.firstElementChild.setAttributeNS(null,"width",i+"px"),this._t.EN.firstElementChild.setAttributeNS(null,"height",s+"px"),!0)}makeElement(e,t,i){const s=this.el.createElementNS(this.IN,e);if(y.$(t))for(const n in t)s.setAttributeNS("href"===n?"http://www.w3.org/1999/xlink":"",n,t[n]);return void 0!==i&&(s.textContent=i),s}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return parseInt(this.bt.getAttribute("width")||"1")}set width(e){this.bt.setAttribute("width",e+"px")}get height(){return parseInt(this.bt.getAttribute("height")||"1")}set height(e){this.bt.setAttribute("height",e+"px")}dispose(){this.el=null}get style(){return this.bt.style}}class he{Mf;Nf;An;Fe;Zi;fillStyle;font;globalAlpha;lineCap;lineDashOffset;lineJoin;lineWidth;miterLimit;shadowBlur;shadowColor;shadowOffsetX;shadowOffsetY;strokeStyle;textAlign;imageSmoothingEnabled;clipInsteadOfFill;lastCreatedElement;Cf;Lf;surface;svg;EN;oD;G1;Wo;Ca;zh;currentElement;clipPathGroup;diagramGroup;lastDrawnPart;currentPath;outerGroup;pathAttributes;rl;Fr;filter;letterSpacing;wordSpacing;partClipRect;constructor(e,t){if(this.surface=e,this.svg=e.bt,this.Cf=[],this.Lf=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.rl=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.Mf=0,this.Nf=0,this.An=0,this.lastCreatedElement=null,this.currentElement=null,this.Fe=[],this.pathAttributes={},this.G1=!1,this.Wo=null,this.Ca=0,this.oD={},this.Fr=!!t,this.filter="",this.partClipRect=null,this.Zi=new Ci,this.letterSpacing="0px",this.wordSpacing="0px",null==e.el)return;this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;const i=z.Ww++,s=this.makeElement("clipPath",{id:"mainClip"+i});s.appendChild(this.makeElement("rect",{x:0,y:0,width:e.width,height:e.height})),this.EN=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")")}setDiagramPosScale(e,t,i,s,n,o){void 0===this.diagramGroup?this.newGroup(e,t,i,s,n,o):this.diagramGroup.setAttribute("transform","matrix("+e+", "+t+", "+i+", "+s+", "+n+", "+o+")")}resetInnerSVG(){null!==this.diagramGroup&&(this.diagramGroup.innerHTML="")}arc(e,t,i,s,n,o,r,a){const l=2*Math.PI,h=1e-6,c=l-h,u=i*Math.cos(s),d=i*Math.sin(s),f=e+u,p=t+d,g=o?0:1;let b=o?s-n:n-s;(Math.abs(r-f)>h||Math.abs(a-p)>h)&&this.Fe.push(["L",f,+p]),b<0&&(b=b%l+l),b>c?(this.Fe.push(["A",i,i,0,1,g,e-u,t-d]),this.Fe.push(["A",i,i,0,1,g,f,p])):b>h&&this.Fe.push(["A",i,i,0,+(b>=Math.PI),g,e+i*Math.cos(n),t+i*Math.sin(n)])}beginPath(){this.Fe=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(e){this.xI(this.Fe,this.Zi,e||0)}bezierCurveTo(e,t,i,s,n,o){this.Fe.push(["C",e,t,i,s,n,o])}clearRect(e,t,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Fe.push(["z"])}createLinearGradient(e,t,i,s){const n=new di("linear");return n.x1=e,n.y1=t,n.x2=i,n.y2=s,n}createPattern(e,t){let i="";e instanceof HTMLCanvasElement&&(i=e.toDataURL()),e instanceof HTMLImageElement&&(i=e.getAttribute("src"));const s=this.oD;if(s[i])return"url(#"+s[i]+")";const n="PATTERN"+z.Ww++,r={x:0,y:0,width:e.width,height:e.height,href:i},a=this.makeElement("pattern",{width:e.width,height:e.height,id:n,patternUnits:"userSpaceOnUse"});return a.appendChild(this.makeElement(U.img,r)),this.svg.appendChild(a),s[i]=n,"url(#"+n+")"}createRadialGradient(e,t,i,s,n,o){const r=new di("radial");return r.x1=e,r.y1=t,r.r1=i,r.x2=s,r.y2=n,r.r2=o,r}amendImageTransform(e,t,i,s,n,o,r,a){const l=r/i,h=a/s;(0!==n||0!==o)&&this.Zi.translate(n,o),(1!==l||1!==h)&&this.Zi.scale(l,h),(0!==e||0!==t)&&this.Zi.translate(-e,-t)}drawImage(e,t,i,s,n,o,r,a,l){let h="",c=e.width,u=e.height;"function"==typeof e.toDataURL?e.toDataURL():(h=e.getAttribute("src"),c=e.naturalWidth,u=e.naturalHeight),void 0===s&&(o=t,r=i,a=s=c,l=n=u),this.amendImageTransform(t,i,s=s||0,n=n||0,o=o||0,r=r||0,a=a||0,l=l||0);const d={x:0,y:0,width:c||s,height:u||n,href:h};L.X(s,a)&&L.X(n,l)?-1===h.toLowerCase().indexOf(".svg")&&-1===h.toLowerCase().indexOf("data:image/svg")&&(d.preserveAspectRatio="xMidYMid slice"):d.preserveAspectRatio="none",(0!==t||0!==i||s!==c||n!==u)&&(d["clip-path"]=`path('M ${t},${i} L ${s+=t} ${i} L ${s} ${n+=i} L ${t} ${n} z')`),this.processCommon(U.img,d,this.Zi),this.Cd(U.img,d)}fill(e,t){e&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(e,t,i){this.clipInsteadOfFill?this.clip():this.fill(t,i)}createOrUpdateClipGroup(e,t){const i=this.newGroup(1,0,0,1,-t.x,-t.y);i.setAttributeNS(null,"class","spotClip"),e.xa=i}fillRect(e,t,i,s){this.addRect("fill",[e,t,i,s],this.Zi)}fillBackground(e,t,i,s){const n={x:e,y:t,width:i,height:s};this.processCommon("fill",n,this.Zi),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(e,t,i){this.addText("fill",[e,t,i],this.Zi)}lineTo(e,t){this.Fe.push(["L",e,t])}moveTo(e,t){this.Fe.push(["M",e,t])}quadraticCurveTo(e,t,i,s){this.Fe.push(["Q",e,t,i,s])}rect(e,t,i,s){this.Fe.push(["M",e,t],["L",e+i,t],["L",e+i,t+s],["L",e,t+s],["z"])}restore(){this.Zi=this.Cf.pop(),this.Fe=this.Cf.pop();const e=this.Cf.pop();this.fillStyle=e.fillStyle,this.font=e.font,this.globalAlpha=e.globalAlpha,this.lineCap=e.lineCap,this.lineDashOffset=e.lineDashOffset,this.lineJoin=e.lineJoin,this.lineWidth=e.lineWidth,this.miterLimit=e.miterLimit,this.shadowBlur=e.shadowBlur,this.shadowColor=e.shadowColor,this.shadowOffsetX=e.shadowOffsetX,this.shadowOffsetY=e.shadowOffsetY,this.strokeStyle=e.strokeStyle,this.textAlign=e.textAlign,this.partClipRect=e.partClipRect,this.letterSpacing=e.letterSpacing,this.wordSpacing=e.wordSpacing}save(){this.Cf.push({fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect});const t=[];for(let i=0;i<this.Fe.length;i++)t.push(this.Fe[i]);this.Cf.push(t),this.Cf.push(this.Zi.copy())}setTransform(e,t,i,s,n,o){1===e&&0===t&&0===i&&1===s&&0===n&&0===o||this.newGroup(e,t,i,s,n,o)}setCurrentTransform(e,t,i,s,n,o){this.Zi.m=[e,t,i,s,n,o]}getCurrentTransform(){const e=this.Zi.m;return"matrix("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}scale(e,t){this.Zi.scale(e,t)}translate(e,t){this.Zi.translate(e,t)}transform(e,t,i,s,n,o){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(e,t,i,s){this.addRect("stroke",[e,t,i,s],this.Zi)}makeElement(e,t,i){return this.surface.makeElement(e,t,i)}Cd(e,t,i){const s=this.makeElement(e,t,i);return null!==this.currentElement?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(e,t,i){if("fill"===e?this.setFill(t):"stroke"===e&&this.setStroke(t),null!==i){const s=i.m;t.transform="matrix("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+", "+s[4]+", "+s[5]+")"}}setFill(e){if(this.fillStyle instanceof di)e.fill=this.addGradient(this.fillStyle,"fill");else if(/^rgba\(/.test(this.fillStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.fill="rgb("+t[1]+","+t[2]+","+t[3]+")",e["fill-opacity"]=t[4]}else e.fill=this.fillStyle}setFillOrStrokeInPlace(e,t){const i=t?"fill":"stroke";if(this.fillStyle instanceof di)e.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,i));else if(/^rgba\(/.test(this.fillStyle)){const s=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.setAttributeNS(null,i,"rgb("+s[1]+","+s[2]+","+s[3]+")"),e.setAttributeNS(null,i+"-opacity",s[4])}else e.setAttributeNS(null,i,this.fillStyle)}setStroke(e){if(this.strokeStyle instanceof di)e.stroke=this.addGradient(this.strokeStyle,"stroke");else if(/^rgba\(/.test(this.strokeStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);e.stroke="rgb("+t[1]+","+t[2]+","+t[3]+")",e["stroke-opacity"]=t[4]}else e.stroke=this.strokeStyle;e["stroke-width"]=this.lineWidth,e["stroke-linecap"]=this.lineCap,e["stroke-linejoin"]=this.lineJoin,e["stroke-miterlimit"]=this.miterLimit,this.G1&&(e["stroke-dasharray"]=this.Wo.toString(),e["stroke-dashoffset"]=this.Ca)}addGradient(e,t){let i="";const s=null!==this.currentPath?this.currentPath.getAttribute(t):null;if(null!==s&&-1!==s.indexOf("GRAD")){i=s.split("#")[1].slice(0,-1);const a=this.svg.getElementById(i);null!==a&&a.remove()}else i="GRAD"+z.Ww++;let n;"linear"===e.type?n=this.makeElement("linearGradient",{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,id:i,gradientUnits:"userSpaceOnUse"}):"radial"===e.type?n=this.makeElement("radialGradient",{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,r1:e.r1,r2:e.r2,id:i}):y.o("invalid gradient");const o=e.colors.sort((a,l)=>a.offset>l.offset?1:-1),r=o.length;for(let a=0;a<r;a++){const l=o[a];n.appendChild(this.makeElement("stop",{offset:l.offset,"stop-color":l.color}))}return this.svg.appendChild(n),"url(#"+i+")"}addRect(e,t,i){const s={x:t[0],y:t[1],width:t[2],height:t[3]};this.processCommon(e,s,i),this.Cd("rect",s)}addText(e,t,i){let s=this.textAlign;"left"===s?s="start":"right"===s?s="end":"center"===s&&(s="middle");const n={x:t[1],y:t[2],style:"font: "+this.font,"text-anchor":s};n["letter-spacing"]=this.letterSpacing,n["word-spacing"]=this.wordSpacing,this.processCommon(e,n,i),this.Cd("text",n,t[0])}xI(e,t,i){const s=this.bI(e),n=this.pathAttributes;if(n.clipPath)this.Lf.length>1&&this.Lf[this.Lf.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');else if(n.d=s,this.processCommon("",n,t),null!==this.currentPath){const o=this.currentPath;if("g"!==o.nodeName)for(const r in n)"transform"!==r&&o.setAttributeNS(null,r,n[r]);else{const r=o.getElementsByTagName("path");for(const a in n)"transform"!==a&&r[i].setAttributeNS(null,a,n[a])}}else this.Cd("path",n)}bI(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i].slice(),n=[s.shift()];if("A"===n[0])n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());t.push(n.join(" "))}return t.join(" ")}newGroup(e,t,i,s,n,o){const r=new Ci;r.m=[e,t,i,s,n,o];const a={};this.processCommon("g",a,r);const l=this.Cd("g",a);return this.Lf.push(l),l}newGroup2(e){const t={};e&&(t.class=e);const i=this.Cd("g",t);return this.Lf.push(i),i}endGroup(){return this.Lf.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(e,t,i){this.Mf=e,this.Nf=t,this.An=i}shadowsOff(){this.rl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.rl=!0,this.shadowOffsetX=this.Mf,this.shadowOffsetY=this.Nf,this.shadowBlur=this.An}enableDash(e,t){this.G1=!0,this.Wo=e,this.Ca=t}disableDash(){this.G1=!1}clearContextCache(e){}setImageSmoothingEnabled(e){}rotate(e){this.Zi.rotate(57.2958*e,0,0)}getImageData(e,t,i,s){return null}measureText(e){return null}removeOldGradient(e,t,i){const s=t.getAttribute(i);if(null===s)return;const n=s.split("#");if(1===n.length)return;const o=this.svg.getElementById(n[1].slice(0,-1));if(null!==o){const r=new RegExp(o.id,"g");1===this.svg.innerHTML.match(r).length&&o.remove()}}removePartFromView(e){null!==e.svg&&e.svg.parentNode===this.diagramGroup&&e.svg.remove()}}class Oe{bt;_t;el;ud;constructor(e,t,i,s){const n=void 0===t?X.document:t;this.el=n,this.ud=null;const o=n.createElement("canvas");o.tabIndex=0,this.bt=o,this._t=new gi(o,i,s),e&&U.Wi.set(o,e)}resize(e,t,i,s){return(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",!0)}toDataURL(e,t){return this.bt.toDataURL(e,t)}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return this.bt.width}set width(e){this.bt.width=e}get height(){return this.bt.height}set height(e){this.bt.height=e}dispose(){U.Wi.delete(this.bt),this.el=null}get style(){return this.bt.style}}class gi{F;Y1;K1;H1;clipInsteadOfFill;Mf;Nf;An;zh;rl;Fr;constructor(e,t,i){e.getContext||y.o("Browser does not support HTML Canvas Element"),this.F=e.getContext("2d",t),this.Y1="",this.K1="",this.H1="",this.clipInsteadOfFill=!1,this.Mf=0,this.Nf=0,this.An=0,this.rl=!1,this.zh=new Ot,this.Fr=!!i}createOrUpdateClipGroup(e,t){}setImageSmoothingEnabled(e){this.F.imageSmoothingEnabled=e}get fillStyle(){return this.F.fillStyle}set fillStyle(e){this.H1!==e&&(this.F.fillStyle=e,this.H1=e)}get font(){return this.F.font}set font(e){this.Y1!==e&&(this.F.font=e,this.Y1=e)}get globalAlpha(){return this.F.globalAlpha}set globalAlpha(e){this.F.globalAlpha=e}get lineCap(){return this.F.lineCap}set lineCap(e){this.F.lineCap=e}get lineDashOffset(){return this.F.lineDashOffset}set lineDashOffset(e){this.F.lineDashOffset=e}get lineJoin(){return this.F.lineJoin}set lineJoin(e){this.F.lineJoin=e}get lineWidth(){return this.F.lineWidth}set lineWidth(e){this.F.lineWidth=e}get miterLimit(){return this.F.miterLimit}set miterLimit(e){this.F.miterLimit=e}get shadowBlur(){return this.F.shadowBlur}set shadowBlur(e){this.F.shadowBlur=e}get shadowColor(){return this.F.shadowColor}set shadowColor(e){this.F.shadowColor=e}get shadowOffsetX(){return this.F.shadowOffsetX}set shadowOffsetX(e){this.F.shadowOffsetX=e}get shadowOffsetY(){return this.F.shadowOffsetY}set shadowOffsetY(e){this.F.shadowOffsetY=e}get strokeStyle(){return this.F.strokeStyle}set strokeStyle(e){this.K1!==e&&(this.F.strokeStyle=e,this.K1=e)}get textAlign(){return this.F.textAlign}set textAlign(e){this.F.textAlign=e}get imageSmoothingEnabled(){return this.F.imageSmoothingEnabled}set imageSmoothingEnabled(e){this.F.imageSmoothingEnabled=e}get filter(){return this.F.filter}set filter(e){this.F.filter=""===e?"none":e}get letterSpacing(){return this.F.letterSpacing}set letterSpacing(e){this.F.letterSpacing=e}get wordSpacing(){return this.F.wordSpacing}set wordSpacing(e){this.F.wordSpacing=e}arc(e,t,i,s,n,o,r,a){this.F.arc(e,t,i,s,n,o)}beginPath(){this.F.beginPath()}endPath(){}bezierCurveTo(e,t,i,s,n,o){this.F.bezierCurveTo(e,t,i,s,n,o)}clearRect(e,t,i,s){this.commitTransform(),this.F.clearRect(e,t,i,s)}clip(e){e?this.F.clip(e):this.F.clip()}closePath(){this.F.closePath()}createLinearGradient(e,t,i,s){return this.F.createLinearGradient(e,t,i,s)}createPattern(e,t){return this.F.createPattern(e,t)}createRadialGradient(e,t,i,s,n,o){return this.F.createRadialGradient(e,t,i,s,n,o)}drawImage(e,t,i,s,n,o,r,a,l){void 0===s?this.F.drawImage(e,t,i):this.F.drawImage(e,t,i,s,n,o,r,a,l)}fill(e,t){t?this.F.fill(t,e?"evenodd":"nonzero"):this.F.fill(e?"evenodd":"nonzero")}fillRect(e,t,i,s){this.F.fillRect(e,t,i,s)}fillBackground(e,t,i,s){this.F.fillRect(e,t,i,s)}fillText(e,t,i){this.F.fillText(e,t,i)}getImageData(e,t,i,s){return this.F.getImageData(e,t,i,s)}lineTo(e,t){this.F.lineTo(e,t)}measureText(e){return this.F.measureText(e)}moveTo(e,t){this.F.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this.F.quadraticCurveTo(e,t,i,s)}rect(e,t,i,s){this.F.rect(e,t,i,s)}restore(){this.F.restore()}save(){this.commitTransform(),this.F.save()}rotate(e){this.zh.ks(57.2958*e,0,0)}setTransform(e,t,i,s,n,o){this.zh.setTo(e,t,i,s,n,o)}scale(e,t){this.zh.it(e,t)}translate(e,t){this.zh.Gs(e,t)}stroke(e){e?this.F.stroke(e):this.F.stroke()}transform(e,t,i,s,n,o){if(1===e&&0===t&&0===i&&1===s&&0===n&&0===o)return;const r=this.zh,a=r.m11*e+r.m21*t,l=r.m12*e+r.m22*t,h=r.m11*i+r.m21*s,c=r.m12*i+r.m22*s;r.dx=r.m11*n+r.m21*o+r.dx,r.dy=r.m12*n+r.m22*o+r.dy,r.m11=a,r.m12=l,r.m21=h,r.m22=c}commitTransform(){const e=this.zh;this.F.setTransform(e.m11,e.m12,e.m21,e.m22,e.dx,e.dy)}fillContext(e,t,i){this.radialFill(e,t,i)||this.fillOrClip(t,i)}radialFill(e,t,i){if(!(e instanceof V)||3!==e.type)return!1;const s=e.bf,n=e.V1;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(t,i),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(e,t){this.clipInsteadOfFill?this.clip(t):this.fill(e,t)}shadowsSet(e,t,i){this.Mf=e,this.Nf=t,this.An=i}shadowsOff(){this.rl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.rl=!0,this.shadowOffsetX=this.Mf,this.shadowOffsetY=this.Nf,this.shadowBlur=this.An}enableDash(e,t){const i=this.F;void 0!==i.setLineDash&&(i.setLineDash(e),i.lineDashOffset=t)}disableDash(){const e=this.F;void 0!==e.setLineDash&&(e.setLineDash(gi.EmptyArray),e.lineDashOffset=0)}clearContextCache(e){e&&(this.Y1=""),this.K1="",this.H1=""}removePartFromView(e){}static EmptyArray=Object.freeze([])}var Re=(m=>(m[m.Solid=1]="Solid",m[m.Linear=2]="Linear",m[m.Radial=3]="Radial",m[m.Pattern=4]="Pattern",m))(Re||{}),Bs=(m=>(m[m.Lab=1]="Lab",m[m.HSL=2]="HSL",m[m.Oklch=3]="Oklch",m))(Bs||{});class ei{n0;n1;n2;n3;constructor(){this.n0=0,this.n1=0,this.n2=0,this.n3=0}}class V{f;W;Xh;ae;Cs;k0;P0;Jo;S0;Cn;bf;V1;constructor(e,t){if(z.Je(this),this.f=!1,void 0===e)this.W=1,this.Xh="black";else if("string"==typeof e){const s=y.$a(Re,e);null!==s?(this.W=s,this.Xh="black"):(this.W=1,this.Xh=e)}else Object.keys(Re).hasOwnProperty(e)?(this.W=e,this.Xh="black"):"object"==typeof e&&(this.W=1,t=e);const i=this.W;if(2===i?(this.ae=A.TopCenter,this.Cs=A.BottomCenter):3===i?(this.ae=A.Center,this.Cs=A.Center):(this.ae=A.None,this.Cs=A.None),this.k0=0,this.P0=NaN,this.Jo=null,this.S0=null,this.Cn=null,this.bf=0,this.V1=0,t){const s={};for(const n in t)isFinite(parseFloat(n))?this.addColorStop(parseFloat(n),t[n]):s[n]=t[n];Object.assign(this,s)}}copy(){const e=new V;return e.W=this.W,e.Xh=this.Xh,e.ae=this.ae.N(),e.Cs=this.Cs.N(),e.k0=this.k0,e.P0=this.P0,null!==this.Jo&&(e.Jo=this.Jo.copy()),e.S0=this.S0,e}k(){return this.f=!0,null!==this.Jo&&this.Jo.k(),this}fe(e){e in Re?this.type=e:y.dr(this,e)}toString(){let e="Brush(";if(1===this.type)e+=this.color;else if(e+=2===this.type?"Linear ":3===this.type?"Radial ":4===this.type?"Pattern ":"(unknown) ",e+=this.start+" "+this.end,null!==this.colorStops){const t=this.colorStops.iterator;for(;t.next();)e+=" "+t.key+":"+t.value}return e+=")",e}addColorStop(e,t){return this.f&&y.L(this),("number"!=typeof e||!isFinite(e)||e>1||e<0)&&y.J(e,"0 <= loc <= 1",V,"addColorStop:loc"),y.s(t,"string",V,"addColorStop:color"),null===this.Jo&&(this.Jo=new xt),this.Jo.set(e,t),1===this.W&&(this.type=2),this.Cn=null,this}get type(){return this.W}set type(e){this.f&&y.L(this,e),this.W=e,this.start.isNoSpot()&&(2===e?this.start=A.TopCenter:3===e&&(this.start=A.Center)),this.end.isNoSpot()&&(2===e?this.end=A.BottomCenter:3===e&&(this.end=A.Center)),this.Cn=null}get color(){return this.Xh}set color(e){this.f&&y.L(this,e),this.Xh=e,this.Cn=null}get start(){return this.ae}set start(e){this.f&&y.L(this,e),this.ae=e.N(),this.Cn=null}get end(){return this.Cs}set end(e){this.f&&y.L(this,e),this.Cs=e.N(),this.Cn=null}get startRadius(){return this.k0}set startRadius(e){this.f&&y.L(this,e),e<0&&y.J(e,">= zero",V,"startRadius"),this.k0=e,this.Cn=null}get endRadius(){return this.P0}set endRadius(e){this.f&&y.L(this,e),e<0&&y.J(e,">= zero",V,"endRadius"),this.P0=e,this.Cn=null}get colorStops(){return this.Jo}set colorStops(e){this.f&&y.L(this,e),this.Jo=e,this.Cn=null}get pattern(){return this.S0}set pattern(e){this.f&&y.L(this,e),this.S0=e,this.Cn=null}static randomColor(e,t){void 0===e&&(e=128),void 0===t&&(t=Math.max(e,255));const i=Math.abs(t-e);let s=Math.floor(e+Math.random()*i).toString(16),n=Math.floor(e+Math.random()*i).toString(16),o=Math.floor(e+Math.random()*i).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),"#"+s+n+o}static isValidColor(e){return!X.CSS||X.CSS.supports("color",e)}static lighten(e){return V.lightenBy(e)}lightenBy(e,t){this.f&&y.L(this);const i=void 0===e||"number"!=typeof e?.2:e,s=void 0===t?3:t;if(1===this.type)V.Uo(this.color),this.color=V.Ld(i,s);else if((2===this.type||3===this.type)&&null!==this.colorStops){const n=this.colorStops.iterator;for(;n.next();)V.Uo(n.value),this.addColorStop(n.key,V.Ld(i,s))}return this}static lightenBy(e,t,i){const s=void 0===t||"number"!=typeof t?.2:t,n=void 0===i?3:i;return V.Uo(e),V.Ld(s,n)}static darken(e){return V.darkenBy(e)}darkenBy(e,t){this.f&&y.L(this);const i=void 0===e||"number"!=typeof e?.2:e,s=void 0===t?3:t;if(1===this.type)V.Uo(this.color),this.color=V.Ld(-i,s);else if((2===this.type||3===this.type)&&null!==this.colorStops){const n=this.colorStops.iterator;for(;n.next();)V.Uo(n.value),this.addColorStop(n.key,V.Ld(-i,s))}return this}static darkenBy(e,t,i){const s=void 0===t||"number"!=typeof t?.2:t,n=void 0===i?3:i;return V.Uo(e),V.Ld(-s,n)}static mix(e,t,i){V.Uo(e);const s=V.Y.n0,n=V.Y.n1,o=V.Y.n2,r=V.Y.n3;return V.Uo(t),void 0===i&&(i=.5),`rgba(${Math.round((V.Y.n0-s)*i+s)}, ${Math.round((V.Y.n1-n)*i+n)}, ${Math.round((V.Y.n2-o)*i+o)}, ${Math.round((V.Y.n3-r)*i+r)})`}isDark(){if(1===this.type)return V.isDark(this.color);if((2===this.type||3===this.type)&&null!==this.colorStops){const e=this.colorStops;if(3===this.type){const a=e.first();return!!a&&V.isDark(a.value)}if(null!==e.get(.5))return V.isDark(e.get(.5));if(2===e.count){const a=e.toArray();return V.isDark(V.mix(a[0].value,a[1].value))}const t=e.iterator;let i=-1,s=-1,n=1,o=1;for(;t.next();){const a=t.key,l=Math.abs(.5-t.key);n>o&&l<n?(i=a,n=l):o>=n&&l<o&&(s=a,o=l)}if(i>s){let a=i;i=s,s=a,a=n,n=o,o=a}const r=s-i;return V.isDark(V.mix(e.get(i),e.get(s),1-o/r))}return!1}static isDark(e){return!!e&&(e instanceof V?e.isDark():(V.Uo(e),(299*V.Y.n0+587*V.Y.n1+114*V.Y.n2)/1e3<128))}static Ld(e,t){switch(t){case 1:return V.kI(),V.co.n0=Math.min(100,Math.max(0,V.co.n0+100*e)),V.SI(),"rgba("+V.Y.n0+", "+V.Y.n1+", "+V.Y.n2+", "+V.Y.n3+")";case 2:return V.OM(),V.ze.n2=Math.min(100,Math.max(0,V.ze.n2+100*e)),"hsla("+V.ze.n0+", "+V.ze.n1+"%, "+V.ze.n2+"%, "+V.ze.n3+")";case 3:return V.MI(),V.fo.n0=Math.min(100,Math.max(0,V.fo.n0+100*e)),V.NI(),"rgba("+V.Y.n0+", "+V.Y.n1+", "+V.Y.n2+", "+V.Y.n3+")";default:y.o("Unknown color space: "+t)}}static Uo(e){!1===V.M0&&(V.M0=!0,V.us=U.isUsingDOM()?new Oe(null,void 0,{willReadFrequently:!0})._t:null);const t=V.us;if(null===t)return;t.clearRect(0,0,1,1),t.fillStyle="#000000";const i=t.fillStyle;if(t.fillStyle=e,t.fillStyle!==i){t.fillRect(0,0,1,1);const s=t.getImageData(0,0,1,1).data;V.Y.n0=s[0],V.Y.n1=s[1],V.Y.n2=s[2],V.Y.n3=s[3]/255}else t.fillStyle="#FFFFFF",t.fillStyle=e,V.Y.n0=0,V.Y.n1=0,V.Y.n2=0,V.Y.n3=1}static OM(){const e=V.Y.n0/255,t=V.Y.n1/255,i=V.Y.n2/255,s=Math.max(e,t,i),n=Math.min(e,t,i),o=s-n;let r,a;const l=(s+n)/2;if(0===o)r=a=0;else{switch(s){case e:r=(t-i)/o%6;break;case t:r=(i-e)/o+2;break;case i:r=(e-t)/o+4;break;default:r=0}r*=60,r<0&&(r+=360),a=o/(1-Math.abs(2*l-1))}V.ze.n0=Math.round(r),V.ze.n1=Math.round(100*a),V.ze.n2=Math.round(100*l),V.ze.n3=V.Y.n3}static VU(){const e=V.ze.n0,t=V.ze.n1/100,i=V.ze.n2/100;let s,n,o;const r=(1-Math.abs(2*i-1))*t,a=e/60,l=r*(1-Math.abs(a%2-1));a>=0&&a<1?(s=r,n=l,o=0):a>=1&&a<2?(s=l,n=r,o=0):a>=2&&a<3?(s=0,n=r,o=l):a>=3&&a<4?(s=0,n=l,o=r):a>=4&&a<5?(s=l,n=0,o=r):(s=r,n=0,o=l);const h=i-.5*r;s+=h,n+=h,o+=h,V.Y.n0=Math.round(255*s),V.Y.n1=Math.round(255*n),V.Y.n2=Math.round(255*o),V.Y.n3=V.ze.n3}static kI(){V.rD(),V.CI()}static SI(){V.LI(),V.lD()}static UN(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}static VN(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055}static rD(){const e=V.UN(V.Y.n0),t=V.UN(V.Y.n1),i=V.UN(V.Y.n2);V.At.n0=.4124564*e+.3575761*t+.1804375*i,V.At.n1=.2126729*e+.7151522*t+.072175*i,V.At.n2=.0193339*e+.119192*t+.9503041*i,V.At.n3=V.Y.n3}static lD(){const t=-.969266*V.At.n0+1.8760108*V.At.n1+.041556*V.At.n2,i=.0556434*V.At.n0+-.2040259*V.At.n1+1.0572252*V.At.n2;V.Y.n0=255*V.VN(3.2404542*V.At.n0+-1.5371385*V.At.n1+-.4985314*V.At.n2),V.Y.n1=255*V.VN(t),V.Y.n2=255*V.VN(i),V.Y.n3=V.At.n3,V.Y.n0=Math.round(V.Y.n0),V.Y.n0>255?V.Y.n0=255:V.Y.n0<0&&(V.Y.n0=0),V.Y.n1=Math.round(V.Y.n1),V.Y.n1>255?V.Y.n1=255:V.Y.n1<0&&(V.Y.n1=0),V.Y.n2=Math.round(V.Y.n2),V.Y.n2>255?V.Y.n2=255:V.Y.n2<0&&(V.Y.n2=0)}static BN=216/24389;static j1=24389/27;static Ad=[95.047,100,108.883];static zN(e){return e>V.BN?Math.pow(e,1/3):(V.j1*e+16)/116}static CI(){const e=V.zN(100*V.At.n0/V.Ad[0]),t=V.zN(100*V.At.n1/V.Ad[1]),i=V.zN(100*V.At.n2/V.Ad[2]);V.co.n0=116*t-16,V.co.n1=500*(e-t),V.co.n2=200*(t-i),V.co.n3=V.At.n3}static aD(e){const t=e*e*e;return t>V.BN?t:(116*e-16)/V.j1}static LI(){const e=(V.co.n0+16)/116,i=e-V.co.n2/200;V.At.n0=V.Ad[0]/100*V.aD(V.co.n1/500+e),V.At.n1=V.Ad[1]/100*(V.co.n0>V.j1*V.BN?Math.pow(e,3):V.co.n0/V.j1),V.At.n2=V.Ad[2]/100*V.aD(i),V.At.n3=V.co.n3}static AI(){let e=.8190224*V.At.n0+.3619062*V.At.n1+-.1288737*V.At.n2,t=.03298366*V.At.n0+.9292868*V.At.n1+.03614466*V.At.n2,i=.04817719*V.At.n0+.2642395*V.At.n1+.6335478*V.At.n2;e=Math.cbrt(e),t=Math.cbrt(t),i=Math.cbrt(i),V.ge.n0=.2104542*e+.7936177*t+-.004072046*i,V.ge.n1=1.977998*e+-2.428592*t+.4505937*i,V.ge.n2=.02590403*e+.7827717*t+-.8086757*i,V.ge.n3=V.At.n3,V.ge.n0*=100}static TI(){V.ge.n0/=100;let e=.9999999*V.ge.n0+.3963377*V.ge.n1+.2158037*V.ge.n2,t=1.000000009*V.ge.n0+-.1055613*V.ge.n1+-.06385417*V.ge.n2,i=1.00000005*V.ge.n0+-.08948418*V.ge.n1+-1.291485*V.ge.n2;e=e**3,t=t**3,i=i**3,V.At.n0=1.2268798*e+-.5578149*t+.281391*i,V.At.n1=-.04057576*e+1.112286*t+-.07171106*i,V.At.n2=-.07637294*e+-.4214933*t+1.586924*i,V.At.n3=V.ge.n3}static DI(){const e=180*Math.atan2(V.ge.n2,V.ge.n1)/Math.PI;V.fo.n0=V.ge.n0,V.fo.n1=Math.sqrt(V.ge.n1**2+V.ge.n2**2),V.fo.n2=e>=0?e:e+360,V.fo.n3=V.ge.n3}static vI(){V.ge.n0=V.fo.n0,V.ge.n1=V.fo.n1*Math.cos(V.fo.n2*Math.PI/180),V.ge.n2=V.fo.n1*Math.sin(V.fo.n2*Math.PI/180),V.ge.n3=V.fo.n3}static MI(){V.rD(),V.AI(),V.DI()}static NI(){V.vI(),V.TI(),V.lD()}static Md(e,t){"string"==typeof e||e instanceof V||y.o("Value for "+t+" must be a color string or a Brush, not "+e)}static Solid=1;static Linear=2;static Radial=3;static Pattern=4;static Lab=1;static HSL=2;static us=null;static M0=!1;static Y=new ei;static ze=new ei;static At=new ei;static co=new ei;static ge=new ei;static fo=new ei}class Rt{Pt="Base";static fs=new xt;static Tn(e,t){t.name=e,Rt.fs.set(e,t)}get name(){return this.Pt}set name(e){this.Pt=e}constructor(){}get classType(){return J}measure(e,t,i,s,n,o,r){}measureElement(e,t,i,s,n){e.ht(t,i,s,n)}arrange(e,t,i){}arrangeElement(e,t,i,s,n,o){e.Ut(t,i,s,n,o)}remeasureObject(e){e.kf()}Ge(e,t,i){}}Rt.Tn("Position",new class io extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length,l=e.$o();for(let h=0;h<a;h++){const c=s[h];if(!c.visible&&c!==l)continue;const u=c.margin,d=u.right+u.left,f=u.top+u.bottom;c.ht(t,i,o,r);const p=c.measuredBounds,g=Math.max(p.width+d,0),b=Math.max(p.height+f,0);let x=c.position.x,v=c.position.y;if(isFinite(x)||(x=0),isFinite(v)||(v=0),c instanceof rt&&c.isGeometryPositioned){const P=c.strokeWidth/2;x-=P,v-=P}n.re(x,v,g,b)}}arrange(e,t,i){const s=t.length,n=e.padding,o=i.x-n.left,r=i.y-n.top;for(let a=0;a<s;a++){const l=t[a],h=l.measuredBounds,c=l.margin,u=l.position.x,d=l.position.y;let f=isNaN(u)?-o:u-o,p=isNaN(d)?-r:d-r;if(l instanceof rt&&l.isGeometryPositioned){const g=l.strokeWidth/2;f-=g,p-=g}l.visible&&l.Ut(f+c.left,p+c.top,h.width,h.height)}}}),Rt.Tn("Horizontal",new class so extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length,l=y.nt(),h=e.$o();for(let u=0;u<a;u++){const d=s[u];if(!d.visible&&d!==h)continue;const f=d.Qs(!1);if(0!==f&&5!==f){l.push(d);continue}d.ht(1/0,i,0,r);const p=d.margin,g=d.measuredBounds,b=Math.max(g.width+p.right+p.left,0),x=Math.max(g.height+p.top+p.bottom,0);n.jn(n.width+b,Math.max(n.height,x))}const c=l.length;e.desiredSize.height?i=Math.min(e.desiredSize.height,e.maxSize.height):0!==n.height&&(i=Math.min(n.height,e.maxSize.height));for(let u=0;u<c;u++){const d=l[u];if(!d.visible&&d!==h)continue;const f=d.margin,p=f.right+f.left,g=f.top+f.bottom;d.ht(1/0,i,0,r);const b=d.measuredBounds,x=Math.max(b.width+p,0),v=Math.max(b.height+g,0);n.width+=x,n.height=Math.max(n.height,v)}y.Z(l)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.top,r=e.isOpposite;let a=r?i.width:n.left;for(let l=0;l<s;l++){const h=o,c=t[l];if(!c.visible)continue;const u=c.measuredBounds,d=c.margin,f=d.top+d.bottom,p=o+n.bottom;let g=u.height;const b=c.Qs(!1);(isNaN(c.desiredSize.height)&&2===b||4===b)&&(g=Math.max(i.height-f-p,0));const x=g+f+p;let v=c.alignment;v.isDefault()&&(v=e.defaultAlignment),v.isSpot()||(v=A.Center),r&&(a-=u.width+d.left+d.right),c.Ut(a+v.offsetX+d.left,h+v.offsetY+d.top+(i.height*v.y-x*v.y),u.width,g),r||(a+=u.width+d.left+d.right)}}}),Rt.Tn("Vertical",new class no extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length,l=y.nt(),h=e.$o();for(let u=0;u<a;u++){const d=s[u];if(!d.visible&&d!==h)continue;const f=d.Qs(!1);if(0!==f&&4!==f){l.push(d);continue}d.ht(t,1/0,o,0);const p=d.margin,g=d.measuredBounds,b=Math.max(g.width+p.right+p.left,0),x=Math.max(g.height+p.top+p.bottom,0);n.jn(Math.max(n.width,b),n.height+x)}const c=l.length;e.desiredSize.width?t=Math.min(e.desiredSize.width,e.maxSize.width):0!==n.width&&(t=Math.min(n.width,e.maxSize.width));for(let u=0;u<c;u++){const d=l[u];if(!d.visible&&d!==h)continue;const f=d.margin,p=f.right+f.left,g=f.top+f.bottom;d.ht(t,1/0,o,0);const b=d.measuredBounds,x=Math.max(b.width+p,0),v=Math.max(b.height+g,0);n.width=Math.max(n.width,x),n.height+=v}y.Z(l)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,r=e.isOpposite;let a=r?i.height:n.top;for(let l=0;l<s;l++){const h=o,c=t[l];if(!c.visible)continue;const u=c.measuredBounds,d=c.margin,f=d.left+d.right,p=o+n.right;let g=u.width;const b=c.Qs(!1);(isNaN(c.desiredSize.width)&&2===b||5===b)&&(g=Math.max(i.width-f-p,0));const x=g+f+p;let v=c.alignment;v.isDefault()&&(v=e.defaultAlignment),v.isSpot()||(v=A.Center),r&&(a-=u.height+d.bottom+d.top),c.Ut(h+v.offsetX+d.left+(i.width*v.x-x*v.x),a+v.offsetY+d.top,g,u.height),r||(a+=u.height+d.bottom+d.top)}}});let oo=(()=>{class m extends Rt{constructor(){super()}static hD=!1;measure(t,i,s,n,o,r,a){const l=n.length;if(0===l)return;const h=t.findMainElement();let c=h.margin,u=0,d=0;const f=c.right+c.left,p=c.top+c.bottom;h.ht(i,s,r,a);let g=h.measuredBounds,b=g.width,x=g.height,v=Math.max(b+f,0),P=Math.max(x+p,0);const w=t.isClipping;w&&0!==h.jp()&&!m.hD&&(m.hD=!0,y.ne("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+t.toString()));const M=j.z(-c.left,-c.top,v,P);let C=j.z(0,0,b,x);this.XN(h,C,!0),b=C.width,x=C.height;let N=!0;const I=t.$o();let T;for(let D=0;D<l;D++){const F=n[D];let E=i,B=s;if(F===h||!F.visible&&F!==I)continue;c=F.margin;let Y=c.left,W=c.top;switch(u=c.right+c.left,d=c.top+c.bottom,T=F.Qs(!1),T){case 2:E=b,B=x,u=0,d=0,Y=0,W=0;break;case 5:E=b,u=0,Y=0;break;case 4:B=x,d=0,W=0}F.ht(E,B,0,0),g=F.measuredBounds,v=Math.max(g.width+u,0),P=Math.max(g.height+d,0);let $=F.alignment;$.isDefault()&&($=t.defaultAlignment),$.isSpot()||($=A.Center);let K=F.alignmentFocus;K.isDefault()&&(K=A.Center);let Z=null;F instanceof J&&""!==F.uo&&(Z=F.findObject(F.uo),Z===F&&(Z=null));let it=C.x-Y,yt=C.y-W;if(null!==Z){F.Ut(0,0,g.width,g.height);const ot=Z.actualBounds,at=S.z(ot.x+(K.x*ot.width-K.offsetX),ot.y+(K.y*ot.height-K.offsetY));for(Z=Z.panel;null!==Z&&Z!==F;)Z.v.gt(at),Z=Z.panel;it+=$.x*b+$.offsetX-at.x,yt+=$.y*x+$.offsetY-at.y,S.i(at)}else it+=$.x*b+$.offsetX-(K.x*g.width+K.offsetX),yt+=$.y*x+$.offsetY-(K.y*g.height+K.offsetY);N?(N=!1,o.e(it,yt,v,P)):o.re(it,yt,v,P)}switch(N?o.h(M):w?o.intersect(C.x,C.y,C.width,C.height):o.re(M.x,M.y,M.width,M.height),j.i(M),j.i(C),T=h.stretch,1===T&&(T=h.Qs(!1)),T){case 0:return;case 2:if(!isFinite(i)&&!isFinite(s))return;break;case 5:if(!isFinite(i))return;break;case 4:if(!isFinite(s))return}g=h.measuredBounds,b=g.width,x=g.height,v=Math.max(b+f,0),P=Math.max(x+p,0),c=h.margin,C=j.z(-c.left,-c.top,v,P),this.XN(h,C,!0),b=C.width,x=C.height;for(let D=0;D<l;D++){const F=n[D];if(F===h||!F.visible&&F!==I)continue;c=F.margin,u=c.right+c.left,d=c.top+c.bottom,g=F.measuredBounds,v=Math.max(g.width+u,0),P=Math.max(g.height+d,0);let E=F.alignment;E.isDefault()&&(E=t.defaultAlignment),E.isSpot()||(E=A.Center);let B=F.alignmentFocus;B.isDefault()&&(B=A.Center),N?(N=!1,o.e(E.x*b+E.offsetX-(B.x*g.width+B.offsetX)-c.left,E.y*x+E.offsetY-(B.y*g.height+B.offsetY)-c.top,v,P)):o.re(E.x*b+E.offsetX-(B.x*g.width+B.offsetX)-c.left,E.y*x+E.offsetY-(B.y*g.height+B.offsetY)-c.top,v,P)}N?o.h(M):w?o.intersect(C.x,C.y,C.width,C.height):o.re(M.x,M.y,M.width,M.height),j.i(C)}arrange(t,i,s){const n=i.length;if(0===n)return;const o=t.findMainElement(),r=o.measuredBounds,a=r.width,l=r.height,h=t.padding,c=h.left,u=h.top;let d=c-s.x,f=u-s.y;o.Ut(d,f,a,l);const p=j.z(0,0,a,l);this.XN(o,p,!1);for(let g=0;g<n;g++){const b=i[g];if(b===o)continue;const x=b.measuredBounds,v=x.width,P=x.height;let w=b.alignment;w.isDefault()&&(w=t.defaultAlignment),w.isSpot()||(w=A.Center);let M=b.alignmentFocus;M.isDefault()&&(M=A.Center);let C=null;if(b instanceof J&&""!==b.uo&&(C=b.findObject(b.uo),C===b&&(C=null)),null!==C){const N=C.actualBounds,I=S.z(N.x+(M.x*N.width-M.offsetX),N.y+(M.y*N.height-M.offsetY));for(C=C.panel;null!==C&&C!==b;)C.v.gt(I),C=C.panel;d=w.x*p.width+w.offsetX-I.x,f=w.y*p.height+w.offsetY-I.y,S.i(I)}else d=w.x*p.width+w.offsetX-(M.x*v+M.offsetX),f=w.y*p.height+w.offsetY-(M.y*P+M.offsetY);d+=p.x-s.x,f+=p.y-s.y,b.visible&&b.Ut(c+d,u+f,v,P)}j.i(p)}XN(t,i,s){let n=null;if(t instanceof J&&""!==t.uo&&(n=t.findObject(t.uo),n===t&&(n=null)),null!==n)for(s&&t.Ut(0,0,i.width,i.height),i.h(n.actualBounds),n=n.panel;null!==n&&n!==t;)n.v.sm(i),n=n.panel}}return m})();Rt.Tn("Spot",new oo),Rt.Tn("Auto",new class ro extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length;if(0===a)return;const l=e.findMainElement();let h=l.margin,c=t,u=i;const d=h.right+h.left,f=h.top+h.bottom;l.ht(t,i,o,r);let p=l.measuredBounds,g=0,b=null;l instanceof rt&&(b=l,g=b.strokeWidth*b.scale);let x=Math.max(p.width+d,0),v=Math.max(p.height+f,0),P=e.GN(l);const w=P.x*x+P.offsetX,M=P.y*v+P.offsetY;let C=e.YN(l);const N=C.x*x+C.offsetX,I=C.y*v+C.offsetY;isFinite(t)&&(c=Math.max(Math.abs(w-N)-g,0)),isFinite(i)&&(u=Math.max(Math.abs(M-I)-g,0));let T=0,D=0;o>0&&(T=Math.max(Math.abs(P.x*o+P.offsetX-(C.x*o+C.offsetX))-g,0)),r>0&&(D=Math.max(Math.abs(P.y*r+P.offsetY-(C.y*r+C.offsetY))-g,0));const F=lt.l();F.e(0,0);const E=e.$o();for(let $=0;$<a;$++){const K=s[$];if(K===l||!K.visible&&K!==E)continue;h=K.margin;const Z=h.right+h.left,it=h.top+h.bottom;K.ht(c,u,T,D),p=K.measuredBounds,x=Math.max(p.width+Z,0),v=Math.max(p.height+it,0),F.e(Math.max(x,F.width),Math.max(v,F.height))}if(1===a)return p=l.measuredBounds,n.width=x,n.height=v,void lt.i(F);P=e.GN(l),C=e.YN(l);let B=0,Y=0;C.x!==P.x&&C.y!==P.y&&(B=F.width/Math.abs(C.x-P.x),Y=F.height/Math.abs(C.y-P.y)),lt.i(F),g=0,null!==b&&(g=b.strokeWidth*b.scale,6===b._S()&&(B=Y=Math.max(B,Y))),B+=Math.abs(P.offsetX)+Math.abs(C.offsetX)+g,Y+=Math.abs(P.offsetY)+Math.abs(C.offsetY)+g;let W=l.stretch;switch(1===W&&(W=l.Qs(!1)),W){case 0:o=0,r=0;break;case 2:isFinite(t)&&(B=t),isFinite(i)&&(Y=i);break;case 5:isFinite(t)&&(B=t),r=0;break;case 4:o=0,isFinite(i)&&(Y=i)}l.kf(),l.ht(B,Y,o,r),n.width=l.measuredBounds.width+d,n.height=l.measuredBounds.height+f}arrange(e,t,i){const s=t.length;if(0===s)return;const n=e.findMainElement(),o=n.measuredBounds,r=j.l();r.e(0,0,1,1);let a=n.margin;const l=a.left,h=a.top,c=e.padding,u=c.left,d=c.top;let f=l,p=h,g=o.width,b=o.height;n.Ut(u+f,d+p,g,b);const x=e.GN(n),v=e.YN(n),w=0+x.y*o.height+x.offsetY,M=0+v.x*o.width+v.offsetX,C=0+v.y*o.height+v.offsetY;r.x=0+x.x*o.width+x.offsetX,r.y=w,r.re(M,C,0,0),r.x+=l+u,r.y+=h+d;for(let N=0;N<s;N++){const I=t[N];if(I===n)continue;const T=I.measuredBounds;a=I.margin;const D=Math.max(T.width+a.right+a.left,0),F=Math.max(T.height+a.top+a.bottom,0);let E=I.alignment;E.isDefault()&&(E=e.defaultAlignment),E.isSpot()||(E=A.Center),f=r.width*E.x+E.offsetX-D*E.x+a.left+r.x,p=r.height*E.y+E.offsetY-F*E.y+a.top+r.y,g=r.width,b=r.height,I.visible&&(j.contains(r.x,r.y,r.width,r.height,f,p,T.width,T.height)?I.Ut(f,p,T.width,T.height):I.Ut(f,p,T.width,T.height,new j(r.x,r.y,r.width,r.height)))}j.i(r)}}),Rt.Tn("Table",new class ao extends Rt{constructor(){super(),this.name="Table"}measure(e,t,i,s,n,o,r){let a=s.length;const l=y.nt(),h=y.nt();for(let dt=0;dt<a;dt++){const tt=s[dt],wt=tt instanceof J?tt:null;if(null!==wt&&wt.ol()&&tt.visible){h.push(wt);const Lt=wt.D.r,Qt=Lt.length;for(let Wt=0;Wt<Qt;Wt++){const Jt=Lt[Wt];wt.type===J.TableRow?Jt.row=tt.row:wt.type===J.TableColumn&&(Jt.column=tt.column),l.push(Jt)}}else l.push(tt)}a=l.length,0===a&&(e.getRowDefinition(0),e.getColumnDefinition(0));const c=[];for(let dt=0;dt<a;dt++){const tt=l[dt];tt.visible&&(tt.xi(!0),tt.ao(!0),c[tt.row]||(c[tt.row]=[]),c[tt.row][tt.column]||(c[tt.row][tt.column]=[]),c[tt.row][tt.column].push(tt))}y.Z(l);const u=y.nt(),d=y.nt(),f=y.nt(),p={count:0},g={count:0};let b=t,x=i;const v=e.Qi,P=e._i;let w;a=v.length;for(let dt=0;dt<a;dt++)w=v[dt],void 0!==w&&(w.actual=0,w.Re=0);a=P.length;for(let dt=0;dt<a;dt++)w=P[dt],void 0!==w&&(w.actual=0,w.Re=0);let M=c.length,C=0;for(let dt=0;dt<M;dt++)c[dt]&&(C=Math.max(C,c[dt].length));const N=Math.min(e.topIndex,M-1),I=Math.min(e.leftIndex,C-1);let D,T=0;M=c.length;const F=e.$o();for(let dt=0;dt<M;dt++){if(!c[dt])continue;C=c[dt].length;const tt=e.getRowDefinition(dt);tt.actual=0,tt.Re=0;for(let wt=0;wt<C;wt++){if(!c[dt][wt])continue;const Lt=e.getColumnDefinition(wt);void 0===u[wt]&&(Lt.actual=0,Lt.Re=0,u[wt]=!0);const Qt=c[dt][wt],Wt=Qt.length;for(let Jt=0;Jt<Wt;Jt++){const Zt=Qt[Jt];if(!Zt.visible&&Zt!==F)continue;const Se=Zt.rowSpan>1,fe=Zt.columnSpan>1;(Se||fe)&&!(dt<N)&&!(wt<I)&&d.push(Zt);const me=Zt.margin,_t=me.right+me.left,ie=me.top+me.bottom;D=Zt.Qp(tt,Lt,!1);const we=Zt.desiredSize,Bt=!isNaN(we.width),Le=!isNaN(we.height);if(0!==D&&!(Bt&&Le)&&!(dt<N)&&!(wt<I)&&(!fe&&void 0===p[wt]&&(2===D||5===D)&&(p[wt]=-1,p.count++),!Se&&void 0===g[dt]&&(2===D||4===D)&&(g[dt]=-1,g.count++),!Se&&!fe&&f.push(Zt)),Zt.ht(1/0,1/0,0,0),dt<N||wt<I)continue;const le=Zt.measuredBounds,Me=Math.max(le.width+_t,0),De=Math.max(le.height+ie,0);if(1===Zt.rowSpan&&(0===D||5===D)){w=e.getRowDefinition(dt);const Ce=w.computeEffectiveSpacing(),bi=0===w.j;T=Math.max(De-w.actual,0),T+(bi?Ce:0)>x&&(T=Math.max(x-Ce,0)),w.Re=w.Re+T,w.actual=w.j+T,x=Math.max(x-(T+(bi?Ce:0)),0)}if(1===Zt.columnSpan&&(0===D||4===D)){w=e.getColumnDefinition(wt);const Ce=w.computeEffectiveSpacing(),bi=0===w.j;T=Math.max(Me-w.actual,0),T+(bi?Ce:0)>b&&(T=Math.max(b-Ce,0)),w.Re=w.Re+T,w.actual=w.j+T,b=Math.max(b-(T+(bi?Ce:0)),0)}(Se||fe)&&Zt.kf()}}}y.Z(u);let E=0,B=0;a=e.columnCount;for(let dt=0;dt<a;dt++){const tt=P[dt];void 0!==tt&&(E+=isNaN(tt.ki)?tt.Re:tt.ki,0!==tt.Re&&(E+=tt.computeEffectiveSpacing()))}a=e.rowCount;for(let dt=0;dt<a;dt++){const tt=v[dt];void 0!==tt&&(B+=isNaN(tt.ki)?tt.Re:tt.ki,0!==tt.Re&&(B+=tt.computeEffectiveSpacing()))}b=Math.max(t-E,0),x=Math.max(i-B,0);let Y=x,W=b;a=f.length;for(let dt=0;dt<a;dt++){const tt=f[dt],wt=e.getRowDefinition(tt.row),Lt=e.getColumnDefinition(tt.column),Qt=tt.measuredBounds,Wt=tt.margin,Zt=Wt.top+Wt.bottom;p[tt.column]=0===Lt.Re&&void 0!==p[tt.column]?Math.max(Qt.width+(Wt.right+Wt.left),p[tt.column]):null,g[tt.row]=0===wt.Re&&void 0!==g[tt.row]?Math.max(Qt.height+Zt,g[tt.row]):null}let Z,$=0,K=0;for(Z in g)"count"!==Z&&($+=g[Z]);for(Z in p)"count"!==Z&&(K+=p[Z]);const it=lt.l();for(let dt=0;dt<a;dt++){const tt=f[dt];if(!tt.visible&&tt!==F)continue;const wt=e.getRowDefinition(tt.row),Lt=e.getColumnDefinition(tt.column);let Qt=0;isFinite(Lt.width)?Qt=Lt.width:(Qt=isFinite(b)&&null!==p[tt.column]?0===K?Lt.actual+b:p[tt.column]/K*W:null!==p[tt.column]?b:Lt.actual||b,Qt=Math.max(0,Qt-Lt.computeEffectiveSpacing()));let Wt=0;switch(isFinite(wt.height)?Wt=wt.height:(Wt=isFinite(x)&&null!==g[tt.row]?0===$?wt.actual+x:g[tt.row]/$*Y:null!==g[tt.row]?x:wt.actual||x,Wt=Math.max(0,Wt-wt.computeEffectiveSpacing())),it.e(Math.max(Lt.minimum,Math.min(Qt,Lt.maximum)),Math.max(wt.minimum,Math.min(Wt,wt.maximum))),D=tt.Qp(wt,Lt,!1),D){case 5:it.height=Math.max(it.height,wt.actual+x);break;case 4:it.width=Math.max(it.width,Lt.actual+b)}const Jt=tt.margin,Zt=Jt.right+Jt.left,Se=Jt.top+Jt.bottom;tt.kf();let fe=Lt.minimum,me=wt.minimum;const _t=tt.measuredBounds;0===_t.width&&null!==p[tt.column]&&(fe=Math.max(fe,p[tt.column])),0===_t.height&&null!==g[tt.row]&&(me=Math.max(fe,g[tt.row])),tt.ht(it.width,it.height,fe,me);const ie=tt.measuredBounds;let we=Math.max(ie.width+Zt,0),Bt=Math.max(ie.height+Se,0);isFinite(b)&&(we=Math.min(we,it.width)),isFinite(x)&&(Bt=Math.min(Bt,it.height));let Le=0;Le=wt.actual,wt.actual=Math.max(wt.actual,Bt),wt.Re=Math.max(wt.Re,Bt),T=wt.actual-Le,x=Math.max(x-T,0),null===g[tt.row]&&(Y=Math.max(Y-T,0)),Le=Lt.actual,Lt.actual=Math.max(Lt.actual,we),Lt.Re=Math.max(Lt.Re,we),T=Lt.actual-Le,b=Math.max(b-T,0),null===p[tt.column]&&(W=Math.max(W-T,0))}y.Z(f);const yt=lt.l(),ot=y.nt(),at=y.nt();if(a=d.length,0!==a)for(let dt=0;dt<M;dt++){if(!c[dt])continue;C=c[dt].length;const tt=e.getRowDefinition(dt);ot[dt]=tt.actual;for(let wt=0;wt<C;wt++){if(!c[dt][wt])continue;const Lt=e.getColumnDefinition(wt);at[wt]=Lt.actual}}for(let dt=0;dt<a;dt++){const tt=d[dt];if(!tt.visible&&tt!==F)continue;const wt=e.getRowDefinition(tt.row),Lt=e.getColumnDefinition(tt.column);switch(it.e(Math.max(Lt.minimum,Math.min(t,Lt.maximum)),Math.max(wt.minimum,Math.min(i,wt.maximum))),D=tt.Qp(wt,Lt,!1),D){case 2:0!==at[Lt.index]&&(it.width=Math.min(it.width,at[Lt.index])),0!==ot[wt.index]&&(it.height=Math.min(it.height,ot[wt.index]));break;case 5:0!==at[Lt.index]&&(it.width=Math.min(it.width,at[Lt.index]));break;case 4:0!==ot[wt.index]&&(it.height=Math.min(it.height,ot[wt.index]))}isFinite(Lt.width)&&(it.width=Lt.width),isFinite(wt.height)&&(it.height=wt.height),yt.e(0,0);let Qt=Lt.minimum,Wt=wt.minimum;for(let Bt=1;Bt<tt.rowSpan&&!(tt.row+Bt>=e.rowCount);Bt++){if(w=e.getRowDefinition(tt.row+Bt),T=0,2===D||4===D){if(0===w.j)continue;T=Math.max(w.minimum,0===w.j?w.maximum:Math.min(w.j,w.maximum))}else T=Math.max(w.minimum,isNaN(w.ki)?w.maximum:Math.min(w.ki,w.maximum));yt.height+=T,Wt+=w.minimum}for(let Bt=1;Bt<tt.columnSpan&&!(tt.column+Bt>=e.columnCount);Bt++){if(w=e.getColumnDefinition(tt.column+Bt),T=0,2===D||5===D){if(0===w.j)continue;T=Math.max(w.minimum,0===w.j?w.maximum:Math.min(w.j,w.maximum))}else T=Math.max(w.minimum,isNaN(w.ki)?w.maximum:Math.min(w.ki,w.maximum));yt.width+=T,Qt+=w.minimum}it.width+=yt.width,it.height+=yt.height;const Jt=tt.margin,Zt=Jt.right+Jt.left,Se=Jt.top+Jt.bottom;tt.ht(it.width,it.height,Qt,Wt);const fe=tt.measuredBounds,me=Math.max(fe.width+Zt,0),_t=Math.max(fe.height+Se,0);let ie=0;for(let Bt=0;Bt<tt.rowSpan&&!(tt.row+Bt>=e.rowCount);Bt++)w=e.getRowDefinition(tt.row+Bt),ie+=w.total||0;if(ie<_t){let Bt=_t-ie;const Le=_t-ie;if(null!==tt.spanAllocation){const le=tt.spanAllocation;for(let Me=0;Me<tt.rowSpan&&!(Bt<=0||tt.row+Me>=e.rowCount);Me++){w=e.getRowDefinition(tt.row+Me);const De=w.j||0,Ce=le(tt,w,Le);w.actual=Math.min(w.maximum,De+Ce),w.j!==De&&(Bt-=w.j-De)}}for(;Bt>0&&void 0!==w;){const le=w.j||0;if(isNaN(w.height)&&w.maximum>le&&(w.actual=Math.min(w.maximum,le+Bt),w.j!==le&&(Bt-=w.j-le)),0===w.index)break;w=e.getRowDefinition(w.index-1)}}let we=0;for(let Bt=0;Bt<tt.columnSpan&&!(tt.column+Bt>=e.columnCount);Bt++)w=e.getColumnDefinition(tt.column+Bt),we+=w.total||0;if(we<me){let Bt=me-we;const Le=me-we;if(null!==tt.spanAllocation){const le=tt.spanAllocation;for(let Me=0;Me<tt.columnSpan&&!(Bt<=0||tt.column+Me>=e.columnCount);Me++){w=e.getColumnDefinition(tt.column+Me);const De=w.j||0,Ce=le(tt,w,Le);w.actual=Math.min(w.maximum,De+Ce),w.j!==De&&(Bt-=w.j-De)}}for(;Bt>0&&void 0!==w;){const le=w.j||0;if(isNaN(w.width)&&w.maximum>le&&(w.actual=Math.min(w.maximum,le+Bt),w.j!==le&&(Bt-=w.j-le)),0===w.index)break;w=e.getColumnDefinition(w.index-1)}}}y.Z(d),lt.i(yt),lt.i(it),void 0!==ot&&y.Z(ot),void 0!==at&&y.Z(at);let ft=0,ut=0;const kt=e.desiredSize,Mt=e.maxSize;D=e.Qs(!0),E=0,B=0;let et=0,Pt=0;a=e.columnCount;for(let dt=0;dt<a;dt++)if(void 0!==P[dt]){if(w=e.getColumnDefinition(dt),isFinite(w.width)){et+=w.width,et+=w.computeEffectiveSpacing();continue}if(2===w.q1()){et+=w.j,et+=w.computeEffectiveSpacing();continue}0!==w.j&&(E+=w.j,E+=w.computeEffectiveSpacing())}ft=isFinite(kt.width)?Math.min(kt.width,Mt.width):0!==D&&isFinite(t)?t:E,ft=Math.max(ft,isFinite(t)?Math.min(o,t):o),ft=Math.max(ft-et,0);const zt=0===E?1:Math.max(ft/E,1);for(let dt=0;dt<a;dt++)void 0!==P[dt]&&(w=e.getColumnDefinition(dt),!isFinite(w.width)&&2!==w.q1()&&(w.actual=w.j*zt),w.position=n.width,0!==w.j&&(n.width+=w.j,n.width+=w.computeEffectiveSpacing()));a=e.rowCount;for(let dt=0;dt<a;dt++)if(void 0!==v[dt]){if(w=e.getRowDefinition(dt),isFinite(w.height)){Pt+=w.height,Pt+=w.computeEffectiveSpacing();continue}if(2===w.q1()){Pt+=w.j,Pt+=w.computeEffectiveSpacing();continue}0!==w.j&&(B+=w.j,B+=w.computeEffectiveSpacing())}ut=isFinite(kt.height)?Math.min(kt.height,Mt.height):0!==D&&isFinite(i)?i:B,ut=Math.max(ut,isFinite(i)?Math.min(r,i):r),ut=Math.max(ut-Pt,0);const Tt=0===B?1:Math.max(ut/B,1);for(let dt=0;dt<a;dt++)void 0!==v[dt]&&(w=e.getRowDefinition(dt),!isFinite(w.height)&&2!==w.q1()&&(w.actual=w.j*Tt),w.position=n.height,0!==w.j&&(n.height+=w.j,n.height+=w.computeEffectiveSpacing()));a=h.length;for(let dt=0;dt<a;dt++){const tt=h[dt];let wt=0,Lt=0;tt.type===J.TableRow?(wt=n.width,w=e.getRowDefinition(tt.row),Lt=w.actual):(w=e.getColumnDefinition(tt.column),wt=w.actual,Lt=n.height),tt.measuredBounds.e(0,0,wt,Lt),tt.xi(!1)}y.Z(h),e.La=c}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,r=n.top,a=e.La;if(null===a)return;let l=0,h=0;const c=a.length;let u=0;for(let I=0;I<c;I++)a[I]&&(u=Math.max(u,a[I].length));const d=e.Qi,f=e._i;let p=0,g=0,b=Math.min(e.topIndex,c-1);if(d.length>0){for(;b!==c&&(void 0===d[b]||0===d[b].j);)b++;b=Math.max(Math.min(b,c-1),0),p=-d[b].position}let x=Math.min(e.leftIndex,u-1);if(f.length>0){for(;x!==u&&(void 0===f[x]||0===f[x].j);)x++;x=Math.max(Math.min(x,u-1),0),g=-f[x].position}let v=0,P=0;for(;v!==c&&void 0===d[v];)v++;for(;P!==c&&void 0===f[P];)P++;const w=e.part;let M=e.getRowDefinition(v),C=e.getColumnDefinition(P);for(let I=0;I<t.length;I++){const T=t[I];if(!(T instanceof J&&T.visible&&T.ol()))continue;T.type===J.TableRow?(M=e.getRowDefinition(T.row),C=e.getColumnDefinition(P)):(M=e.getRowDefinition(v),C=e.getColumnDefinition(T.column)),h=M.position+p+r,0!==M.j&&(h+=M.computeEffectiveSpacingTop(Math.max(v,b))),l=C.position+g+o,0!==C.j&&(l+=C.computeEffectiveSpacingTop(Math.max(P,x)));const D=T.measuredBounds;T.yf(),T.actualBounds.ce();const F=T.actualBounds,E=j.z(F.x,F.y,F.width,F.height);F.x=T.type===J.TableRow?o:l,F.y=T.type===J.TableColumn?r:h,F.width=D.width,F.height=D.height,T.actualBounds.k(),T.ao(!1),E.equalsApproxClose(F)||null!==w&&(w.Sa(),T.Wp(w)),j.i(E)}const N=lt.l();for(let I=0;I<c;I++){if(!a[I])continue;u=a[I].length;const T=e.getRowDefinition(I);h=T.position+p+r,0!==T.j&&(h+=T.computeEffectiveSpacingTop(Math.max(v,b)));for(let D=0;D<u;D++){if(!a[I][D])continue;const F=e.getColumnDefinition(D);l=F.position+g+o,0!==F.j&&(l+=F.computeEffectiveSpacingTop(Math.max(P,x)));const E=a[I][D],B=E.length;for(let Y=0;Y<B;Y++){const W=E[Y],$=W.measuredBounds;N.e(0,0);for(let _t=1;_t<W.rowSpan&&!(I+_t>=e.rowCount);_t++){const ie=e.getRowDefinition(I+_t);0!==ie.j&&(N.height+=ie.total)}for(let _t=1;_t<W.columnSpan&&!(D+_t>=e.columnCount);_t++){const ie=e.getColumnDefinition(D+_t);0!==ie.j&&(N.width+=ie.total)}const K=F.j+N.width,Z=T.j+N.height;let it=l,yt=h;const ot=K,at=Z,ft=l,ut=h;let kt=K,Mt=Z;l+K>i.width&&(kt=Math.max(i.width-l,0)),h+Z>i.height&&(Mt=Math.max(i.height-h,0));let et=W.alignment,Pt=0,zt=0,Tt=0,dt=0;if(et.isDefault()){et=e.defaultAlignment,et.isSpot()||(et=A.Center),Pt=et.x,zt=et.y,Tt=et.offsetX,dt=et.offsetY;const _t=F.alignment,ie=T.alignment;_t.isSpot()&&(Pt=_t.x,Tt=_t.offsetX),ie.isSpot()&&(zt=ie.y,dt=ie.offsetY)}else Pt=et.x,zt=et.y,Tt=et.offsetX,dt=et.offsetY;(isNaN(Pt)||isNaN(zt))&&(Pt=.5,zt=.5,Tt=0,dt=0);let tt=$.width,wt=$.height;const Lt=W.margin,Qt=Lt.left+Lt.right,Wt=Lt.top+Lt.bottom,Jt=W.Qp(T,F,!1);isNaN(W.desiredSize.width)&&(2===Jt||5===Jt)&&(tt=Math.max(K-Qt,0)),isNaN(W.desiredSize.height)&&(2===Jt||4===Jt)&&(wt=Math.max(Z-Wt,0));const Zt=W.maxSize,Se=W.minSize;tt=Math.min(Zt.width,tt),wt=Math.min(Zt.height,wt),tt=Math.max(Se.width,tt),wt=Math.max(Se.height,wt),it+=ot*Pt-(tt+Qt)*Pt+Tt+Lt.left,yt+=at*zt-(wt+Wt)*zt+dt+Lt.top,W.visible&&(j.contains(ft,ut,kt,Mt,it,yt,$.width,$.height)?W.Ut(it,yt,tt,wt):W.Ut(it,yt,tt,wt,new j(ft,ut,kt,Mt)))}}}lt.i(N);for(let I=0;I<s;I++){const T=t[I],D=T instanceof J?T:null;if(null!==D&&D.ol()){const F=T.actualBounds;T.naturalBounds.ce(),T.naturalBounds.e(0,0,F.width,F.height),T.naturalBounds.k()}}}}),Rt.Tn("TableRow",new class lo extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){}arrange(e,t,i){}}),Rt.Tn("TableColumn",new class ho extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){}arrange(e,t,i){}}),Rt.Tn("Viewbox",new class co extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){1!==s.length&&y.o("Viewbox Panel must contain exactly one GraphObject.");const a=s[0];a.it=1,a.kf(),a.ht(1/0,1/0,o,r);let l=a.measuredBounds;const h=a.margin,c=h.right+h.left,u=h.top+h.bottom;if(isFinite(t)||isFinite(i)){const d=a.scale,f=l.width,p=l.height,g=Math.max(t-c,0),b=Math.max(i-u,0);let x=1;6===e.viewboxStretch?(0!==f&&0!==p&&(x=Math.min(g/f,b/p)),0===x&&(x=1e-4),a.it*=x):(0!==f&&0!==p&&(x=Math.max(g/f,b/p)),0===x&&(x=1e-4),a.it*=x),d!==a.scale&&(a.xi(!0),a.ht(1/0,1/0,o,r))}l=a.measuredBounds,n.width=isFinite(t)?t:Math.max(l.width+c,0),n.height=isFinite(i)?i:Math.max(l.height+u,0)}arrange(e,t,i){const s=t[0],n=s.measuredBounds,o=s.margin,a=o.top+o.bottom,l=Math.max(n.width+(o.right+o.left),0),h=Math.max(n.height+a,0);let c=s.alignment;c.isDefault()&&(c=e.defaultAlignment),c.isSpot()||(c=A.Center),s.Ut(i.width*c.x-l*c.x+c.offsetX,i.height*c.y-h*c.y+c.offsetY,n.width,n.height)}}),Rt.Tn("Grid",new class uo extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){null===e.Pe&&(e.Pe=new ii),this.FI(e),this.RI(e)}arrange(e,t,i){}Ge(e,t,i){const s=e.naturalBounds;t.save(),t.beginPath(),t.rect(0,0,s.width,s.height),t.clip(),t.endPath(),this.OI(e,t,i),t.restore(),t.clearContextCache(!1)}OI(e,t,i){let s=e.getDocumentScale()*i.scale;s<=0&&(s=1);const n=e.gridCellSize,o=n.width,r=n.height,a=e.naturalBounds,l=e.actualBounds,h=a.width,c=a.height,u=Math.ceil(h/o),d=Math.ceil(c/r),f=e.gridOrigin,p=f.x,g=f.y,b=e.Pe.N0,x=e.D.r,v=x.length;for(let P=0;P<v;P++){const w=x[P];if(!w.visible)continue;const M=w.interval||1,C=Math.abs(M);if(o*C*s<2)continue;let N=w.segmentIndex;(!isFinite(N)||isNaN(N))&&(N=0),N<0&&(N=C-Math.min(-N,C)),N=Math.round(N%C);const I=w.opacity;let T=1;if(1!==I){if(0===I)continue;T=t.globalAlpha,t.globalAlpha=T*I}const D=b[P];let F=!1;const E=w.strokeDashArray;if(null!==E&&(F=!0,t.enableDash(E,w.strokeDashOffset)),null!==w.stroke&&w.strokeWidth>0&&("LineV"===w.figure||"LineH"===w.figure)){if(t.lineWidth=w.strokeWidth,e.kn(t,w.stroke,!1,!1,a,l),t.beginPath(),"LineV"===w.figure){const B=Math.floor((p-o)/o);for(let Y=B;Y<=B+u;Y++){const W=Y*o+p;0<=W&&W<=h&&this.W1(Y,M,N,D)&&(t.moveTo(W,0),t.lineTo(W,c))}}else if("LineH"===w.figure){const B=Math.floor((g-r)/r);for(let Y=B;Y<=B+d;Y++){const W=Y*r+g;0<=W&&W<=c&&this.W1(Y,M,N,D)&&(t.moveTo(0,W),t.lineTo(h,W))}}t.stroke(),t.endPath()}else if(null!==w.fill)if(e.kn(t,w.fill,!0,!1,a,l),"BarV"===w.figure){let B=w.width;isNaN(B)&&(B=o);const Y=Math.floor((p-o)/o);for(let W=Y;W<=Y+u;W++){const $=W*o+p;0<=$+B&&$<=h&&this.W1(W,M,N,D)&&t.fillRect($,0,B,c)}}else if("BarH"===w.figure){let B=w.height;isNaN(B)&&(B=r);const Y=Math.floor((g-r)/r);for(let W=Y;W<=Y+d;W++){const $=W*r+g;0<=$+B&&$<=c&&this.W1(W,M,N,D)&&t.fillRect(0,$,h,B)}}F&&t.disableDash(),1!==I&&(t.globalAlpha=T)}}W1(e,t,i,s){if(t<0)return e%t===i;if(e%t!==i)return!1;const n=s.length;for(let o=0;o<n;o++)if(e%s[o]===i)return!1;return!0}RI(e){const t=[],i=e.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(t.push(r),!o.visible)continue;const a=o.interval;if(a<0)continue;const h=this.KN(o.figure);for(let c=0;c<s;c++){if(c===n)continue;const u=i[c];if(!u.visible)continue;if(this.KN(u.figure)!==h)continue;const f=u.interval;f>a&&r.push(f)}}e.Pe.N0=t}KN(e){return"LineV"===e||"BarV"===e}FI(e){let t=1,i=1;const s=e.D.r,n=s.length;for(let a=0;a<n;a++){const l=s[a],h=Math.abs(l.interval);h<2||(this.KN(l.figure)?i=i*h/L.HL(i,h):t=t*h/L.HL(t,h))}const o=e.gridCellSize,r=e.Pe;r.af.isReal()?r.af.e(i*o.width,t*o.height):r.af=new lt(i*o.width,t*o.height)}}),Rt.Tn("Link",new class fo extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length;if(!(e instanceof Nt||e instanceof gt))return;let l=null,h=null;if(e instanceof gt&&(l=e),e instanceof Nt&&(h=e,l=h.adornedPart,null===e.Af&&(e.Af=[])),!(l instanceof gt))return;const c=l;if(0===a)return e.naturalBounds.jn(0,0),void e.measuredBounds.e(0,0,0,0);const u=e instanceof Nt?null:l.path,d=l.routeBounds,f=e.Zo;f.e(0,0,d.width,d.height);const p=c.points,g=l.pointsCount;null!==h?h.Td(!1):null!==l&&l.Td(!1);const b=d.width,x=d.height,v=e.Af;if(v.length=0,null!==u){this.measureLinkPath(e,b,x,u);const C=u.measuredBounds;f.unionRect(C),v.push(C)}const P=Ot.l(),w=S.l(),M=S.l();for(let C=0;C<a;C++){const N=s[C];if(N===u)continue;let I=N.measuredBounds;if(N.isPanelMain&&N instanceof rt){this.measureLinkPath(e,b,x,N),I=N.measuredBounds,f.unionRect(I),v.push(I);continue}if(g<2){N.ht(1/0,1/0,0,0),I=N.measuredBounds,f.unionRect(I),v.push(I);continue}const T=N.segmentIndex,D=N.segmentFraction;let F=N.alignmentFocus;F.isNoSpot()&&(F=A.Center);const E=N.segmentOrientation,B=N.segmentOffset;let Y=0,W=0,$=0,K=0;if(isNaN(T)){const et=c.ut,Pt=y.nt();et.getPointAndAngleAlongPath(D,Pt);const zt=S.z(Pt[0],Pt[1]);K=Pt[2],0!==E&&($=c.computeAngle(N,E,K),N.Xt=$,N.xi(!0),N.ao(!0)),Y=zt.x,W=zt.y,S.i(zt),y.Z(Pt)}else if(T<-g||T>=g){const et=S.l();c.HN(et),K=c.midAngle,0!==E&&($=c.computeAngle(N,E,K),N.Xt=$,N.xi(!0),N.ao(!0)),Y=et.x-d.x,W=et.y-d.y,S.i(et)}else{let et,Pt,zt=0;if(T>=0?(et=p.elt(T),Pt=T<g-1?p.elt(T+1):et):(zt=g+T,et=p.elt(zt),Pt=zt>0?p.elt(zt-1):et),et.equalsApprox(Pt)){let Tt,dt;T>=0?(Tt=T>0?p.elt(T-1):et,dt=T<g-2?p.elt(T+2):Pt):(Tt=zt<g-1?p.elt(zt+1):et,dt=zt>1?p.elt(zt-2):Pt);const tt=Tt.distanceSquaredPoint(et),wt=Pt.distanceSquaredPoint(dt);K=tt>wt+10?T>=0?Tt.directionPoint(et):et.directionPoint(Tt):wt>tt+10?T>=0?Pt.directionPoint(dt):dt.directionPoint(Pt):T>=0?Tt.directionPoint(dt):dt.directionPoint(Tt)}else K=T>=0?et.directionPoint(Pt):Pt.directionPoint(et);0!==E&&($=c.computeAngle(N,E,K),N.Xt=$,N.xi(!0),N.ao(!0)),Y=et.x+(Pt.x-et.x)*D-d.x,W=et.y+(Pt.y-et.y)*D-d.y}N.ht(1/0,1/0,0,0),I=N.measuredBounds;const Z=N.naturalBounds;let it=0;N instanceof rt&&(it=N.strokeWidth);const yt=Z.width+it,ot=Z.height+it;P.Ue(),P.Gs(-I.x,-I.y),P.it(N.scale,N.scale),P.ks(0===E?N.angle:K,yt/2,ot/2),(22===E||26===E)&&P.ks(90,yt/2,ot/2),(23===E||27===E)&&P.ks(-90,yt/2,ot/2),28===E&&(K>45&&K<135||K>225&&K<315)&&P.ks(-K,yt/2,ot/2);const at=new j(0,0,yt,ot);w.setRectSpot(at,F),P.gt(w);const ft=it/2*N.scale-w.x,ut=it/2*N.scale-w.y;M.h(B);const kt=isNaN(B.x),Mt=isNaN(B.y);if(kt||Mt){const et=yt/2+gt.J1,Pt=ot/2+gt.J1,zt=K>=45&&K<=135,Tt=K>=225&&K<=315;0===E&&(zt||Tt)?(M.x=Mt?et:B.y,M.y=kt?Pt:B.x,zt?T>=0||isNaN(T)&&D<.5||kt&&(M.y=-Pt):Tt&&((T>=0||isNaN(T)&&D<.5)&&kt&&(M.y=-Pt),Mt&&(M.x=-et))):(kt&&(M.x=T>=0||isNaN(T)&&D<.5?et:-et),Mt&&(M.y=-Pt),M.rotate(K))}else M.rotate(K);Y+=M.x,W+=M.y,at.e(Y+ft,W+ut,I.width,I.height),v.push(at),f.unionRect(at)}if(null!==l){const C=l.labelNodes;for(;C.next();)C.value.ht(1/0,1/0)}e.Zo=f,e.position.e(d.x+f.x,d.y+f.y),n.jn(f.width||0,f.height||0),Ot.i(P),S.i(w),S.i(M)}arrange(e,t,i){const s=t.length;if(!(e instanceof Nt||e instanceof gt))return;let n=e,o=null;e instanceof Nt&&(o=e,n=o.adornedPart);const r=e,a=e instanceof Nt?null:n.path,l=e.Af;if(0!==l.length){let d=0;if(null!==a&&d<l.length){const f=l[d];d++,a.Ut(f.x-r.Zo.x,f.y-r.Zo.y,f.width,f.height)}for(let f=0;f<s;f++){const p=t[f];if(p!==a&&d<l.length){const g=l[d];d++,p.Ut(g.x-r.Zo.x,g.y-r.Zo.y,g.width,g.height)}}}const h=n.points,c=h.count;if(c>=2&&r instanceof gt){const d=r.labelNodes;for(;d.next();)r.II(d.value,c,h)}null!==o?o.Td(!1):n.Td(!1);const u=e.cD(S.l());e.location.e(e.position.x+u.x,e.position.y+u.y),S.i(u)}measureLinkPath(e,t,i,s){if(!1===s.Go())return;let n=s.strokeWidth;if(0===n&&e instanceof Nt&&e.type===J.Link&&e.adornedObject instanceof rt&&(n=e.adornedObject.strokeWidth),n*=s.it,e instanceof gt&&null!==e.ut){const o=e.geometry.bounds;s.lo(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else if(e instanceof Nt&&null!==e.adornedPart.ut){const o=e.adornedPart.ut.bounds;s.lo(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else s.lo(-n/2,-n/2,t+n,i+n);s.EI(),s.xi(!1)}}),Rt.Tn("Graduated",new class go extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=e.findMainElement();if(!(a instanceof rt))return;e.ts=[];const l=a.margin,h=l.right+l.left,c=l.top+l.bottom;a.ht(t,i,o,r);const u=a.measuredBounds,f=u.height,p=Math.max(u.width+h,0),g=Math.max(f+c,0),b=new j(-l.left,-l.top,p,g);e.ts.push(b),n.h(b),this.determineGraduatedMarks(e,a);const x=e.Fs;if(null===x)return;const v=s.length;for(let P=0;P<v;P++){const w=s[P],M=x[P];!w.visible||w===a||0===M.length||(w instanceof rt?this.measureGraduatedTicks(e,w,M,n):w instanceof mt&&this.measureGraduatedLabels(e,w,M,n),w.xi(!1))}}arrange(e,t,i){if(null===e.ts)return;const s=e.findMainElement(),n=e.Fs;if(null===n)return;const o=e.ts;let r=0,a=o[r];r++,null!==s&&s.Ut(a.x-i.x,a.y-i.y,a.width,a.height);const l=t.length;for(let h=0;h<l;h++){const c=t[h];!c.visible||c===s||0===n[h].length||(a=o[r],r++,c.Ut(a.x-i.x,a.y-i.y,a.width,a.height))}e.ts=null}measureGraduatedTicks(e,t,i,s){let n=t.alignmentFocus;n.isNoSpot()&&(n=A.TopCenter);const o=t.angle;t.Xt=0,t.ht(1/0,1/0,0,0),t.Xt=o;const r=t.measuredBounds,a=r.width,l=r.height,h=j.z(0,0,a,l),c=S.l();c.setRectSpot(h,n),j.i(h);const u=-c.x,d=-c.y,f=new j,p=i.length;for(let g=0;g<p;g++){const b=i[g],x=b.pt.x,v=b.pt.y,P=b.angle;for(let w=0;w<4;w++){switch(w){case 0:c.e(u,d);break;case 1:c.e(u+a,d);break;case 2:c.e(u,d+l);break;case 3:c.e(u+a,d+l)}c.rotate(P+t.angle),c.offset(x,v),0===g&&0===w?f.e(c.x,c.y,0,0):f.unionPoint(c),c.offset(-x,-v),c.rotate(-P-t.angle)}}S.i(c),null!==e.ts&&e.ts.push(f),s.re(f.x,f.y,f.width,f.height)}measureGraduatedLabels(e,t,i,s){null===e.vi&&(e.vi=new mt);const n=e.vi;this.fD(t,n);let o=t.alignmentFocus;o.isNoSpot()&&(o=A.TopCenter);const r=t.segmentOrientation,a=t.segmentOffset,l=new j;let h=0,c=0,u=0,d=0,f=0;const p=i.length;for(let g=0;g<p;g++){const b=i[g];h=b.pt.x,c=b.pt.y,u=b.angle,d=t.angle,f=t.angle,0!==r&&(f=21===r||25===r?u+t.angle:u,d=gt.computeAngle(r,f)),n.Xt=d,n.text=b.text||"",n.ht(1/0,1/0,0,0);const x=n.measuredBounds,v=n.naturalBounds,P=v.width,w=v.height,M=Ot.l();M.Ue(),M.Gs(-x.x,-x.y),M.it(n.scale,n.scale),M.ks(f,P/2,w/2),(22===r||26===r)&&M.ks(90,P/2,w/2),(23===r||27===r)&&M.ks(-90,P/2,w/2),28===r&&(u>45&&u<135||u>225&&u<315)&&M.ks(-u,P/2,w/2);const C=j.z(0,0,P,w),N=S.l();N.setRectSpot(C,o),M.gt(N);const I=-N.x,T=-N.y,D=S.l();D.h(a),isNaN(D.x)&&(D.x=P/2+3),isNaN(D.y)&&(D.y=-(w/2+3)),D.rotate(u),h+=D.x+I,c+=D.y+T;const F=new j(h,c,x.width,x.height),E=new j(x.x,x.y,x.width,x.height),B=new j(v.x,v.y,v.width,v.height);b.labelAngle=d,b.lineCount=n.lineCount,b.lines=n.getMetrics(),b.actualBounds=F,b.measuredBounds=E,b.naturalBounds=B,0===g?l.h(F):l.unionRect(F),S.i(D),S.i(N),j.i(C),Ot.i(M)}null!==e.ts&&e.ts.push(l),s.re(l.x,l.y,l.width,l.height)}determineGraduatedMarks(e,t){const i=t.geometry,s=t.strokeWidth,n=i.flattenedSegments,o=i.flattenedLengths,r=i.flattenedTotalLength,a=n.length;let l=0,h=0;const c=y.nt();for(let v=0;v<a;v++){const P=n[v],w=[];l=0,h=0;const M=P.length;for(let C=0;C<M;C+=2){const N=P[C],I=P[C+1];if(0===C){l=N,h=I;continue}let T=180*Math.atan2(I-h,N-l)/Math.PI;T<0&&(T+=360),w.push(T),l=N,h=I}c.push(w)}const u=this.UI(e),d=e.D.r,f=d.length;let x,p=0,g=0,b=r;e.Fs=[];for(let v=0;v<f;v++){const P=d[v];if(x=[],!P.visible||P===t){e.Fs.push(x);continue}const w=Math.abs(P.interval),M=e.graduatedTickUnit;if(M*w*r/e.graduatedRange<2&&null===P.graduatedSkip){e.Fs.push(x);continue}let C=o[0][0],N=0,I=0;g=r*P.graduatedStart-1e-4,b=r*P.graduatedEnd+1e-4;const T=M*w;let D=e.graduatedTickBase;if(D<e.graduatedMin){let Y=(e.graduatedMin-D)/T;Y=Y%1==0?Y:Math.floor(Y+1),D+=Y*T}else D>e.graduatedMin+T&&(D-=Math.floor((D-e.graduatedMin)/T)*T);const F=u[v],E=D,B=1e-6*e.graduatedMax;for(let Y=1;D<=e.graduatedMax+B;Y++){if(this.VI(e,D-e.graduatedTickBase,F)&&(D>e.graduatedMax&&(D=e.graduatedMax),(null===P.graduatedSkip||P instanceof mt&&!P.graduatedSkip(D,P)||P instanceof rt&&!P.graduatedSkip(D,P))&&(p=(D-e.graduatedMin)*r/e.graduatedRange,p>r&&(p=r),g<=p&&p<=b))){let W=c[N][I],$=o[N][I];for(;N<o.length;){for(;p>C&&I<o[N].length-1;)I++,W=c[N][I],$=o[N][I],C+=$;if(p<=C)break;N++,I=0,W=c[N][I],$=o[N][I],C+=$}const K=n[N],Z=K[2*I],it=K[2*I+1],at=(p-(C-$))/$,ft=new S(Z+(K[2*I+2]-Z)*at+s/2-i.bounds.x,it+(K[2*I+3]-it)*at+s/2-i.bounds.y);if(ft.scale(t.scale,t.scale),W=this.BI(W,at,K,c[N],I),P instanceof mt){let ut="";null!==P.graduatedFunction?(ut=P.graduatedFunction(D,P),ut=null!=ut?ut.toString():""):ut=(+D.toFixed(2)).toString(),""!==ut&&x.push({pt:ft,angle:W,text:ut})}else x.push({pt:ft,angle:W})}D=E+Y*T}e.Fs.push(x)}y.Z(c)}BI(e,t,i,s,n){if(t<.5005&&t>.4995)return e;let o=e;if(t<.5?n>0?o=s[n-1]:L.X(i[0],i[i.length-2])&&L.X(i[1],i[i.length-1])&&(o=s[s.length-1]):t>.5&&(n+1<s.length?o=s[n+1]:L.X(i[0],i[i.length-2])&&L.X(i[1],i[i.length-1])&&(o=s[0])),e!==o){let r=Math.abs(e-o);if(r>180&&(e<o?e+=360:o+=360,r=Math.abs(e-o)),t<5e-4||t>.9995)return(e+o)/2%360;if(r<10){const a=1-Math.abs(.5-t);return(e*a+o*(1-a))%360}}return e}UI(e){if(null===e.ds){const t=[],i=e.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(t.push(r),!o.visible)continue;const a=o.interval;if(!(a<0))for(let l=0;l<s;l++){if(l===n)continue;const h=i[l];if(!h.visible||o.constructor!==h.constructor)continue;const c=h.interval;c>a&&r.push(c)}}e.ds=t}return e.ds}VI(e,t,i){const s=i.length;for(let n=0;n<s;n++){const r=t%(i[n]*e.graduatedTickUnit),a=1e-6*e.graduatedTickUnit;if(r<a&&r>-a)return!1}return!0}Ge(e,t,i){const s=i.ph;i.ph=!0;const n=e.naturalBounds,o=n.width,r=n.height,a=t instanceof he;t.save(),t.beginPath(),t.rect(-1,-1,o+1,r+1),t.clip(),t.endPath();const l=e.findMainElement();l.Ge(t,i);let h=e.getDocumentScale()*i.scale;h<=0&&(h=1);const c=l.actualBounds,u=e.D.r,d=e.Fs,f=u.length;for(let p=0;p<f;p++){const g=u[p],b=d[p],x=b.length;if(g.visible&&g!==l&&0!==b.length)if(g instanceof rt){if(e.graduatedTickUnit*g.interval*l.geometry.flattenedTotalLength/e.graduatedRange*h<2&&null===g.graduatedSkip)continue;const v=g.measuredBounds,P=g.strokeWidth*g.scale;let w=g.alignmentFocus;w.isNoSpot()&&(w=A.TopCenter);for(let M=0;M<x;M++)this.zI(g,b[M].pt,c,b[M].angle,v,P,w),g.Ge(t,i),a&&(e.svg.appendChild(g.svg),g.svg=null),g.il.Ue()}else if(g instanceof mt){null===e.vi&&(e.vi=new mt);const v=e.vi;this.fD(g,v),v.jN=!0;for(let P=0;P<x;P++){const w=b[P];if(w.actualBounds&&w.measuredBounds&&w.naturalBounds){v.XI(w);const M=w.actualBounds;v.Ut(M.x,M.y,M.width,M.height),this.GI(v,c,M,w.measuredBounds,w.naturalBounds),v.nl=g.part,v.Zs=g.panel,v.Ge(t,i),v.Zs=null,v.nl=null,a&&(e.svg.appendChild(v.svg),v.svg=null)}}}}i.ph=s,t.restore(),t.clearContextCache(!0)}zI(e,t,i,s,n,o,r){const a=e.il;a.Ue(),a.Gs(t.x+i.x,t.y+i.y),a.ks(s+e.angle,0,0),a.Gs(-n.width*r.x+r.offsetX+o/2,-n.height*r.y+r.offsetY+o/2),a.it(e.scale,e.scale),e.Sd(!1),e.wa.set(e.il),e.Th=e.scale,e.Uh(!1)}GI(e,t,i,s,n){const o=e.il;o.Ue(),o.Gs(i.x+t.x,i.y+t.y),o.Gs(-s.x,-s.y),e.Kp(o,n.x,n.y,n.width,n.height),e.Sd(!1),e.wa.set(e.il),e.Th=e.scale,e.Uh(!1)}fD(e,t){t.YI(e)}});var Vs=(m=>(m[m.Uniform=6]="Uniform",m[m.UniformToFill=7]="UniformToFill",m))(Vs||{});class J extends st{W;D;Qt;Dd;Qn;ll;uo;Zo;qN;O;vd;ot;Pe;te;Fd;Aa;tn;constructor(e,t){if(super(),void 0===e)this.W=J.Position;else if("string"==typeof e){const i=Rt.fs.get(e);null!==i?this.W=i:y.o("PanelLayout not loaded: "+e)}else e instanceof Rt?this.W=e:(this.W=J.Position,e&&(t=e));this.n|=4194304|(this.W===J.Grid?1048576:0),this.D=new H,this.Qt=It.im,this.Dd=A.Default,this.Qn=1,this.ll=null,this.uo="",this.Zo=new j(NaN,NaN,NaN,NaN),this.qN=null,this.O=null,this.vd=6,this.Pe=null,this.ot=null,this.te=null,this.Fd=NaN,this.Aa=null,this.tn=null,t&&Object.assign(this,t)}cloneProtected(e){super.cloneProtected(e),e.W=this.W,e.Qt=this.Qt.N(),e.Dd=this.Dd.N(),e.Qn=this.Qn,e.uo=this.uo,e.Zo.h(this.Zo),null!==this.O&&(e.O=this.O.copy(e)),e.vd=this.vd,null!==this.ot&&(e.ot=this.ot.copy()),null!==this.Pe&&(e.Pe=this.Pe.copy()),e.te=this.te,e.Fd=this.Fd,e.Aa=this.Aa}jo(e){super.jo(e),e.D=this.D;const t=e.D.r,i=t.length;for(let s=0;s<i;s++)t[s].Zs=e;e.ll=null}copy(){const e=super.copy(),t=this.D.r,i=t.length;for(let s=0;s<i;s++){const n=t[s].copy();e.KI(n)}return e}toString(){return"Panel("+this.type.name+")#"+z.xs(this)}get type(){return this.W}set type(e){const t=this.W;t!==e&&(this.W=e,this.Tf=this.W===J.Grid,this.c(),this.t("type",t,e))}get elements(){return this.D.iterator}get naturalBounds(){return this.Ke}get padding(){return this.Qt}set padding(e){"number"==typeof e?(e<0&&y.J(e,">= 0",J,"padding"),e=new It(e)):(e.left<0&&y.J(e.left,">= 0",J,"padding:value.left"),e.right<0&&y.J(e.right,">= 0",J,"padding:value.right"),e.top<0&&y.J(e.top,">= 0",J,"padding:value.top"),e.bottom<0&&y.J(e.bottom,">= 0",J,"padding:value.bottom"));const t=this.Qt;t.equals(e)||(e=e.N(),this.Qt=e,this.c(),this.t("padding",t,e))}get defaultAlignment(){return this.Dd}set defaultAlignment(e){const t=this.Dd;t.equals(e)||(e=e.N(),this.Dd=e,this.c(),this.t("defaultAlignment",t,e))}get defaultStretch(){return this.Qn}set defaultStretch(e){const t=this.Qn;t!==e&&(this.Qn=e,this.c(),this.t("defaultStretch",t,e))}get defaultSeparatorPadding(){return null!==this.O?this.O.C0:It.im}set defaultSeparatorPadding(e){"number"==typeof e&&(e=new It(e));const t=this.defaultSeparatorPadding;t.equals(e)||(e=e.N(),null===this.O&&(this.O=new ae),this.O.C0=e,this.c(),this.t("defaultSeparatorPadding",t,e))}get defaultRowSeparatorStroke(){return null!==this.O?this.O.L0:null}set defaultRowSeparatorStroke(e){const t=this.defaultRowSeparatorStroke;t!==e&&(null===e||"string"==typeof e||e instanceof V)&&(e instanceof V&&e.k(),null===this.O&&(this.O=new ae),this.O.L0=e,this.C(),this.t("defaultRowSeparatorStroke",t,e))}get defaultRowSeparatorStrokeWidth(){return null!==this.O?this.O.A0:1}set defaultRowSeparatorStrokeWidth(e){const t=this.defaultRowSeparatorStrokeWidth;t!==e&&isFinite(e)&&e>=0&&(null===this.O&&(this.O=new ae),this.O.A0=e,this.c(),this.t("defaultRowSeparatorStrokeWidth",t,e))}get defaultRowSeparatorDashArray(){return null!==this.O?this.O.T0:null}set defaultRowSeparatorDashArray(e){const t=this.defaultRowSeparatorDashArray;if(t!==e){if(null!==e&&!Array.isArray(e)&&y.si(e,"Array",J,"defaultRowSeparatorDashArray:value"),null!==e){const i=e.length;let s=0;for(let n=0;n<i;n++){const o=e[n];("number"!=typeof o||!(o>=0)||!isFinite(o))&&y.o("defaultRowSeparatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(0===s){if(null===t)return;e=null}}null===this.O&&(this.O=new ae),this.O.T0=e,this.C(),this.t("defaultRowSeparatorDashArray",t,e)}}get defaultColumnSeparatorStroke(){return null!==this.O?this.O.D0:null}set defaultColumnSeparatorStroke(e){const t=this.defaultColumnSeparatorStroke;t!==e&&(null===e||"string"==typeof e||e instanceof V)&&(e instanceof V&&e.k(),null===this.O&&(this.O=new ae),this.O.D0=e,this.C(),this.t("defaultColumnSeparatorStroke",t,e))}get defaultColumnSeparatorStrokeWidth(){return null!==this.O?this.O.v0:1}set defaultColumnSeparatorStrokeWidth(e){const t=this.defaultColumnSeparatorStrokeWidth;t!==e&&isFinite(e)&&e>=0&&(null===this.O&&(this.O=new ae),this.O.v0=e,this.c(),this.t("defaultColumnSeparatorStrokeWidth",t,e))}get defaultColumnSeparatorDashArray(){return null!==this.O?this.O.F0:null}set defaultColumnSeparatorDashArray(e){const t=this.defaultColumnSeparatorDashArray;if(t!==e){if(null!==e&&!Array.isArray(e)&&y.si(e,"Array",J,"defaultColumnSeparatorDashArray:value"),null!==e){const i=e.length;let s=0;for(let n=0;n<i;n++){const o=e[n];("number"!=typeof o||!(o>=0)||!isFinite(o))&&y.o("defaultColumnSeparatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(0===s){if(null===t)return;e=null}}null===this.O&&(this.O=new ae),this.O.F0=e,this.C(),this.t("defaultColumnSeparatorDashArray",t,e)}}get La(){return null!==this.O?this.O.La:null}set La(e){null===this.O&&(this.O=new ae),this.O.La=e}get viewboxStretch(){return this.vd}set viewboxStretch(e){const t=this.vd;t!==e&&(this.vd=e,this.c(),this.t("viewboxStretch",t,e))}get gridCellSize(){return null!==this.Pe?this.Pe.Rd:lt.OL}set gridCellSize(e){null===this.Pe&&(this.Pe=new ii);const t=this.Pe.Rd;if(!t.equals(e)){(!e.isReal()||0===e.width||0===e.height)&&y.o("Invalid Panel.gridCellSize: "+e),this.Pe.Rd=e.N();const i=this.diagram;null!==i&&this===i.grid&&i.ca(),this.C(),this.t("gridCellSize",t,e)}}get gridOrigin(){return null!==this.Pe?this.Pe.Od:S.gn}set gridOrigin(e){null===this.Pe&&(this.Pe=new ii);const t=this.Pe.Od;if(!t.equals(e)){e.isReal()||y.o("Invalid Panel.gridOrigin: "+e),this.Pe.Od=e.N();const i=this.diagram;null!==i&&this===i.grid&&i.ca(),this.C(),this.t("gridOrigin",t,e)}}get graduatedMin(){return null!==this.ot?this.ot.R0:0}set graduatedMin(e){const t=this.graduatedMin;if(t!==e&&(null===this.ot&&(this.ot=new Te),this.ot.R0=e,this.c(),this.t("graduatedMin",t,e),this.mf())){const i=this.part;null!==i&&this.Eh(i,"graduatedRange")}}get graduatedMax(){return null!==this.ot?this.ot.O0:100}set graduatedMax(e){const t=this.graduatedMax;if(t!==e&&(null===this.ot&&(this.ot=new Te),this.ot.O0=e,this.c(),this.t("graduatedMax",t,e),this.mf())){const i=this.part;null!==i&&this.Eh(i,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return null!==this.ot?this.ot.I0:10}set graduatedTickUnit(e){const t=this.graduatedTickUnit;t!==e&&e>0&&(null===this.ot&&(this.ot=new Te),this.ot.I0=e,this.c(),this.t("graduatedTickUnit",t,e))}get graduatedTickBase(){return null!==this.ot?this.ot.E0:0}set graduatedTickBase(e){const t=this.graduatedTickBase;t!==e&&(null===this.ot&&(this.ot=new Te),this.ot.E0=e,this.c(),this.t("graduatedTickBase",t,e))}get Fs(){return null!==this.ot?this.ot.Fs:null}set Fs(e){null!==this.ot?this.ot.Fs=e:null!==e&&(this.ot=new Te,this.ot.Fs=e)}get ts(){return null!==this.ot?this.ot.ts:null}set ts(e){null!==this.ot?this.ot.ts=e:null!==e&&(this.ot=new Te,this.ot.ts=e)}get ds(){return null!==this.ot?this.ot.ds:null}set ds(e){null!==this.ot?this.ot.ds=e:null!==e&&(this.ot=new Te,this.ot.ds=e)}get vi(){return null!==this.ot?this.ot.vi:null}set vi(e){null!==this.ot?this.ot.vi=e:null!==e&&(this.ot=new Te,this.ot.vi=e)}Wp(e){super.Wp(e);const t=this.D.r,i=t.length;for(let s=0;s<i;s++)t[s].Wp(e)}Ma(e,t){if(this.W===J.Grid)return e.commitTransform(),void this.W.Ge(this,e,t);if(this.W===J.Graduated)return e.commitTransform(),void this.W.Ge(this,e,t);if(this.W===J.Table)if(e.commitTransform(),e instanceof he){const r=e.currentElement;e.currentElement=e.newGroup2("gojs-ts"),this.WN(e,t),e.endGroup(),e.currentElement=r}else this.WN(e,t);const i=this.isClipping&&this.W===J.Spot;i&&e.save();const s=this.findMainElement(),n=this.D.r,o=n.length;for(let r=0;r<o;r++){const a=n[r];i&&a===s&&(e.clipInsteadOfFill=!0),a.Ge(e,t),i&&a===s&&(e.clipInsteadOfFill=!1)}i&&(e.restore(),e.clearContextCache(!0))}WN(e,t){e.lineCap="butt";const i=this.rowCount>0?this.Qi:null,s=this.columnCount>0?this._i:null;null!==i&&this.$1(e,t,!0,i,!0),null!==s&&this.$1(e,t,!1,s,!0),null!==i&&this.uD(e,!0,i),null!==s&&this.uD(e,!1,s),null!==i&&this.$1(e,t,!0,i,!1),null!==s&&this.$1(e,t,!1,s,!1)}uD(e,t,i){const s=i.length,n=this.actualBounds,o=this.naturalBounds;let r=!0;for(let a=0;a<s;a++){const l=i[a];if(void 0===l||0===l.actual)continue;if(r){r=!1;continue}if(t){if(l.position>o.height)continue}else if(l.position>o.width)continue;let h=l.separatorStrokeWidth;isNaN(h)&&(h=t?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let c=l.separatorStroke;if(null===c&&(c=t?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),0===h||null===c)continue;this.kn(e,c,!1,!1,o,n);let u=!1,d=l.separatorDashArray;null===d&&(d=t?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),null!==d&&(u=!0,e.enableDash(d,0)),e.beginPath();const f=l.position+h;t?f>o.height&&(h-=f-o.height):f>o.width&&(h-=f-o.width);let p=l.position+h/2;e.lineWidth=h;const g=this.Qt;if(t){p+=g.top;const x=o.width-g.right;e.moveTo(g.left,p),e.lineTo(x,p)}else{p+=g.left;const x=o.height-g.bottom;e.moveTo(p,g.top),e.lineTo(p,x)}e.stroke(),e.endPath(),u&&e.disableDash()}}$1(e,t,i,s,n){const o=s.length,r=this.actualBounds,a=this.naturalBounds,l=this.dD(!0),h=this.dD(!1);for(let c=0;c<o;c++){const u=s[c];if(void 0===u||null===u.background||u.coversSeparators===n||0===u.actual)continue;const d=i?r.height:r.width;if(u.position>d)continue;let f=u.computeEffectiveSpacing(),p=u.separatorStrokeWidth;isNaN(p)&&(p=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let g=u.separatorStroke;null===g&&(g=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(null===g||u.index===(i?l:h))&&(p=0),f-=p;const b=u.position+p;let x=f+u.actual;if(b+x>d&&(x=d-b),x<=0)continue;const v=this.Qt;this.kn(e,u.background,!0,!1,a,r),i?e.fillRect(v.left,b+v.top,r.width-(v.left+v.right),x):e.fillRect(b+v.left,v.top,x,r.height-(v.top+v.bottom))}}dD(e){const t=e?this.rowCount:this.columnCount;for(let i=0;i<t;i++){const s=e?this.Qi[i]:this._i[i];if(void 0!==s)return s.index}return 0}xf(){const e=this.D.r,t=e.length;for(let i=0;i<t;i++)e[i].xf();this.$i(!0)}wf(e,t,i){const s=this.svg;if(null===s)return!1;if(this.type===J.Table){const r=s.getElementsByClassName("gojs-ts"),a=0!==r.length?r[0]:null;null!==a&&(a.innerHTML=""),e.currentElement=a,this.WN(e,t),e.currentElement=null}else{if(this.W===J.Grid||this.W===J.Graduated)return s.innerHTML="",s.remove(),!1;if(this.W===J.Spot&&this.isClipping)return s.innerHTML="",s.remove(),this.xa=null,this.xf(),!1}if(!super.wf(e,t,i))return!1;const n=this.D.r,o=n.length;for(let r=0;r<o;r++)n[r].Ge(e,t);return!0}Pd(e){return!0}$p(e,t,i,s){if(!this.isClipping){if(this._s()&&null!==e.partClipRect){const n=e.partClipRect,o=this.D.r;let r=0,a=0;for(let l=0;l<o.length;l++){if(!o[l].isVisibleObject())continue;const h=o[l].actualBounds;r=0===l?h.x:Math.min(h.x,r),a=0===l?h.y:Math.min(h.y,a)}return void s.setAttributeNS(null,"clip-path",`path('M ${n.x-i.x-r},${n.y-i.y-a} l ${n.width} 0 l 0 ${n.height} l -${n.width} 0 z')`)}super.$p(e,t,i,s)}}pf(e,t,i,s,n){const o=this.Nn(),r=this.v,a=1/(r.m11*r.m22-r.m12*r.m21);let l=r.m22*a,h=-r.m12*a,c=-r.m21*a,u=r.m11*a,d=a*(r.m21*r.dy-r.m22*r.dx),f=a*(r.m12*r.dx-r.m11*r.dy);if(null!==this.background){const p=e*l+t*c+d,g=e*h+t*u+f,b=i*l+s*c+d,x=i*h+s*u+f;n.e(0,0);const v=this.naturalBounds,P=L.Cl(0,0,v.width,v.height,p,g,b,x,n);return n.v(r),P}{o||(l=1,h=0,c=0,u=1,d=0,f=0);const p=e*l+t*c+d,g=e*h+t*u+f,b=i*l+s*c+d,x=i*h+s*u+f;n.e(b,x);let v=(b-p)**2+(x-g)**2,P=!1;const w=this.D.r,M=w.length,C=S.l();let N=null,I=1/0,T=null;const D=this.isClipping&&this.W===J.Spot;D&&(T=S.l(),N=this.findMainElement(),P=N.pf(p,g,b,x,T),P&&(I=(p-T.x)**2+(g-T.y)**2));for(let F=0;F<M;F++){const E=w[F];if(!E.visible||E===N||!E.pf(p,g,b,x,C))continue;P=!0;const B=(p-C.x)**2+(g-C.y)**2;B<v&&(v=B,n.set(C))}return D&&(I>v&&n.set(T),S.i(T)),S.i(C),o&&n.v(r),P}}Wc(){const e=this.D.r,t=e.length;for(let i=0;i<t;i++)e[i].Wc();super.Wc()}c(e){if(this.Go())return;super.c(e);let t=null;(this.W===J.Auto||this.W===J.Link)&&(t=this.findMainElement());const i=this.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if((o===t||o.isPanelMain)&&o.c(!0),o.desiredSize.isReal()||!o.visible)continue;const r=o.Qs(!1);!(o instanceof de)&&!(o instanceof J)&&!(o instanceof mt)&&0===r||o.c(!0)}}kf(){if(this.Go())return;this.xi(!0),this.ao(!0);const e=this.D.r,t=e.length;for(let i=0;i<t;i++)e[i].kf()}yf(){if(!1===this.B1()){this.Sd(!0),this.Uh(!0);const e=this.D.r,t=e.length;for(let i=0;i<t;i++)e[i].AN()}}AN(){this.Uh(!0);const e=this.D.r,t=e.length;for(let i=0;i<t;i++)e[i].AN()}bd(e,t,i,s){const n=this.Zo;n.e(0,0,0,0);const o=this.desiredSize,r=this.minSize;void 0===i&&(i=r.width,s=r.height),i=Math.max(i,r.width),s=Math.max(s,r.height);const a=this.maxSize;isNaN(o.width)||(e=Math.min(o.width,a.width)),isNaN(o.height)||(t=Math.min(o.height,a.height)),e=Math.max(i,e),t=Math.max(s,t);const l=this.Qt;e=Math.max(e-l.left-l.right,0),t=Math.max(t-l.top-l.bottom,0),this.W.measure(this,e,t,this.D.r,n,i,s);let c=n.width+l.left+l.right,u=n.height+l.top+l.bottom;isFinite(o.width)&&(c=o.width),isFinite(o.height)&&(u=o.height),c=Math.min(a.width,c),u=Math.min(a.height,u),c=Math.max(r.width,c),u=Math.max(r.height,u),c=Math.max(i,c),u=Math.max(s,u),n.jn(c,u),this.naturalBounds.jn(c,u),this.lo(0,0,c,u)}findMainElement(){if(null===this.ll){const e=this.D.r,t=e.length;if(0===t)return null;for(let i=0;i<t;i++){const s=e[i];if(!0===s.isPanelMain)return this.ll=s,s}this.ll=e[0]}return this.ll}$o(){return null!==this.part?this.part.locationObject:null}get panelLayoutState(){return this.qN}set panelLayoutState(e){this.qN=e}Pa(e,t,i,s){const n=this.D.r;if(this.actualBounds.e(e,t,i,s),!this.desiredSize.isReal()){let o=this.Qs(!0);const r=this.measuredBounds,a=r.width,l=r.height,h=this.sl,c=h.left+h.right,u=h.top+h.bottom;switch(a===i&&l===s&&(o=0),o){case 0:(a>i||l>s)&&(this.c(),this.ht(a>i?i:a,l>s?s:l,0,0));break;case 2:this.c(!0),this.ht(i+c,s+u,0,0);break;case 5:this.c(!0),this.ht(i+c,l+u,0,0);break;case 4:this.c(!0),this.ht(a+c,s+u,0,0)}}this.W.arrange(this,n,this.Zo)}ka(e){const t=this.naturalBounds,i=this.$o();if(j.contains(0,0,t.width,t.height,e.x,e.y)){const s=this.D.r,n=s.length,o=S.z(0,0);for(let r=n;r--;){const a=s[r];if((a.visible||a===i)&&(o.set(e).Ki(a.v),a.containsPoint(o)))return S.i(o),!0}return S.i(o),null!==this.Lt}return!1}Yp(e){if(this.oo===e)return this;const t=this.D.r,i=t.length;for(let s=0;s<i;s++){const n=t[s].Yp(e);if(null!==n)return n}return null}walkVisualTreeFrom(e,t){if(t(this,e),e instanceof J){const i=e.D.r,s=i.length;for(let n=0;n<s;n++)this.walkVisualTreeFrom(i[n],t)}}Sn(e){this.gD(this,e)}gD(e,t){t(e);const i=e.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o instanceof J&&this.gD(o,t)}}HI(e){this.mD(this,e)}mD(e,t){if(t(e),e instanceof J){const i=e.D.r,s=i.length;for(let n=0;n<s;n++)this.mD(i[n],t)}}findInVisualTree(e){return this.pD(this,e)}pD(e,t){if(t(e))return e;if(e instanceof J){const i=e.D.r,s=i.length;for(let n=0;n<s;n++){const o=this.pD(i[n],t);if(null!==o)return o}}return null}findObject(e){if(this.name===e)return this;const t=this.D.r;let i=t.length;this.jI()&&(i=this.U0());for(let s=0;s<i;s++){const n=t[s];if(n instanceof J){const o=n.findObject(e);if(null!==o)return o}if(n.name===e)return n}return null}yD(){const e=this.D.r,t=e.length;let i=0;for(let s=0;s<t;s++){const n=e[s];n instanceof J?i=Math.max(i,n.yD()):n instanceof rt&&(i=Math.max(i,n.qI()))}return i}Nn(){return!(this.type===J.TableRow||this.type===J.TableColumn)}ol(){return this.type===J.TableRow||this.type===J.TableColumn}BA(e,t,i){if(!1===this.pickable||(void 0===t&&(t=null),void 0===i&&(i=null),this.as()))return null;const s=this.naturalBounds,n=1/this.getDocumentScale(),o=this.Nn(),r=o?e:S.z(e.x,e.y).Ki(this.v),a=this.diagram;let l=10,h=5;if(null!==a&&(l=a.getInputOption("extraTouchArea"),h=l/2),j.contains(-h*n,-h*n,s.width+l*n,s.height+l*n,r.x,r.y)){if(!this.Tf){const u=this.D.r,d=u.length,f=S.l(),p=this.isClipping&&this.W===J.Spot,g=p?this.findMainElement():null;if(p&&g&&(g.Nn()?f.set(e).Ki(g.v):f.set(e),!g.containsPoint(f)))return S.i(f),o||S.i(r),null;const b=this.$o();for(let x=d;x--;){const v=u[x];if(!v.visible&&v!==b||(v.Nn()?f.set(e).Ki(v.v):f.set(e),p&&v===g))continue;let P=null;if(v instanceof J?P=v.BA(f,t,i):!0===v.pickable&&v.containsPoint(f)&&(P=v),null!==P&&(null!==t&&(P=t(P)),null!==P&&(null===i||i(P))))return S.i(f),o||S.i(r),P}S.i(f)}if(null===this.background)return o||S.i(r),null;const c=j.contains(0,0,s.width,s.height,r.x,r.y)?this:null;return o||S.i(r),c}return o||S.i(r),null}zA(e,t,i,s){if(!1===this.pickable)return!1;void 0===t&&(t=null),void 0===i&&(i=null);const n=this.naturalBounds,o=this.Nn(),r=o?e:S.z(e.x,e.y).Ki(this.v),a=this.ol(),l=j.contains(0,0,n.width,n.height,r.x,r.y);if(a||l){if(!this.Tf){const h=this.D.r,c=h.length,u=S.l(),d=this.$o();for(let f=c;f--;){const p=h[f];if(!p.visible&&p!==d)continue;p.Nn()?u.set(e).Ki(p.v):u.set(e);let g=p;const b=p instanceof J?p:null;if(null!==b?b.zA(u,t,i,s):g.containsPoint(u)){if(!1===g.pickable)continue;null!==t&&(g=t(g)),null!==g&&(null===i||i(g))&&s.add(g)}}S.i(u)}return o||S.i(r),l&&null!==this.background}return o||S.i(r),!1}Zm(e,t,i,s,n,o){if(!1===this.pickable)return!1;void 0===t&&(t=null),void 0===i&&(i=null);let r=o;if(void 0===r&&(r=Ot.l(),r.Ue()),r.kc(this.v),this.containedInRect(e,r))return this.JN(t,i,n),void 0===o&&Ot.i(r),!0;if(this.intersectsRect(e,r)){if(!this.Tf){const a=this.$o(),l=this.D.r;for(let c=l.length;c--;){const u=l[c];if(!u.visible&&u!==a)continue;const d=u.actualBounds,f=this.naturalBounds;if(d.x>f.width||d.y>f.height||d.x+d.width<0||d.y+d.height<0)continue;let p=u;const g=u instanceof J?u:null,b=Ot.l();b.set(r),(null!==g?g.Zm(e,t,i,s,n,b):p.JT(e,s,b))&&(null!==t&&(p=t(p)),null!==p&&(null===i||i(p))&&n.add(p)),Ot.i(b)}}return void 0===o&&Ot.i(r),s}return void 0===o&&Ot.i(r),!1}JN(e,t,i){const s=this.D.r;for(let o=s.length;o--;){const r=s[o];if(!r.visible)continue;const a=r.actualBounds,l=this.naturalBounds;if(a.x>l.width||a.y>l.height||a.x+a.width<0||a.y+a.height<0)continue;r instanceof J&&r.JN(e,t,i);let h=r;null!==e&&(h=e(h)),null!==h&&(null===t||t(h))&&i.add(h)}}XA(e,t,i,s,n,o){if(!1===this.pickable)return!1;void 0===i&&(i=null),void 0===s&&(s=null);const r=this.naturalBounds,a=this.Nn(),l=a?e:S.z(e.x,e.y).Ki(this.v),h=a?t:S.z(t.x,t.y).Ki(this.v),c=l.distanceSquaredPoint(h),u=l.x>0&&l.x<r.width&&l.y>0&&l.y<r.height||S.distanceLineSegmentSquared(l.x,l.y,0,0,0,r.height)<=c||S.distanceLineSegmentSquared(l.x,l.y,0,r.height,r.width,r.height)<=c||S.distanceLineSegmentSquared(l.x,l.y,r.width,r.height,r.width,0)<=c||S.distanceLineSegmentSquared(l.x,l.y,r.width,0,0,0)<=c,d=l.distanceSquared(0,0)<=c&&l.distanceSquared(0,r.height)<=c&&l.distanceSquared(r.width,0)<=c&&l.distanceSquared(r.width,r.height)<=c;if(a||(S.i(l),S.i(h)),u){if(!this.Tf){const f=S.l(),p=S.l(),g=this.$o(),b=this.D.r;for(let v=b.length;v--;){const P=b[v];if(!P.visible&&P!==g)continue;const w=P.actualBounds,M=this.naturalBounds;if(a&&(w.x>M.width||w.y>M.height||w.x+w.width<0||w.y+w.height<0))continue;if(P.Nn()){const I=P.v;f.set(e).Ki(I),p.set(t).Ki(I)}else f.set(e),p.set(t);let C=P;const N=P instanceof J?P:null;(null!==N?N.XA(f,p,i,s,n,o):C.$T(f,p,n))&&(null!==i&&(C=i(C)),null!==C&&(null===s||s(C))&&o.add(C))}S.i(f),S.i(p)}return n?u:d}return!1}GN(e){let t=null;if(e instanceof rt){t=e.spot1,t===A.Default&&(t=null);const i=e.geometry;null!==i&&null===t&&(t=i.spot1)}return null===t&&(t=A.TopLeft),t}YN(e){let t=null;if(e instanceof rt){t=e.spot2,t===A.Default&&(t=null);const i=e.geometry;null!==i&&null===t&&(t=i.spot2)}return null===t&&(t=A.BottomRight),t}add(...e){for(let t=0;t<e.length;t++)this.insertAt(this.D.count,e[t]);return this}elt(e){return this.D.elt(e)}insertAt(e,t){t instanceof At&&y.o("Cannot add a Part to a Panel: "+t+"; use a Panel instead"),(this===t||this.isContainedBy(t))&&(this===t&&y.o("Cannot make a Panel contain itself: "+this.toString()),y.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+t.toString()));const i=t.panel;if(null!==i&&i!==this&&y.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+t.toString()+", already contained by "+i.toString()+", cannot be shared by this Panel: "+this.toString()),this.W===J.Grid&&!(t instanceof rt)&&y.o("Can only add Shapes to a Grid Panel, not: "+t),this.W===J.Graduated&&!(t instanceof rt||t instanceof mt)&&y.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+t),t.Vh(this),t.nl=null,null!==this.itemArray){const r=t.data;y.$(r)&&(null===this.tn&&(this.tn=new xt),this.tn.set(r,t))}const s=this.D;let n=-1;if(i===this){let r=-1;const a=this.D.r,l=a.length;for(let h=0;h<l;h++)if(a[h]===t){r=h;break}if(-1!==r){if(r===e||r+1>=s.count&&e>=s.count)return;s.removeAt(r),n=r}else y.o("element "+t.toString()+" has panel "+i.toString()+" but is not contained by it.")}(e<0||e>s.count)&&(e=s.count),s.insertAt(e,t),(0===e||t.isPanelMain)&&(this.ll=null),this.Go()||this.c(),t.c(!1),(null!==t.portId||t instanceof J&&!0===t.Ln)&&(this.Ln=!0),this.ds=null,this.isEnabledObject()||this.Z1(t,!1);const o=this.part;if(null!==o){o.s0(),o.Df(),this.Ln&&o instanceof nt&&(o.Ln=!0),o.Ln&&o instanceof nt&&(o.ci=null);const r=this.diagram;if(null!==r&&r.undoManager.isUndoingRedoing)return;-1!==n&&o.raiseChangedEvent(4,"elements",this,t,null,n,null),o.raiseChangedEvent(3,"elements",this,null,t,null,e)}}get Ln(){return!!(8388608&this.n)}set Ln(e){!!(8388608&this.n)!==e&&(this.n=8388608^this.n)}MN(){return!!(16777216&this.n)}$N(e){e?this.n|=16777216:this.n&=-16777217}KI(e){e.Vh(this),e.nl=null;const t=this.D,i=t.count;t.insertAt(i,e);const s=this.part;if(null!==s){s.s0(),null!==e.portId&&s instanceof nt&&(s.Ln=!0);const n=this.diagram;if(null!==n&&n.undoManager.isUndoingRedoing)return;s.raiseChangedEvent(3,"elements",this,null,e,null,i)}}cI(e){const t=this.D.r,i=t.length;let s=-1;for(let n=0;n<i;n++)if(t[n]===e){s=n;break}return s}remove(e){const t=this.D.r,i=t.length;let s=-1;for(let n=0;n<i;n++)if(t[n]===e){s=n;break}-1!==s&&this.ri(s,!0)}removeAt(e){e>=0&&this.ri(e,!0)}ri(e,t){const i=this.D,s=i.elt(e);if(s.nl=null,s.Vh(null),null!==this.tn){const o=s.data;y.$(o)&&this.tn.delete(o)}i.removeAt(e),this.xi(!1),this.c(),this.ll===s&&(this.ll=null),this.ds=null;const n=this.part;if(null!==n){n.s0(),n.Df(),n.invalidateAdornments(),n instanceof nt&&(s instanceof J?s.walkVisualTreeFrom(s,(r,a)=>n.FN(a,t)):n.FN(s,t));const o=this.diagram;if(null!==o&&o.undoManager.isUndoingRedoing)return;n.raiseChangedEvent(4,"elements",this,s,null,e,null)}}get Qi(){return null===this.O&&(this.O=new ae),this.O.Qi}get rowCount(){return null===this.O?0:this.Qi.length}getRowDefinition(e){e<0&&y.J(e,">= 0",J,"getRowDefinition:idx"),e=Math.round(e);const t=this.Qi;if(void 0===t[e]){const i=new ee;i.Vh(this),i.isRow=!0,i.index=e,t[e]=i,this.raiseChangedEvent(3,"rowdefs",this,null,i,null,e)}return t[e]}removeRowDefinition(e){if(e<0&&y.J(e,">= 0",J,"removeRowDefinition:idx"),0===this.rowCount)return;e=Math.round(e);const t=this.Qi,i=t[e];if(i){t[e]=void 0;let s=t.length-1;for(;s>=0&&void 0===t[s--];)t.length--;this.raiseChangedEvent(4,"rowdefs",this,i,null,e,null),this.c()}}xT(e,t){const i=this.Qi;if(!(e<0)){if(i[e]=t instanceof ee?t:void 0,!t){let s=i.length-1;for(;s>=0&&void 0===i[s--];)i.length--}this.c()}}get _i(){return null===this.O&&(this.O=new ae),this.O._i}get columnCount(){return null===this.O?0:this._i.length}getColumnDefinition(e){e<0&&y.J(e,">= 0",J,"getColumnDefinition:idx"),e=Math.round(e);const t=this._i;if(void 0===t[e]){const i=new ee;i.Vh(this),i.isRow=!1,i.index=e,t[e]=i,this.raiseChangedEvent(3,"coldefs",this,null,i,null,e)}return t[e]}removeColumnDefinition(e){if(e<0&&y.J(e,">= 0",J,"removeColumnDefinition:idx"),0===this.columnCount)return;e=Math.round(e);const t=this._i,i=t[e];if(i){t[e]=void 0;let s=t.length-1;for(;s>=0&&void 0===t[s--];)t.length--;this.raiseChangedEvent(4,"coldefs",this,i,null,e,null),this.c()}}bT(e,t){const i=this._i;if(!(e<0)){if(i[e]=t instanceof ee?t:void 0,!t){let s=i.length-1;for(;s>=0&&void 0===i[s--];)i.length--}this.c()}}addRowColumnDefinition(e){let t=null;return e.isRow?t=this.getRowDefinition(e.index):e.isRow||(t=this.getColumnDefinition(e.index)),t&&t.X1(e),this}addRowDefinition(e,t){const i=this.getRowDefinition(e);return i&&i.X1(new ee(t)),this}addColumnDefinition(e,t){const i=this.getColumnDefinition(e);return i&&i.X1(new ee(t)),this}get rowSizing(){return null!==this.O?this.O.V0:3}set rowSizing(e){const t=this.rowSizing;t!==e&&(null===this.O&&(this.O=new ae),this.O.V0=e,this.c(),this.t("rowSizing",t,e))}get columnSizing(){return null!==this.O?this.O.B0:3}set columnSizing(e){const t=this.columnSizing;t!==e&&(null===this.O&&(this.O=new ae),this.O.B0=e,this.c(),this.t("columnSizing",t,e))}get topIndex(){return null!==this.O?this.O.z0:0}set topIndex(e){const t=this.topIndex;t!==e&&((!isFinite(e)||e<0)&&y.o("Panel.topIndex must be greater than zero and a real number, not: "+e),null===this.O&&(this.O=new ae),this.O.z0=e,this.c(),this.t("topIndex",t,e))}get leftIndex(){return null!==this.O?this.O.X0:0}set leftIndex(e){const t=this.leftIndex;t!==e&&((!isFinite(e)||e<0)&&y.o("Panel.leftIndex must be greater than zero and a real number, not: "+e),null===this.O&&(this.O=new ae),this.O.X0=e,this.c(),this.t("leftIndex",t,e))}findRowForLocalY(e){if(e<0||this.type!==J.Table||0===this.rowCount)return-1;let t=0;const i=this.Qi,s=i.length;let n=this.topIndex;for(;n<s;n++){const o=i[n];if(void 0!==o&&(t+=o.total,e<t))return n}return n}findColumnForLocalX(e){if(e<0||this.type!==J.Table||0===this.columnCount)return-1;let t=0;const i=this._i,s=i.length;let n=this.leftIndex;for(;n<s;n++){const o=i[n];if(void 0!==o&&(t+=o.total,e<t))return n}return n}graduatedPointForValue(e,t){if(void 0===t&&(t=new S(NaN,NaN)),this.type!==J.Graduated)return t.e(NaN,NaN),t;e=Math.min(Math.max(e,this.graduatedMin),this.graduatedMax);const i=this.findMainElement();return i.geometry.getPointAlongPath((e-this.graduatedMin)/this.graduatedRange,t),i.v.gt(t)}graduatedValueForPoint(e){if(this.type!==J.Graduated)return NaN;const t=this.findMainElement();return t.v.Ci(e),t.geometry.getFractionForPoint(e)*this.graduatedRange+this.graduatedMin}get data(){return this.te}set data(e){const t=this.te;if(t!==e){const i=this instanceof At&&!(this instanceof Nt);i&&y.s(e,"object",J,"data"),this.It(),this.te=e;const s=this.diagram;if(null!==s)if(i){s.partManager.WI(this,t,e);let n=this.adornments;for(;n.next();){const o=n.value,r=o.adornedObject;if(null!==r){const a=r.findBindingPanel();null!==a&&(o.data=a.data)}}}else{const n=this.panel;null!==n&&null!==n.tn&&(null!==t&&n.tn.delete(t),null!==e&&n.tn.set(e,this))}if(this.t("data",t,e),null!==s&&s.undoManager.isUndoingRedoing)return;null!==e&&this.updateTargetBindings()}}get itemIndex(){return this.Fd}set itemIndex(e){const t=this.Fd;t!==e&&(this.Fd=e,this.t("itemIndex",t,e))}get vs(){return null!==this.w?this.w.vs:null}set vs(e){this.ve!==e&&(null===this.w&&(this.w=new qe),this.w.vs=e)}RN(){return null!==this.vs}nD(){const e=this.vs;return null!==e&&e.f}freezeBindings(){return this.It()}It(){let e=this.vs;if(null===e)null!==this.data&&y.o("Template cannot have .data be non-null: "+this),this.vs=e=new H;else if(e.f)return this;const t=new H;this.$N(!1),this.walkVisualTreeFrom(this,(n,o)=>{o.ba();const r=o.ve;if(null!==r){o.TN(!1);const a=r.iterator;for(;a.next();){const l=a.value;if(2===l.mode&&o.TN(!0),l.isToObject){"/"===l.sourceName&&n.$N(!0);const c=l.WT(n,o);null!==c&&(t.add(c),null===c.ro&&(c.ro=new H),c.ro.add(l))}e.add(l)}}if(o instanceof J&&o.type===J.Table){if(o.rowCount>0){const a=o.Qi,l=a.length;for(let h=0;h<l;h++){const c=a[h];if(void 0!==c&&null!==c.Rs){const u=c.Rs.iterator;for(;u.next();){const d=u.value;d.Ti=c,d.Id=2,d.vf=c.index,e.add(d)}}}}if(o.columnCount>0){const a=o._i,l=a.length;for(let h=0;h<l;h++){const c=a[h];if(void 0!==c&&null!==c.Rs){const u=c.Rs.iterator;for(;u.next();){const d=u.value;d.Ti=c,d.Id=1,d.vf=c.index,e.add(d)}}}}}});const i=t.iterator;for(;i.next();){const n=i.value;if(null!==n.ro){n.TN(!0);const o=n.ro.iterator;for(;o.next();){const r=o.value;null===n.ve&&(n.ve=new H),n.ve.add(r)}}n.ro=null}let s=e.iterator;for(;s.next();){const n=s.value;let o=n.Ti;if(null!==o){n.Ti=null;const r=n.targetProperty,a=r.indexOf(".");if(a>0&&o instanceof J){const l=r.substring(0,a),h=r.substring(a+1),c=o.findObject(l);null!==c?(o=c,n.targetProperty=h):(y.ne('Warning: unable to find GraphObject named "'+l+'" for Binding: '+n.toString()),o=null)}if(o instanceof ee){const l=z.xs(o.panel);n.targetId=void 0===l?-1:l,o.panel.oo=n.targetId}else if(o instanceof st){const l=z.xs(o);n.targetId=void 0===l?-1:l,o.oo=n.targetId}else y.o("Unknown type of binding target: "+o);n.check(o)}}return e.k(),this instanceof At&&this.Di()&&this.ensureBounds(),this}static BU=!1;copyTemplate(e){void 0===e&&(e=!1);const t=this.copy();return t.HI(i=>{i instanceof J&&(i.vs=null,i.te=null);const s=i.ve;null!==s&&(i.ve=null,s.each(o=>i.bind(o.copy())));const n=i.Ds;null!==n&&(i.Ds=null,n.each(o=>i.trigger(o.value.copy())))}),e&&t.It(),t}updateTargetBindings(e){const t=this.vs;if(null===t)return;void 0===e&&(e="");const i=this.diagram?.model,s=t.iterator;for(;s.next();){const n=s.value,o=this.ZN(n,e);if(null===o)continue;const{data:r,elt:a}=o;n.isToTheme&&null===this.diagram||void 0!==a&&n.updateTarget(a,r,void 0,i)}}JI(e){if(""===e)return void this.updateTargetBindings(e);const t=this.vs;if(null===t)return;const i=this.diagram?.model,s=t.iterator;for(;s.next();){const n=s.value;if(n.isToData&&""!==n.sourceProperty)continue;const o=this.ZN(n,"");if(null===o)continue;const{data:r,elt:a}=o;void 0!==a&&n.updateTarget(a,r,void 0,i)}}Yo(){if(null!==this.diagram)if(this.RN()){const e=this.diagram.model,t=this.vs.iterator;for(;t.next();){const i=t.value;if(!i.isToTheme)continue;const s=this.ZN(i);if(null===s)continue;const{data:n,elt:o}=s;void 0!==o&&i.updateTarget(o,n,void 0,e)}}else{const e=this.D.r,t=e.length;for(let i=0;i<t;i++)e[i].Yo()}}ZN(e,t=""){const i=e.sourceProperty;if(""!==t&&""!==i&&i!==t)return null;if(null===e.converter&&""===e.targetProperty)return null;let n=this.data;const o=e.sourceName;if(e.isToObject){if(n=this.qT(o),null===n)return null}else if(e.isToModel){const h=this.diagram;if(null===h)return null;n=h.model.modelData}let r=this;const a=e.targetId;if(-1!==a){if(r=this.Yp(a),null===r)return null}else null!==e.Ti&&(r=e.Ti);"/"===o?n=r.part:"."===o?n=r:".."===o&&(n=r.panel);const l=e.Id;if(0!==l){if(!(r instanceof J))return null;1===l?r=r.getColumnDefinition(e.vf):2===l&&(r=r.getRowDefinition(e.vf))}return{data:n,elt:r}}get itemArray(){return this.Aa}set itemArray(e){const t=this.Aa;if(t!==e||null!==e&&this.$I(e)){const i=this.diagram;if(t!==e&&(null!==i&&null!==t&&i.partManager.C2(this,i),this.Aa=e,null!==i&&null!==e&&i.partManager.N2(this,i)),this.t("itemArray",t,e),null!==i&&i.undoManager.isUndoingRedoing)return;this.wD(t,e)}}findItemPanelForData(e){return null==e||null===this.tn?null:(y.xc(e,J,"findItemPanelForData"),this.tn.get(e))}$I(e){const t=this.D.r,i=t.length,s=e.length;let n=0,o=null;for(;n<i&&(o=t[n],!(o instanceof J)||null===o.data);)n++,o=t[n];if(i-n!==s)return!0;if(null===o)return s>0;let r=0;for(;n<i&&r<s;){if(o=t[n],!(o instanceof J)||o.data!==e[r])return!0;n++,r++}return!1}U0(){if(this.type===J.Spot||this.type===J.Auto)return Math.min(this.D.length,1);if(this.type===J.Link){const e=this.D,t=e.length;let i=0;for(;i<t;i++){const s=e.elt(i);if(!(s instanceof rt&&s.isPanelMain))return i}return i}if(this.type===J.Table&&this.D.length>0){const e=this.D.elt(0);if(e.isPanelMain&&e instanceof J&&e.ol())return 1}return 0}rebuildItemElements(){const e=this.U0();for(;this.D.length>e;)this.ri(this.D.length-1,!1);this.wD(null,this.itemArray)}wD(e,t){const i=this.U0(),s=t;if(null!==s&&0!==s.length)if(this.D.length<=i){const n=s.length;for(let o=0;o<n;o++)this.Q1(s[o],o,!0)}else{let n=i;for(let r=0;r<s.length;r++,n++){const a=s[r],l=n<this.D.length?this.D.elt(n):null;if(l instanceof J){if(l.data!==a){const h=this.QN(l.data,r),c=this.QN(a,r);let u=c!==h;if(!u){const d=this._N(l.data,r,h);u=this._N(a,r,c)!==d}u?(this.ri(n,!1),this.Q1(a,r,!1)):l.data=a}}else this.Q1(a,r,!1)}for(;n<this.D.length;)this.ri(n,!1);this.ll=null,this.tC(i,0),this.Go()||this.c(),this.ds=null,this.isEnabledObject()||this.Z1(this,!1);const o=this.part;null!==o&&(o.s0(),o.Df(),this.Ln&&o instanceof nt&&(o.Ln=!0),o.Ln&&o instanceof nt&&(o.ci=null))}else for(;this.D.length>i;)this.ri(this.D.length-1,!1)}Q1(e,t,i){if(null==e||t<0)return;const s=this.QN(e,t),n=this._N(e,t,s);if(null!==n){n.It();const o=n.copy();if(o.MN()){const a=this.findBindingPanel();null!==a&&a.$N(!0)}y.$(e)&&(null===this.tn&&(this.tn=new xt),this.tn.set(e,o));const r=t+this.U0();this.insertAt(r,o),i&&(o.te=e,this.tC(r,t),o.te=null),o.data=e}}ZI(e){if(e<0)return;const t=e+this.U0();this.ri(t,!0),this.tC(t,e)}tC(e,t){const i=this.D;let s=e,n=t;for(;s<i.length;){const o=i.elt(s);o instanceof J&&o.QI(s,n),s++,n++}}QI(e,t){this.type===J.TableRow?this.row=e:this.type===J.TableColumn&&(this.column=e),this.itemIndex=t}jI(){return null!==this.Aa||null!==this.itemTemplateMap}get itemTemplate(){const e=this.itemTemplateMap;if(null!==e){const t=e.get("");if(t)return t}return J.xD()}set itemTemplate(e){const t=this.itemTemplate;if(t!==e){(e instanceof At||e.isPanelMain)&&y.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+e),null===this.itemTemplateMap&&(this.itemTemplateMap=new xt),this.itemTemplateMap.set("",e),this.t("itemTemplate",t,e);const i=this.diagram;if(null!==i&&i.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return null!==this.w?this.w.x0:null}set itemTemplateMap(e){const t=this.itemTemplateMap;if(t!==e){const i=e.iterator;for(;i.next(););this.Yt().x0=e,this.t("itemTemplateMap",t,e);const s=this.diagram;if(null!==s&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return null!==this.w?this.w.b0:"category"}set itemCategoryProperty(e){const t=this.itemCategoryProperty;t!==e&&("string"!=typeof e&&!y.st(e)&&y.si(e,"string or function",J,"itemCategoryProperty"),this.Yt().b0=e,this.t("itemCategoryProperty",t,e))}QN(e,t){if(null===e)return"";const i=this.itemCategoryProperty;let s="";if(y.st(i))s=i(e);else{if("string"!=typeof i||!y.$(e))return"";{if(""===i)return"";const n=this.diagram,o=null!==n?n.model:null;s=o?o.St(e,i):bt.St(e,i)}}return void 0===s?"":"string"==typeof s?s:void y.o("Panel.getCategoryForItemData found a non-string category for "+e+": "+s)}static bD=!1;static eC;static xD(){return J.eC||(J.eC=(new J).add((new mt).bind("text","",y.toString).theme("stroke","text"))),J.eC}_N(e,t,i){let s=null;const n=this.itemTemplateMap;return null!==n&&(s=n.get(i),null===s&&(s=n.get(""))),null===s&&(J.bD||(J.bD=!0,y.ne('No item template Panel found for category "'+i+'" on '+this),y.ne("  Using default item template.")),s=J.xD()),s}get Tf(){return!!(1048576&this.n)}set Tf(e){const t=!!(1048576&this.n);t!==e&&(y.s(e,"boolean",J,"isAtomic"),this.n=1048576^this.n,this.t("isAtomic",t,e))}get isClipping(){return!!(2097152&this.n)}set isClipping(e){const t=!!(2097152&this.n);t!==e&&(this.xf(),this.n=2097152^this.n,this instanceof pt&&(this.he=null),this.c(),this.t("isClipping",t,e))}get isOpposite(){return!!(33554432&this.n)}set isOpposite(e){const t=!!(33554432&this.n);t!==e&&(this.n=33554432^this.n,this.c(),this.t("isOpposite",t,e))}get isEnabled(){return!!(4194304&this.n)}set isEnabled(e){const t=!!(4194304&this.n);if(t!==e){const i=null===this.panel||this.panel.isEnabledObject();this.n=4194304^this.n,this.t("isEnabled",t,e);const s=this.diagram;if(null!==s&&s.undoManager.isUndoingRedoing)return;i&&this.Z1(this,e)}}Z1(e,t){const i=e.enabledChanged;if(null!==i&&i(e,t),e instanceof J){const s=e.D.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];t&&r instanceof J&&!r.isEnabled||this.Z1(r,t)}}}get alignmentFocusName(){return this.uo}set alignmentFocusName(e){const t=this.uo;t!==e&&(this.uo=e,this.c(),this.t("alignmentFocusName",t,e))}static definePanelLayout(e,t){Rt.Tn(e,t)}static isLayoutDefined(e){return Rt.fs.has(e)}static Position=Rt.fs.get("Position");static Horizontal=Rt.fs.get("Horizontal");static Vertical=Rt.fs.get("Vertical");static Spot=Rt.fs.get("Spot");static Auto=Rt.fs.get("Auto");static Table=Rt.fs.get("Table");static Viewbox=Rt.fs.get("Viewbox");static TableRow=Rt.fs.get("TableRow");static TableColumn=Rt.fs.get("TableColumn");static Link=Rt.fs.get("Link");static Grid=Rt.fs.get("Grid");static Graduated=Rt.fs.get("Graduated")}J.definePanelLayout=J.definePanelLayout;class Te{R0;O0;I0;E0;Fs;ts;ds;vi;constructor(){this.R0=0,this.O0=100,this.I0=10,this.E0=0,this.Fs=null,this.ts=null,this.ds=null,this.vi=null}copy(){const e=new Te;return e.R0=this.R0,e.O0=this.O0,e.I0=this.I0,e.E0=this.E0,e.Fs=this.Fs,e.ts=this.ts,e.ds=this.ds,e.vi=this.vi,e}}class ii{Rd;Od;af;N0;constructor(){this.Rd=lt.OL,this.Od=S.gn,this.af=lt.Zw,this.N0=[]}copy(){const e=new ii;return e.Rd=this.Rd.copy(),e.Od=this.Od.copy(),e.af=this.af.copy(),e.N0=this.N0,e}}class ae{Qi;_i;V0;B0;z0;X0;C0;A0;L0;T0;v0;D0;F0;La;constructor(){this.Qi=[],this._i=[],this.V0=3,this.B0=3,this.z0=0,this.X0=0,this.C0=It.im,this.A0=1,this.L0=null,this.T0=null,this.v0=1,this.D0=null,this.F0=null,this.La=null}copy(e){const t=new ae,i=this.Qi,s=i.length,n=t.Qi;for(let l=0;l<s;l++){const h=i[l];if(void 0===h)continue;const c=h.copy();c.Vh(e),n[l]=c}const o=this._i,r=o.length,a=t._i;for(let l=0;l<r;l++){const h=o[l];if(void 0===h)continue;const c=h.copy();c.Vh(e),a[l]=c}return t.V0=this.V0,t.B0=this.B0,t.z0=this.z0,t.X0=this.X0,t.C0=this.C0.N(),t.A0=this.A0,t.L0=this.L0,t.T0=this.T0,t.v0=this.v0,t.D0=this.D0,t.F0=this.F0,t.La=this.La,t}}var Vi=(m=>(m[m.Default=1]="Default",m[m.None=2]="None",m[m.ProportionalExtra=3]="ProportionalExtra",m))(Vi||{});let ee=(()=>{class m{Zs;G0;Tt;Gh;Yh;de;ct;Ed;ho;al;Ud;Vd;Kh;Lt;Bd;Rs;j;Re;ki;constructor(t){z.Je(this),this.Zs=null,this.G0=!0,this.Tt=0,this.ki=NaN,this.Gh=0,this.Yh=1/0,this.de=A.Default,this.j=0,this.Re=0,this.ct=0,this.Rs=null,this.Ed=1,this.ho=1,this.al=null,this.Ud=null,this.Vd=NaN,this.Kh=null,this.Lt=null,this.Bd=!1,t&&(Object.assign(this,t),void 0!==t.column?(this.isRow=!1,this.index=t.column):void 0!==t.row&&(this.isRow=!0,this.index=t.row))}copy(){const t=new m;return t.G0=this.G0,t.Tt=this.Tt,t.ki=this.ki,t.Gh=this.Gh,t.Yh=this.Yh,t.de=this.de,t.j=this.j,t.Re=this.Re,t.ct=this.ct,t.ho=this.ho,t.Ed=this.Ed,t.al=null===this.al?null:this.al.N(),t.Ud=this.Ud,t.Vd=this.Vd,t.Kh=null,null!==this.Kh&&(t.separatorDashArray=this.Kh.slice()),t.Lt=this.Lt,t.Bd=this.Bd,t.Rs=this.Rs,t}X1(t){t.isRow?void 0!==t.height&&(this.height=t.height):void 0!==t.width&&(this.width=t.width),void 0!==t.minimum&&(this.minimum=t.minimum),void 0!==t.maximum&&(this.maximum=t.maximum),void 0!==t.alignment&&(this.alignment=t.alignment),void 0!==t.stretch&&(this.stretch=t.stretch),void 0!==t.sizing&&(this.sizing=t.sizing),void 0!==t.separatorPadding&&(this.separatorPadding=t.separatorPadding),void 0!==t.separatorStroke&&(this.separatorStroke=t.separatorStroke),void 0!==t.separatorStrokeWidth&&(this.separatorStrokeWidth=t.separatorStrokeWidth),void 0!==t.separatorDashArray&&(this.Kh=t.separatorDashArray),void 0!==t.background&&(this.background=t.background),void 0!==t.coversSeparators&&(this.coversSeparators=t.coversSeparators),void 0!==t.Rs&&(this.Rs=t.Rs)}fe(t){t in Vi?this.sizing=t:y.dr(this,t)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+z.xs(this)}static Default=1;static None=2;static ProportionalExtra=3;Vh(t){this.Zs=t}computeEffectiveSpacingTop(t){let i=0;const s=this.Zs;if(this.index!==t){let o=this.separatorStroke;null===o&&null!==s&&(o=this.isRow?s.defaultRowSeparatorStroke:s.defaultColumnSeparatorStroke),null!==o&&(i=this.separatorStrokeWidth,isNaN(i)&&(i=null!==s?this.isRow?s.defaultRowSeparatorStrokeWidth:s.defaultColumnSeparatorStrokeWidth:0))}let n=this.al;if(null===n){if(null===s)return i;n=s.defaultSeparatorPadding}return i+(this.isRow?n.top:n.left)}computeEffectiveSpacing(){let t=0;const i=this.Zs;let s=0;const n=this.isRow;if(null!==i&&i.type===J.Table){const r=n?i.Qi.length:i._i.length;for(let a=0;a<r;a++){const l=n?i.Qi[a]:i._i[a];if(void 0!==l&&0!==l.j){s=l.index;break}}}if(this.index!==s){let r=this.separatorStroke;null===r&&null!==i&&(r=n?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),null!==r&&(t=this.separatorStrokeWidth,isNaN(t)&&(t=null!==i?n?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:0))}let o=this.al;if(null===o){if(null===i)return t;o=i.defaultSeparatorPadding}return t+(this.isRow?o.top+o.bottom:o.left+o.right)}t(t,i,s,n,o){const r=this.Zs;if(null!==r&&(r.raiseChangedEvent(2,t,this,i,s,n,o),null!==this.Rs)){const a=r.diagram;if(null!==a&&!a.wi){const l=r.findBindingPanel();if(null!==l){const h=l.data;if(null!==h){const c=this.Rs.iterator;for(;c.next();)c.value.updateSource(this,h,t,l)}}}}}get panel(){return this.Zs}get isRow(){return this.G0}set isRow(t){this.G0=t}get index(){return this.Tt}set index(t){this.Tt=t}get height(){return this.ki}set height(t){const i=this.ki;i!==t&&(t<0&&y.J(t,">= 0",m,"height"),this.ki=t,this.actual=this.j,null!==this.panel&&this.panel.c(),this.t("height",i,t))}get width(){return this.ki}set width(t){const i=this.ki;i!==t&&(t<0&&y.J(t,">= 0",m,"width"),this.ki=t,this.actual=this.j,null!==this.panel&&this.panel.c(),this.t("width",i,t))}get minimum(){return this.Gh}set minimum(t){const i=this.Gh;i!==t&&((t<0||!isFinite(t))&&y.J(t,">= 0",m,"minimum"),this.Gh=t,this.actual=this.j,null!==this.panel&&this.panel.c(),this.t("minimum",i,t))}get maximum(){return this.Yh}set maximum(t){const i=this.Yh;i!==t&&(t<0&&y.J(t,">= 0",m,"maximum"),this.Yh=t,this.actual=this.j,null!==this.panel&&this.panel.c(),this.t("maximum",i,t))}get alignment(){return this.de}set alignment(t){const i=this.de;i.equals(t)||(this.de=t.N(),null!==this.panel&&this.panel.c(),this.t("alignment",i,t))}get stretch(){return this.ho}set stretch(t){const i=this.ho;i!==t&&(this.ho=t,null!==this.panel&&this.panel.c(),this.t("stretch",i,t))}get separatorPadding(){return this.al}set separatorPadding(t){"number"==typeof t&&(t=new It(t));const i=this.al;(null===t||null===i||!i.equals(t))&&(null!==t&&(t=t.N()),this.al=t,null!==this.panel&&this.panel.c(),this.t("separatorPadding",i,t))}get separatorStroke(){return this.Ud}set separatorStroke(t){const i=this.Ud;i!==t&&(null!==t&&V.Md(t,"RowColumnDefinition.separatorStroke"),t instanceof V&&t.k(),this.Ud=t,null!==this.panel&&this.panel.c(),this.t("separatorStroke",i,t))}get separatorStrokeWidth(){return this.Vd}set separatorStrokeWidth(t){const i=this.Vd;i!==t&&(this.Vd=t,null!==this.panel&&this.panel.c(),this.t("separatorStrokeWidth",i,t))}get separatorDashArray(){return this.Kh}set separatorDashArray(t){const i=this.Kh;if(i!==t){if(null!==t&&!Array.isArray(t)&&y.si(t,"Array",m,"separatorDashArray:value"),null!==t){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];("number"!=typeof r||!(r>=0)||!isFinite(r))&&y.o("separatorDashArray value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(0===n){if(null===i)return;t=null}}this.Kh=t,null!==this.panel&&this.panel.C(),this.t("separatorDashArray",i,t)}}get background(){return this.Lt}set background(t){const i=this.Lt;i!==t&&(null!==t&&V.Md(t,"RowColumnDefinition.background"),t instanceof V&&t.k(),this.Lt=t,null!==this.panel&&this.panel.C(),this.t("background",i,t))}get coversSeparators(){return this.Bd}set coversSeparators(t){const i=this.Bd;i!==t&&(y.s(t,"boolean",m,"coversSeparators"),this.Bd=t,null!==this.panel&&this.panel.C(),this.t("coversSeparators",i,t))}get sizing(){return this.Ed}set sizing(t){const i=this.Ed;i!==t&&(this.Ed=t,null!==this.panel&&this.panel.c(),this.t("sizing",i,t))}q1(){if(1===this.sizing){const t=this.Zs;return null===t?2:this.isRow?t.rowSizing:t.columnSizing}return this.sizing}get actual(){return this.j}set actual(t){this.j=isNaN(this.ki)?Math.max(Math.min(this.Yh,t),this.Gh):Math.max(Math.min(this.Yh,this.ki),this.Gh)}get measured(){return this.Re}set measured(t){this.Re=t}get total(){return this.j+this.computeEffectiveSpacing()}get position(){return this.ct}set position(t){this.ct=t}bind(t,i,s,n){return this.Sf(t,i,s,n),this}bindTwoWay(t,i,s,n){const o=this.Sf(t,i,s,n);return void 0===n&&o.makeTwoWay(),this}theme(t,i,s,n,o){return this.Na(t,i,s,n,o),this}themeData(t,i,s,n,o){return this.Na(t,i,s,n,o).ofData(),this}themeObject(t,i,s,n,o,r){return this.Na(t,i,s,n,o).ofObject(r),this}themeModel(t,i,s,n,o){return this.Na(t,i,s,n,o).ofModel(),this}Sf(t,i,s,n){let o;return o="string"==typeof t?new We(t,i,s,n):t,this.w0(o),o}Na(t,i,s,n,o){let r;return r="string"==typeof t?new ni(t,i,s,n,o):t,this.w0(r),r}w0(t){t.Ti=this;const i=this.panel;if(null!==i){const s=i.findBindingPanel();null!==s&&s.nD()&&y.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+t+" on "+i)}null===this.Rs&&(this.Rs=new H),this.Rs.add(t)}}return m})();class rt extends st{ut;en;zd;Hh;Qe;Qo;Wo;Kt;Xd;Gd;K;constructor(e,t){super(),this.ut=null,this.en=null,this.zd="None",this.Hh="black",this.Qe="black",this.Qo=1,this.Wo=null,this.Kt=null,this.Xd=NaN,this.Gd=NaN,this.K=null,"string"==typeof e?this.figure=e:e&&Object.assign(this,e),t&&Object.assign(this,t)}cloneProtected(e){super.cloneProtected(e),e.ut=this.ut,e.en=this.en,e.zd=this.zd,e.Hh=this.Hh,e.Qe=this.Qe,e.Qo=this.Qo,null!==this.Wo&&(e.Wo=this.Wo.slice()),null!==this.Kt&&(e.Kt=this.Kt.me?this.Kt:this.Kt.copy()),e.Xd=this.Xd,e.Gd=this.Gd,null!==this.K&&(e.K=this.K.copy())}jh(){return null===this.Kt?this.Kt=new ji:this.Kt.me&&(this.Kt=this.Kt.copy()),this.Kt}ba(){super.ba(),null!==this.Kt&&(this.Kt.me=!0)}fe(e){e in Fi?this.geometryStretch=e:super.fe(e)}toString(){return"Shape("+("None"!==this.figure?this.figure:"None"!==this.toArrow?this.toArrow:this.fromArrow)+")#"+z.xs(this)}_I(e,t){const i=this.pathPattern;if(null===i)return;i.ht(1/0,1/0);const s=i.measuredBounds;i.Ut(0,0,s.width,s.height);const n=this.geometry;if(null===n)return;e.save(),e.beginPath();const o=y.nt();if(1===n.type)o.push(n.startX),o.push(n.startY),o.push(n.endX),o.push(n.endY),this.Yd(e,t,o,i);else if(4===n.type){const r=n.figures.iterator;for(;r.next();){const a=r.value;o.length=0,o.push(a.startX),o.push(a.startY);let l=a.startX,h=a.startY,c=l,u=h;const d=a.segments.r,f=d.length;for(let p=0;p<f;p++){const g=d[p];switch(g.type){case 1:this.Yd(e,t,o,i),o.length=0,o.push(g.endX),o.push(g.endY),l=g.endX,h=g.endY,c=l,u=h;break;case 2:o.push(g.endX),o.push(g.endY),l=g.endX,h=g.endY;break;case 3:L.Wn(l,h,g.point1X,g.point1Y,g.point2X,g.point2Y,g.endX,g.endY,.5,o),l=g.endX,h=g.endY;break;case 4:L.nm(l,h,g.point1X,g.point1Y,g.endX,g.endY,.5,o),l=g.endX,h=g.endY;break;case 5:{const b=g.Fo(a),x=b.length;if(0===x){o.push(g.centerX),o.push(g.centerY),l=g.centerX,h=g.centerY;break}for(let v=0;v<x;v++){const P=b[v];L.Wn(l,h,P[2],P[3],P[4],P[5],P[6],P[7],.5,o),l=P[6],h=P[7]}break}case 6:{const b=g.Za(a,l,h),x=b.length;if(0===x){o.push(g.endX),o.push(g.endY),l=g.endX,h=g.endY;break}for(let v=0;v<x;v++){const P=b[v];L.Wn(l,h,P[2],P[3],P[4],P[5],P[6],P[7],.5,o),l=P[6],h=P[7]}break}default:y.o("Segment not of valid type: "+g.type)}g.isClosed&&(o.push(c),o.push(u),this.Yd(e,t,o,i))}this.Yd(e,t,o,i)}}else if(2===n.type)o.push(n.startX),o.push(n.startY),o.push(n.endX),o.push(n.startY),o.push(n.endX),o.push(n.endY),o.push(n.startX),o.push(n.endY),o.push(n.startX),o.push(n.startY),this.Yd(e,t,o,i);else if(3===n.type){const r=new Ht;r.startX=n.endX,r.startY=(n.startY+n.endY)/2;const a=new St(5);a.startAngle=0,a.sweepAngle=360,a.centerX=(n.startX+n.endX)/2,a.centerY=(n.startY+n.endY)/2,a.radiusX=Math.abs(n.startX-n.endX)/2,a.radiusY=Math.abs(n.startY-n.endY)/2,r.add(a);const l=a.Fo(r),h=l.length;if(0===h)o.push(a.centerX),o.push(a.centerY);else{let c=r.startX,u=r.startY;for(let d=0;d<h;d++){const f=l[d];L.Wn(c,u,f[2],f[3],f[4],f[5],f[6],f[7],.5,o),c=f[6],u=f[7]}}this.Yd(e,t,o,i)}y.Z(o),e.restore(),e.clearContextCache(!1)}tE(e){let t=e.measuredBounds.width;return e instanceof rt&&(t-=e.strokeWidth),t<1&&(t=1),t}Yd(e,t,i,s){const n=i.length;if(n<4)return;const o=s.measuredBounds,r=Math.max(1,o.width),a=o.height;let l=i[0],h=i[1],c=0,u=0,d=0,f=0,p=0,g=0,b=0,x=0;const v=y.nt();for(let D=2;D<n;D+=2)c=i[D],u=i[D+1],d=c-l,f=u-h,0===d&&(d=.001),p=f/d,g=Math.atan2(f,d),b=Math.sqrt(d*d+f*f),v.push([d,g,p,b]),x+=b,l=c,h=u;l=i[0],h=i[1];const P=this.tE(s);let w=P;const M=r/2;let C=0!==M,N=0,I=v[N];d=I[0],g=I[1],p=I[2],b=I[3];let T=0;for(;x>=.1;){if(0===T&&(C?(w=P,w-=M,x-=M,C=!1):w=P,0===w&&(w=1)),w>x)return w=x,void y.Z(v);w>b?(T=w-b,w=b):T=0;let D=Math.sqrt(w*w/(1+p*p));if(d<0&&(D=-D),l+=D,h+=p*D,e.translate(l,h),e.rotate(g),e.translate(-r/2,-a/2),0===T&&s.Ma(e,t),e.translate(r/2,a/2),e.rotate(-g),e.translate(-l,-h),x-=w,b-=w,0!==T){if(N++,N===v.length)return void y.Z(v);I=v[N],d=I[0],g=I[1],p=I[2],b=I[3],w=T}}y.Z(v)}Ma(e,t){const i=e instanceof he;let s=this.Qe;const n=this.Hh;if(null===s&&null===n)return;const o=this.ut;if(null===o)return;e.commitTransform();const r=this.actualBounds,a=this.naturalBounds;null!==n&&this.kn(e,n,!0,!1,a,r);const l=this.part;let h=this.Qo;null!==s&&0===h&&null!==l&&(this.isPanelMain||l.findMainElement()===this)&&(h=l.eE()),0===h&&(s=null),null!==s&&0!==h&&(this.kn(e,s,!1,!1,a,r),e.lineWidth=h,e.lineJoin=this.strokeJoin,e.lineCap=this.strokeCap,e.miterLimit=this.strokeMiterLimit);let c=!1;l&&t.getRenderingHint("drawShadows")&&(c=l.isShadowed),!1===e.rl&&(c=!1);let u=!0;null!==s&&(null===n||"transparent"===n)&&(u=!1);let d=!1;const f=this.strokeDashArray;if(null!==f&&(d=!0,e.enableDash(f,this.strokeDashOffset)),1===o.type)e.beginPath(),e.moveTo(o.startX,o.startY),e.lineTo(o.endX,o.endY),null!==s&&e.strokeContext(),e.endPath();else if(2===o.type){const p=o.startX,g=o.startY,b=o.endX,x=o.endY,v=Math.min(p,b),P=Math.min(g,x),w=Math.abs(b-p),M=Math.abs(x-g);e.beginPath(),e.rect(v,P,w,M),null!==n&&e.fillContext(n,!1,null),null!==s&&(u&&c&&e.shadowsOff(),e.strokeContext(),u&&c&&e.shadowsOn()),e.endPath()}else if(3===o.type){const p=o.startX,g=o.startY,b=o.endX,x=o.endY,v=Math.abs(b-p)/2,P=Math.abs(x-g)/2,w=Math.min(p,b)+v,M=Math.min(g,x)+P;e.beginPath(),e.moveTo(w,M-P),e.bezierCurveTo(w+L.qn*v,M-P,w+v,M-L.qn*P,w+v,M),e.bezierCurveTo(w+v,M+L.qn*P,w+L.qn*v,M+P,w,M+P),e.bezierCurveTo(w-L.qn*v,M+P,w-v,M+L.qn*P,w-v,M),e.bezierCurveTo(w-v,M-L.qn*P,w-L.qn*v,M-P,w,M-P),e.closePath(),null!==n&&e.fillContext(n,!1,null),null!==s&&(u&&c&&e.shadowsOff(),e.strokeContext(),u&&c&&e.shadowsOn()),e.endPath()}else if(4===o.type){const p=o.figures,g=p.length;for(let b=0;b<g;b++){const x=p.r[b];i?(e.beginPath(),this.kD(e,x)):null===x.ji&&(x.ji=new Path2D,this.kD(x.ji,x));const v=x.isFilled;c?x.isShadowed?(!0===v&&"transparent"!==n&&null!==n&&e.fillContext(n,x.isEvenOdd,x.ji),null!==s&&(v&&u&&e.shadowsOff(),e.stroke(x.ji),v&&u&&e.shadowsOn())):(e.shadowsOff(),v&&"transparent"!==n&&null!==n&&e.fillContext(n,x.isEvenOdd,x.ji),null!==s&&e.stroke(x.ji),e.shadowsOn()):(v&&null!==n&&e.fillContext(n,x.isEvenOdd,x.ji),null!==s&&e.stroke(x.ji)),e.endPath(b)}}d&&e.disableDash(),this._I(e,t)}kD(e,t){e.moveTo(t.startX,t.startY);const i=t.segments.r,s=i.length;let n=null;for(let o=0;o<s;o++){const r=i[o];switch(r.type){case 1:e.moveTo(r.endX,r.endY);break;case 2:e.lineTo(r.endX,r.endY);break;case 3:e.bezierCurveTo(r.point1X,r.point1Y,r.point2X,r.point2Y,r.endX,r.endY);break;case 4:e.quadraticCurveTo(r.point1X,r.point1Y,r.endX,r.endY);break;case 5:if(r.radiusX===r.radiusY){const h=Math.PI/180;e.arc(r.point1X,r.point1Y,r.radiusX,r.startAngle*h,(r.startAngle+r.sweepAngle)*h,r.sweepAngle<0,null!==n?n.endX:t.startX,null!==n?n.endY:t.startY)}else{const a=r.Fo(t),l=a.length;if(0===l){e.lineTo(r.centerX,r.centerY);break}for(let h=0;h<l;h++){const c=a[h];0===h&&e.lineTo(c[0],c[1]),e.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7])}}break;case 6:{let h,a=0,l=0;if(null!==n&&5===n.type){h=n.Fo(t);const u=h.length;if(0===u){e.lineTo(r.endX,r.endY);break}const d=h[u-1]||null;null!==d&&(a=d[6],l=d[7])}else a=null!==n?n.endX:t.startX,l=null!==n?n.endY:t.startY;h=r.Za(t,a,l);const c=h.length;if(0===c){e.lineTo(r.endX,r.endY);break}for(let u=0;u<c;u++){const d=h[u];e.bezierCurveTo(d[2],d[3],d[4],d[5],d[6],d[7])}break}}r.isClosed&&e.closePath(),n=r}}wf(e,t,i){if(!super.wf(e,t,i)||null===this.Qe&&null===this.Hh||null===this.ut||null!==this.pathPattern)return!1;const s=this.svg.getElementsByTagName("path");return this.geometry.figures.length===s.length&&(e.currentPath=this.svg,this.Ma(e,t),e.currentPath=null,!0)}Pd(e){return null!==this.geometry&&this.geometry.figures.length>1||null!==this.pathPattern||super.Pd(e)}LN(e,t){if("g"!==e.nodeName)e.setAttributeNS(null,"filter",t);else{const i=e.getElementsByTagName("path");for(let s=0;s<i.length;s++)i[s].setAttributeNS(null,"filter",t)}}getDocumentPoint(e,t){if(void 0===t&&(t=new S),e instanceof A){const i=e;i.isNoSpot()&&y.o("getDocumentPoint Spot must be a real, specific Spot, not: "+i.toString());const s=this.naturalBounds,n=this.strokeWidth;return t.e(i.x*(s.width+n)-n/2+s.x+i.offsetX,i.y*(s.height+n)-n/2+s.y+i.offsetY),this.Js.gt(t),t}return t.set(e),this.Js.gt(t),t}getDocumentBounds(e){void 0===e&&(e=new j);const t=this.naturalBounds,i=this.Js,s=j.z(t.x,t.y,t.width,t.height),n=this.strokeWidth;s.inflate(n/2,n/2);const o=S.z(s.x,s.y).v(i);return e.e(o.x,o.y,0,0),o.e(s.right,s.y).v(i),e.re(o.x,o.y,0,0),o.e(s.right,s.bottom).v(i),e.re(o.x,o.y,0,0),o.e(s.x,s.bottom).v(i),e.re(o.x,o.y,0,0),j.i(s),S.i(o),e}ka(e,t){const i=this.geometry;if(null===i||null===this.fill&&null===this.stroke)return!1;const s=i.bounds;let n=this.strokeWidth/2;1===i.type&&!t&&(n+=2);const o=j.l();if(o.h(s),o.inflate(n+2,n+2),!o.containsPoint(e))return j.i(o),!1;const r=n+1e-4;if(1===i.type)return null!==this.stroke&&(!((i.startX-i.endX)*(e.x-i.endX)+(i.startY-i.endY)*(e.y-i.endY)<0||(i.endX-i.startX)*(e.x-i.startX)+(i.endY-i.startY)*(e.y-i.startY)<0)&&(j.i(o),L.Ve(i.startX,i.startY,i.endX,i.endY,n,e.x,e.y)));if(2===i.type){const a=i.startX,l=i.startY,h=i.endX,c=i.endY;if(o.x=Math.min(a,h),o.y=Math.min(l,c),o.width=Math.abs(h-a),o.height=Math.abs(c-l),null===this.fill){if(o.inflate(-r,-r),o.containsPoint(e))return j.i(o),!1;o.inflate(r,r)}null!==this.stroke&&o.inflate(n,n);const u=o.containsPoint(e);return j.i(o),u}if(3===i.type){const a=i.startX,l=i.startY,h=i.endX,c=i.endY;let u=Math.min(a,h),d=Math.min(l,c),g=Math.abs(h-a)/2,b=Math.abs(c-l)/2;if(u=e.x-(u+g),d=e.y-(d+b),null===this.fill){if(g-=r,b-=r,g<=0||b<=0||u*u/(g*g)+d*d/(b*b)<=1)return j.i(o),!1;g+=r,b+=r}return null!==this.stroke&&(g+=r,b+=r),j.i(o),!(g<=0||b<=0)&&u*u/(g*g)+d*d/(b*b)<=1}if(4===i.type)return j.i(o),null===this.fill?i.ZL(e.x,e.y,n):i.VP(e,n,this.strokeWidth>1,t);y.o("Unknown Geometry type: "+i.type)}bd(e,t,i,s){const n=this.desiredSize,o=this.Qo;let r;if(e=Math.max(e,0),t=Math.max(t,0),null!==this.en)r=this.geometry.bounds;else{const p=this.figure;let g=rt.iC[p];if(void 0===g){let b=L.Jn[p];"string"==typeof b&&(b=L.Jn[b]),y.st(b)?(g=b(null,100,100),rt.iC[p]=g):y.o("Unsupported Figure: "+p)}r=g.bounds}let a=r.width,l=r.height,h=r.width,c=r.height;switch(this.Qs(!0)){case 0:i=0,s=0;break;case 2:h=Math.max(e-o,0),c=Math.max(t-o,0);break;case 5:h=Math.max(e-o,0),s=0;break;case 4:i=0,c=Math.max(t-o,0)}isFinite(n.width)&&(h=n.width),isFinite(n.height)&&(c=n.height);const u=this.maxSize,d=this.minSize;i=Math.max(i-o,d.width),s=Math.max(s-o,d.height),h=Math.min(u.width,h),c=Math.min(u.height,c),h=isFinite(h)?Math.max(i,h):Math.max(a,i),c=isFinite(c)?Math.max(s,c):Math.max(l,s);const f=this._S();switch(f){case 0:break;case 2:a=h,l=c;break;case 6:{let p=Math.min(h/a,c/l);isFinite(p)||(p=1),a*=p,l*=p;break}default:y.o(f+" is not a valid geometryStretch.")}if(null!==this.en){0===a&&(a=.001),0===l&&(l=.001);const p=this.en.sR(a,l);this.ut=p}else(null===this.ut||!L.X(this.ut.Sc,e-o)||!L.X(this.ut.Mc,t-o))&&(this.ut=rt.iE(this,a,l));r=this.ut.bounds,e===1/0||t===1/0?this.lo(r.x-o/2,r.y-o/2,0===e&&0===a?0:r.width+o,0===t&&0===l?0:r.height+o):this.lo(-o/2,-o/2,h+o,c+o),n.isReal()?(h=n.width,c=n.height,h=Math.min(u.width,h),c=Math.min(u.height,c),h=Math.max(d.width,h),c=Math.max(d.height,c),this.Ke.e(0,0,h,c)):this.Ke.h(r)}_S(){const e=this.geometryStretch;return null!==this.en?1===e?2:e:1===e?rt.iC[this.figure].defaultStretch:e}Pa(e,t,i,s){this.commonArrange(e,t,i,s)}getNearestIntersectionPoint(e,t,i){return this.pf(e.x,e.y,t.x,t.y,i)}pf(e,t,i,s,n){const o=this.v,r=1/(o.m11*o.m22-o.m12*o.m21),a=o.m22*r,l=-o.m12*r,h=-o.m21*r,c=o.m11*r,u=r*(o.m21*o.dy-o.m22*o.dx),d=r*(o.m12*o.dx-o.m11*o.dy),f=e*a+t*h+u,p=e*l+t*c+d,g=i*a+s*h+u,b=i*l+s*c+d,x=this.Qo/2;let v=this.ut;null===v&&(this.ht(1/0,1/0),v=this.ut);const P=v.bounds;let w=!1;if(1===v.type)if(this.strokeWidth<=1.5)w=L.vo(v.startX,v.startY,v.endX,v.endY,f,p,g,b,n);else{let M=0,C=0;if(v.startX===v.endX)M=x,C=0;else{const F=(v.endY-v.startY)/(v.endX-v.startX);C=x/Math.sqrt(1+F*F),M=C*F}const N=y.nt();let I=new S;L.vo(v.startX+M,v.startY+C,v.endX+M,v.endY+C,f,p,g,b,I)&&N.push(I),I=new S,L.vo(v.startX-M,v.startY-C,v.endX-M,v.endY-C,f,p,g,b,I)&&N.push(I),I=new S,L.vo(v.startX+M,v.startY+C,v.startX-M,v.startY-C,f,p,g,b,I)&&N.push(I),I=new S,L.vo(v.endX+M,v.endY+C,v.endX-M,v.endY-C,f,p,g,b,I)&&N.push(I);const T=N.length;if(0===T)return y.Z(N),!1;w=!0;let D=1/0;for(let F=0;F<T;F++){const E=N[F],B=(E.x-f)**2+(E.y-p)**2;B<D&&(D=B,n.x=E.x,n.y=E.y)}y.Z(N)}else if(2===v.type)w=L.Cl(P.x-x,P.y-x,P.x+P.width+x,P.y+P.height+x,f,p,g,b,n);else if(3===v.type){const M=j.z(P.x,P.y,P.width,P.height).inflate(x,x);w=this.sE(M,f,p,g,b,n),j.i(M)}else if(4===v.type){let M=0,C=0,N=0,I=0;const T=S.l();let D=g-f,F=b-p,E=D*D+F*F,B=f,Y=p;if(E>0&&P.contains(B,Y)&&(T.x=B,T.y=Y,this.containsPoint(T)))for(0!==D&&Math.abs(D)<.5?(F*=.5/D,D=.5):0!==F&&Math.abs(F)<.5&&(D*=.5/F,F=.5),B-=D,Y-=F;P.contains(B,Y);)B-=D,Y-=F;const W=.6;n.x=g,n.y=b;for(let it=0;it<v.figures.count;it++){const yt=v.figures.r[it],ot=yt.isFilled?B:f,at=yt.isFilled?Y:p,ft=yt.segments;M=yt.startX,C=yt.startY;let ut=M,kt=C;for(let Mt=0;Mt<ft.count;Mt++){const et=ft.r[Mt],Pt=et.type;N=et.endX,I=et.endY;let zt=!1;switch(Pt){case 1:ut=N,kt=I;break;case 2:zt=this._1(M,C,N,I,ot,at,g,b,T);break;case 3:zt=L.om(M,C,et.point1X,et.point1Y,et.point2X,et.point2Y,N,I,ot,at,g,b,W,T);break;case 4:zt=L.om(M,C,M+2/3*(et.point1X-M),C+2/3*(et.point1Y-C),N+2/3*(et.point1X-N),I+2/3*(et.point1Y-I),N,I,ot,at,g,b,W,T);break;case 5:case 6:{const Tt=5===et.type?et.Fo(yt):et.Za(yt,M,C),dt=Tt.length;if(0===dt){zt=this._1(M,C,5===et.type?et.centerX:et.endX,5===et.type?et.centerY:et.endY,ot,at,g,b,T);break}let tt=null;for(let wt=0;wt<dt;wt++){if(tt=Tt[wt],0===wt&&this._1(M,C,tt[0],tt[1],ot,at,g,b,T)){const Lt=this.tk(ot,at,T,E,n);Lt<E&&(E=Lt,w=!0)}if(L.om(tt[0],tt[1],tt[2],tt[3],tt[4],tt[5],tt[6],tt[7],ot,at,g,b,W,T)){const Lt=this.tk(ot,at,T,E,n);Lt<E&&(E=Lt,w=!0)}}N=tt[6],I=tt[7];break}default:y.o("Unknown Segment type: "+Pt)}if(M=N,C=I,zt){const Tt=this.tk(ot,at,T,E,n);Tt<E&&(E=Tt,w=!0)}if(et.isClosed&&(N=ut,I=kt,this._1(M,C,N,I,ot,at,g,b,T))){const Tt=this.tk(ot,at,T,E,n);Tt<E&&(E=Tt,w=!0)}}}let $=i-e,K=s-t;const Z=Math.sqrt($*$+K*K);0!==Z&&($/=Z,K/=Z),n.x-=$*x,n.y-=K*x,S.i(T)}else y.o("Unknown Geometry type: "+v.type);return!!w&&(this.v.gt(n),!0)}tk(e,t,i,s,n){const o=i.x-e,r=i.y-t,a=o*o+r*r;return a<s?(n.x=i.x,n.y=i.y,a):s}_1(e,t,i,s,n,o,r,a,l){if(L.X(e,i)&&L.X(t,s)||L.X(n,r)&&L.X(o,a))return!1;let h=!1;const c=(n-r)*(t-s)-(o-a)*(e-i);if(0===c)return!1;if(l.x=((n*a-o*r)*(e-i)-(n-r)*(e*s-t*i))/c,l.y=((n*a-o*r)*(t-s)-(o-a)*(e*s-t*i))/c,(e>i?e-i:i-e)<(t>s?t-s:s-t)){const u=t<s?t:s,d=t<s?s:t;(l.y>u||L.X(l.y,u))&&(l.y<d||L.X(l.y,d))&&(h=!0)}else{const u=e<i?e:i,d=e<i?i:e;(l.x>u||L.X(l.x,u))&&(l.x<d||L.X(l.x,d))&&(h=!0)}return h}nE(e,t,i){return!1!==this.pickable&&(i.kc(this.v),t?this.oE(e,i):this.containedInRect(e,i))}containedInRect(e,t){if(void 0===t)return e.containsRect(this.actualBounds);let i=this.ut;null===i&&(this.ht(1/0,1/0),i=this.ut);const s=i.bounds,n=this.strokeWidth/2;let o=!1;const r=S.l();return r.e(s.x-n,s.y-n),e.containsPoint(t.gt(r))&&(r.e(s.x-n,s.bottom+n),e.containsPoint(t.gt(r))&&(r.e(s.right+n,s.bottom+n),e.containsPoint(t.gt(r))&&(r.e(s.right+n,s.y-n),e.containsPoint(t.gt(r))&&(o=!0)))),S.i(r),o}intersectsRect(e,t){if(this.containedInRect(e,t)||void 0===t&&(t=this.v,e.containsRect(this.actualBounds)))return!0;const i=Ot.l();i.set(t),i.ex();const s=e.left,n=e.right,o=e.top,r=e.bottom,a=S.l();if(a.e(s,o),i.gt(a),this.ka(a,!0)||(a.e(n,o),i.gt(a),this.ka(a,!0))||(a.e(s,r),i.gt(a),this.ka(a,!0))||(a.e(n,r),i.gt(a),this.ka(a,!0)))return S.i(a),!0;const l=S.l(),h=S.l();i.set(t),i.zL(this.v),i.ex(),l.x=n,l.y=o,l.v(i),a.x=s,a.y=o,a.v(i);let c=!1;return this.qh(a,l,h)?c=!0:(a.x=n,a.y=r,a.v(i),this.qh(a,l,h)?c=!0:(l.x=s,l.y=r,l.v(i),this.qh(a,l,h)?c=!0:(a.x=s,a.y=o,a.v(i),this.qh(a,l,h)&&(c=!0)))),S.i(a),Ot.i(i),S.i(l),S.i(h),c}qh(e,t,i){if(!this.getNearestIntersectionPoint(e,t,i))return!1;const s=e.x,n=e.y,o=t.x,r=t.y,a=i.x,l=i.y;if(s===o){let h=0,c=0;return n<r?(h=n,c=r):(h=r,c=n),l>=h&&l<=c}{let h=0,c=0;return s<o?(h=s,c=o):(h=o,c=s),a>=h&&a<=c}}oE(e,t){if(this.containedInRect(e,t)||void 0===t&&(t=this.v,e.containsRect(this.actualBounds)))return!0;const i=e.left,s=e.right,n=e.top,o=e.bottom,r=S.l(),a=S.l(),l=S.l(),h=Ot.l();h.set(t),h.zL(this.v),h.ex(),a.x=s,a.y=n,a.v(h),r.x=i,r.y=n,r.v(h);let c=!1;return this.qh(r,a,l)?c=!0:(r.x=s,r.y=o,r.v(h),this.qh(r,a,l)?c=!0:(a.x=i,a.y=o,a.v(h),this.qh(r,a,l)?c=!0:(r.x=i,r.y=n,r.v(h),this.qh(r,a,l)&&(c=!0)))),Ot.i(h),S.i(r),S.i(a),S.i(l),c}$T(e,t,i){if(i&&null!==this.fill&&this.ka(e,!0))return!0;let s=e.distanceSquaredPoint(t);const n=s;this.strokeWidth>1.5&&(s=this.strokeWidth/2+Math.sqrt(s),s*=s);let o=this.ut;if(null===o&&(this.ht(1/0,1/0),o=this.ut,null===o))return!1;if(!i){const u=o.bounds,d=u.x,f=u.y,p=u.x+u.width,g=u.y+u.height;if(S.distanceSquared(e.x,e.y,d,f)<=s&&S.distanceSquared(e.x,e.y,p,f)<=s&&S.distanceSquared(e.x,e.y,d,g)<=s&&S.distanceSquared(e.x,e.y,p,g)<=s)return!0}function r(u,d){const f=u.length;for(let p=0;p<f;p+=2)if(d.distanceSquared(u[p],u[p+1])>s)return!0;return!1}const a=o.startX,l=o.startY,h=o.endX,c=o.endY;if(1===o.type)return S.distanceLineSegmentSquared(e.x,e.y,a,l,h,c)<=((h-a)*(e.x-a)+(c-l)*(e.y-l)>=0&&(a-h)*(e.x-h)+(l-c)*(e.y-c)>=0?s:n);if(2===o.type){let u=!1;return i&&(u=S.distanceLineSegmentSquared(e.x,e.y,a,l,a,c)<=s||S.distanceLineSegmentSquared(e.x,e.y,a,l,h,l)<=s||S.distanceLineSegmentSquared(e.x,e.y,h,l,h,c)<=s||S.distanceLineSegmentSquared(e.x,e.y,a,c,h,c)<=s),u}if(3===o.type){const f=e.x-(a+h)/2,p=e.y-(l+c)/2,g=Math.abs(h-a)/2,b=Math.abs(c-l)/2;if(0===g||0===b)return S.distanceLineSegmentSquared(e.x,e.y,a,l,h,c)<=s;if(i){const x=L.WF(g,b,f,p);return x*x<=s}return!(S.distanceSquared(f,p,-g,0)>=s||S.distanceSquared(f,p,0,-b)>=s||S.distanceSquared(f,p,0,b)>=s||S.distanceSquared(f,p,g,0)>=s)}if(4===o.type){const u=o.bounds,d=u.x,f=u.y,p=u.x+u.width,g=u.y+u.height;if(e.x>p&&e.x<d&&e.y>g&&e.y<f&&S.distanceLineSegmentSquared(e.x,e.y,d,f,d,g)>s&&S.distanceLineSegmentSquared(e.x,e.y,d,f,p,f)>s&&S.distanceLineSegmentSquared(e.x,e.y,p,g,d,g)>s&&S.distanceLineSegmentSquared(e.x,e.y,p,g,p,f)>s)return!1;const b=Math.sqrt(s);if(!i){const x=o.figures;for(let v=0;v<x.count;v++){const P=x.r[v];let w=P.startX,M=P.startY;if(e.distanceSquared(w,M)>s)return!1;const C=P.segments.r,N=C.length;for(let I=0;I<N;I++){const T=C[I];switch(T.type){case 1:case 2:if(w=T.endX,M=T.endY,e.distanceSquared(w,M)>s)return!1;break;case 3:{const D=y.nt();L.Wn(w,M,T.point1X,T.point1Y,T.point2X,T.point2Y,T.endX,T.endY,.8,D);const F=r(D,e);if(y.Z(D),F||(w=T.endX,M=T.endY,e.distanceSquared(w,M)>s))return!1;break}case 4:{const D=y.nt();L.nm(w,M,T.point1X,T.point1Y,T.endX,T.endY,.8,D);const F=r(D,e);if(y.Z(D),F||(w=T.endX,M=T.endY,e.distanceSquared(w,M)>s))return!1;break}case 5:case 6:{const D=5===T.type?T.Fo(P):T.Za(P,w,M),F=D.length;if(0===F){if(w=5===T.type?T.centerX:T.endX,M=5===T.type?T.centerY:T.endY,e.distanceSquared(w,M)>s)return!1;break}let E=null;const B=y.nt();for(let Y=0;Y<F;Y++)if(E=D[Y],B.length=0,L.Wn(E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],.8,B),r(B,e))return y.Z(B),!1;y.Z(B),null!==E&&(w=E[6],M=E[7]);break}default:y.o("Unknown Segment type: "+T.type)}}}return!0}if(null===this.fill?o.ZL(e.x,e.y,b):o.VP(e,b,!0,!1))return!0}return!1}sE(e,t,i,s,n,o){if(0===e.width)return L.vo(e.x,e.y,e.x,e.y+e.height,t,i,s,n,o);if(0===e.height)return L.vo(e.x,e.y,e.x+e.width,e.y,t,i,s,n,o);{const r=e.width/2,a=e.height/2,l=e.x+r,h=e.y+a;let c=9999;if(t!==s&&(c=(i-n)/(t-s)),Math.abs(c)<9999){const u=i-h-c*(t-l);if(r*r*(c*c)+a*a-u*u<0)return o.x=NaN,o.y=NaN,!1;const d=Math.sqrt(r*r*(c*c)+a*a-u*u),f=(-r*r*c*u+r*a*d)/(a*a+r*r*(c*c))+l,p=(-r*r*c*u-r*a*d)/(a*a+r*r*(c*c))+l,g=c*(f-l)+u+h,b=c*(p-l)+u+h;Math.abs((t-f)**2)+Math.abs((i-g)**2)<Math.abs((t-p)**2)+Math.abs((i-b)**2)?(o.x=f,o.y=g):(o.x=p,o.y=b)}else{const u=a*a,f=t-l,p=u-u/(r*r)*(f*f);if(p<0)return o.x=NaN,o.y=NaN,!1;const g=Math.sqrt(p),b=h+g,x=h-g;Math.abs(b-i)<Math.abs(x-i)?(o.x=t,o.y=b):(o.x=t,o.y=x)}return!0}}qI(){return this.Qo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return null!==this.ut?this.ut:this.en}set geometry(e){const t=this.ut,i=this.en;if(t===e)return;null!==e?(this.ut=e.k(),this.en=this.ut):(this.ut=null,this.en=null);const s=this.part;if(null!==s&&s.Df(),this.c(),this.t("geometry",t||i,e),this.mf()){const n=this.part;null!==n&&this.Eh(n,"geometryString")}}get geometryString(){return null===this.geometry?"":this.geometry.toString()}set geometryString(e){const t=Ct.parse(e),i=t.normalize();this.geometry=t;const s=S.z(-i.x,-i.y);this.position=s,S.i(s)}get isGeometryPositioned(){return!!(1048576&this.n)}set isGeometryPositioned(e){const t=!!(1048576&this.n);t!==e&&(this.n=1048576^this.n,this.c(),this.t("isGeometryPositioned",t,e))}ai(){this.ut=null}get fill(){return this.Hh}set fill(e){const t=this.Hh;t!==e&&(null!==e&&V.Md(e,"Shape.fill"),e instanceof V&&e.k(),this.Hh=e,this.C(),this.t("fill",t,e))}get stroke(){return this.Qe}set stroke(e){const t=this.Qe;t!==e&&(null!==e&&V.Md(e,"Shape.stroke"),e instanceof V&&e.k(),this.Qe=e,this.C(),this.t("stroke",t,e))}get strokeWidth(){return this.Qo}set strokeWidth(e){const t=this.Qo;if(t!==e)if(e>=0){this.Qo=e,this.c();const i=this.part;null!==i&&i.Df(),this.t("strokeWidth",t,e)}else y.J(e,"value >= 0",rt,"strokeWidth:value")}jp(){return this.Qo}get strokeCap(){return null!==this.Kt?this.Kt.Y0:"butt"}set strokeCap(e){const t=this.strokeCap;t!==e&&("string"!=typeof e||"butt"!==e&&"round"!==e&&"square"!==e?y.J(e,'"butt", "round", or "square"',rt,"strokeCap"):(this.jh().Y0=e,this.C(),this.t("strokeCap",t,e)))}get strokeJoin(){return null!==this.Kt?this.Kt.K0:"miter"}set strokeJoin(e){const t=this.strokeJoin;t!==e&&("string"!=typeof e||"miter"!==e&&"bevel"!==e&&"round"!==e?y.J(e,'"miter", "bevel", or "round"',rt,"strokeJoin"):(this.jh().K0=e,this.C(),this.t("strokeJoin",t,e)))}get strokeMiterLimit(){return null!==this.Kt?this.Kt.H0:10}set strokeMiterLimit(e){const t=this.strokeMiterLimit;if(t!==e&&e>=1){this.jh().H0=e,this.C();const i=this.part;null!==i&&i.Df(),this.t("strokeMiterLimit",t,e)}}get strokeDashArray(){return this.Wo}set strokeDashArray(e){const t=this.Wo;if(t!==e){if(null!==e&&!Array.isArray(e)&&y.si(e,"Array",rt,"strokeDashArray:value"),null!==e){const i=e.length;let s=0;for(let n=0;n<i;n++){const o=e[n];(!(o>=0)||!isFinite(o))&&y.o("strokeDashArray:value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(0===s){if(null===t)return;e=null}}this.Wo=e,this.C(),this.t("strokeDashArray",t,e)}}get strokeDashOffset(){return null!==this.Kt?this.Kt.Ca:0}set strokeDashOffset(e){const t=this.strokeDashOffset;t!==e&&e>=0&&(this.jh().Ca=e,this.C(),this.t("strokeDashOffset",t,e))}get figure(){return this.zd}set figure(e){const t=this.zd;if(t!==e){let i=L.Jn[e];if(y.st(i)?i=e:(i=L.Jn[e.toLowerCase()],(!i||"function"==typeof i)&&y.o("Unknown Shape.figure: "+e)),t!==i){const s=this.part;null!==s&&s.Df(),this.zd=i,this.en=null,this.ai(),this.c(),this.t("figure",t,i)}}}get toArrow(){return null!==this.Ot?this.Ot.j0:"None"}set toArrow(e){const t=this.toArrow;if(!0===e?e="Standard":!1===e&&(e=""),t!==e){const i=rt.PD(e);null===i?y.o("Unknown Shape.toArrow: "+e):t!==i&&(null===this.Ot&&(this.Ot=new Ee),this.Ot.j0=i,this.en=null,this.ai(),this.c(),this.SD(i),this.t("toArrow",t,i))}}get fromArrow(){return null!==this.Ot?this.Ot.q0:"None"}set fromArrow(e){const t=this.fromArrow;if(!0===e?e="Standard":!1===e&&(e=""),t!==e){const i=rt.PD(e);null===i?y.o("Unknown Shape.fromArrow: "+e):t!==i&&(null===this.Ot&&(this.Ot=new Ee),this.Ot.q0=i,this.en=null,this.ai(),this.c(),this.SD(i),this.t("fromArrow",t,i))}}SD(e){const t=this.diagram;null!==t&&t.undoManager.isUndoingRedoing||(this.mI(),"None"!==this.toArrow?(this.segmentIndex=-1,this.alignmentFocus=A.Right):"None"!==this.fromArrow&&(this.segmentIndex=0,this.alignmentFocus=A.Left))}get spot1(){return null!==this.Kt?this.Kt.$n:A.Default}set spot1(e){const t=this.spot1;t.equals(e)||(e=e.N(),this.jh().$n=e,this.c(),this.t("spot1",t,e))}get spot2(){return null!==this.Kt?this.Kt.Zn:A.Default}set spot2(e){const t=this.spot2;t.equals(e)||(e=e.N(),this.jh().Zn=e,this.c(),this.t("spot2",t,e))}get parameter1(){return this.Xd}set parameter1(e){const t=this.Xd;t!==e&&(this.Xd=e,this.ai(),this.c(),this.t("parameter1",t,e))}get parameter2(){return this.Gd}set parameter2(e){const t=this.Gd;t!==e&&(this.Gd=e,this.ai(),this.c(),this.t("parameter2",t,e))}get naturalBounds(){return this.Ke}EI(){const e=this.desiredSize;e.isReal()||null===this.ut?this.Ke.e(0,0,e.width,e.height):this.Ke.h(this.ut.bounds)}get pathPattern(){return null!==this.Kt?this.Kt.W0:null}set pathPattern(e){const t=this.pathPattern;t!==e&&(this.jh().W0=e,this.C(),this.t("pathPattern",t,e))}get geometryStretch(){return null!==this.Kt?this.Kt.J0:1}set geometryStretch(e){const t=this.geometryStretch;t!==e&&(this.jh().J0=e,this.c(),this.t("geometryStretch",t,e))}get interval(){return null!==this.K?this.K.Ff:1}set interval(e){const t=this.interval;if(t!==(e=Math.round(e))&&0!==e&&isFinite(e)){null===this.K&&(this.K=new Pe),this.K.Ff=e;const i=this.diagram;null!==i&&this.panel===i.grid&&i.ca(),this.c();const s=this.panel;null!==s&&(s.ds=null),this.t("interval",t,e)}}get graduatedStart(){return null!==this.K?this.K.Rf:0}set graduatedStart(e){const t=this.graduatedStart;t!==e&&(e<0?e=0:e>1&&(e=1),null===this.K&&(this.K=new Pe),this.K.Rf=e,this.c(),this.t("graduatedStart",t,e))}get graduatedEnd(){return null!==this.K?this.K.Of:1}set graduatedEnd(e){const t=this.graduatedEnd;t!==e&&(e<0?e=0:e>1&&(e=1),null===this.K&&(this.K=new Pe),this.K.Of=e,this.c(),this.t("graduatedEnd",t,e))}get graduatedSkip(){return null!==this.K?this.K.If:null}set graduatedSkip(e){const t=this.graduatedSkip;t!==e&&(null!==e&&y.S(e,rt,"graduatedSkip"),null===this.K&&(this.K=new Pe),this.K.If=e,this.c(),this.t("graduatedSkip",t,e))}polygonContainsRect(e){const t=this;if(!t.part||!t.part.actualBounds.containsRect(e))return!1;const i=t.geometry;if(!i)return!1;const s=e.x,n=e.y,o=e.width,r=e.height,a=S.l();if(a.x=s,a.y=n,t.getLocalPoint(a,a),!i.containsPoint(a)||o>0&&r>0&&(a.x=s+o,a.y=n+r,t.getLocalPoint(a,a),!i.containsPoint(a))||o>0&&(a.x=s+o,a.y=n,t.getLocalPoint(a,a),!i.containsPoint(a))||r>0&&(a.x=s,a.y=n+r,t.getLocalPoint(a,a),!i.containsPoint(a))||1===i.type)return!1;if(4===i.type){const l=i.figures.iterator;for(;l.next();){const h=l.value;if(!h.isFilled)continue;a.x=h.startX,a.y=h.startY,t.getDocumentPoint(a,a);let c=a.x,u=a.y,d=c,f=u,p=c,g=u;const b=h.segments.iterator;for(;b.next();){const x=b.value;if(a.x=x.endX,a.y=x.endY,t.getDocumentPoint(a,a),p=a.x,g=a.y,1===x.type)c=p,u=g;else if(5!==x.type&&(j.intersectsLineSegment(s,n,o,r,d,f,p,g)||x.isClosed&&j.intersectsLineSegment(s,n,o,r,p,g,c,u)))return!1;d=p,f=g}}}return S.i(a),!0}static iE(e,t,i){let s=null;if("None"!==e.toArrow)s=rt.Dn[e.toArrow];else if("None"!==e.fromArrow)s=rt.Dn[e.fromArrow];else{let n=L.Jn[e.figure];"string"==typeof n&&(n=L.Jn[n]),void 0===n&&y.o("Unknown Shape.figure: "+e.figure),s=n(e,t,i),s.Sc=t,s.Mc=i}if(null===s){const n=L.Jn.Rectangle;y.st(n)&&(s=n(e,t,i))}return s}static getFigureGenerators(){const e=new xt;for(const t in L.Jn)t!==t.toLowerCase()&&e.set(t,L.Jn[t]);return e.k(),e}static defineFigureGenerator(e,t){y.s(e,"string",rt,"defineFigureGenerator:name"),"string"==typeof t||y.S(t,rt,"defineFigureGenerator:func");const i=e.toLowerCase(),s=L.Jn;s[e]=t,s[i]=e}static isFigureDefined(e){return e in L.Jn}static getArrowheadGeometries(){const e=new xt;for(const t in L.lm)if(void 0===rt.Dn[t]){const i=Ct.parse(L.lm[t],!1);rt.Dn[t]=i;const s=t.toLowerCase();s!==t&&(rt.Dn[s]=t)}for(const t in rt.Dn){if(t===t.toLowerCase())continue;const i=rt.Dn[t];i instanceof Ct&&e.set(t,i)}return e.k(),e}static defineArrowheadGeometry(e,t){y.s(e,"string",rt,"defineArrowheadGeometry:name");let i=null;"string"==typeof t?(y.s(t,"string",rt,"defineArrowheadGeometry:pathstr"),i=Ct.parse(t,!1)):i=t;const s=e.toLowerCase();("none"===s||e===s)&&y.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+e);const n=rt.Dn;n[e]=i,n[s]=e}static isArrowheadDefined(e){return rt.Dn.has(e)}static Dn=new R;static iC=new R;static PD(e){let t=rt.Dn[e];if(void 0===t){const i=e.toLowerCase();if("none"===i)return"None";if(t=rt.Dn[i],void 0===t){let s=null;for(const n in L.lm)if(n.toLowerCase()===i){s=n;break}if(null!==s){const n=Ct.parse(L.lm[s],!1);return rt.Dn[s]=n,i!==s&&(rt.Dn[i]=s),s}}}return"string"==typeof t?t:t instanceof Ct?e:null}}class ji{me;Y0;K0;H0;Ca;W0;J0;$n;Zn;constructor(){this.me=!1,this.Y0="butt",this.K0="miter",this.H0=10,this.Ca=0,this.W0=null,this.J0=1,this.$n=A.Default,this.Zn=A.Default}copy(){const e=new ji;return e.Y0=this.Y0,e.K0=this.K0,e.H0=this.H0,e.Ca=this.Ca,e.W0=this.W0,e.J0=this.J0,e.$n=this.$n.N(),e.Zn=this.Zn.N(),e}}var zi=(m=>(m[m.None=0]="None",m[m.Fit=1]="Fit",m[m.DesiredSize=2]="DesiredSize",m[m.BreakAll=3]="BreakAll",m))(zi||{}),js=(m=>(m[m.Clip=0]="Clip",m[m.Ellipsis=1]="Ellipsis",m))(js||{}),Xi=(m=>(m[m.Trim=0]="Trim",m[m.None=1]="None",m))(Xi||{});class mt extends st{ue;Qe;vn;Pi;pe;qp;Kd;K;tt;Xl;go;Fn;Ii;ye;Rn;constructor(e,t){return super(),!1===mt.M0&&(mt.M0=!0,mt.us=U.isUsingDOM()?new Oe(null)._t:null),this.n|=2097152,this.ue="",this.Qe="black",this.vn="13px sans-serif",this.Pi=0,this.pe=0,this.qp=0,this.Kd=null,this.K=null,this.tt=null,this.Xl=0,this.go=null,this.Fn=0,this.Ii=null,this.ye=null,this.Rn=null,"string"==typeof e?this.text=e:e&&Object.assign(this,e),t&&Object.assign(this,t),this}cloneProtected(e){super.cloneProtected(e),e.ue=this.ue,e.Qe=this.Qe,e.vn=this.vn,e.Pi=this.Pi,e.pe=this.pe,e.qp=this.qp,e.Kd=this.Kd,null!==this.K&&(e.K=this.K.copy()),null!==this.tt&&(e.tt=this.tt.me?this.tt:this.tt.copy()),e.Xl=this.Xl,e.go=this.go,e.Fn=this.Fn,e.Ii=this.Ii,e.ye=this.ye,e.Rn=this.Rn}Os(){return null===this.tt?this.tt=new Yi:this.tt.me&&(this.tt=this.tt.copy()),this.tt}ba(){super.ba(),null!==this.tt&&(this.tt.me=!0)}YI(e){this.n=6144|e.n,this.Zt=e.opacity,this.Lt=e.background,this.cs=e.desiredSize.N(),this.minSize=e.minSize.N(),this.maxSize=e.maxSize.N(),this.Se=null!==e.Se?e.Se.copy():null,this.it=e.scale,this.Xt=e.angle,this.stretch=e.stretch,this.sl=e.margin.N(),this.de=e.alignment.N(),this.wd=e.alignmentFocus.N(),this.segmentFraction=e.segmentFraction,this.segmentOffset=e.segmentOffset.N(),this.segmentOrientation=e.segmentOrientation,null!==e.he&&(this.he=e.he.copy()),this.shadowVisible=e.shadowVisible,this.ue=e.ue,this.Qe=e.Qe,this.vn=e.vn,null!==this.K&&(this.K=e.K.copy()),null!==e.tt&&(this.tt=e.tt.me?e.tt:e.tt.copy()),this.Xl=e.Xl}XI(e){if(this.ue=e.text||"",this.Xt=e.labelAngle||0,this.Pi=e.lineCount||0,this.rE(e.lines),e.naturalBounds&&(this.Ke=e.naturalBounds),e.actualBounds){const t=e.actualBounds;this.Ut(t.x,t.y,t.width,t.height)}}fe(e){e in zi?this.wrap=e:super.fe(e)}toString(){return this.ue.length>22?'TextBlock("'+this.ue.substring(0,20)+'"...)':'TextBlock("'+this.ue+'")'}static getEllipsis(){return mt.$0}static setEllipsis(e){mt.$0=e,mt.ek=new R,mt.sC=0}static getBaseline(){return mt.ik}static setBaseline(e){mt.ik=e}static ik=null;static getUnderline(){return mt.sk}static setUnderline(e){mt.sk=e}static sk=null;static None=0;static WrapFit=1;static WrapDesiredSize=2;static WrapBreakAll=3;static OverflowClip=0;static OverflowEllipsis=1;static FormatTrim=0;static FormatNone=1;c(){super.c(),this.$i(!0)}get font(){return this.vn}set font(e){const t=this.vn;t!==e&&(this.vn=e,this.go=null,this.c(),this.t("font",t,e))}static isValidFont(e){return!X.CSS||X.CSS.supports("font",e)}get text(){return this.ue}set text(e){const t=this.ue;t!==(e=null!=e?e.toString():"")&&(this.ue=e,this.c(),this.t("text",t,e))}get textAlign(){return null!==this.tt?this.tt.Z0:"start"}set textAlign(e){const t=this.textAlign;t!==e&&("start"===e||"end"===e||"left"===e||"right"===e||"center"===e)&&(this.Os().Z0=e,this.C(),this.t("textAlign",t,e))}get flip(){return null!==this.tt?this.tt.mo:0}set flip(e){const t=this.flip;t!==e&&(this.Os().mo=e,this.C(),this.t("flip",t,e))}get verticalAlignment(){return null!==this.tt?this.tt.hl:A.Top}set verticalAlignment(e){const t=this.verticalAlignment;t.equals(e)||(e=e.N(),this.Os().hl=e,this.Pf(),this.t("verticalAlignment",t,e))}get naturalBounds(){if(!this.Ke.isReal()){const e=lt.l();this.nC(this.ue,999999,e);let t=e.width;lt.i(e);let i=this.MD(t);const s=this.desiredSize;isNaN(s.width)||(t=s.width),isNaN(s.height)||(i=s.height),this.Ke.jn(t,i)}return this.Ke}get isMultiline(){return!!(2097152&this.n)}set isMultiline(e){const t=!!(2097152&this.n);t!==e&&(this.n=2097152^this.n,this.c(),this.t("isMultiline",t,e))}get isUnderline(){return!!(4194304&this.n)}set isUnderline(e){const t=!!(4194304&this.n);t!==e&&(this.n=4194304^this.n,this.$i(!0),this.C(),this.t("isUnderline",t,e))}get isStrikethrough(){return!!(8388608&this.n)}set isStrikethrough(e){const t=!!(8388608&this.n);t!==e&&(this.n=8388608^this.n,this.$i(!0),this.C(),this.t("isStrikethrough",t,e))}get wrap(){return null!==this.tt?this.tt.Q0:2}set wrap(e){const t=this.wrap;t!==e&&(this.Os().Q0=e,this.c(),this.t("wrap",t,e))}get overflow(){return null!==this.tt?this.tt._0:0}set overflow(e){const t=this.overflow;t!==e&&(this.Os()._0=e,this.c(),this.t("overflow",t,e))}get isOverflowed(){return!!(16777216&this.n)}oC(e){e?this.n|=16777216:this.n&=-16777217}get stroke(){return this.Qe}set stroke(e){const t=this.Qe;t!==e&&(null!==e&&V.Md(e,"TextBlock.stroke"),e instanceof V&&e.k(),this.Qe=e,"string"!=typeof e&&this.xf(),this.C(),this.t("stroke",t,e))}get lineCount(){return this.Pi}get lineHeight(){return this.ty()}get editable(){return!!(1048576&this.n)}set editable(e){const t=!!(1048576&this.n);t!==e&&(this.n=1048576^this.n,this.t("editable",t,e))}get jN(){return!!(33554432&this.n)}set jN(e){this.n=33554432^this.n}get textEditor(){return null!==this.tt?this.tt.ey:null}set textEditor(e){const t=this.textEditor;t!==e&&(this.Os().ey=e,this.t("textEditor",t,e))}get errorFunction(){return null!==this.tt?this.tt.gs:null}set errorFunction(e){const t=this.errorFunction;t!==e&&(null!==e&&y.S(e,mt,"errorFunction"),this.Os().gs=e,this.t("errorFunction",t,e))}get interval(){return null!==this.K?this.K.Ff:1}set interval(e){const t=this.interval;if(t!==(e=Math.round(e))&&0!==e&&isFinite(e)){null===this.K&&(this.K=new Pe),this.K.Ff=e,this.c();const i=this.panel;null!==i&&(i.ds=null),this.t("interval",t,e)}}get graduatedStart(){return null!==this.K?this.K.Rf:0}set graduatedStart(e){const t=this.graduatedStart;t!==e&&(e<0?e=0:e>1&&(e=1),null===this.K&&(this.K=new Pe),this.K.Rf=e,this.c(),this.t("graduatedStart",t,e))}get graduatedEnd(){return null!==this.K?this.K.Of:1}set graduatedEnd(e){const t=this.graduatedEnd;t!==e&&(e<0?e=0:e>1&&(e=1),null===this.K&&(this.K=new Pe),this.K.Of=e,this.c(),this.t("graduatedEnd",t,e))}get graduatedFunction(){return null!==this.K?this.K.iy:null}set graduatedFunction(e){const t=this.graduatedFunction;t!==e&&(null!==e&&y.S(e,mt,"graduatedFunction"),null===this.K&&(this.K=new Pe),this.K.iy=e,this.c(),this.t("graduatedFunction",t,e))}get graduatedSkip(){return null!==this.K?this.K.If:null}set graduatedSkip(e){const t=this.graduatedSkip;t!==e&&(null!==e&&y.S(e,mt,"graduatedSkip"),null===this.K&&(this.K=new Pe),this.K.If=e,this.c(),this.t("graduatedSkip",t,e))}Ma(e,t){if(null===this.Qe||0===this.ue.length||null===this.vn)return;const i=this.naturalBounds,s=this.actualBounds,n=i.width,o=i.height,r=this.ty();let a=e.textAlign=this.textAlign;const l=t.ld;"start"===a?a=l?"right":"left":"end"===a&&(a=l?"left":"right");const h=this.isUnderline,c=this.isStrikethrough;this.kn(e,this.Qe,!0,!1,i,s),(h||c)&&this.kn(e,this.Qe,!1,!1,i,s);let d=0;const f=n;let p=!1;t.Wt===e&&!(t.Wt instanceof he)&&!this.jN&&!0===t.getRenderingHint("textGreeking")&&r*this.Th*t.scale<3&&(p=!0);const g=this.spacingAbove,b=this.spacingBelow;switch(this.flip){case 0:break;case 2:e.translate(n,0),e.scale(-1,1);break;case 1:e.translate(0,o),e.scale(1,-1);break;case 3:e.translate(n,o),e.scale(-1,-1)}e.commitTransform();const x=this.Pi,v=(g+r+b)*x;if(o>v){const P=this.verticalAlignment;d=P.y*o-P.y*v+P.offsetY}if(mt.nk&&(e.letterSpacing=this.letterSpacing,e.wordSpacing=this.wordSpacing),1===x&&null!==this.Rn){let P=this.pe;P>f&&(P=f),d+=g,this.ND(this.Rn,e,0,d,f,r,P,p,a,h,c)}else if(null!==this.Ii&&null!==this.ye)for(let P=0;P<x;P++){let w=this.Ii[P];w>f&&(w=f),d+=g,this.ND(this.ye[P],e,0,d,f,r,w,p,a,h,c),d+=r+b}switch(this.flip){case 0:break;case 2:e.scale(-1,1),e.translate(-n,0);break;case 1:e.scale(1,-1),e.translate(0,-o);break;case 3:e.scale(-1,-1),e.translate(-n,-o)}}ND(e,t,i,s,n,o,r,a,l,h,c){let u=0;if(a){"left"===l?u=0:"right"===l?u=n-r:"center"===l&&(u=(n-r)/2);const p=t.globalAlpha;return t.globalAlpha=p/2,t.fillRect(i+u,s+o/4,r,o/2),void(t.globalAlpha=p)}"left"===l?u=0:"right"===l?u=n:"center"===l&&(u=n/2);const d=null!==mt.ik?mt.ik(this,o):.75*o;t.fillText(e,i+u,s+d);let f=o/20|0;if(0===f&&(f=1),"right"===l?u-=r:"center"===l&&(u-=r/2),h){const p=null!==mt.sk?mt.sk(this,o):.8*o;this.CD(i+u,s+p,i+u+r,s+p,f,t),t instanceof he&&t.lastCreatedElement.classList.add("gojs-td")}if(c){let p=s+o-o/2.2|0;f%2!=0&&(p+=.5),this.CD(i+u,p,i+u+r,p,f,t),t instanceof he&&t.lastCreatedElement.classList.add("gojs-td")}}CD(e,t,i,s,n,o){o.beginPath(),o.lineWidth=n,o.moveTo(e,t),o.lineTo(i,s),o.stroke(),o.endPath()}wf(e,t,i){if(!super.wf(e,t,i))return!1;if(this.kn(e,this.Qe,!0,!1,this.naturalBounds,this.actualBounds),i){if(0===this.svg.getElementsByTagName("text").length)return!0;const s=this.svg.getElementsByClassName("gojs-td");for(let n=0;n<s.length;n++)e.setFillOrStrokeInPlace(s[n],!1)}else this.lE(this.svg,this.ye?this.ye[0]:this.text,e);return!0}lE(e,t,i){e.innerHTML=t,i.setFillOrStrokeInPlace(e,!0)}Pd(e){return!!(this.lineCount>1||this.isUnderline||this.isStrikethrough)||super.Pd(e)}LN(e,t){if("g"!==e.nodeName)e.setAttributeNS(null,"filter",t);else{const i=e.getElementsByTagName("text");for(let s=0;s<i.length;s++)i[s].setAttributeNS(null,"filter",t)}}aE(){this.Fn=0,this.pe=0,this.go=null,this.Ii=null,this.ye=null,this.Rn=null}bd(e,t,i,s){const n=this.Pi;this.Xl=e,this.oC(!1);const o=this.vn;null!==mt.us&&(mt.LD!==o&&(mt.us.font=o,mt.LD=o),mt.nk&&(mt.us.letterSpacing=this.letterSpacing,mt.us.wordSpacing=this.wordSpacing)),this.aE();let r=0,a=0;isNaN(this.desiredSize.width)?(r=this.hE(),r=Math.min(r,e/this.scale)):r=this.desiredSize.width,null!==this.panel&&(r=Math.min(r,this.panel.maxSize.width)),a=this.MD(r),a=isNaN(this.desiredSize.height)?Math.min(a,t/this.scale):this.desiredSize.height,this.cE(e,a),(1===this.wrap||isNaN(this.desiredSize.width))&&(r=isNaN(e)?this.pe:Math.min(e,this.pe)),r=Math.max(i,r),a=Math.max(s,a),this.Ke.jn(r,a),this.lo(0,0,r,a),null!==this.svg&&n!==this.Pi&&this.$i(!0)}Pa(e,t,i,s){this.commonArrange(e,t,i,s)}On(e,t){null===this.Rn?(this.Rn=e,this.pe=t):((null===this.ye||null===this.Ii)&&(this.ye=[],this.Ii=[],this.ye.push(this.Rn),this.Ii.push(this.pe)),this.ye.push(e),this.Ii.push(t),this.ye.length>this.maxLines&&(this.n|=16777216))}nC(e,t,i){const s=0===this.formatting;s&&(e=e.trim());let n=0,o=0,r=0;const a=this.vn,l=this.spacingAbove+this.spacingBelow,h=Math.max(0,this.ty()+l),c=1===this.overflow?this.AD(a):0;if(this.Pi>=this.maxLines)return void(void 0!==i&&i.e(0,h));let u=e;if(0===this.wrap){if(this.Fn=1,o=this.getStringWidth(e),0===c||o<=t)return this.pe=Math.max(this.pe,o),this.On(e,this.pe),void(void 0!==i&&i.e(o,h));let f=this.Hd(u);u=u.substring(f.length);let p=this.Hd(u);for(o=this.getStringWidth(f+p),r=0;p.length>0&&o<=t;){f+=p,u=u.substring(p.length),p=this.Hd(u),r=o;let g=f+p;s&&(g=g.trim()),o=this.getStringWidth(g)}for(s&&(p=p.trim()),f+=p,t=Math.max(1,t-c);this.getStringWidth(f)>t&&f.length>1;)f=f.substring(0,f.length-1);return this.oC(!0),f+=mt.$0,r=this.getStringWidth(f),this.pe=r,this.On(f,r),void(void 0!==i&&i.e(r,h))}let d=0;for(0===u.length&&(d=1,this.On(u,0));u.length>0;){let f=this.Hd(u);for(u=u.substring(f.length);this.getStringWidth(f)>t;){let b=1;for(o=this.getStringWidth(f.substring(0,b)),r=0;o<=t;)b++,r=o,o=this.getStringWidth(f.substring(0,b));let x=0;1===b?(x=o,n=Math.max(n,o)):(x=r,n=Math.max(n,r)),b--,b<1&&(b=1);const v=f.substring(0,b);if(this.On(v,x),d++,f=f.substring(b),this.Pi+d>this.maxLines)break}let p=this.Hd(u);for(o=this.getStringWidth(f+p),r=0;p.length>0&&o<=t;){f+=p,u=u.substring(p.length),p=this.Hd(u),r=o;let b=f+p;s&&(b=b.trim()),o=this.getStringWidth(b)}if(s&&(f=f.trim()),""===f)continue;"\xad"===f[f.length-1]&&(f=f.substring(0,f.length-1)+"\u2010");let g=0;if(0===p.length?(g=o,n=Math.max(n,o)):(r=this.getStringWidth(f),g=r,n=Math.max(n,r)),this.On(f,g),d++,this.Pi+d>this.maxLines)break}this.Fn=Math.min(this.maxLines-this.Pi,d),this.pe=Math.max(this.pe,n),void 0!==i&&i.e(this.pe,h*this.Fn)}cE(e,t){if(0===this.pe||null===this.Ii||null===this.ye||1!==this.overflow)return;const s=1===this.overflow?this.AD(this.vn):0,n=this.spacingAbove+this.spacingBelow,o=Math.max(0,this.ty()+n),r=Math.min(this.maxLines-1,Math.max(Math.floor(t/o+.01)-1,0));if(r+1>=this.ye.length)return;this.oC(!0);let a=this.ye[r];const l=Math.max(1,e-s);for(;this.getStringWidth(a)>l&&a.length>1;)a=a.substring(0,a.length-1);a+=mt.$0;const h=this.getStringWidth(a);this.ye[r]=a,this.ye=this.ye.slice(0,r+1),this.Ii[r]=h,this.Ii=this.Ii.slice(0,r+1),this.Fn=this.ye.length,this.pe=Math.max(this.pe,h),this.Pi=this.Fn,1===this.Pi&&(this.Rn=this.ye[0])}Hd(e){if(3===this.wrap)return e.substring(0,1);let t=e.length,i=0;const s=mt.fE;for(;i<t&&!s.test(e.charAt(i));)i++;for(1===this.formatting&&(t=Math.min(t,i+1));i<t&&s.test(e.charAt(i));)i++;return i>=e.length?e:e.substring(0,i)}getStringWidth(e){return null===mt.us?8*e.length:mt.us.measureText(e).width}ty(){if(null!==this.go)return this.go;const e=this.vn;let t=0;if(null===mt.us)return t=16,this.go=t,t;if(void 0!==mt.rC[e]&&mt.TD<5e3)t=mt.rC[e];else{mt.us.letterSpacing="0px";const i=mt.us.measureText("M");mt.us.letterSpacing=this.letterSpacing,t=1.3*i.width,mt.rC[e]=t,mt.TD++}return this.go=t,t}AD(e){if(null===mt.us)return 6;let t=0;return void 0!==mt.ek[e]&&mt.sC<5e3?t=mt.ek[e]:(t=mt.us.measureText(mt.$0).width,mt.ek[e]=t,mt.sC++),t}ok(e,t){return e.indexOf("\n",t)}MD(e){let t=this.ue.replace(/\r\n/g,"\n").replace(/\r/g,"\n");const i=this.spacingAbove+this.spacingBelow,s=Math.max(0,this.ty()+i);if(0===t.length)return this.pe=0,this.Pi=1,s;if(!this.isMultiline){const l=this.ok(t,0);l>=0&&(t=t.substring(0,l))}let n=0;this.Pi=0;let o=0,r=-1,a=!1;for(;!a;){if(r=this.ok(t,o),-1===r&&(r=t.length,a=!0),o<=r){const l=t.substring(o,r);if(0!==this.wrap){this.Fn=0;const h=lt.l();this.nC(l,e,h),n+=h.height,lt.i(h),this.Pi+=this.Fn}else this.nC(l,e),n+=s,this.Pi++;this.Pi===this.maxLines&&(a=!0)}o=r+1}return this.qp=n,n}hE(){let e=this.ue.replace(/\r\n/g,"\n").replace(/\r/g,"\n");if(0===e.length)return 8;if(this.isMultiline){let t=0,i=0,s=!1;for(;!s;){let n=this.ok(e,i);-1===n&&(n=e.length,s=!0);let o=e.substring(i,n);0===this.formatting&&(o=o.trim()),t=Math.max(t,this.getStringWidth(o)),i=n+1}return t}{const t=this.ok(e,0);return t>=0&&(e=e.substring(0,t)),this.getStringWidth(e)}}get textValidation(){return null!==this.tt?this.tt.zl:null}set textValidation(e){const t=this.textValidation;t!==e&&(null!==e&&y.S(e,mt,"textValidation"),this.Os().zl=e,this.t("textValidation",t,e))}get textEdited(){return null!==this.tt?this.tt.ny:null}set textEdited(e){const t=this.textEdited;t!==e&&(null!==e&&y.S(e,mt,"textEdited"),this.Os().ny=e,this.t("textEdited",t,e))}get spacingAbove(){return null!==this.tt?this.tt.ly:0}set spacingAbove(e){const t=this.spacingAbove;t!==e&&(this.Os().ly=e,this.c(),this.t("spacingAbove",t,e))}get spacingBelow(){return null!==this.tt?this.tt.hy:0}set spacingBelow(e){const t=this.spacingBelow;t!==e&&(this.Os().hy=e,this.c(),this.t("spacingBelow",t,e))}get letterSpacing(){return null!==this.tt?this.tt.cy:"0px"}set letterSpacing(e){const t=this.letterSpacing;t!==e&&(mt.nk=!0,this.Os().cy=e,this.c(),this.t("letterSpacing",t,e))}get wordSpacing(){return null!==this.tt?this.tt.fy:"0px"}set wordSpacing(e){const t=this.wordSpacing;t!==e&&(mt.nk=!0,this.Os().fy=e,this.c(),this.t("wordSpacing",t,e))}get formatting(){return null!==this.tt?this.tt.uy:0}set formatting(e){const t=this.formatting;t!==e&&(this.Os().uy=e,this.c(),this.t("formatting",t,e))}get maxLines(){return null!==this.tt?this.tt.gy:1/0}set maxLines(e){const t=this.maxLines;t!==e&&((e=Math.floor(e))<=0&&y.J(e,"> 0",mt,"maxLines"),this.Os().gy=e,this.c(),this.t("maxLines",t,e))}getMetrics(){return[this.pe,this.Xl,this.go,this.Fn,this.Ii,this.ye,this.Rn||""]}rE(e){void 0!==e&&(this.pe=e[0],this.Xl=e[1],this.go=e[2],this.Fn=e[3],this.Ii=e[4],this.ye=e[5],this.Rn=e[6])}get metrics(){return{arrSize:null!==this.Ii?this.Ii:[this.pe],arrText:null!==this.ye?this.ye:[this.Rn],maxLineWidth:this.pe,fontHeight:this.go}}get choices(){return this.Kd}set choices(e){const t=this.Kd;t!==e&&(this.Kd=e,this.t("choices",t,e))}static fE=new RegExp("[ \u200b\xad]");static rC=new R;static TD=0;static ek=new R;static sC=0;static $0="...";static LD="";static us=null;static M0=!1;static nk=!1}class Yi{me;gs;mo;uy;gy;_0;ly;hy;Z0;ny;ey;zl;hl;Q0;cy;fy;constructor(){this.me=!1,this.gs=null,this.mo=0,this.uy=0,this.gy=1/0,this._0=0,this.ly=0,this.hy=0,this.Z0="start",this.ny=null,this.ey=null,this.zl=null,this.hl=A.Top,this.Q0=2,this.cy="0px",this.fy="0px"}copy(){const e=new Yi;return e.gs=this.gs,e.mo=this.mo,e.uy=this.uy,e.gy=this.gy,e._0=this._0,e.ly=this.ly,e.hy=this.hy,e.Z0=this.Z0,e.ny=this.ny,e.ey=this.ey,e.zl=this.zl,e.hl=this.hl,e.Q0=this.Q0,e.cy=this.cy,e.fy=this.fy,e}}class Pe{Ff;Rf;Of;iy;If;constructor(){this.Ff=1,this.Rf=0,this.Of=1,this.iy=null,this.If=null}copy(){const e=new Pe;return e.Ff=this.Ff,e.Rf=this.Rf,e.Of=this.Of,e.iy=this.iy,e.If=this.If,e}}var Gi=(m=>(m[m.None=0]="None",m[m.Fill=2]="Fill",m[m.Uniform=6]="Uniform",m[m.UniformToFill=7]="UniformToFill",m))(Gi||{});class Kt extends st{cl;sn;fl;Ef;gs;ul;Uf;mo;Vf;Bf;U1;constructor(e,t){super(),this.n|=2097152,this.cl=null,this.sn="",this.fl=j.GF,this.Ef=2,this.gs=null,this.ul=null,this.Uf=A.Center,this.mo=0,this.Vf=null,this.Bf=null,this.U1=null,"string"==typeof e?this.source=e:e&&Object.assign(this,e),t&&Object.assign(this,t)}cloneProtected(e){super.cloneProtected(e),e.sn=this.sn,e.element=this.cl,e.fl=this.fl.N(),e.Ef=this.Ef,e.mo=this.mo,e.gs=this.gs,e.ul=this.ul,e.Uf=this.Uf.N(),e.Bf=this.Bf}fe(e){e in Gi?this.imageStretch=e:super.fe(e)}toString(){return"Picture("+this.source+")#"+z.xs(this)}get zf(){return!!(1048576&this.n)}set zf(e){this.zf!==e&&(this.n=1048576^this.n)}get my(){return!!(2097152&this.n)}set my(e){this.my!==e&&(this.n=2097152^this.n)}get Mn(){return!!(4194304&this.n)}set Mn(e){this.Mn!==e&&(this.n=4194304^this.n)}static clearCache(e){void 0===e&&(e=""),y.s(e,"string",Kt,"clearCache:url"),""!==e?Kt.yy[e]&&(delete Kt.yy[e],Kt.rk--):(Kt.yy=new R,Kt.rk=0)}static ST(e,t){t.DD||(t.lk=i=>{Kt.uE(t,i),e.desiredSize.isReal()||(e.xi(!1),e.c())},t.ak=i=>Kt.dE(t,i),t.addEventListener("load",t.lk),t.addEventListener("error",t.ak),t.DD=!0)}static DO(e){e.lk&&e.removeEventListener("load",e.lk),e.ak&&e.removeEventListener("error",e.ak),delete e.lk,delete e.ak,e.DD=!1}get element(){return this.cl}set element(e){const t=this.cl;if(this.$i(!0),t!==e){let s=!1;U.isUsingDOM()&&(this.zf=e instanceof HTMLCanvasElement,s=e instanceof HTMLImageElement,null!==e&&!(s||e instanceof HTMLVideoElement||this.zf)&&y.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+e));const n=this.diagram;null!==n&&n.R2(this),this.cl=e,null!==e&&s&&void 0===e.hs&&(e.hs=new z),null!==n&&s&&n.F2(this),this.t("element",t,e),this.C()}}AO(){const e=this.cl;if(null===e)return;const t=this.desiredSize.isReal();(this.zf||!0===e.complete)&&(e.Dp&&(e.wy instanceof Event&&null!==this.gs?this.gs(this,e.wy):!0===e.Mn&&!e.wy&&null!==this.ul&&e.lC&&this.ul(this,e.lC)),e.Mn=!0),e.Mn&&t&&null!==this.diagram&&this.diagram.rd.add(this)}gE(){if(null===this.cl)return void(this.Vf=!1);const e=new Oe(null)._t;try{e.drawImage(this.cl,0,0)}catch{this.my=!1}try{e.getImageData(0,0,1,1).data[3]&&(this.Vf=!1),this.Vf=!1}catch{this.Vf=!0}}get source(){return this.sn}set source(e){const t=this.sn;if(t!==e){this.$i(!0),y.s(e,"string",Kt,"source"),this.sn=e;let i=Kt.yy,s=null;if(void 0!==i[e])s=i[e];else if(""!==e){Kt.rk>30&&(Kt.clearCache(),i=Kt.yy),s=y.Ni("img"),s.Dp=!0,Kt.ST(this,s);const n=this.Bf;null!==n&&(s.crossOrigin=n(this)),s.src=e,i[e]=s,Kt.rk++}this.element=s,null!==s&&void 0===s.__goCache&&(s.__goCache=new po),this.c(),this.C(),this.t("source",t,e)}}static uE(e,t){let i;e.Mn=!0,e.wy=!1;const s=e.hs.copy();if(null==s)return;const n=s.iterator;for(;n.next();){const o=n.value;o.C();const r=e.getAttribute("src")||"",a=o.oa.get(r);if(null===a)continue;const l=a.length;for(let h=0;h<l;h++)i=a[h],i.desiredSize.isReal()||o.rd.add(i),i.$i(!0),o.requestUpdate(),e.Dp&&(void 0===e.lC&&(e.lC=t),null!==i.ul&&i.ul(i,t))}e.hs.clear()}static dE(e,t){let i;e.wy=t;const s=e.hs.copy();if(null==s)return;const n=s.iterator;for(;n.next();){const o=n.value,r=e.getAttribute("src")||"",a=o.oa.get(r);if(null===a)continue;const l=a.length,h=y.nt();for(let c=0;c<l;c++)h.push(a[c]);if(e.Dp)for(let c=0;c<l;c++)i=h[c],null!==i.gs&&i.gs(i,t);y.Z(h)}e.hs.clear()}reloadSource(){if(""===this.source)return;Kt.clearCache(this.source);const e=this.source;this.source="",this.source=e}redraw(){this.C(),this.$i(!0)}get sourceCrossOrigin(){return this.Bf}set sourceCrossOrigin(e){if(this.Bf!==e){null!==e&&y.S(e,Kt,"sourceCrossOrigin"),this.Bf=e;const t=this.element;if(null!==t){const i=t.getAttribute("src");void 0!==t.crossOrigin&&(null===e&&"string"==typeof i?t.crossOrigin=null:null!==e&&(t.crossOrigin=e(this)),i&&(t.src=i))}}}get sourceRect(){return this.fl}set sourceRect(e){const t=this.fl;t.equals(e)||(e=e.N(),this.fl=e,this.C(),this.t("sourceRect",t,e))}get imageStretch(){return this.Ef}set imageStretch(e){const t=this.Ef;t!==e&&(this.Ef=e,this.C(),this.t("imageStretch",t,e))}get flip(){return this.mo}set flip(e){const t=this.mo;t!==e&&(this.mo=e,this.C(),this.t("flip",t,e))}get imageAlignment(){return this.Uf}set imageAlignment(e){const t=this.Uf;t.equals(e)||(e=e.N(),this.Uf=e,this.C(),this.t("imageAlignment",t,e))}get errorFunction(){return this.gs}set errorFunction(e){const t=this.gs;t!==e&&(null!==e&&y.S(e,Kt,"errorFunction"),this.gs=e,this.t("errorFunction",t,e))}get successFunction(){return this.ul}set successFunction(e){const t=this.ul;t!==e&&(null!==e&&y.S(e,Kt,"successFunction"),this.ul=e,this.t("successFunction",t,e))}Ma(e,t){const i=this.cl;if(null===i)return;const s=i.getAttribute("src"),n=U.isUsingDOM();if(n&&i instanceof HTMLImageElement&&(null===s||""===s)||i.wy instanceof Event&&e instanceof gi)return;const o=e instanceof he,r=this.naturalBounds;let a=0,l=0;const h=this.zf;let c=h?+i.width:i.naturalWidth,u=h?+i.height:i.naturalHeight;if(void 0===c&&i.videoWidth&&(c=i.videoWidth),void 0===u&&i.videoHeight&&(u=i.videoHeight),n){if(0===c||0===u)return}else c=this.width,u=this.height;const d=c,f=u;this.sourceRect.isReal()&&(a=this.fl.x,l=this.fl.y,c=this.fl.width,u=this.fl.height);let p=c,g=u;const b=this.Ef,x=this.Uf;switch(b){case 0:if(this.sourceRect.isReal())break;p>=r.width&&(a=a+x.offsetX+(p*x.x-r.width*x.x)),g>=r.height&&(l=l+x.offsetY+(g*x.y-r.height*x.y)),c=Math.min(r.width,p),u=Math.min(r.height,g);break;case 2:p=r.width,g=r.height;break;case 6:case 7:let B=0;6===b?(B=Math.min(r.height/g,r.width/p),p*=B,g*=B):7===b&&(B=Math.max(r.height/g,r.width/p),p*=B,g*=B,p>=r.width&&(a=(a+x.offsetX+(p*x.x-r.width*x.x)/p)*c),g>=r.height&&(l=(l+x.offsetY+(g*x.y-r.height*x.y)/g)*u),c*=1/(p/r.width),u*=1/(g/r.height),p=r.width,g=r.height)}const v=c*u,P=this.getDocumentScale()*t.scale,C=p*P*(g*P),N=v/C,I=i.__goCache;let T=null;const D=Kt.mE;if(!o){if(i.Mn&&void 0!==I&&d<8e3&&f<8e3&&C>4&&N>D*D){null===I.Vt&&(I.vD(4,d,f,i),I.vD(16,d,f,i));const B=I.Vt,Y=B.length;for(let W=0;W<Y&&B[W].jd*B[W].jd<N;W++)T=B[W]}if(!t.od&&(null===this.Vf&&this.gE(),this.Vf))return}const F=p<r.width?x.offsetX+(r.width*x.x-p*x.x):0,E=g<r.height?x.offsetY+(r.height*x.y-g*x.y):0;switch(this.flip){case 0:break;case 2:e.translate(Math.min(r.width,p),0),e.scale(-1,1);break;case 1:e.translate(0,Math.min(r.height,g)),e.scale(1,-1);break;case 3:e.translate(Math.min(r.width,p),Math.min(r.height,g)),e.scale(-1,-1)}if(e.commitTransform(),t.getRenderingHint("pictureRatioOptimization")&&!t.ph&&void 0!==I&&null!==T&&1!==T.jd){e.save();const B=T.jd;try{e.drawImage(T.sn,a/B,l/B,Math.min(T.sn.width,c/B),Math.min(T.sn.height,u/B),F,E,Math.min(r.width,p),Math.min(r.height,g)),e instanceof he&&(this.U1=[a/B,l/B,Math.min(T.sn.width,c/B),Math.min(T.sn.height,u/B),F,E,Math.min(r.width,p),Math.min(r.height,g)])}catch{this.my=!1}e.restore()}else try{e.drawImage(i,a,l,c,u,F,E,Math.min(r.width,p),Math.min(r.height,g)),e instanceof he&&(this.U1=[a,l,c,u,F,E,Math.min(r.width,p),Math.min(r.height,g)])}catch{this.my=!1}switch(this.flip){case 0:break;case 2:e.scale(-1,1),e.translate(-Math.min(r.width,p),0);break;case 1:e.scale(1,-1),e.translate(0,-Math.min(r.height,g));break;case 3:e.scale(-1,-1),e.translate(-Math.min(r.width,p),-Math.min(r.height,g))}}get naturalBounds(){return this.Ke}bd(e,t,i,s){const n=this.desiredSize,o=this.Qs(!0),r=this.cl,a=this.zf;let l=0,h=0;(a||!this.Mn&&r&&r.complete)&&(this.Mn=!0),null===r?(isFinite(n.width)||(e=i),isFinite(n.height)||(t=s)):(l=a?+r.width:r.naturalWidth,h=a?+r.height:r.naturalHeight),isFinite(n.width)||2===o||5===o?(isFinite(e)||(this.sourceRect.isReal()?e=this.sourceRect.width:null!==r&&(e=l)),i=0):null!==r&&!1!==this.Mn&&(e=this.sourceRect.isReal()?this.sourceRect.width:l),isFinite(n.height)||2===o||4===o?(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.height:null!==r&&(t=h)),s=0):null!==r&&!1!==this.Mn&&(t=this.sourceRect.isReal()?this.sourceRect.height:h),isFinite(n.width)&&(e=n.width),isFinite(n.height)&&(t=n.height);const c=this.maxSize,u=this.minSize;i=Math.max(i||0,u.width),s=Math.max(s||0,u.height),e=Math.min(c.width,e),t=Math.min(c.height,t),e=Math.max(i,e),t=Math.max(s,t),null!==r&&!r.complete&&(isFinite(e)||(e=0),isFinite(t)||(t=0)),this.Ke.jn(e,t),this.lo(0,0,e,t)}Pa(e,t,i,s){this.commonArrange(e,t,i,s)}static yy=new R;static rk=0;static mE=4}class po{Vt;constructor(){this.Vt=null}vD(e,t,i,s){null===this.Vt&&(this.Vt=[]);const n=new Oe(null),o=n._t,r=1/e;if(n.width=t/e,n.height=i/e,0===n.width||0===n.height)return;const a=new mo(n.bt,e);let l=s,h=1;if(this.Vt.length>0){const c=this.Vt[this.Vt.length-1];l=c.sn,h=c.jd}o.setTransform(r*h,0,0,r*h,0,0),o.commitTransform(),o.drawImage(l,0,0),this.Vt.push(a)}}class mo{sn;jd;constructor(e,t){this.sn=e,this.jd=t}}let Ni=(()=>{class m{Ne;um;constructor(){this.um=new Ct,this.Ne=null}Ue(t){null!==t?(this.um=t,t.figures.clear()):this.um=new Ct,this.Ne=null}Au(t,i,s,n,o,r){if(void 0!==n&&!0===n){const a=new St(1);a.endX=t,a.endY=i,this.Ne.segments.add(a)}else this.Ne=new Ht,this.Ne.startX=t,this.Ne.startY=i,this.Ne.isFilled=s,this.Ne.isEvenOdd=r||!1,this.um.figures.add(this.Ne);void 0!==o&&(this.Ne.isShadowed=o)}_F(){const t=this.Ne.segments.length;t>0&&this.Ne.segments.elt(t-1).close()}tR(){this.Ne.segments.length>0&&(this.Ne.isFilled=!0)}eR(t){this.Ne.isShadowed=t}zU(t){this.Ne.isEvenOdd=t}$F(t,i,s){void 0===s&&(s=!1);const n=new St(1);n.endX=t,n.endY=i,s&&n.close(),this.Ne.segments.add(n)}Ks(t,i,s){void 0===s&&(s=!1);const n=new St(2);n.endX=t,n.endY=i,s&&n.close(),this.Ne.segments.add(n)}xr(t,i,s,n,o,r,a){void 0===a&&(a=!1);const l=new St(3);l.point1X=t,l.point1Y=i,l.point2X=s,l.point2Y=n,l.endX=o,l.endY=r,a&&l.close(),this.Ne.segments.add(l)}Tu(t,i,s,n,o){void 0===o&&(o=!1);const r=new St(4);r.point1X=t,r.point1Y=i,r.endX=s,r.endY=n,o&&r.close(),this.Ne.segments.add(r)}ZF(t,i,s,n,o,r,a){void 0===r&&(r=0),void 0===a&&(a=!1);const l=new St(5);l.startAngle=t,l.sweepAngle=i,l.centerX=s,l.centerY=n,l.radiusX=o,l.radiusY=0!==r?r:o,a&&l.close(),this.Ne.segments.add(l)}QF(t,i,s,n,o,r,a,l){void 0===l&&(l=!1);const h=new St(6,r,a,t,i,s,n,o);l&&h.close(),this.Ne.segments.add(h)}static aC=null;static qL(t){const i=m.aC;if(null!==i)return m.aC=null,i.Ue(t),i;{const s=new m;return s.Ue(t),s}}static WL(t){m.aC=t}}return m})();{const m=function(n,o){const r=n.toLowerCase(),a=L.Jn;a[n]=o,a[r]=n};m("Rectangle",(n,o,r)=>{const a="r"+o+","+r;let l=L.yr[a];return void 0!==l||(l=new Ct(2),l.endX=o,l.endY=r,L.wr<L.am&&(L.yr[a]=l,L.wr++)),l}),m("Square",(n,o,r)=>{const a="s"+o+","+r;let l=L.yr[a];return void 0!==l||(l=new Ct(2),l.endX=o,l.endY=r,l.defaultStretch=6,L.wr<L.am&&(L.yr[a]=l,L.wr++)),l});const e=(n,o,r,a,l)=>{(isNaN(a)||a<0)&&(a=5),isNaN(l)&&(l=15);const h="rr"+o+","+r+","+a+","+l;let c=L.yr[h];if(void 0!==c)return c;let u=a;1&~l?u=0:(u=Math.min(u,2&~l?o:o/3),u=Math.min(u,8&~l?r:r/3));const d=new Ht(u,0,!0);c=(new Ct).add(d);const f=A.TopLeft.copy(),p=A.BottomRight.copy();if(2&~l)d.add(new St(2,o,0));else{let g=a;g=Math.min(g,1&~l?o:o/3),g=Math.min(g,4&~l?r:r/3);const b=g*L.qn;d.add(new St(2,o-g,0)).add(new St(3,o,g,o-b,0,o,b)),f.offsetY=b,p.offsetX=-b}if(4&~l)d.add(new St(2,o,r));else{let g=a;g=Math.min(g,8&~l?o:o/3),g=Math.min(g,2&~l?r:r/3);const b=g*L.qn;d.add(new St(2,o,r-g)).add(new St(3,o-g,r,o,r-b,o-b,r)),p.offsetX=-b,p.offsetY=-b}if(8&~l)d.add(new St(2,0,r));else{let g=a;g=Math.min(g,4&~l?o:o/3),g=Math.min(g,1&~l?r:r/3);const b=g*L.qn;d.add(new St(2,g,r)).add(new St(3,0,r-g,b,r,0,r-b)),f.offsetX=b,p.offsetY=-b}if(1&~l)d.add(new St(2,0,0).close());else{const g=u*L.qn;d.add(new St(2,0,u)).add(new St(3,u,0,0,g,g,0).close()),f.offsetX=g,f.offsetY=g}return c.spot1=f,c.spot2=p,L.wr<L.am&&(L.yr[h]=c,L.wr++),c};m("RoundedRectangle",(n,o,r)=>e(n,o,r,n?n.parameter1:NaN,n?n.parameter2:NaN)),m("Border","RoundedRectangle"),m("RoundedTopRectangle",(n,o,r)=>e(n,o,r,n?n.parameter1:NaN,3)),m("RoundedBottomRectangle",(n,o,r)=>e(n,o,r,n?n.parameter1:NaN,12)),m("RoundedLeftRectangle",(n,o,r)=>e(n,o,r,n?n.parameter1:NaN,9)),m("RoundedRightRectangle",(n,o,r)=>e(n,o,r,n?n.parameter1:NaN,6)),m("Ellipse",(n,o,r)=>{const a="e"+o+","+r;let l=L.yr[a];return void 0!==l||(l=new Ct(3),l.endX=o,l.endY=r,l.spot1=A.vP,l.spot2=A.FP,L.wr<L.am&&(L.yr[a]=l,L.wr++)),l}),m("Circle",(n,o,r)=>{const a="c"+o+","+r;let l=L.yr[a];return void 0!==l||(l=new Ct(3),l.endX=o,l.endY=r,l.spot1=A.vP,l.spot2=A.FP,l.defaultStretch=6,L.wr<L.am&&(L.yr[a]=l,L.wr++)),l}),m("TriangleRight",(n,o,r)=>(new Ct).add(new Ht(0,0).add(new St(2,o,.5*r)).add(new St(2,0,r).close())).setSpots(0,.25,.5,.75)),m("TriangleDown",(n,o,r)=>(new Ct).add(new Ht(0,0).add(new St(2,o,0)).add(new St(2,.5*o,r).close())).setSpots(.25,0,.75,.5)),m("TriangleLeft",(n,o,r)=>(new Ct).add(new Ht(o,r).add(new St(2,0,.5*r)).add(new St(2,o,0).close())).setSpots(.5,.25,1,.75)),m("TriangleUp",(n,o,r)=>(new Ct).add(new Ht(o,r).add(new St(2,0,r)).add(new St(2,.5*o,0).close())).setSpots(.25,.5,.75,1)),m("Triangle","TriangleUp"),m("Diamond",(n,o,r)=>(new Ct).add(new Ht(.5*o,0).add(new St(2,0,.5*r)).add(new St(2,.5*o,r)).add(new St(2,o,.5*r).close())).setSpots(.25,.25,.75,.75)),m("LineH",(n,o,r)=>{const a=new Ct(1);return a.startX=0,a.startY=r/2,a.endX=o,a.endY=r/2,a}),m("LineV",(n,o,r)=>{const a=new Ct(1);return a.startX=o/2,a.startY=0,a.endX=o/2,a.endY=r,a}),m("None","Rectangle"),m("BarH","Rectangle"),m("BarV","Rectangle"),m("MinusLine","LineH"),m("PlusLine",(n,o,r)=>(new Ct).add(new Ht(0,r/2,!1).add(new St(2,o,r/2)).add(new St(1,o/2,0)).add(new St(2,o/2,r)))),m("XLine",(n,o,r)=>(new Ct).add(new Ht(0,r,!1).add(new St(2,o,0)).add(new St(1,0,0)).add(new St(2,o,r)))),m("LineRight",(n,o,r)=>(new Ct).add(new Ht(.25*o,0,!1).add(new St(2,.75*o,.5*r)).add(new St(2,.25*o,r)))),m("LineDown",(n,o,r)=>(new Ct).add(new Ht(0,.25*r,!1).add(new St(2,.5*o,.75*r)).add(new St(2,o,.25*r)))),m("LineLeft",(n,o,r)=>(new Ct).add(new Ht(.75*o,0,!1).add(new St(2,.25*o,.5*r)).add(new St(2,.75*o,r)))),m("LineUp",(n,o,r)=>(new Ct).add(new Ht(0,.75*r,!1).add(new St(2,.5*o,.25*r)).add(new St(2,o,.75*r)))),m("Capsule",(n,o,r)=>{const a=new Ct;if(o<r){const l=o/2,h=new Ht(0,l,!0);a.add(h),h.add(new St(5,180,180,l,l,l,l)),h.add(new St(2,o,r-l)),h.add(new St(5,0,180,l,r-l,l,l)),h.add(new St(2,0,l));const c=isFinite(n.parameter1)?n.parameter1:.156*o;return a.setSpots(0,0,1,1,0,c,0,-c),a}if(o>r){const l=r/2,h=new Ht(l,0,!0);a.add(h),h.add(new St(2,o-l,0)),h.add(new St(5,270,180,o-l,l,l,l)),h.add(new St(2,l,r)),h.add(new St(5,90,180,l,l,l,l));const c=isFinite(n.parameter1)?n.parameter1:.156*r;return a.setSpots(0,0,1,1,c,0,-c,0),a}return a.type=3,a.endX=o,a.endY=r,a.spot1=A.vP,a.spot2=A.FP,a});const t=(n,o)=>new Ht(n,o,!1,!1),i=(n,o,r)=>n.add(new St(2,o,r)),s=(n,o,r)=>n.add(new St(1,o,r));m("Borders",(n,o,r)=>{let a=n?n.parameter1:NaN;isNaN(a)?a=10:a&=15;const l=new Ct;let h;return 10===a?(h=t(o,0),i(h,o,r),s(h,0,r),i(h,0,0)):5===a?(h=t(0,0),i(h,o,0),s(h,o,r),i(h,0,r)):1===a?(h=t(0,0),i(h,o,0),s(h,o,r)):2===a?(h=t(o,0),i(h,o,r)):4===a?(h=t(o,r),i(h,0,r)):8===a?(h=t(0,r),i(h,0,0),s(h,o,r)):3===a?(h=t(0,0),i(h,o,0),i(h,o,r)):6===a?(h=t(o,0),i(h,o,r),i(h,0,r)):12===a?(h=t(o,r),i(h,0,r),i(h,0,0)):9===a?(h=t(0,r),i(h,0,0),i(h,o,0)):7===a?(h=t(0,0),i(h,o,0),i(h,o,r),i(h,0,r)):14===a?(h=t(o,0),i(h,o,r),i(h,0,r),i(h,0,0)):13===a?(h=t(o,r),i(h,0,r),i(h,0,0),i(h,o,0)):11===a?(h=t(0,r),i(h,0,0),i(h,o,0),i(h,o,r)):15===a?(h=t(0,0),i(h,o,0),i(h,o,r),i(h,0,r),h.add(new St(2,0,0).close())):(h=t(0,0),s(h,o,r)),l.add(h),l})}L.lm={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var zs=(m=>(m[m.None=0]="None",m[m.Added=1]="Added",m[m.Removed=2]="Removed",m[m.Shown=4]="Shown",m[m.Hidden=8]="Hidden",m[m.NodeSized=16]="NodeSized",m[m.GroupLayout=32]="GroupLayout",m[m.NodeReplaced=64]="NodeReplaced",m[m.Standard=127]="Standard",m[m.All=16777215]="All",m))(zs||{});let At=(()=>{class m extends J{b;_o;H;dl;gl;tr;ue;pl;Ta;nn;er;qd;UM;FD;xy;ky;constructor(t,i){let s;void 0===t||t instanceof Rt||"string"==typeof t?s=t:t&&(i=t),super(s),this.b=2408959,this._o="",this.H=null,this.dl="",this.gl=null,this.tr=null,this.ue="",this.pl=null,this.Ta=null,this.nn=new S(NaN,NaN).k(),this.er=null,this.qd=NaN,this.UM=-1,this.FD=new j,this.xy=null,this.ky=NaN,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.b=49152|-4097&this.b,t._o=this._o,null!==this.H&&(t.H=this.H.me?this.H:this.H.copy()),t.dl=this.dl,t.tr=null,t.ue=this.ue,t.nn.h(this.nn),t.qd=this.qd}jo(t){super.jo(t),t.Sa(),t.gl=null,t.er=null,t.xy=null}toString(){let t=y.Hn(this.constructor)+"#"+z.xs(this);return null!==this.data&&(t+="("+y.toString(this.data)+")"),t}static LayoutNone=0;static LayoutAdded=1;static LayoutRemoved=2;static LayoutShown=4;static LayoutHidden=8;static LayoutNodeSized=16;static LayoutGroupLayout=32;static LayoutNodeReplaced=64;static LayoutStandard=127;static LayoutAll=16777215;_e(){return null===this.H?this.H=new Ki:this.H.me&&(this.H=this.H.copy()),this.H}ba(){super.ba(),null!==this.H&&(this.H.me=!0)}gf(t,i,s,n,o,r,a){const l=this.diagram;null!==l&&(3===t&&"elements"===i?o instanceof J?o.Sn(h=>{l.partManager.N2(h,l)}):o instanceof Kt&&l.F2(o):4===t&&"elements"===i&&(o instanceof J?o.Sn(h=>l.partManager.C2(h,l)):o instanceof Kt&&l.R2(o)),l.raiseChangedEvent(t,i,s,n,o,r,a))}updateTargetBindings(t){if(super.updateTargetBindings(t),null===this.data)return;const i=this.D.r,s=i.length;for(let o=0;o<s;o++){const r=i[o];r instanceof J&&r.Sn(a=>{null!==a.data&&a.JI(t)})}const n=this.adornments;for(;n.next();)n.value.updateTargetBindings(t)}Yo(){if(super.Yo(),this.RN()){const i=this.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o instanceof J&&o.Sn(r=>r.Yo())}}const t=this.adornments;for(;t.next();)t.value.Yo()}updateRelationshipsFromData(){null!==this.data&&this.diagram?.partManager.updateRelationshipsFromData(this)}get key(){const t=this.diagram;if(null!==t)return t.model.getKeyForNodeData(this.data)}get adornments(){return null===this.tr?O.instance:this.tr.iteratorValues}findAdornment(t){const i=this.tr;return null===i?null:i.get(t)}addAdornment(t,i){if(null===i)return;let s=null,n=this.tr;if(null!==n&&(s=n.get(t)),s!==i){if(null!==s){const r=s.diagram;null!==r&&r.remove(s)}null===n&&(n=new xt,this.tr=n),i._o!==t&&(i.category=t),n.set(t,i);const o=this.diagram;if(null!==o){o.add(i);const r=i.adornedObject;if(null!==r){const a=r.findBindingPanel();null!==a&&(i.data=a.data)}}}}removeAdornment(t){const i=this.tr;if(null===i)return;const s=i.get(t);if(null!==s){const n=s.diagram;null!==n&&(n.remove(s),s.data=null)}i.delete(t),0===i.count&&(this.tr=null)}clearAdornments(){const t=this.tr;if(null===t)return;const i=y.nt(),s=t.iterator;for(;s.next();)i.push(s.key);const n=i.length;for(let o=0;o<n;o++)this.removeAdornment(i[o]);y.Z(i)}updateAdornments(){const t=this.diagram;if(null===t)return;this.pE(t),this.yE(t);let i=this.adornments;for(;i.next();){const s=i.value;s.c(),s.hasPlaceholder()&&s.placeholder.c()}for(i=this.adornments;i.next();)i.value.updateTargetBindings()}invalidateAdornments(){const t=this.diagram;null!==t&&(t.ha(),!0!==this.RD()&&this.OD(!0))}VM(){!1!==this.RD()&&(this.updateAdornments(),this.OD(!1))}pE(t){const i="Selection";if(this.isSelected&&this.selectionAdorned){const s=this.selectionObject;if(null!==s&&this.actualBounds.isReal()&&this.isVisible()&&s.isVisibleObject()&&s.actualBounds.isReal()){let n=this.findAdornment(i);if(null===n){let o=this.selectionAdornmentTemplate;null===o&&(o=this.Ar()?t.linkSelectionAdornmentTemplate:this instanceof pt?t.groupSelectionAdornmentTemplate:t.nodeSelectionAdornmentTemplate),n=o.copy(),null!==n&&(this.Ar()&&this.selectionObject===this.path&&(n.type=J.Link),n.adornedObject=s)}if(null!==n)return n.type===J.Link&&n.c(),void this.addAdornment(i,n)}}this.removeAdornment(i)}yE(t){const i=this;t.toolManager.mouseDownTools.each(s=>{s.isEnabled&&s.updateAdornments(i)}),t.toolManager.updateAdornments(i)}IM(t){this.pl=t,null===t&&this.uI()}get layer(){return this.pl}get diagram(){const t=this.pl;return null==t?null:t.diagram}get layerName(){return this.dl}set layerName(t){const i=this.dl;if(i===t)return;let s=this.diagram;if(null!==s&&(null===s.findLayer(t)||s.partManager.addsToTemporaryLayer))return;this.dl=t,null!==s&&s.invalidateDocumentBounds(),this.t("layerName",i,t);const n=this.layer;if(null===n||n.name===t||(s=n.diagram,null===s))return;const o=s.findLayer(t);if(null===o||o===n)return;let r=n.ri(-1,this,!0);r>=0&&s.raiseChangedEvent(4,"parts",n,this,null,r,!0),r=o.ch(99999999,this,!0),n.visible!==o.visible&&this.Xe(o.visible),r>=0&&s.raiseChangedEvent(3,"parts",o,null,this,!0,r);const a=this.layerChanged;if(null===a)return;const l=s.G;s.G=!0,a(this,n,o),s.G=l}get layerChanged(){return null!==this.H?this.H.Py:null}set layerChanged(t){const i=this.layerChanged;i!==t&&(null!==t&&y.S(t,m,"layerChanged"),this._e().Py=t,this.t("layerChanged",i,t))}get zOrder(){return this.qd}set zOrder(t){const i=this.qd;if(i===t)return;this.qd=t;const s=this.layer;null!==s&&s.rb(-1,this),this.t("zOrder",i,t);const n=this.diagram;null!==n&&n.C()}wE(){const t=this.layer;null!==t&&t.rb(-1,this)}hk(){if(!1!==this.fa())return;this.hC(!0),this.yf();const t=this.diagram;null!==t&&(t.Cp(this),t.requestUpdate())}ID(){if(this.b|=2097152,!1===this.fa())return;const t=this.position,i=this.location;(!i.isReal()||!t.isReal())&&this.ED(t,i);const s=this.De,n=j.l().h(s);s.ce(),s.x=t.x,s.y=t.y,s.k(),this.kd(n,s),j.i(n),this.hC(!1),this.yf()}lo(t,i,s,n){const o=this.hi;o.e(t,i,s,n),null===this.Se&&(this.Se=new Ot);const r=this.Se;r.Ue(),this.Kp(r,t,i,s,n),this.Se=r,r.RP()||r.sm(o)}Kp(t,i,s,n,o){if(1!==this.it&&t.it(this.it),0===this.Xt)return;let r=A.Center;this.locationSpot.isSpot()&&(r=this.locationSpot);const a=S.l();if(this.locationObject!==this){const l=this.locationObject,h=l.naturalBounds;a.setSpot(h.x,h.y,h.width,h.height,r),null!==l.Se&&l.Se.gt(a),a.offset(-l.measuredBounds.x,-l.measuredBounds.y);let c=l.panel;for(;null!==c&&c!==this;)null!==c.Se&&c.Se.gt(a),a.offset(-c.measuredBounds.x,-c.measuredBounds.y),c=c.panel}else a.setSpot(i,s,n,o,r);t.ks(this.Xt,a.x,a.y),S.i(a)}get locationObject(){if(null===this.er)if(this instanceof Nt&&this.type!==J.Link&&this.hasPlaceholder())this.er=this.placeholder;else{const t=this.locationObjectName;if(""!==t){const i=this.findObject(t);this.er=null!==i?i:this}else this.er=this}return this.er?.visible?this.er:this}get minLocation(){return null!==this.H?this.H.Sy:S.DL}set minLocation(t){const i=this.minLocation;i.equals(t)||(t=t.N(),this._e().Sy=t,this.t("minLocation",i,t))}get maxLocation(){return null!==this.H?this.H.My:S.vL}set maxLocation(t){const i=this.maxLocation;i.equals(t)||(t=t.N(),this._e().My=t,this.t("maxLocation",i,t))}get locationObjectName(){return null!==this.H?this.H.Ny:""}set locationObjectName(t){const i=this.locationObjectName;i!==t&&(this._e().Ny=t,this.er=null,this.c(),this.t("locationObjectName",i,t))}get locationSpot(){return null!==this.H?this.H.Cy:A.TopLeft}set locationSpot(t){const i=this.locationSpot;i.equals(t)||(t=t.N(),this._e().Cy=t,this.c(),this.t("locationSpot",i,t))}move(t,i){!0===i?this.location=t:this.position=t}moveTo(t,i,s){const n=S.z(t,i);this.move(n,s),S.i(n)}isVisible(){if(!this.visible)return!1;const t=this.layer;if(null!==t){if(!t.visible)return!1;const s=t.diagram;if(null!==s&&s.animationManager.Wx(this))return!0}const i=this.containingGroup;return!!(null===i||i.isSubGraphExpanded&&i.isVisible())}Xe(t){const i=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),null!==i&&i.Cp(this)):(this.invalidateLayout(8),this.clearAdornments()),this.Sa(),null!==i&&(i.invalidateDocumentBounds(),this instanceof nt&&this.canAvoid()&&i.fd(this),i.C())}findObject(t){if(this.name===t)return this;let i=this.xy;if(null===i&&(this.xy=i=new xt),null!==i.get(t))return i.get(t);const s=super.findObject(t);return null!==s?(i.set(t,s),s):(i.set(t,null),null)}s0(){this.xy=null}getRelativePoint(t,i,s){void 0===s&&(s=new S);const n=i.isNoSpot()?A.Center:i,o=t.naturalBounds;if(s.e(o.width*n.x+n.offsetX,o.height*n.y+n.offsetY),null===t||t===this)return s;t.v.gt(s);let r=t.panel;for(;null!==r&&r!==this;)r.v.gt(s),r=r.panel;return null!==this.Se&&this.Se.gt(s),s.offset(-this.hi.x,-this.hi.y),s}getDocumentBounds(t){return void 0===t&&(t=new j),t.h(this.actualBounds)}ensureBounds(){this.ht(1/0,1/0),this.Ut()}cD(t){const i=this.locationSpot,s=this.locationObject;let n=s.naturalBounds;n.isReal()||(n=j.em);const o=s instanceof rt?s.strokeWidth:0;if(t.setSpot(0,0,n.width+o,n.height+o,i),s!==this){t.offset(-o/2,-o/2),s.v.gt(t);let r=s.panel;for(;null!==r&&r!==this;)r.v.gt(t),r=r.panel}return null!==this.Se&&this.Se.gt(t),t.offset(-this.hi.x,-this.hi.y),t}hh(t,i){const s=void 0===i?this.FD:i,n=this.xE(),o=2*n;if(!this.isShadowed)return s.e(t.x-1-n,t.y-1-n,t.width+2+o,t.height+2+o),s;let r=t.x,a=t.y,l=t.width,h=t.height;const c=this.shadowBlur,u=this.shadowOffset;return l+=c,h+=c,r-=c/2,a-=c/2,u.x>0?l+=u.x:(r+=u.x,l-=u.x),u.y>0?h+=u.y:(a+=u.y,h-=u.y),s.e(r-1,a-1,l+2,h+2),s}eE(){return this.type===J.Link&&this instanceof Nt&&"Selection"===this.category&&this.adornedObject instanceof rt&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}xE(){return isNaN(this.ky)&&(this.ky=this.yD()),this.ky}Df(){this.ky=NaN}Ut(){if(!1===this.as())return void this.ID();this.ao(!1);const t=this.De,i=j.l();i.h(t);const s=this.Ul();this.Pa(0,0,this.hi.width,this.hi.height);const n=this.position;this.ED(n,this.location),t.ce(),t.x=n.x,t.y=n.y,t.k(),this.kd(i,t),i.equals(t)?this.As(s):this.Di()&&(!L.u(i.width,t.width)||!L.u(i.height,t.height))&&this.UM>=0&&this.invalidateLayout(16),j.i(i),this.hC(!1)}kd(t,i){const s=this.diagram;if(null===s)return;let n=!1;if(!1===s.mh&&t.isReal()){const o=j.l();o.h(s.documentBounds),o.subtractMargin(s.padding),t.x>o.x&&t.y>o.y&&t.right<o.right&&t.bottom<o.bottom&&i.x>o.x&&i.y>o.y&&i.right<o.right&&i.bottom<o.bottom&&(n=!0),j.i(o)}(!0===this.bE()||!t.equals(i))&&this.dT(n,s),s.C(),(t.isReal()||i.isReal())&&!t.equalsApproxClose(i)&&(this instanceof nt&&!s.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.Sa())}get location(){return this.nn}set location(t){const i=t.x,s=t.y,n=this.nn;(n.x!==i&&(!isNaN(n.x)||!isNaN(i))||n.y!==s&&(!isNaN(n.y)||!isNaN(s)))&&(t=t.copy(),this.kE(t,n)&&this.t("location",n,t.copy()))}kE(t,i){if(this.Ar())return!1;if(this.nn=t,this.b|=2097152,!1===this.as()){this.hk();const s=this.ct;if(s.isReal()){const n=this.diagram;if(null===n||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing){const o=s.copy();s.e(s.x+(t.x-i.x),s.y+(t.y-i.y)),this.UD(n,s,o.x,o.y),this.t("position",o,s.copy())}}}return!0}DN(t,i,s){if(this.Ar()||!t.isReal())return!1;const n=this.diagram;if(null!==n&&this.UD(n,t,i,s),this.ct=t,this.b&=-2097153,this.nn.isReal()&&(null===n||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing)){const o=this.nn;this.nn=new S(o.x+(t.x-i),o.y+(t.y-s)).k(),this.t("location",o,this.nn.copy())}return!1===this.fa()&&!1===this.as()&&(this.hk(),this.ID()),!0}UD(t,i,s,n){if(null===t||this instanceof Nt)return;const o=t.animationManager;o.ke&&o.vA(this,new S(s,n),i,!1)}Uc(t,i,s){const n=this.nn,o=this.ct;if(s){if(n.x===t&&n.y===i)return;this.fa()||this.as()?o.e(NaN,NaN):o.e(o.x+t-n.x,o.y+i-n.y),n.e(t,i)}else{if(o.x===t&&o.y===i)return;n.e(n.x+t-o.x,n.y+i-o.y),o.e(t,i)}this.hk()}vN(){this.b&=-2097153,this.hk()}ED(t,i){const s=this.cD(S.l()),n=this.diagram,o=i.isReal(),r=t.isReal();o&&r?2097152&this.b?this.VD(t,i,n,s):this.BD(t,i,n,s):o?this.VD(t,i,n,s):r&&this.BD(t,i,n,s),this.b|=2097152,S.i(s),this.yf()}VD(t,i,s,n){const o=t.x,r=t.y;if(t.e(i.x-n.x,i.y-n.y),null!==s){const a=s.animationManager,l=a.defaultAnimation.isAnimating;!l&&a.ke&&!(this instanceof Nt)&&a.vA(this,new S(o,r),t,!1),!l&&(t.x!==o||t.y!==r)&&this.t("position",new S(o,r),t.copy())}}BD(t,i,s,n){const o=i.copy();i.e(t.x+n.x,t.y+n.y),!i.equals(o)&&null!==s&&this.t("location",o,i.copy())}dT(t,i){this.NN(!1),this instanceof nt&&i.fd(this),!this.layer.isTemporary&&!t&&i.invalidateDocumentBounds();const s=this.De,n=i.viewportBounds;n.isReal()?this.Ul()?(s.UL(n,10)||this.As(!1),this.updateAdornments()):this.isVisible()&&s.intersectsRect(n)?(this.As(!0),this.updateAdornments()):this.invalidateAdornments():i.tf=!0}_r(){return!0}Di(){return!0}Ar(){return!1}_s(){return!0}hasPlaceholder(){return!1}get category(){return this._o}set category(t){const i=this._o;if(i===t)return;null!==this.svg&&(this.svg.remove(),this.$i(!0));const s=this.diagram,n=this.data;let o=null;if(null!==s&&null!==n&&!(this instanceof Nt)){const r=s.model.undoManager;r.isEnabled&&!r.isUndoingRedoing&&(o=this.clone(),o.D.addAll(this.D))}if(this._o=t,this.t("category",i,t),null===s||null===n||this instanceof Nt){if(this instanceof Nt){const r=this.adornedPart;if(null!==r){const a=r.tr;null!==a&&a.delete(i),r.addAdornment(this.category,this)}}}else{const r=s.model;if(r.undoManager.isUndoingRedoing)return;if(this.Ar()){s.partManager.setLinkCategoryForData(n,t);const a=s.partManager.findLinkTemplateForCategory(t);if(null!==a){a.It();const l=a.copy();null!==l&&this.cC(l,i,t)}}else{null!==r&&r.setCategoryForNodeData(n,t);const a=s.partManager.findTemplateForNodeData(n,t);if(null!==a){a.It();const l=a.copy();if(null!==l&&!(l instanceof gt)){const h=this.location.copy();this.cC(l,i,t),this.location.isReal()||(this.location=h)}}}if(null!==o){const a=this.clone();a.D.addAll(this.D),this.t("self",o,a)}}}get self(){return this}set self(t){this.cC(t,this.category,t.category)}static zD=!1;cC(t,i,s){t.constructor!==this.constructor&&(m.zD||(m.zD=!0,y.ne('Should not change the class of the Part when changing category from "'+i+'" to "'+s+'"'),y.ne("  Old class: "+y.Hn(this.constructor)+", new class: "+y.Hn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();const n=this.data,o=this.layerName,r=this.isSelected,a=this.isHighlighted;let l=!0,h=!0,c=!1;this instanceof nt&&(l=this.isTreeLeaf,h=this.isTreeExpanded,c=this.wasTreeExpanded),t.jo(this),t.cloneProtected(this),this._o=s,null!==this.svg&&(this.svg.remove(),this.Wc(),this.$i(!0)),this.c(),this.C();const u=this.diagram;let d=!0;null!==u&&(d=u.skipsUndoManager,u.skipsUndoManager=!0),this.te=n,this.b=r?4096|this.b:-4097&this.b,this.b=a?524288|this.b:-524289&this.b,this instanceof nt&&(this.E=l?4|this.E:-5&this.E,this.E=h?1|this.E:-2&this.E,this.E=c?2|this.E:-3&this.E),null!==n&&this.updateTargetBindings();const f=this.layerName;f!==o&&(this.dl=o,this.layerName=f),null!==u&&(u.skipsUndoManager=d),this.Di()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowCopy)return!1;const i=t.diagram;return null===i||!!i.allowCopy}canDelete(){if(!this.deletable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowDelete)return!1;const i=t.diagram;return null===i||!!i.allowDelete}canEdit(){if(!this.textEditable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowTextEdit)return!1;const i=t.diagram;return null===i||!!i.allowTextEdit}canGroup(){if(!this.groupable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowGroup)return!1;const i=t.diagram;return null===i||!!i.allowGroup}canMove(){if(!this.movable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowMove)return!1;const i=t.diagram;return null===i||!!i.allowMove}canReshape(){if(!this.reshapable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowReshape)return!1;const i=t.diagram;return null===i||!!i.allowReshape}canResize(){if(!this.resizable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowResize)return!1;const i=t.diagram;return null===i||!!i.allowResize}canRotate(){if(!this.rotatable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowRotate)return!1;const i=t.diagram;return null===i||!!i.allowRotate}canSelect(){if(!this.selectable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowSelect)return!1;const i=t.diagram;return null===i||!!i.allowSelect}get copyable(){return!!(1&this.b)}set copyable(t){const i=!!(1&this.b);i!==t&&(this.b=1^this.b,this.t("copyable",i,t))}get deletable(){return!!(2&this.b)}set deletable(t){const i=!!(2&this.b);i!==t&&(this.b=2^this.b,this.t("deletable",i,t))}get textEditable(){return!!(4&this.b)}set textEditable(t){const i=!!(4&this.b);i!==t&&(this.b=4^this.b,this.t("textEditable",i,t),this.invalidateAdornments())}get groupable(){return!!(8&this.b)}set groupable(t){const i=!!(8&this.b);i!==t&&(this.b=8^this.b,this.t("groupable",i,t))}get movable(){return!!(16&this.b)}set movable(t){const i=!!(16&this.b);i!==t&&(this.b=16^this.b,this.t("movable",i,t))}get selectionAdorned(){return!!(32&this.b)}set selectionAdorned(t){const i=!!(32&this.b);i!==t&&(this.b=32^this.b,this.t("selectionAdorned",i,t),this.invalidateAdornments())}get isInDocumentBounds(){return!!(64&this.b)}set isInDocumentBounds(t){const i=!!(64&this.b);if(i!==t){this.b=64^this.b;const s=this.diagram;null!==s&&s.invalidateDocumentBounds(),this.t("isInDocumentBounds",i,t)}}get isLayoutPositioned(){return!!(128&this.b)}set isLayoutPositioned(t){const i=!!(128&this.b);i!==t&&(this.b=128^this.b,this.t("isLayoutPositioned",i,t),this.invalidateLayout(t?4:8))}get selectable(){return!!(256&this.b)}set selectable(t){const i=!!(256&this.b);i!==t&&(this.b=256^this.b,this.t("selectable",i,t),this.invalidateAdornments())}get reshapable(){return!!(512&this.b)}set reshapable(t){const i=!!(512&this.b);i!==t&&(this.b=512^this.b,this.t("reshapable",i,t),this.invalidateAdornments())}get resizable(){return!!(1024&this.b)}set resizable(t){const i=!!(1024&this.b);i!==t&&(this.b=1024^this.b,this.t("resizable",i,t),this.invalidateAdornments())}get rotatable(){return!!(2048&this.b)}set rotatable(t){const i=!!(2048&this.b);i!==t&&(this.b=2048^this.b,this.t("rotatable",i,t),this.invalidateAdornments())}get isSelected(){return!!(4096&this.b)}set isSelected(t){const i=!!(4096&this.b);if(i!==t){const s=this.diagram;if(t){if(!this.canSelect())return;if(null!==s&&s.selection.count>=s.maxSelectionCount)return}this.b=4096^this.b;let n=!1;if(null!==s){n=s.skipsUndoManager,s.skipsUndoManager=!0;const r=s.selection;r.ce(),t?r.add(this):r.delete(this),r.k()}this.t("isSelected",i,t),this.invalidateAdornments();const o=this.selectionChanged;null!==o&&o(this),null!==s&&(s.requestUpdate(),s.skipsUndoManager=n)}}get isHighlighted(){return!!(524288&this.b)}set isHighlighted(t){const i=!!(524288&this.b);if(i!==t){this.b=524288^this.b;const s=this.diagram;if(null!==s){const o=s.highlighteds;o.ce(),t?o.add(this):o.delete(this),o.k()}this.t("isHighlighted",i,t),this.C();const n=this.highlightedChanged;null!==n&&n(this)}}get isShadowed(){return!!(8192&this.b)}set isShadowed(t){const i=!!(8192&this.b);i!==t&&(this.b=8192^this.b,this.$i(!0),this.t("isShadowed",i,t),this.C())}RD(){return!!(16384&this.b)}OD(t){t?this.b|=16384:this.b&=-16385}fa(){return!!(32768&this.b)}hC(t){t?this.b|=32768:this.b&=-32769}bE(){return!!(65536&this.b)}NN(t){t?this.b|=65536:this.b&=-65537}Ul(){return!!(131072&this.b)}As(t){t?this.b|=131072:this.b&=-131073}XD(){return!!(1048576&this.b)}ck(t){t?this.b|=1048576:this.b&=-1048577}get isAnimated(){return!!(262144&this.b)}set isAnimated(t){const i=!!(262144&this.b);i!==t&&(this.b=262144^this.b,this.t("isAnimated",i,t))}get highlightedChanged(){return null!==this.H?this.H.Ly:null}set highlightedChanged(t){const i=this.highlightedChanged;i!==t&&(null!==t&&y.S(t,m,"highlightedChanged"),this._e().Ly=t,this.t("highlightedChanged",i,t))}get selectionObjectName(){return null!==this.H?this.H.Ay:""}set selectionObjectName(t){const i=this.selectionObjectName;i!==t&&(this._e().Ay=t,this.gl=null,this.t("selectionObjectName",i,t))}get selectionAdornmentTemplate(){return null!==this.H?this.H.Ty:null}set selectionAdornmentTemplate(t){const i=this.selectionAdornmentTemplate;i!==t&&(null!==t&&t.It(),this._e().Ty=t,this.t("selectionAdornmentTemplate",i,t))}get selectionObject(){if(null===this.gl){const t=this.selectionObjectName;if(null!==t&&""!==t){const i=this.findObject(t);this.gl=null!==i?i:this}else if(this instanceof gt){const i=this.path;this.gl=null!==i?i:this}else this.gl=this}return this.gl}get selectionChanged(){return null!==this.H?this.H.Dy:null}set selectionChanged(t){const i=this.selectionChanged;i!==t&&(null!==t&&y.S(t,m,"selectionChanged"),this._e().Dy=t,this.t("selectionChanged",i,t))}get resizeAdornmentTemplate(){return null!==this.H?this.H.vy:null}set resizeAdornmentTemplate(t){const i=this.resizeAdornmentTemplate;i!==t&&(this._e().vy=null!==t?t.It():null,this.t("resizeAdornmentTemplate",i,t))}get resizeObjectName(){return null!==this.H?this.H.Fy:""}set resizeObjectName(t){const i=this.resizeObjectName;i!==t&&(this._e().Fy=t,this.t("resizeObjectName",i,t))}get resizeObject(){const t=this.resizeObjectName;if(""!==t){const i=this.findObject(t);if(null!==i)return i}return this}get resizeCellSize(){return null!==this.H?this.H.Ry:lt.Zw}set resizeCellSize(t){const i=this.resizeCellSize;i.equals(t)||(t=t.N(),this._e().Ry=t,this.t("resizeCellSize",i,t))}get rotateAdornmentTemplate(){return null!==this.H?this.H.Oy:null}set rotateAdornmentTemplate(t){const i=this.rotateAdornmentTemplate;i!==t&&(this._e().Oy=null!==t?t.It():null,this.t("rotateAdornmentTemplate",i,t))}get rotateObjectName(){return null!==this.H?this.H.Iy:""}set rotateObjectName(t){const i=this.rotateObjectName;i!==t&&(this._e().Iy=t,this.t("rotateObjectName",i,t))}get rotateObject(){const t=this.rotateObjectName;if(""!==t){const i=this.findObject(t);if(null!==i)return i}return this}get rotationSpot(){return null!==this.H?this.H.Ey:A.Default}set rotationSpot(t){const i=this.rotationSpot;i.equals(t)||(t=t.N(),this._e().Ey=t,this.t("rotationSpot",i,t))}get text(){return this.ue}set text(t){const i=this.ue;i!==t&&(this.ue=t,this.t("text",i,t))}get containingGroup(){return this.Ta}set containingGroup(t){if(this.Di()){const i=this.Ta;if(i!==t){null!==t&&(this===t||t.isMemberOf(this))&&(this===t&&y.o("Cannot make a Group a member of itself: "+this.toString()),y.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);const s=this.diagram;if(null!==i?i.fC(this):this instanceof pt&&null!==s&&s.Zr.delete(this),this.Ta=t,null!==t?t.uC(this):this instanceof pt&&null!==s&&s.Zr.add(this),this.invalidateLayout(1),null!==s&&s.G){const o=this.data,r=s.model;null!==o&&r.uf()&&r.setGroupForData(o,r.getKeyForNodeData(null!==t?t.data:null))}const n=this.containingGroupChanged;if(null!==n){let o=!0;null!==s&&(o=s.G,s.G=!0),n(this,i,t),null!==s&&(s.G=o)}if(this instanceof pt){const o=new z;m.ga(o,this,!0,0,!0);const r=o.iterator;for(;r.next();){const a=r.value;if(a instanceof nt){const l=a.linksConnected;for(;l.next();)l.value.Wd()}}}if(this instanceof nt){const o=this.linksConnected;for(;o.next();)o.value.Wd();const r=this.labeledLink;null!==r&&r.Wd()}this.t("containingGroup",i,t),null!==t&&t.wE()}}else y.o("cannot set the Part.containingGroup of a Link or Adornment")}Sa(){const t=this.containingGroup;null!==t&&(t.hasPlaceholder()&&t.placeholder.c(),t.c(),t.invalidateConnectedLinks())}C(){const t=this.diagram;null!==t&&!this.as()&&!this.fa()&&this.isVisible()&&this.De.isReal()&&t.C(this.hh(this.De))}c(){if(this.Go())return;super.c();const t=this.diagram;null!==t&&(t.Cp(this),this instanceof nt&&null!==this.labeledLink&&this.labeledLink.Pf(),t.requestUpdate(!0))}Pf(t){if(this.as())return;const i=this.diagram;null!==i&&(i.Cp(this),this instanceof nt&&this.invalidateConnectedLinks(),i.requestUpdate()),this.ao(!0)}tp(t){if(!t){const i=this.Ta;null!==i&&i.uC(this)}}ep(t){if(!t){const i=this.Ta;null!==i&&i.fC(this)}}lf(){const t=this.data;if(null!==t){const i=this.diagram;if(null!==i){const s=i.model;null!==s&&s.removeNodeData(t)}}}get containingGroupChanged(){return null!==this.H?this.H.Uy:null}set containingGroupChanged(t){const i=this.containingGroupChanged;i!==t&&(null!==t&&y.S(t,m,"containingGroupChanged"),this._e().Uy=t,this.t("containingGroupChanged",i,t))}findSubGraphLevel(){return this.dC(this)}dC(t){const i=t.containingGroup;if(null!==i)return 1+this.dC(i);if(t instanceof nt){const s=t.labeledLink;if(null!==s)return this.dC(s)}return 0}findTopLevelPart(){return this.gC(this)}gC(t){const i=t.containingGroup;if(null!==i)return this.gC(i);if(t instanceof nt){const s=t.labeledLink;if(null!==s)return this.gC(s)}return t}get isTopLevel(){return!(null!==this.containingGroup||this instanceof nt&&null!==this.labeledLink)}isMemberOf(t){return t instanceof pt&&this.mC(this,t)}mC(t,i){if(t===i||null===i)return!1;const s=t.containingGroup;if(null!==s&&(s===i||this.mC(s,i)))return!0;if(t instanceof nt){const n=t.labeledLink;if(null!==n)return this.mC(n,i)}return!1}findCommonContainingGroup(t){if(null===t)return null;if(this===t)return this.containingGroup;let i=this;for(;null!==i;){if(i instanceof pt&&i.ck(!0),i instanceof nt){const n=i.labeledLink;null!==n&&(i=n)}i=i.containingGroup}let s=null;for(i=t;null!==i;){if(i.XD()){s=i;break}if(i instanceof nt){const n=i.labeledLink;null!==n&&(i=n)}i=i.containingGroup}for(i=this;null!==i;){if(i instanceof pt&&i.ck(!1),i instanceof nt){const n=i.labeledLink;null!==n&&(i=n)}i=i.containingGroup}return s}get layoutConditions(){return null!==this.H?this.H.Vy:127}set layoutConditions(t){const i=this.layoutConditions;i!==t&&(this._e().Vy=t,this.t("layoutConditions",i,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;const t=this.layer;return!(null!==t&&t.isTemporary||this instanceof nt&&this.isLinkLabel)}PE(t){if(!this.isLayoutPositioned||0===(t&this.layoutConditions))return!1;const i=this.layer;if(null!==i&&i.isTemporary||this instanceof nt&&this.isLinkLabel)return!1;const s=this.diagram;return!(null!==s&&s.undoManager.isUndoingRedoing)}invalidateLayout(t){if(void 0===t&&(t=16777215),!this.PE(t))return;const i=this.Ta;if(null!==i){const s=i.layout;null!==s?s.p():i.invalidateLayout(t)}else{const s=this.diagram;if(null!==s){const n=s.layout;null!==n&&n.p()}}}gT(){if(!this.isVisible())return!1;const t=this.layer;return!(null!==t&&t.isTemporary)}static ga(t,i,s,n,o,r){if(void 0===r&&(r=null),!t.has(i)&&(null===r||r(i))&&!(i instanceof Nt))if(t.add(i),i instanceof nt){if(s&&i instanceof pt){const a=i.memberParts;for(;a.next();)m.ga(t,a.value,s,n,o,r)}if(!1!==o){const a=i.linksConnected;for(;a.next();){const l=a.value;if(t.has(l))continue;const h=l.fromNode,c=l.toNode,u=null===h||t.has(h),d=null===c||t.has(c);(o?u&&d:u||d)&&m.ga(t,l,s,n,o,r)}}if(n>1){const a=i.findTreeChildrenNodes();for(;a.next();)m.ga(t,a.value,s,n-1,o,r)}}else if(i instanceof gt){const a=i.labelNodes;for(;a.next();)m.ga(t,a.value,s,n,o,r)}}get dragComputation(){return null!==this.H?this.H.By:null}set dragComputation(t){const i=this.dragComputation;i!==t&&(null!==t&&y.S(t,m,"dragComputation"),this._e().By=t,this.t("dragComputation",i,t))}get shadowOffset(){return null!==this.H?this.H.zy:S.FL}set shadowOffset(t){const i=this.shadowOffset;i.equals(t)||(t=t.N(),this._e().zy=t,this.C(),this.t("shadowOffset",i,t))}get shadowColor(){return null!==this.H?this.H.Xy:"gray"}set shadowColor(t){const i=this.shadowColor;i!==t&&(this._e().Xy=t,this.C(),this.t("shadowColor",i,t))}get shadowBlur(){return null!==this.H?this.H.An:4}set shadowBlur(t){const i=this.shadowBlur;i!==t&&(this._e().An=t,this.C(),this.t("shadowBlur",i,t))}}return m})();class Ki{me;Py;Uy;Ty;Ay;Dy;Ly;vy;Fy;Ry;Oy;Iy;Ey;Ny;Cy;Sy;My;By;Vy;zy;Xy;An;constructor(){this.me=!1,this.Py=null,this.Uy=null,this.Ty=null,this.Ay="",this.Dy=null,this.Ly=null,this.vy=null,this.Fy="",this.Ry=lt.Zw,this.Oy=null,this.Iy="",this.Ey=A.Default,this.Ny="",this.Cy=A.TopLeft,this.Sy=S.DL,this.My=S.vL,this.By=null,this.Vy=127,this.zy=S.FL,this.Xy="gray",this.An=4}copy(){const e=new Ki;return e.Py=this.Py,e.Uy=this.Uy,e.Ty=this.Ty,e.Ay=this.Ay,e.Dy=this.Dy,e.Ly=this.Ly,e.vy=this.vy,e.Fy=this.Fy,e.Ry=this.Ry.N(),e.Oy=this.Oy,e.Iy=this.Iy,e.Ey=this.Ey.N(),e.Ny=this.Ny,e.Cy=this.Cy.N(),e.Sy=this.Sy.N(),e.My=this.My.N(),e.By=this.By,e.Vy=this.Vy,e.zy=this.zy.N(),e.Xy=this.Xy,e.An=this.An,e}}class Nt extends At{Ms;Dt;WS;JS;Af;constructor(e,t){let i;void 0===e||e instanceof Rt||"string"==typeof e?i=e:e&&(t=e),super(i),this.b&=-257,this.dl="Adornment",this.Ms=null,this.WS=0,this.JS=!1,this.Dt=null,this.Af=null,t&&Object.assign(this,t)}toString(){const e=this.adornedPart;return"Adornment("+this.category+")"+(null!==e?e.toString():"")}updateRelationshipsFromData(){}Td(e){const t=this.adornedObject;if(!(t instanceof rt))return;const i=t.part;if(!(i instanceof gt))return;const s=i.path;let n=s.geometry;i.Td(e),n=s.geometry;const o=this.D.r,r=o.length;for(let a=0;a<r;a++){const l=o[a];l.isPanelMain&&l instanceof rt&&(l.ut=n)}}hasPlaceholder(){return null!==this.Dt&&this.Dt.isVisibleObject()}get placeholder(){return this.Dt}get adornedObject(){return this.Ms}set adornedObject(e){const t=this.adornedPart;let i=null;null!==e&&(i=e.part),null!==t&&(null===e||t!==i)&&t.removeAdornment(this.category),this.Ms=e,null!==i&&i.addAdornment(this.category,this)}get adornedPart(){const e=this.Ms;return null!==e?e.part:null}_r(){const e=this.Ms;if(null===e)return!0;const t=e.part;return null===t||!t.as()}Di(){return!1}get containingGroup(){return null}gf(e,t,i,s,n,o,r){if(3===e&&"elements"===t){if(n instanceof de)null===this.Dt&&(this.Dt=n);else if(n instanceof J){const a=n.findInVisualTree(l=>l instanceof de);a instanceof de&&null===this.Dt&&(this.Dt=a)}}else 4===e&&"elements"===t&&null!==this.Dt&&(s===this.Dt||s instanceof J&&this.Dt.isContainedBy(s))&&(this.Dt=null);super.gf(e,t,i,s,n,o,r)}updateAdornments(){}lf(){}}var Xs=(m=>(m[m.None=0]="None",m[m.Evenly=1]="Evenly",m[m.Packed=2]="Packed",m))(Xs||{});let nt=(()=>{class m extends At{E;vt;Xf;yl;Da;ci;ee;constructor(t,i){let s;void 0===t||t instanceof Rt||"string"==typeof t?s=t:t&&(i=t),super(s),this.E=13,this.vt=null,this.ee=new H,this.Xf=null,this.yl=null,this.ci=null,this.Da=!1,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.E=this.E,null!==this.vt&&(t.vt=this.vt.me?this.vt:this.vt.copy())}jo(t){super.jo(t),t.invalidateConnectedLinks(),t.yl=this.yl,t.ci=null}static SpreadingNone=0;static SpreadingEvenly=1;static SpreadingPacked=2;wl(){return null===this.vt?this.vt=new Ui:this.vt.me&&(this.vt=this.vt.copy()),this.vt}ba(){super.ba(),null!==this.vt&&(this.vt.me=!0)}GD(t){null!==t&&(null===this.yl&&(this.yl=new z),this.yl.add(t))}YD(t){null!==t&&null!==this.yl&&this.yl.delete(t)}KD(t,i,s){if(null===t||null===this.yl)return null;const n=this.yl.iterator;for(;n.next();){const o=n.value;if(o.Gy===this&&o.fk===t&&o.pC===i&&o.yC===s||o.Gy===t&&o.fk===this&&o.pC===s&&o.yC===i)return o}return null}invalidateLinkBundle(t,i,s){null==i&&(i=""),null==s&&(s="");const n=this.KD(t,i,s);null!==n&&n.Jd()}gf(t,i,s,n,o,r,a){(3===t&&"elements"===i||4===t&&"elements"===i)&&(this.ci=null),super.gf(t,i,s,n,o,r,a)}invalidateConnectedLinks(t,i){const s=this.linksConnected;for(;s.next();){const n=s.value;t&&t.has(n)||i&&n.fromPort!==i&&n.toPort!==i||(this.Ze(n.fromPort),this.Ze(n.toPort),n.$t())}}Ze(t){if(null===t)return;const i=t.yd;null!==i&&i.Jd();const s=t.part,n=s.containingGroup;null!==n&&!s.isVisible()&&n.Ze(n.port)}_r(){return!0}get portSpreading(){return null!==this.vt?this.vt.Yy:1}set portSpreading(t){const i=this.portSpreading;if(i!==t){this.wl().Yy=t,this.t("portSpreading",i,t);const s=this.diagram;if(null!==s&&s.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return!!(8&this.E)}set avoidable(t){const i=!!(8&this.E);if(i!==t){this.E=8^this.E;const s=this.diagram;null!==s&&s.fd(this),this.t("avoidable",i,t)}}get avoidableMargin(){return null!==this.vt?this.vt.Ky:It.BL}set avoidableMargin(t){"number"==typeof t&&(t=new It(t));const i=this.avoidableMargin;if(!i.equals(t)){t=t.N(),this.wl().Ky=t;const s=this.diagram;null!==s&&s.fd(this),this.t("avoidableMargin",i,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;null!==t&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,i=1;const s=this.diagram;if(null!==s){if(s.animationManager.Wx(this))return!0;t=s.isTreePathToChildren,i=s.treeCollapsePolicy}if(1===i){const o=this.findTreeParentNode();if(null!==o&&!o.isTreeExpanded)return!1}else if(2===i){const o=t?this.findLinksInto():this.findLinksOutOf();let r=!1,a=!1;for(;o.next();){const l=o.value;if(l.isTreeLink){r=!0;const h=t?l.fromNode:l.toNode;if(h&&h.isTreeExpanded){a=!0;break}}}if(r&&!a)return!1}else if(3===i){const o=t?this.findLinksInto():this.findLinksOutOf();let r=!1,a=!1;for(;o.next();){const l=o.value;if(l.isTreeLink){r=!0;const h=t?l.fromNode:l.toNode;if(h&&!h.isTreeExpanded){a=!0;break}}}if(r&&a)return!1}const n=this.labeledLink;return null===n||n.isVisible()}Xe(t){super.Xe(t);const i=this.linksConnected;for(;i.next();){const s=i.value;if(t&&null!==this.containingGroup){const n=s.getOtherNode(this);null!==n&&!n.isMemberOf(this.containingGroup)&&s.$t()}s.Xe(t)}}get linksConnected(){return this.ee.iterator}findExternalTreeLinksConnected(){const t=new z,i=new z;return this.HD(this,t,i),i.iterator}HD(t,i,s){if(null===t||i.has(t))return;i.add(t);let n=!0;const o=this.diagram;null!==o&&(n=o.isTreePathToChildren),t.linksConnected.each(r=>{r.isTreeLink?(n?r.fromNode===t:r.toNode===t)&&this.HD(n?r.toNode:r.fromNode,i,s):s.add(r)})}findLinksConnected(t){if(void 0===t&&(t=null),null===t)return this.ee.iterator;const i=new q(this.ee),s=this;return i.predicate=n=>n.fromNode===s&&n.fromPortId===t||n.toNode===s&&n.toPortId===t,i}findLinksOutOf(t){void 0===t&&(t=null);const i=new q(this.ee),s=this;return i.predicate=n=>n.fromNode===s&&(null===t||n.fromPortId===t),i}findLinksInto(t){void 0===t&&(t=null);const i=new q(this.ee),s=this;return i.predicate=n=>n.toNode===s&&(null===t||n.toPortId===t),i}findNodesConnected(t){void 0===t&&(t=null);let i=null,s=null;const n=this.ee.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this){if(null===t||o.fromPortId===t){const r=o.toNode;null!==i?i.add(r):null!==s&&s!==r?(i=new z,i.add(s),i.add(r)):s=r}}else if(o.toNode===this&&(null===t||o.toPortId===t)){const r=o.fromNode;null!==i?i.add(r):null!==s&&s!==r?(i=new z,i.add(s),i.add(r)):s=r}}return null!==i?i.iterator:null!==s?new G(s):O.instance}findNodesOutOf(t){void 0===t&&(t=null);let i=null,s=null;const n=this.ee.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this&&(null===t||o.fromPortId===t)){const r=o.toNode;null!==i?i.add(r):null!==s&&s!==r?(i=new z,i.add(s),i.add(r)):s=r}}return null!==i?i.iterator:null!==s?new G(s):O.instance}findNodesInto(t){void 0===t&&(t=null);let i=null,s=null;const n=this.ee.iterator;for(;n.next();){const o=n.value;if(o.toNode===this&&(null===t||o.toPortId===t)){const r=o.fromNode;null!==i?i.add(r):null!==s&&s!==r?(i=new z,i.add(s),i.add(r)):s=r}}return null!==i?i.iterator:null!==s?new G(s):O.instance}findLinksBetween(t,i,s){void 0===i&&(i=null),void 0===s&&(s=null);const n=new q(this.ee),o=this;return n.predicate=r=>!((r.fromNode!==o||r.toNode!==t||null!==i&&r.fromPortId!==i||null!==s&&r.toPortId!==s)&&(r.fromNode!==t||r.toNode!==o||null!==s&&r.fromPortId!==s||null!==i&&r.toPortId!==i)),n}findLinksTo(t,i,s){void 0===i&&(i=null),void 0===s&&(s=null);const n=new q(this.ee),o=this;return n.predicate=r=>!(r.fromNode!==o||r.toNode!==t||null!==i&&r.fromPortId!==i||null!==s&&r.toPortId!==s),n}findSuccessorParts(t){return void 0===t&&(t=new z),this.jD(this,t),t.remove(this),t}jD(t,i){null!==t&&(i.has(t)||(i.add(t),t.findLinksOutOf().each(s=>{if(i.has(s))return;i.add(s);const n=s.toNode;null!==n&&this.jD(n,i)})))}findPredecessorParts(t){return void 0===t&&(t=new z),this.qD(this,t),t.remove(this),t}qD(t,i){null!==t&&(i.has(t)||(i.add(t),t.findLinksInto().each(s=>{if(i.has(s))return;i.add(s);const n=s.fromNode;null!==n&&this.qD(n,i)})))}get linkConnected(){return null!==this.vt?this.vt.Hy:null}set linkConnected(t){const i=this.linkConnected;i!==t&&(null!==t&&y.S(t,m,"linkConnected"),this.wl().Hy=t,this.t("linkConnected",i,t))}get linkDisconnected(){return null!==this.vt?this.vt.jy:null}set linkDisconnected(t){const i=this.linkDisconnected;i!==t&&(null!==t&&y.S(t,m,"linkDisconnected"),this.wl().jy=t,this.t("linkDisconnected",i,t))}get linkValidation(){return null!==this.vt?this.vt.El:null}set linkValidation(t){const i=this.linkValidation;i!==t&&(null!==t&&y.S(t,m,"linkValidation"),this.wl().El=t,this.t("linkValidation",i,t))}uk(t,i){this.Ze(i);const s=this.ee.has(t);if(s||this.ee.add(t),!s||t.fromNode===t.toNode){const n=this.linkConnected;if(null!==n){let o=!0;const r=this.diagram;null!==r&&(o=r.G,r.G=!0),n(this,t,i),null!==r&&(r.G=o)}}if(!s){if(!t.isTreeLink)return;const n=t.fromNode,o=t.toNode;if(null!==n&&null!==o&&n!==o){let r=!0;const a=this.diagram;null!==a&&(r=a.isTreePathToChildren);const l=r?o:n,h=r?n:o;if(l.Da||(l.Da=h),h.isTreeLeaf){if(null!==a&&a.undoManager.isUndoingRedoing)return;r?n===h&&(h.isTreeLeaf=!1):o===h&&(h.isTreeLeaf=!1)}}}}dk(t,i){this.Ze(i);const s=this.ee.delete(t);let n=null;if(s||t.toNode===t.fromNode){const o=this.linkDisconnected;if(n=this.diagram,null!==o){let r=!0;null!==n&&(r=n.G,n.G=!0),o(this,t,i),null!==n&&(n.G=r)}}if(s){if(!t.isTreeLink)return;let o=!0;null!==n&&(o=n.isTreePathToChildren);const r=o?t.toNode:t.fromNode,a=o?t.fromNode:t.toNode;if(null!==r&&(r.Da=!1),null!==a&&!a.isTreeLeaf)if(0===a.ee.count){if(a.Da=null,null!==n&&n.undoManager.isUndoingRedoing)return;a.isTreeLeaf=!0}else a.vp()}}vp(){if(this.Da=!1,0===this.ee.count)return;let t=!0;const i=this.diagram;if(null!==i&&i.undoManager.isUndoingRedoing)return;null!==i&&(t=i.isTreePathToChildren);const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.isTreeLink)if(t){if(n.fromNode===this)return void(this.isTreeLeaf=!1)}else if(n.toNode===this)return void(this.isTreeLeaf=!1)}this.isTreeLeaf=!0}updateRelationshipsFromData(){const t=this.diagram;null!==t&&t.partManager.updateRelationshipsFromData(this)}tp(t){if(super.tp(t),!t){this.vp();const i=this.Xf;null!==i&&i.WD(this)}}ep(t){if(super.ep(t),!t){const i=this.Xf;null!==i&&i.JD(this)}}lf(){if(this.ee.count>0){const t=this.diagram;if(null!==t){const i=null===t.commandHandler||t.commandHandler.deletesConnectedLinks,s=this.ee.copy().iterator;for(;s.next();){const n=s.value;i?t.remove(n):(n.fromNode===this&&(n.fromNode=null),n.toNode===this&&(n.toNode=null))}}}this.labeledLink=null,super.lf()}get isLinkLabel(){return null!==this.Xf}get labeledLink(){return this.Xf}set labeledLink(t){const i=this.Xf;if(i!==t){const s=this.diagram,n=this.data;if(null!==i){if(i.JD(this),null!==s&&null!==n&&!s.undoManager.isUndoingRedoing){const o=i.data,r=s.model;if(null!==o&&r.Wh()){const a=r.getKeyForNodeData(n);void 0!==a&&r.removeLabelKeyForLinkData(o,a)}}this.containingGroup=null}if(this.Xf=t,null!==t){if(t.WD(this),null!==s&&null!==n&&!s.undoManager.isUndoingRedoing){const o=t.data,r=s.model;if(null!==o&&r.Wh()){const a=r.getKeyForNodeData(n);void 0!==a&&r.addLabelKeyForLinkData(o,a)}}this.containingGroup=t.containingGroup}this.Pf(),this.t("labeledLink",i,t)}}findVisiblePort(t){let i=t;for(;!(null===i||i.actualBounds.isReal()&&i.isVisibleObject());)i=i.panel;return null===i?this.port:i}findPort(t){if(null===this.ci){if(""===t&&!1===this.Ln)return this;this.$D()}let i=this.ci.get(t);return null!==i||""!==t&&(i=this.ci.get(""),null!==i)?i:this}get port(){return this.findPort("")}get ports(){return null===this.ci&&this.$D(),this.ci.iteratorValues}$D(){null===this.ci?this.ci=new xt:this.ci.clear(),this.walkVisualTreeFrom(this,(t,i)=>t.sD(i)),0===this.ci.count&&this.ci.set("",this)}sD(t){const i=t.portId;null!==i&&null!==this.ci&&this.ci.set(i,t)}FN(t,i){const s=t.portId;if(null!==s){null!==this.ci&&this.ci.delete(s);const n=this.diagram;if(null!==n&&i){let o=null;const r=this.findLinksConnected(s);for(;r.next();){const a=r.value;null===o&&(o=y.nt()),o.push(a)}if(null!==o){for(let a=0;a<o.length;a++)n.remove(o[a]);y.Z(o)}}}}isInTreeOf(t){if(null===t||t===this)return!1;let i=!0;const s=this.diagram;null!==s&&(i=s.isTreePathToChildren);let n=this;const o=t;let r;if(i)for(;n!==o;){r=null;const a=n.ee.iterator;for(;a.next();){const l=a.value;if(l.isTreeLink&&(r=l.fromNode,r!==n&&r!==this))break}if(r===this||null===r||r===n)return!1;n=r}else for(;n!==o;){r=null;const a=n.ee.iterator;for(;a.next();){const l=a.value;if(l.isTreeLink&&(r=l.toNode,r!==n&&r!==this))break}if(r===this||null===r||r===n)return!1;n=r}return!0}findTreeRoot(){let t=!0;const i=this.diagram;null!==i&&(t=i.isTreePathToChildren);let n,s=this;if(t)for(;;){n=null;const o=s.ee.iterator;for(;o.next();){const r=o.value;if(r.isTreeLink&&(n=r.fromNode,n!==s&&n!==this))break}if(n===this)return this;if(null===n||n===s)return s;s=n}else for(;;){n=null;const o=s.ee.iterator;for(;o.next();){const r=o.value;if(r.isTreeLink&&(n=r.toNode,n!==s&&n!==this))break}if(n===this)return this;if(null===n||n===s)return s;s=n}}findCommonTreeParent(t){if(null===t)return null;if(this===t)return this;let i=this;for(;null!==i;)i.ck(!0),i=i.findTreeParentNode();let s=null;for(i=t;null!==i;){if(i.XD()){s=i;break}i=i.findTreeParentNode()}for(i=this;null!==i;)i.ck(!1),i=i.findTreeParentNode();return s}findTreeParentLink(){let t=!0;const i=this.diagram;null!==i&&(t=i.isTreePathToChildren);const s=this.ee.iterator;if(t)for(;s.next();){const n=s.value;if(n.isTreeLink&&n.fromNode!==this)return n}else for(;s.next();){const n=s.value;if(n.isTreeLink&&n.toNode!==this)return n}return null}findTreeParentNode(){const t=this.Da;if(null===t)return null;if(t instanceof m)return t;const i=this.diagram,s=null===i||i.isTreePathToChildren,n=this.ee.iterator;for(;n.next();){const o=n.value;if(!o.isTreeLink)continue;const r=s?o.fromNode:o.toNode;if(r!==this)return this.Da=r,r}return this.Da=null,null}findTreeParentChain(t){return void 0===t&&(t=new z),function i(s,n){n.add(s);const o=s.findTreeParentLink();if(null!==o){n.add(o);const r=s.findTreeParentNode();if(null===r)return;i(r,n)}}(this,t),t}findTreeLevel(){return this.SE(this)}SE(t){let i=0,s=t.findTreeParentNode();for(;null!==s&&s!==t;)s=s.findTreeParentNode(),i++;return i}findTreeChildrenLinks(){let t=!0;const i=this.diagram;null!==i&&(t=i.isTreePathToChildren);const s=new q(this.ee),n=this;return s.predicate=t?o=>!(!o.isTreeLink||o.fromNode!==n):o=>!(!o.isTreeLink||o.toNode!==n),s}findTreeChildrenNodes(){let t=!0;const i=this.diagram;null!==i&&(t=i.isTreePathToChildren);let s=null,n=null;const o=this.ee.iterator;if(t)for(;o.next();){const r=o.value;if(r.isTreeLink&&r.fromNode===this){const a=r.toNode;null!==s?s.add(a):null!==n&&n!==a?(s=new H,s.add(n),s.add(a)):n=a}}else for(;o.next();){const r=o.value;if(r.isTreeLink&&r.toNode===this){const a=r.fromNode;null!==s?s.add(a):null!==n&&n!==a?(s=new H,s.add(n),s.add(a)):n=a}}return null!==s?s.iterator:null!==n?new G(n):O.instance}findTreeParts(t,i){return void 0===t&&(t=1/0),y.s(t,"number",m,"findTreeParts:level"),void 0===i&&(i=new z),At.ga(i,this,!1,t,!0),i}collapseTree(t){void 0===t&&(t=1),t<1&&(t=1);const i=this.diagram;if(null===i||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new z;s.add(this),this.ZD(s,i.isTreePathToChildren,t,i,this,1===i.treeCollapsePolicy),i.isCollapsingExpanding=!1}ZD(t,i,s,n,o,r){if(s>1){const a=i?this.findLinksOutOf():this.findLinksInto();for(;a.next();){const l=a.value;if(!l.isTreeLink)continue;const h=l.getOtherNode(this);null!==h&&h!==this&&!t.has(h)&&(t.add(h),h.ZD(t,i,s-1,n,o,r))}}else this.QD(t,i,n,o,r)}QD(t,i,s,n,o){const r=n===this||this.isTreeExpanded,a=i?this.findLinksOutOf():this.findLinksInto();for(;a.next();){const l=a.value;if(!l.isTreeLink)continue;const h=l.getOtherNode(this);if(null!==h&&h!==this){const c=t.has(h);if(c||t.add(h),r){const u=i?h.findNodesInto():h.findNodesOutOf(),d=this;u.all(f=>f===d||!f.isTreeExpanded)&&s.Kc(h,n),h.Sa(),h.Xe(!1)}h.isTreeExpanded&&(h.wasTreeExpanded=h.isTreeExpanded,c||h.QD(t,i,s,n,o))}}this.isTreeExpanded=!1}expandTree(t){void 0===t&&(t=2),t<2&&(t=2);const i=this.diagram;if(null===i||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new z;s.add(this),this._D(s,i.isTreePathToChildren,t,i,this,1===i.treeCollapsePolicy),i.isCollapsingExpanding=!1}_D(t,i,s,n,o,r){const a=o!==this&&this.isTreeExpanded,l=i?this.findLinksOutOf():this.findLinksInto();for(;l.next();){const h=l.value;if(!h.isTreeLink)continue;a||h.Fi||h.$t();const c=h.getOtherNode(this);if(null!==c&&c!==this&&!t.has(c)){if(t.add(c),!a){c.Xe(!0),c.Sa();const u=i?c.findNodesInto():c.findNodesOutOf(),d=this;u.all(f=>f===d||!f.isTreeExpanded)&&n.Yc(c,o)}(s>2||c.wasTreeExpanded)&&(c.wasTreeExpanded=!1,c._D(t,i,s-1,n,o,r))}}this.isTreeExpanded=!0}get isTreeExpanded(){return!!(1&this.E)}set isTreeExpanded(t){const i=!!(1&this.E);if(i!==t){this.E=1^this.E;const s=this.diagram;this.t("isTreeExpanded",i,t);const n=this.treeExpandedChanged;if(null!==n){let o=!0;null!==s&&(o=s.G,s.G=!0),n(this),null!==s&&(s.G=o)}if(null!==s&&s.undoManager.isUndoingRedoing)return void this.Xe(t);t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return!!(2&this.E)}set wasTreeExpanded(t){const i=!!(2&this.E);i!==t&&(this.E=2^this.E,this.t("wasTreeExpanded",i,t))}get treeExpandedChanged(){return null!==this.vt?this.vt.qy:null}set treeExpandedChanged(t){const i=this.treeExpandedChanged;i!==t&&(null!==t&&y.S(t,m,"treeExpandedChanged"),this.wl().qy=t,this.t("treeExpandedChanged",i,t))}get isTreeLeaf(){return!!(4&this.E)}set isTreeLeaf(t){const i=!!(4&this.E);i!==t&&(this.E=4^this.E,this.t("isTreeLeaf",i,t))}get isTreeRoot(){return null===this.findTreeParentLink()}}return m})();class Ui{me;Hy;jy;El;qy;Ky;Yy;Wy;Jy;da;$y;constructor(){this.me=!1,this.Hy=null,this.jy=null,this.El=null,this.qy=null,this.Ky=It.BL,this.Yy=1,this.Wy=null,this.Jy=null,this.da=null,this.$y=null}copy(){const e=new Ui;return e.Hy=this.Hy,e.jy=this.jy,e.El=this.El,e.qy=this.qy,e.Ky=this.Ky.N(),e.Yy=this.Yy,e.Wy=this.Wy,e.Jy=this.Jy,e.da=this.da,e.$y=this.$y,e}}var Hi=(m=>(m[m.None=0]="None",m[m.End=17]="End",m[m.Scale=18]="Scale",m[m.Stretch=19]="Stretch",m))(Hi||{}),qi=(m=>(m[m.Normal=1]="Normal",m[m.Orthogonal=2]="Orthogonal",m[m.AvoidsNodes=6]="AvoidsNodes",m[m.AvoidsNodesStraight=7]="AvoidsNodesStraight",m))(qi||{}),Wi=(m=>(m[m.None=0]="None",m[m.Bezier=9]="Bezier",m[m.JumpGap=10]="JumpGap",m[m.JumpOver=11]="JumpOver",m))(Wi||{});let gt=(()=>{class m extends At{Mt;po;yo;$d;wo;xo;Zd;Gf;Qd;_d;tg;Jh;eg;on;Me;xl;vr;va;ir;wC;xC;gk;bC;kC;$h;mk;ut;sr;static Zh=null;static Qh=null;Af;PC;SC;constructor(t){super(J.Link),this.Mt=8,this.po=null,this.yo="",this.$d=null,this.wo=null,this.xo="",this.Zd=null,this.Gf=0,this.Qd=0,this._d=0,this.tg=NaN,this.Jh=1,this.eg=.5,this.on=null,this.Me=(new H).k(),this.xl=null,this.vr=null,this.va=new j,this.ut=new Ct,this.ir=null,this.sr=null,this.wC=S.mn,this.xC=S.mn,this.PC=0,this.SC=0,this.gk=new S,this.bC=null,this.kC=null,this.$h=null,this.mk=NaN,this.ft=null,this.Af=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Mt=-113&this.Mt,t.yo=this.yo,t.$d=this.$d,t.xo=this.xo,t.Zd=this.Zd,t.Gf=this.Gf,t.Qd=this.Qd,t._d=this._d,t.tg=this.tg,t.Jh=this.Jh,t.eg=this.eg,null!==this.ft&&(t.ft=this.ft.copy())}jo(t){super.jo(t),this.yo=t.yo,this.xo=t.xo,t.xl=null,t.$t(),t.sr=this.sr;const i=t.fromPort;null!==i&&t.fromNode.Ze(i);const s=t.toPort;null!==s&&t.toNode.Ze(s)}fe(t){t in qi||t in Wi||t in Hi?m.MC(t)?this.routing=t:9===t||10===t||11===t?this.curve=t:17===t||18===t||19===t?this.adjusting=t:1===t||0===t||y.o("Unknown Link enum value for a Link property: "+t):super.fe(t)}static Normal=1;static Orthogonal=2;static AvoidsNodes=6;static AvoidsNodesStraight=7;static None=0;static Bezier=9;static JumpGap=10;static JumpOver=11;static End=17;static Scale=18;static Stretch=19;static OrientAlong=21;static OrientPlus90=22;static OrientMinus90=23;static OrientOpposite=24;static OrientUpright=25;static OrientPlus90Upright=26;static OrientMinus90Upright=27;static OrientUpright45=28;static tv=8;static ev=16;static Fa=8;static J1=3;static iv=3;static sv=1.333;static NC=1;static CC=0;static nv=10;static Yf=9999;static ov=30;static rv=30;static LC=10;static lv=10;static av=14;static hv=30;static cv=14;static _A=8;static tT=8;static fv=11;static setRoutingParameter(t,i){switch(t){case 1:m.tv=i;break;case 2:m.ev=i;break;case 3:m.Fa=i;break;case 4:m.J1=i;break;case 5:m.iv=i;break;case 6:m.sv=i;break;case 7:m.NC=i;break;case 8:m.CC=i;break;case 9:m.nv=i;break;case 10:m.Yf=i;break;case 11:m.ov=i;break;case 12:m.rv=i;break;case 13:m.LC=i;break;case 14:m.lv=i;break;case 15:m.av=i;break;case 16:m.hv=i;break;case 17:m.cv=i;break;case 18:m._A=i;break;case 19:m.tT=i;break;case 20:m.fv=i}t>29&&t<71&&(m.IT=t+parseInt(i.toString().slice(0,-1)))}static IT;Ji(){return null===this.ft&&(this.ft=new Ti),this.ft}II(t,i,s){const n=t.segmentIndex,o=t.segmentFraction;let r=t.alignmentFocus;const a=t.segmentOrientation,l=t.segmentOffset;let h=0,c=0,u=0,d=0;if(isNaN(n)){const T=this.ut,D=y.nt();T.getPointAndAngleAlongPath(o,D);const F=S.z(D[0],D[1]);if(d=D[2],F.add(this.getPoint(0)),1===T.type)F.offset(-T.startX,-T.startY);else{const E=T.figures.first();F.offset(-E.startX,-E.startY)}0!==a&&(u=this.computeAngle(t,a,d),t.angle=u),h=F.x,c=F.y,S.i(F),y.Z(D)}else if(n<-i||n>=i){const T=S.l();this.HN(T),d=this.midAngle,0!==a&&(u=this.computeAngle(t,a,d),t.angle=u),h=T.x,c=T.y,S.i(T)}else{let T,D,F=0;if(n>=0?(T=s.r[n],D=n<i-1?s.r[n+1]:T):(F=i+n,T=s.r[F],D=F>0?s.r[F-1]:T),T.equalsApprox(D)){let E,B;n>=0?(E=n>0?s.r[n-1]:T,B=n<i-2?s.r[n+2]:D):(E=F<i-1?s.r[F+1]:T,B=F>1?s.r[F-2]:D);const Y=E.distanceSquaredPoint(T),W=D.distanceSquaredPoint(B);d=Y>W+10?n>=0?E.directionPoint(T):T.directionPoint(E):W>Y+10?n>=0?D.directionPoint(B):B.directionPoint(D):n>=0?E.directionPoint(B):B.directionPoint(E)}else d=n>=0?T.directionPoint(D):D.directionPoint(T);0!==a&&(u=this.computeAngle(t,a,d),t.angle=u),h=T.x+(D.x-T.x)*o,c=T.y+(D.y-T.y)*o}if(r.isNone())return void t.moveTo(h,c,!0);r.isNoSpot()&&(r=A.Center);const f=Ot.l();f.Ue(),f.it(t.scale,t.scale),f.ks(t.angle,0,0);const p=t.naturalBounds,g=j.z(0,0,p.width,p.height),b=S.l();b.setRectSpot(g,r),f.gt(b);let x=-b.x,v=-b.y;const P=p.width,w=p.height,M=S.bs(l),C=isNaN(l.x),N=isNaN(l.y);if(C||N){const T=P/2+m.J1,D=w/2+m.iv,F=d>=45&&d<=135,E=d>=225&&d<=315;0===a&&(F||E)?(M.x=N?T:l.y,M.y=C?D:l.x,F?n>=0||isNaN(n)&&o<.5||C&&(M.y=-D):E&&((n>=0||isNaN(n)&&o<.5)&&C&&(M.y=-D),N&&(M.x=-T))):(C&&(M.x=n>=0||isNaN(n)&&o<.5?T:-T),N&&(M.y=-D),M.rotate(d))}else M.rotate(d);h+=M.x,c+=M.y,f.sm(g),x+=g.x,v+=g.y;const I=S.z(h+x,c+v);t.move(I),S.i(I),S.i(M),S.i(b),j.i(g),Ot.i(f)}_r(){let t=this.fromNode;if(null!==t){const s=t.findVisibleNode();if(null!==s&&(t=s),t.as()||t.fa())return!1}let i=this.toNode;if(null!==i){const s=i.findVisibleNode();if(null!==s&&(i=s),i.as()||i.fa())return!1}return!0}DN(t,i,s){return!1}vN(){}Di(){return!1}computeAngle(t,i,s){return m.computeAngle(i,s)}static computeAngle(t,i){let s=0;switch(t){default:case 0:s=0;break;case 21:s=i;break;case 22:s=i+90;break;case 23:s=i-90;break;case 24:s=i+180;break;case 25:s=L.Ee(i),s>90&&s<270&&(s-=180);break;case 26:s=L.Ee(i+90),s>90&&s<270&&(s-=180);break;case 27:s=L.Ee(i-90),s>90&&s<270&&(s-=180);break;case 28:if(s=L.Ee(i),s>45&&s<135||s>225&&s<315)return 0;s>90&&s<270&&(s-=180)}return L.Ee(s)}get fromNode(){return this.po}set fromNode(t){const i=this.po;if(i!==t){const s=this.fromPort;null!==i&&(this.wo!==i&&i.dk(this,s),this.Zy(),this.invalidateLayout(2)),this.po=t,null!==t&&this.Xe(t.isVisible()),this.ir=null,this.$t();const n=this.diagram;null!==n&&n.G&&n.partManager.setFromNodeForLink(this,t,i);const o=this.fromPort,r=this.fromPortChanged;if(null!==r){let a=!0;null!==n&&(a=n.G,n.G=!0),r(this,s,o),null!==n&&(n.G=a)}null!==t&&(this.wo!==t&&t.uk(this,o),this.Qy(),this.invalidateLayout(1)),this.t("fromNode",i,t),this.Wd()}}get fromPortId(){return this.yo}set fromPortId(t){const i=this.yo;if(i!==t){const s=this.fromPort;null!==s&&this.fromNode?.Ze(s),this.Zy(),this.yo=t;const n=this.fromPort;null!==n&&this.fromNode?.Ze(n);const o=this.diagram;if(null!==o){const r=this.data,a=o.model;null!==r&&a.Wh()&&a.setFromPortIdForLinkData(r,t)}if(s!==n){this.ir=null,this.$t();const r=this.fromPortChanged;if(null!==r){let a=!0;null!==o&&(a=o.G,o.G=!0),r(this,s,n),null!==o&&(o.G=a)}}this.Qy(),this.t("fromPortId",i,t)}}get fromPort(){const t=this.po;return null===t?null:t.findPort(this.yo)}get fromPortChanged(){return this.$d}set fromPortChanged(t){const i=this.$d;i!==t&&(null!==t&&y.S(t,m,"fromPortChanged"),this.$d=t,this.t("fromPortChanged",i,t))}get toNode(){return this.wo}set toNode(t){const i=this.wo;if(i!==t){const s=this.toPort;null!==i&&(this.po!==i&&i.dk(this,s),this.Zy(),this.invalidateLayout(2)),this.wo=t,null!==t&&this.Xe(t.isVisible()),this.ir=null,this.$t();const n=this.diagram;null!==n&&n.G&&n.partManager.setToNodeForLink(this,t,i);const o=this.toPort,r=this.toPortChanged;if(null!==r){let a=!0;null!==n&&(a=n.G,n.G=!0),r(this,s,o),null!==n&&(n.G=a)}null!==t&&(this.po!==t&&t.uk(this,o),this.Qy(),this.invalidateLayout(1)),this.t("toNode",i,t),this.Wd()}}get toPortId(){return this.xo}set toPortId(t){const i=this.xo;if(i!==t){const s=this.toPort;null!==s&&this.toNode?.Ze(s),this.Zy(),this.xo=t;const n=this.toPort;null!==n&&this.toNode?.Ze(n);const o=this.diagram;if(null!==o){const r=this.data,a=o.model;null!==r&&a.Wh()&&a.setToPortIdForLinkData(r,t)}if(s!==n){this.ir=null,this.$t();const r=this.toPortChanged;if(null!==r){let a=!0;null!==o&&(a=o.G,o.G=!0),r(this,s,n),null!==o&&(o.G=a)}}this.Qy(),this.t("toPortId",i,t)}}get toPort(){const t=this.wo;return null===t?null:t.findPort(this.xo)}get toPortChanged(){return this.Zd}set toPortChanged(t){const i=this.Zd;i!==t&&(null!==t&&y.S(t,m,"toPortChanged"),this.Zd=t,this.t("toPortChanged",i,t))}get fromSpot(){return null!==this.ft?this.ft.Dh:A.Default}set fromSpot(t){const i=this.fromSpot;if(!i.equals(t)){if(t=t.N(),this.Ji().Dh=t,this.t("fromSpot",i,t),i.isSide()||t.isSide()){const s=this.fromNode;null!==s&&s.Ze(this.fromPort)}this.$t()}}get fromEndSegmentLength(){return null!==this.ft?this.ft.Fh:NaN}set fromEndSegmentLength(t){const i=this.fromEndSegmentLength;if(i!==t){if(t<0&&y.J(t,">= 0",m,"fromEndSegmentLength"),this.Ji().Fh=t,this.t("fromEndSegmentLength",i,t),this.computeSpot(!0,this.fromPort).isSide()){const s=this.fromNode;null!==s&&s.Ze(this.fromPort)}this.$t()}}get fromShortLength(){return null!==this.ft?this.ft.Oh:NaN}set fromShortLength(t){const i=this.fromShortLength;i!==t&&(this.Ji().Oh=t,this.ai(),this.t("fromShortLength",i,t))}get toSpot(){return null!==this.ft?this.ft.vh:A.Default}set toSpot(t){const i=this.toSpot;if(!i.equals(t)){if(t=t.N(),this.Ji().vh=t,this.t("toSpot",i,t),i.isSide()||t.isSide()){const s=this.toNode;null!==s&&s.Ze(this.toPort)}this.$t()}}get toEndSegmentLength(){return null!==this.ft?this.ft.Rh:NaN}set toEndSegmentLength(t){const i=this.toEndSegmentLength;if(i!==t){if(t<0&&y.J(t,">= 0",m,"toEndSegmentLength"),this.Ji().Rh=t,this.t("toEndSegmentLength",i,t),this.computeSpot(!1,this.toPort).isSide()){const s=this.toNode;null!==s&&s.Ze(this.toPort)}this.$t()}}get toShortLength(){return null!==this.ft?this.ft.Ih:NaN}set toShortLength(t){const i=this.toShortLength;i!==t&&(this.Ji().Ih=t,this.ai(),this.t("toShortLength",i,t))}Wd(){const t=this.fromNode,i=this.toNode;let s=null;if(s=null!==t?null!==i?t.findCommonContainingGroup(i):t.containingGroup:null!==i?i.containingGroup:null,this.ME(s),this.isLabeledLink){const n=this.labelNodes;for(;n.next();)n.value.containingGroup=s}}ME(t){const i=this.Ta;if(i!==t){null!==i&&i.fC(this),this.Ta=t,null!==t&&t.uC(this);const s=this.containingGroupChanged;if(null!==s){let n=!0;const o=this.diagram;null!==o&&(n=o.G,o.G=!0),s(this,i,t),null!==o&&(o.G=n)}this.Fi&&(this.bC===i||this.kC===i)&&this.$t()}}Sa(){const t=this.containingGroup;null!==t&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.Sa()}getOtherNode(t){const i=this.fromNode;return t===i?this.toNode:i}getOtherPort(t){const i=this.fromPort;return t===i?this.toPort:i}get isLabeledLink(){return null!==this.on&&this.on.count>0}get labelNodes(){return null===this.on?O.instance:this.on.iterator}WD(t){null===this.on&&(this.on=new z),this.on.add(t),this.c()}JD(t){null!==this.on&&(this.on.delete(t),this.c())}tp(t){if(super.tp(t),this._h()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.po;let s=null;null!==i&&(s=this.fromPort,i.uk(this,s));const n=this.wo;let o=null;null!==n&&(o=this.toPort,(n!==i||o!==s)&&n.uk(this,o)),this.Qy()}}ep(t){if(super.ep(t),this._h()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.po;let s=null;null!==i&&(s=this.fromPort,i.dk(this,s));const n=this.wo;let o=null;null!==n&&(o=this.toPort,(n!==i||o!==s)&&n.dk(this,o)),this.Zy()}}lf(){if(this.Fi=!0,null!==this.on){const t=this.diagram;if(null!==t){const i=this.on.copy().iterator;for(;i.next();)t.remove(i.value)}}if(null!==this.data){const t=this.diagram;null!==t&&t.partManager.AC(this)}}updateRelationshipsFromData(){if(null===this.data)return;const t=this.diagram;null!==t&&t.partManager.updateRelationshipsFromData(this)}move(t,i){const s=i?this.location:this.position;let n=s.x;isNaN(n)&&(n=0);let o=s.y;isNaN(o)&&(o=0);const r=t.x-n,a=t.y-o;if(!0===i)super.move(t,!1);else{const h=S.z(s.x+r,s.y+a);super.move(h,!1),S.i(h)}this.Pr(r,a);const l=this.labelNodes;for(;l.next();){const h=l.value,c=h.position;h.moveTo(c.x+r,c.y+a)}}get relinkableFrom(){return!!(1&this.Mt)}set relinkableFrom(t){const i=!!(1&this.Mt);i!==t&&(this.Mt=1^this.Mt,this.t("relinkableFrom",i,t),this.invalidateAdornments())}get relinkableTo(){return!!(2&this.Mt)}set relinkableTo(t){const i=!!(2&this.Mt);i!==t&&(this.Mt=2^this.Mt,this.t("relinkableTo",i,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(null!==i&&!i.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(null!==i&&!i.allowRelink)}get resegmentable(){return!!(4&this.Mt)}set resegmentable(t){const i=!!(4&this.Mt);i!==t&&(this.Mt=4^this.Mt,this.t("resegmentable",i,t),this.invalidateAdornments())}get isTreeLink(){return!!(8&this.Mt)}set isTreeLink(t){const i=!!(8&this.Mt);i!==t&&(this.Mt=8^this.Mt,this.t("isTreeLink",i,t),null!==this.fromNode&&this.fromNode.vp(),null!==this.toNode&&this.toNode.vp())}get path(){const t=this.findMainElement();return t instanceof rt?t:null}get routeBounds(){return this.updateRoute(),this.va}uv(t){let i=1/0,s=1/0;const n=this.pointsCount;if(0===n)return t.e(NaN,NaN,0,0),t;if(1===n){const o=this.getPoint(0);i=Math.min(o.x,i),s=Math.min(o.y,s),t.e(o.x,o.y,0,0)}else if(2===n){const o=this.getPoint(0),r=this.getPoint(1);i=Math.min(o.x,r.x),s=Math.min(o.y,r.y),t.e(o.x,o.y,0,0),t.unionPoint(r)}else if(9===this.computeCurve()&&n>=3&&!this.isOrthogonal){let o=this.getPoint(0);if(i=o.x,s=o.y,t.e(i,s,0,0),3===n){const r=this.getPoint(1);i=Math.min(r.x,i),s=Math.min(r.y,s);const a=this.getPoint(2);i=Math.min(a.x,i),s=Math.min(a.y,s),L.Nu(o.x,o.y,r.x,r.y,r.x,r.y,a.x,a.y,.5,t)}else for(let r=3;r<n;r+=3){const a=this.getPoint(r-2);r+3>=n&&(r=n-1);const l=this.getPoint(r-1),h=this.getPoint(r);L.Nu(o.x,o.y,a.x,a.y,l.x,l.y,h.x,h.y,.5,t),i=Math.min(h.x,i),s=Math.min(h.y,s),o=h}}else{const o=this.getPoint(0),r=this.getPoint(1);i=Math.min(o.x,r.x),s=Math.min(o.y,r.y),t.e(o.x,o.y,0,0),t.unionPoint(r);for(let a=2;a<n;a++){const l=this.getPoint(a);i=Math.min(l.x,i),s=Math.min(l.y,s),t.unionPoint(l)}}return this.gk.e(i-t.x,s-t.y),t}get midPoint(){return this.HN(new S)}HN(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){const i=this.pointsCount;if(0===i)return t.h(S.mn),t;if(1===i)return t.h(this.getPoint(0)),t;if(2===i){const c=this.getPoint(0),u=this.getPoint(1);return t.e((c.x+u.x)/2,(c.y+u.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||9===this.computeCurve())){this.ut.getPointAlongPath(.5,t),t.add(this.getPoint(0));const c=this.ut.figures.first();return t.offset(-c.startX,-c.startY),t}if(9===this.computeCurve()){if(3===i){const d=this.getPoint(0),f=this.getPoint(1),p=this.getPoint(2);return L.YL(d.x,d.y,f.x,f.y,f.x,f.y,p.x,p.y,t),t}const c=(i-1)/3|0,u=3*(c/2|0);if(c%2==1){const d=this.getPoint(u),f=this.getPoint(u+1),p=this.getPoint(u+2),g=this.getPoint(u+3);return L.YL(d.x,d.y,f.x,f.y,p.x,p.y,g.x,g.y,t),t}return t.h(this.getPoint(u)),t}const s=this.flattenedLengths,n=this.flattenedTotalLength;let o=0,r=0,a=0;for(;o<n/2&&r<i&&(a=s[r],!(o+a>n/2));)o+=a,r++;const l=this.getPoint(r),h=this.getPoint(r+1);if(Math.abs(l.x-h.x)<1)t.e(l.x,l.y>h.y?l.y-(n/2-o):l.y+(n/2-o));else if(Math.abs(l.y-h.y)<1)t.e(l.x>h.x?l.x-(n/2-o):l.x+(n/2-o),l.y);else{const c=(n/2-o)/a;t.e(l.x+c*(h.x-l.x),l.y+c*(h.y-l.y))}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){const t=this.pointsCount;if(t<2)return NaN;if(2===t){const h=this.getPoint(0),c=this.getPoint(1);return h.directionPoint(c)}if(this.isOrthogonal&&(this.computeCorner()>=15||9===this.computeCurve()))return this.ut.getAngleAlongPath(.5);if(9===this.computeCurve()&&t>=4){const h=(t-1)/3|0;let c=3*(h/2|0);if(h%2==1){c=Math.floor(c);const u=this.getPoint(c),d=this.getPoint(c+1),f=this.getPoint(c+2),p=this.getPoint(c+3);return L.HF(u.x,u.y,d.x,d.y,f.x,f.y,p.x,p.y)}if(c>0&&c+1<t){const u=this.getPoint(c-1),d=this.getPoint(c+1);return u.directionPoint(d)}}const i=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,o=0,r=0;for(;n<s/2&&o<t&&(r=i[o],!(n+r>s/2));)n+=r,o++;const a=this.getPoint(o),l=this.getPoint(o+1);if(Math.abs(a.x-l.x)<.5&&Math.abs(a.y-l.y)<m.NC){if(o>0&&o<t-2){const h=this.getPoint(o-1),c=this.getPoint(o+2);return h.x<c.x?0:h.x>c.x?180:h.y<c.y?90:270}}else if(Math.abs(a.y-l.y)<.5&&Math.abs(a.x-l.x)<m.NC&&o>0&&o<t-2){const h=this.getPoint(o-1),c=this.getPoint(o+2);return h.y<c.y?90:h.y>c.y?270:h.x<c.x?0:180}return a.directionPoint(l)}get flattenedLengths(){return null!==this.$h?this.$h:(this.Fi||this.pk(),this.NE())}get flattenedTotalLength(){let t=this.mk;if(isNaN(t)){const i=this.flattenedLengths,s=i.length;t=0;for(let n=0;n<s;n++)t+=i[n];this.mk=t}return t}NE(){null===this.$h?this.$h=[]:this.$h.length=0;const t=this.$h,i=this.pointsCount;for(let s=0;s<i-1;s++){let n=0;const o=this.getPoint(s),r=this.getPoint(s+1);L.X(o.x,r.x)?(n=r.y-o.y,n<0&&(n=-n),t.push(n)):L.X(o.y,r.y)?(n=r.x-o.x,n<0&&(n=-n),t.push(n)):(n=Math.sqrt(o.distanceSquaredPoint(r)),t.push(n))}return t}get points(){return this.Me}set points(t){const i=this.Me;if(i===t)return;let s=null;if(Array.isArray(t))s=this.convertPointsArrayToList(t);else if(t instanceof H){s=t.copy();const o=s.iterator;for(;o.next();)o.value.k()}else y.o("Link.points value is not an instance of List or Array: "+t);if(null===s)return;s.k(),this.Me=s,this.ai(),this.pk();const n=this.diagram;null!==n&&(!n.Qa&&!n.undoManager.isUndoingRedoing&&n.nb.add(this),n.animationManager.ke&&n.animationManager.AM(this,s)),this.t("points",i,s)}convertPointsArrayToList(t){let i=null,s=t.length%2==0;if(s)for(let n=0;n<t.length;n++)if("number"!=typeof t[n]||isNaN(t[n])){s=!1;break}if(s){i=new H;for(let n=0;n<t.length/2;n++)i.add(new S(t[2*n],t[2*n+1]).k())}else{let n=!0;for(let o=0;o<t.length;o++){const r=t[o];if(!y.$(r)||"number"!=typeof r.x||isNaN(r.x)||"number"!=typeof r.y||isNaN(r.y)){n=!1;break}}if(n){i=new H;for(let o=0;o<t.length;o++){const r=t[o];i.add(new S(r.x,r.y).k())}}}return i}get pointsCount(){return this.Me.count}getPoint(t){return this.Me.r[t]}setPoint(t,i){this.Me.setElt(t,i)}setPointAt(t,i,s){this.Me.setElt(t,new S(i,s))}insertPoint(t,i){this.Me.insertAt(t,i)}insertPointAt(t,i,s){this.Me.insertAt(t,new S(i,s))}addPoint(t){this.Me.add(t)}addPointAt(t,i){this.Me.add(new S(t,i))}removePoint(t){this.Me.removeAt(t)}clearPoints(){this.Me.clear()}Pr(t,i){if(0===t&&0===i)return;if(0===this.pointsCount)return this.defaultFromPoint.isReal()&&this.defaultFromPoint.offset(t,i),void(this.defaultToPoint.isReal()&&this.defaultToPoint.offset(t,i));const s=this.Fi,n=new H,o=this.Me.iterator;for(;o.next();){const l=o.value;n.add(new S(l.x+t,l.y+i).k())}n.k();const r=this.Me;this.Me=n;const a=this.diagram;isNaN(t)||isNaN(i)||null!==a&&a.animationManager.ke?this.c():(this.nn.e(this.nn.x+t,this.nn.y+i),this.ct.e(this.ct.x+t,this.ct.y+i),this.Pf()),s?this.pk():(this.defaultFromPoint.isReal()&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint.isReal()&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),null!==a&&a.animationManager.ke&&a.animationManager.AM(this,n),this.t("points",r,n)}startRoute(){null===this.xl&&(this.xl=this.Me,this.Me=this.Me.copy())}commitRoute(){if(null===this.xl)return;const t=this.xl,i=this.Me;this.xl=null;const s=this.diagram;null!==s&&s.animationManager.ke&&s.animationManager.AM(this,i),this.ai(),this.pk(),this.t("points",t,i)}rollbackRoute(){null!==this.xl&&(this.Me=this.xl,this.xl=null,this.uv(this.va))}DR(){null!==this.vr&&(this.points=this.vr,this.vr=null)}pk(){0!==this.Me.count?(this.Fi=!0,this.uv(this.va),this.$h=null,this.mk=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.yk(!1)):this.Fi=!1}invalidateRoute(){this.$t()}$t(){if(this.suspendsRouting)return;const t=this.path;if(null===t)return;const i=this.diagram;if(i){if(i.nb.has(this)||i.undoManager.isUndoingRedoing)return;const s=i.animationManager;if(s.isTicking&&!s.isAnimating)return;null!==this.vr&&!s.isTicking&&(this.vr=null)}this.Fi=!1,this.c(),t.c()}get Fi(){return!!(16&this.Mt)}set Fi(t){!!(16&this.Mt)!==t&&(this.Mt=16^this.Mt)}get suspendsRouting(){return!!(32&this.Mt)}set suspendsRouting(t){!!(32&this.Mt)!==t&&(this.Mt=32^this.Mt)}get _y(){return!!(64&this.Mt)}set _y(t){!!(64&this.Mt)!==t&&(this.Mt=64^this.Mt)}get TC(){return!!(512&this.Mt)}set TC(t){!!(512&this.Mt)!==t&&(this.Mt=512^this.Mt)}get defaultFromPoint(){return this.wC}set defaultFromPoint(t){this.wC=t&&t.isReal()?t.copy():S.mn}get defaultToPoint(){return this.xC}set defaultToPoint(t){this.xC=t&&t.isReal()?t.copy():S.mn}updateRoute(){if(this.Fi||this._y)return;let t=!0;try{this._y=!0,this.startRoute(),t=this.computePoints()}catch{this._y=!1,this.rollbackRoute()}finally{this._y=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){const t=this.diagram;if(null===t)return!1;let i=this.fromNode,s=null;if(null===i?(m.Zh||(m.Zh=new nt,m.Zh.desiredSize=lt.bc,m.Zh.ensureBounds()),this.defaultFromPoint.isReal()&&(m.Zh.location=this.defaultFromPoint,m.Zh.ensureBounds(),i=m.Zh,s=m.Zh)):s=this.fromPort,null!==s&&!i.isVisible()){const g=i.findVisibleNode();null!==g&&g!==i?(i=g,s=g.port):i=g}if(this.bC=i,null===i||!i.location.isReal()||null===s||(s=i.findVisiblePort(s),null===s))return!1;let n=this.toNode,o=null;if(null===n?(m.Qh||(m.Qh=new nt,m.Qh.desiredSize=lt.bc,m.Qh.ensureBounds()),this.defaultToPoint.isReal()&&(m.Qh.location=this.defaultToPoint,m.Qh.ensureBounds(),n=m.Qh,o=m.Qh)):o=this.toPort,null!==o&&!n.isVisible()){const g=n.findVisibleNode();null!==g&&g!==n?(n=g,o=g.port):n=g}if(this.kC=n,null===n||!n.location.isReal()||null===o||(o=n.findVisiblePort(o),null===o))return!1;const r=this.pointsCount,a=this.computeSpot(!0,s),l=this.computeSpot(!1,o),h=this.bl(a),c=this.bl(l),u=s===o&&null!==s,d=this.isOrthogonal;let f=9===this.curve;u&&!d?(f=!0,this.ir=!0):this.ir=!1;const p=0===this.computeAdjusting()||u;if(!d&&!u&&h&&c){let g=!1;if(!p&&r>=3){let b=this.getLinkPoint(i,s,a,!0,!1,n,o),x=this.getLinkPoint(n,o,l,!1,!1,i,s);g=this.adjustPoints(0,b,r-1,x),g&&(b=this.getLinkPoint(i,s,a,!0,!1,n,o),x=this.getLinkPoint(n,o,l,!1,!1,i,s),this.adjustPoints(0,b,r-1,x))}g||(this.clearPoints(),f?this.CE(i,s,a,n,o,l):this.LE(i,s,a,n,o,l))}else{const g=u?this.computeCurviness():0;p&&(d&&this.isAvoiding||u)&&this.clearPoints();const b=this.getLinkPoint(i,s,a,!0,d,n,o),x=this.getLinkPoint(n,o,l,!1,d,i,s);let v=0,P=0,w=0;if(d||!h||u){w=this.getLinkDirection(i,s,b,a,!0,d,n,o);let D=this.wk(i,s,a,!0,w);if(u&&(h||a.equals(l)||!d&&a.x+l.x===1&&a.y+l.y===1)&&(w-=d?90:m.ov,g<0&&(w-=180)),w=L.Ee(w),u&&(D+=Math.abs(g)*(d?1:2)),0===w?v=D:90===w?P=D:180===w?v=-D:270===w?P=-D:(v=D*Math.cos(w*Math.PI/180),P=D*Math.sin(w*Math.PI/180)),a.isNoSpot()&&u){const F=s.getDocumentPoint(A.Center,S.l()),E=S.z(F.x+v*m.Yf,F.y+P*m.Yf);this.getLinkPointFromPoint(i,s,F,E,!0,b),S.i(F),S.i(E)}}let M=0,C=0,N=0;if(d||!c||u){N=this.getLinkDirection(n,o,x,l,!1,d,i,s);let D=this.wk(n,o,l,!1,N);if(u&&(c||a.equals(l)||!d&&a.x+l.x===1&&a.y+l.y===1)&&(N+=d?0:m.rv,g<0&&(N+=180)),N=L.Ee(N),u&&(D+=Math.abs(g)*(d?1:2)),0===N?M=D:90===N?C=D:180===N?M=-D:270===N?C=-D:(M=D*Math.cos(N*Math.PI/180),C=D*Math.sin(N*Math.PI/180)),l.isNoSpot()&&u){const F=o.getDocumentPoint(A.Center,S.l()),E=S.z(F.x+M*m.Yf,F.y+C*m.Yf);this.getLinkPointFromPoint(n,o,F,E,!1,x),S.i(F),S.i(E)}}let I=b;(d||!h||u)&&(I=new S(b.x+v,b.y+P));let T=x;(d||!c||u)&&(T=new S(x.x+M,x.y+C)),!p&&!d&&h&&r>3&&this.adjustPoints(0,b,r-2,T)?this.setPoint(r-1,x):!p&&!d&&c&&r>3&&this.adjustPoints(1,I,r-1,x)?this.setPoint(0,b):!p&&(d?r>=6:r>4)&&this.adjustPoints(1,I,r-2,T)?(this.setPoint(0,b),this.setPoint(r-1,x)):(this.clearPoints(),this.addPoint(b),(d||!h||u)&&this.addPoint(I),d&&this.addOrthoPoints(I,w,T,N,i,n),(d||!c||u)&&this.addPoint(T),this.addPoint(x))}return t.addInvalidRoute(this),!0}DC(t,i){return Math.abs(i.x-t.x)>Math.abs(i.y-t.y)?(i.x=i.x>=t.x?t.x+9e9:t.x-9e9,i.y=t.y):(i.y=i.y>=t.y?t.y+9e9:t.y-9e9,i.x=t.x),i}getLinkPointFromPoint(t,i,s,n,o,r){if(void 0===r&&(r=new S),null===t||null===i)return r.h(s),r;if(!t.isVisible()){const f=t.findVisibleNode();null!==f&&f!==t&&(i=(t=f).port)}let a=0,l=0,h=0,c=0,u=null,d=i.panel;if(null!==d&&!d.Nn()&&(d=d.panel),null===d)a=n.x,l=n.y,h=s.x,c=s.y;else{u=d.Js;const f=1/(u.m11*u.m22-u.m12*u.m21),p=u.m22*f,g=-u.m12*f,b=-u.m21*f,x=u.m11*f,v=f*(u.m21*u.dy-u.m22*u.dx),P=f*(u.m12*u.dx-u.m11*u.dy);a=n.x*p+n.y*b+v,l=n.x*g+n.y*x+P,h=s.x*p+s.y*b+v,c=s.x*g+s.y*x+P}return i.pf(a,l,h,c,r),null!==u&&r.v(u),r}AE(t,i){const s=t.yd;return null!==s?s.dv(i):null}xk(t){if(null===t)return null;let i=t.yd;return null===i&&(i=new $i(t.part,t),t.yd=i),i.dv(this)}getLinkPoint(t,i,s,n,o,r,a,l){if(void 0===l&&(l=new S),s.isSpot()&&!this.bl(s))return i.getDocumentPoint(s,l),l;if(s.isSide()){const u=this.xk(i);if(null!==u){if(l.h(u.tc),o&&7===this.routing){const f=this.xk(a);if(null!==f&&u.Kf<f.Kf){const p=S.l(),g=S.l(),b=j.l();i.getDocumentPoint(A.TopLeft,p),i.getDocumentPoint(A.BottomRight,g);const x=p.x,v=p.y,P=g.x,w=g.y;b.x=Math.min(x,P),b.y=Math.min(v,w),b.width=Math.abs(x-P),b.height=Math.abs(v-w);const M=this.computeSpot(!n,a),C=this.getLinkPoint(r,a,M,!n,o,t,i,g);(s.includesSide(A.LeftSide)||s.includesSide(A.RightSide))&&C.y>=b.y&&C.y<=b.y+b.height?l.y=C.y:(s.includesSide(A.TopSide)||s.includesSide(A.BottomSide))&&C.x>=b.x&&C.x<=b.x+b.width&&(l.x=C.x),j.i(b),S.i(p),S.i(g)}}return l}}const h=i.getDocumentPoint(this.ig(s,n),S.l()),c=S.l();if(this.pointsCount>(o?6:2))c.h(this.getPoint(n?1:this.pointsCount-2)),o&&this.DC(h,c);else if(t?.isMemberOf(r)||r?.isMemberOf(t)){const u=i.getDocumentBounds(j.l()),d=a.getDocumentBounds(j.l());u.isReal()&&d.isReal()?d.containsRect(u)?(c.h(h),this.vC(d,h.x,h.y,0,this.computeSpot(a===this.toPort,a),c)):u.containsRect(d)?(a.getDocumentPoint(A.Center,c),this.vC(u,c.x,c.y,0,this.computeSpot(i===this.toPort,i),c)):this.FC(a,h,n,o,c):this.FC(a,h,n,o,c),j.i(u),j.i(d)}else this.FC(a,h,n,o,c);return this.getLinkPointFromPoint(t,i,h,c,n,l),S.i(c),S.i(h),l}FC(t,i,s,n,o){const r=this.computeSpot(!s,t);t.getDocumentPoint(this.ig(r,!s),o),n&&this.DC(i,o)}getLinkDirection(t,i,s,n,o,r,a,l){let h=this.TE(t,i,s,n,o,r,a,l);if(t&&a){const u=j.l(),d=j.l();if(n.isNone()&&t.isMemberOf(a)&&i&&l){if(i.getDocumentBounds(u),l.getDocumentBounds(d),u.isReal()&&d.isReal()&&d.containsRect(u)){const f=this.computeSpot(l===this.toPort,l);h=f.equals(A.Left)||f.equals(A.LeftSide)?180:f.equals(A.Right)||f.equals(A.RightSide)?0:f.equals(A.Top)||f.equals(A.TopSide)?270:f.equals(A.Bottom)||f.equals(A.BottomSide)?90:L.Ee(h+180)}}else a?.isMemberOf(t)&&i&&l&&(i.getDocumentBounds(u),l.getDocumentBounds(d),u.isReal()&&d.isReal()&&u.containsRect(d)&&(h=L.Ee(h+180)));j.i(u),j.i(d)}if(this.bl(n)||null===i)return h;const c=i.getDocumentAngle();return 0===c?h:(45<=c&&c<135?h+=90:135<=c&&c<225?h+=180:225<=c&&c<315&&(h+=270),L.Ee(h))}TE(t,i,s,n,o,r,a,l){if(n.isSpot())return L._w(null,n.x,n.y);if(n.isSide()){const d=this.xk(i);if(null===d)return n.includesSide(A.TopSide)?270:n.includesSide(A.BottomSide)?90:n.includesSide(A.LeftSide)?180:0;switch(d.fi){case 1:return 270;case 8:return 90;case 2:return 180;default:return 0}}if(null===i||null===l)return 0;const h=i.getDocumentPoint(A.Center,S.l()),c=S.l();this.pointsCount>(r?6:2)?r?(c.h(this.getPoint(o?1:this.pointsCount-2)),this.DC(h,c)):c.h(s):l.getDocumentPoint(A.Center,c);let u=0;return u=Math.abs(c.x-h.x)>Math.abs(c.y-h.y)?c.x>=h.x?0:180:c.y>=h.y?90:270,S.i(c),S.i(h),u}computeEndSegmentLength(t,i,s,n){return this.wk(t,i,s,n,NaN)}wk(t,i,s,n,o){if(null!==i&&s.isSide()){const a=this.xk(i);if(null!==a)return a.bk}let r=NaN;if(r=n?this.fromEndSegmentLength:this.toEndSegmentLength,null!==i&&isNaN(r))if(void 0===o&&(o=NaN),m.CC>0&&9===this.computeCurve()&&!isNaN(o)&&s.isSpot()){const a=this.getOtherPort(i);if(a){const l=S.l(),h=S.l(),c=i.getDocumentPoint(s,l),u=a.getDocumentPoint(s.opposite(),h);let f=Math.abs(o>=315||o<=45||o>=135&&o<=225?c.x-u.x:c.y-u.y)/m.CC;return f=Math.max(f,m.LC),S.i(l),S.i(h),f}}else r=n?i.fromEndSegmentLength:i.toEndSegmentLength;return isNaN(r)&&(r=m.LC),r}computeSpot(t,i){return void 0===i&&(i=null),t?this.DE(i||this.fromPort):this.vE(i||this.toPort)}DE(t){if(null===t)return A.Center;let i=this.fromSpot;return i.isDefault()&&(i=t.fromSpot),i===A.Default?A.None:i}vE(t){if(null===t)return A.Center;let i=this.toSpot;return i.isDefault()&&(i=t.toSpot),i===A.Default?A.None:i}bl(t){return t===A.None||.5===t.x&&.5===t.y}ig(t,i){return.5===t.x&&.5===t.y?t:A.Center}computeOtherPoint(t,i){if(0!==this.computeAdjusting()&&this.pointsCount>4)return this.computeMidPoint(new S);{const s=this.AE(i,this);if(null!==s)return s.tc;if(t instanceof pt){let n=this.fromNode,o=this.fromPort;o===i&&(n=this.toNode,o=this.toPort);const r=j.l(),a=j.l();if(o&&n?.isMemberOf(t)){const l=this.computeSpot(o===i,i);if(i.getDocumentBounds(r),o.getDocumentBounds(a),r.isReal()&&a.isReal()&&r.containsRect(a)){const h=o.getDocumentPoint(A.Center);return this.vC(r,h.x,h.y,0,l,h),j.i(r),j.i(a),h}}j.i(r),j.i(a)}return i.getDocumentPoint(A.Center)}}computeShortLength(t){if(t){let i=this.fromShortLength;if(isNaN(i)){const s=this.fromPort;null!==s&&(i=s.fromShortLength)}return isNaN(i)?0:i}{let i=this.toShortLength;if(isNaN(i)){const s=this.toPort;null!==s&&(i=s.toShortLength)}return isNaN(i)?0:i}}Zm(t,i,s,n,o,r){if(!1===this.pickable)return!1;let a;if(void 0===i&&(i=null),void 0===s&&(s=null),void 0===r?(a=Ot.l(),a.Ue()):a=r,a.kc(this.v),this.containedInRect(t,a))return this.JN(i,s,o),void 0===r&&Ot.i(a),!0;if(this.intersectsRect(t,a)){let l=!1;if(!this.Tf){const h=this.D.r;for(let u=h.length;u--;){const d=h[u];if(!d.visible&&d!==this.locationObject)continue;const f=d.actualBounds,p=this.naturalBounds;if(f.x>p.width||f.y>p.height||f.x+f.width<0||f.y+f.height<0)continue;const g=d,b=Ot.l();if(b.set(a),g instanceof J?l=g.Zm(t,i,s,n,o,b):this.path===g?g instanceof rt&&(l=g.nE(t,n,b)):l=g.JT(t,n,b),l){let x=g;null!==i&&(x=i(g)),x&&(null===s||s(x))&&o.add(x)}Ot.i(b)}}return void 0===r&&Ot.i(a),l||null!==this.background}return void 0===r&&Ot.i(a),!1}get isOrthogonal(){return!(2&~this.Jh)}static MC(t){return!(2&~t)}get isAvoiding(){return!(4&~this.Jh)}computeCurve(){if(null===this.ir){const t=this.fromPort;this.ir=null!==t&&t===this.toPort&&!this.isOrthogonal}return this.ir?9:this.curve}computeCorner(){if(9===this.curve)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=m.lv),t}findMidLabel(){const t=this.path,i=this.D.r,s=i.length;for(let o=0;o<s;o++){const r=i[o];if(r!==t&&!r.isPanelMain&&(r.segmentIndex===-1/0||isNaN(r.segmentIndex)))return r}const n=this.labelNodes;for(;n.next();){const o=n.value;if(o.segmentIndex===-1/0||isNaN(o.segmentIndex))return o}return null}computeSpacing(){if(!this.isVisible())return 0;let t=m.av;t=Math.max(t,this.computeThickness());const i=this.fromPort,s=this.toPort;if(null!==i&&null!==s){const n=this.findMidLabel();if(null!==n){const o=n.naturalBounds,r=n.margin,a=isNaN(o.width)?m.hv:o.width*n.scale+r.left+r.right,l=isNaN(o.height)?m.cv:o.height*n.scale+r.top+r.bottom,h=n.segmentOrientation;if(21===h||25===h||24===h)t=Math.max(t,l);else if(23===h||27===h||22===h||26===h)t=Math.max(t,a);else{const c=i.getDocumentPoint(A.Center).directionPoint(s.getDocumentPoint(A.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(c)*a)+Math.abs(Math.cos(c)*l)+1)}9===this.curve&&(t*=m.sv)}}return t}arrangeBundledLinks(t,i){if(i)for(let s=0;s<t.length;s++){const n=t[s];0===n.computeAdjusting()&&n.$t()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=m.ev;const i=this.sr;if(null!==i){const s=y.nt();let n=0;const o=i.rn;for(let a=0;a<o.length;a++){const l=o[a].computeSpacing();s.push(l),n+=l}let r=-n/2;for(let a=0;a<o.length;a++){if(o[a]===this){t=r+s[a]/2;break}r+=s[a]}i.Gy===this.fromNode&&(t=-t),y.Z(s)}}return t}computeThickness(){if(!this.isVisible())return 0;const t=this.path;return null!==t?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||null!==this.sr}LE(t,i,s,n,o,r){let a=this.getLinkPoint(t,i,s,!0,!1,n,o),l=this.getLinkPoint(n,o,r,!1,!1,t,i);if(this.gv(t,i,s,a,n,o,r,l),this.addPoint(a),this.addPoint(l),this.hasCurviness()){const h=l.x-a.x,c=l.y-a.y,u=this.computeCurviness(),d=u,f=a.x+h/2,p=a.y+c/2;let g=f,b=p;if(L.u(c,0))h>0?b-=d:b+=d;else{const x=-h/c;let v=Math.sqrt(d*d/(x*x+1));u<0&&(v=-v),g=(c<0?-1:1)*v+f,b=x*(g-f)+p}this.insertPointAt(1,g,b)}}gv(t,i,s,n,o,r,a,l){const h=r.getDocumentBounds(j.l()),c=i.getDocumentBounds(j.l());if(!h.intersectsRect(c)||h.containsRect(c)||c.containsRect(h)){if(h.containsPoint(n)){const u=S.l();i.getDocumentPoint(this.ig(s,!0),u),l.h(u),this.RC(h,u.x,u.y,m.Yf,l),this.getLinkPointFromPoint(o,r,h.containsPoint(u)?u:n,l,!1,l),this.getLinkPointFromPoint(t,i,u,l,!0,n),S.i(u)}else if(c.containsPoint(l)){const u=S.l();r.getDocumentPoint(this.ig(a,!1),u),n.h(u),this.RC(c,u.x,u.y,m.Yf,n),this.getLinkPointFromPoint(t,i,c.containsPoint(u)?u:l,n,!0,n),this.getLinkPointFromPoint(o,r,u,n,!1,l),S.i(u)}}else{const u=S.l();i.getDocumentPoint(this.ig(s,!0),u);const d=S.l();r.getDocumentPoint(this.ig(a,!1),d);const f=c.width*c.height,p=h.width*h.height;f>p?(n.h(u),this.getLinkPointFromPoint(o,r,d,u,!1,d),l.h(d)):f<p?(this.getLinkPointFromPoint(t,i,u,d,!0,u),n.h(u),l.h(d)):(n.h(u),l.h(d)),S.i(u),S.i(d)}j.i(c),j.i(h)}vC(t,i,s,n,o,r){let a=-1;return o.equals(A.Left)||o.equals(A.LeftSide)?a=180:o.equals(A.Right)||o.equals(A.RightSide)?a=0:o.equals(A.Top)||o.equals(A.TopSide)?a=270:(o.equals(A.Bottom)||o.equals(A.BottomSide))&&(a=90),-1===a?this.RC(t,i,s,0,r):this.mv(t,i,s,0,a,r)}RC(t,i,s,n,o){const r=L._w(t,i,s);return this.mv(t,i,s,n,r,o)}mv(t,i,s,n,o,r){return 0===o?r.x=t.right+n:90===o?r.y=t.bottom+n:180===o?r.x=t.x-n:270===o?r.y=t.y-n:45===o?(r.x=t.right+n,r.y=t.bottom+n):135===o?(r.x=t.x-n,r.y=t.bottom+n):225===o?(r.x=t.x-n,r.y=t.y-n):315===o&&(r.x=t.right+n,r.y=t.y-n),r}CE(t,i,s,n,o,r){let a=this.getLinkPoint(t,i,s,!0,!1,n,o),l=this.getLinkPoint(n,o,r,!1,!1,t,i);this.gv(t,i,s,a,n,o,r,l),this.addPoint(a),this.addPoint(l);const h=l.x-a.x,c=l.y-a.y,u=this.computeCurviness();let d=0,f=0,p=a.x+h/3,g=a.y+c/3,b=p,x=g;L.u(c,0)?h>0?x-=u:x+=u:(d=-h/c,f=Math.sqrt(u*u/(d*d+1)),u<0&&(f=-f),b=(c<0?-1:1)*f+p,x=d*(b-p)+g),p=a.x+2*h/3,g=a.y+2*c/3;let v=p,P=g;L.u(c,0)?h>0?P-=u:P+=u:(v=(c<0?-1:1)*f+p,P=d*(v-p)+g),this.insertPointAt(1,b,x),this.insertPointAt(2,v,P),this.setPoint(0,this.getLinkPoint(t,i,s,!0,!1,n,o)),this.setPoint(3,this.getLinkPoint(n,o,r,!1,!1,t,i))}adjustPoints(t,i,s,n){let o=this.computeAdjusting();if(this.isOrthogonal){if(18===o)return!1;19===o&&(o=17)}switch(o){case 18:return this.FE(t,i,s,n);case 19:return this.RE(t,i,s,n);case 17:return this.OE(t,i,s,n);default:return!1}}FE(t,i,s,n){const o=this.getPoint(t),r=this.getPoint(s);if(o.equalsApprox(i)&&r.equalsApprox(n))return!0;const a=o.x,l=o.y;let u=r.x-a,d=r.y-l;const f=Math.sqrt(u*u+d*d);if(L.X(f,0))return!0;let p=0;L.X(u,0)?p=d<0?-Math.PI/2:Math.PI/2:(p=Math.atan(d/Math.abs(u)),u<0&&(p=Math.PI-p));const g=i.x,b=i.y,P=n.x-g,w=n.y-b,M=Math.sqrt(P*P+w*w);let C=0;L.X(P,0)?C=w<0?-Math.PI/2:Math.PI/2:(C=Math.atan(w/Math.abs(P)),P<0&&(C=Math.PI-C));const N=M/f,I=C-p;this.setPoint(t,i);for(let T=t+1;T<s;T++){const D=this.getPoint(T);u=D.x-a,d=D.y-l;const F=Math.sqrt(u*u+d*d);if(L.X(F,0))continue;let E=0;L.X(u,0)?E=d<0?-Math.PI/2:Math.PI/2:(E=Math.atan(d/Math.abs(u)),u<0&&(E=Math.PI-E));const B=E+I,Y=F*N,W=g+Y*Math.cos(B),$=b+Y*Math.sin(B);this.setPointAt(T,W,$)}return this.setPoint(s,n),!0}RE(t,i,s,n){const o=this.getPoint(t),r=this.getPoint(s);if(o.equalsApprox(i)&&r.equalsApprox(n))return!0;const a=o.x,l=o.y,h=r.x,c=r.y,u=(h-a)**2+(c-l)**2,d=i.x,f=i.y,p=n.x,g=n.y;let b=0,x=1;p-d!==0?(b=(g-f)/(p-d),x=Math.sqrt(1+1/(b*b))):b=9e9,this.setPoint(t,i);for(let v=t+1;v<s;v++){const P=this.getPoint(v),w=P.x,M=P.y;let C=.5;0!==u&&(C=((a-w)*(a-h)+(l-M)*(l-c))/u);const N=a+C*(h-a),I=l+C*(c-l);let T=Math.sqrt((w-N)**2+(M-I)**2);M<b*(w-N)+I&&(T=-T),b>0&&(T=-T);const D=d+C*(p-d),F=f+C*(g-f);if(0!==b){const E=D+T/x;this.setPointAt(v,E,F-(E-D)/b)}else this.setPointAt(v,D,F+T)}return this.setPoint(s,n),!0}OE(t,i,s,n){if(this.isOrthogonal){let o=this.getPoint(t),r=this.getPoint(t+1),a=this.getPoint(t+2),l=r.x,h=r.y;const c=l,u=h;L.u(o.y,r.y)?L.u(r.x,a.x)?h=i.y:L.u(r.y,a.y)&&(l=i.x):L.u(o.x,r.x)&&(L.u(r.y,a.y)?l=i.x:L.u(r.x,a.x)&&(h=i.y)),this.setPointAt(t+1,l,h),o=this.getPoint(s),r=this.getPoint(s-1),a=this.getPoint(s-2);let d=r.x,f=r.y;const p=d,g=f;if(L.u(o.y,r.y)?L.u(r.x,a.x)?f=n.y:L.u(r.y,a.y)&&(d=n.x):L.u(o.x,r.x)&&(L.u(r.y,a.y)?d=n.x:L.u(r.x,a.x)&&(f=n.y)),this.setPointAt(s-1,d,f),this.yT())return this.setPointAt(t+1,c,u),this.setPointAt(s-1,p,g),!1}return this.setPoint(t,i),this.setPoint(s,n),!0}addOrthoPoints(t,i,s,n,o,r){i=L.Ee(i);const a=n=L.Ee(n);i=i>=315||i<45?0:45<=i&&i<135?90:135<=i&&i<225?180:270,n=n>=315||n<45?0:45<=n&&n<135?90:135<=n&&n<225?180:270;const l=t,h=s,c=j.bs(o.actualBounds),u=j.bs(r.actualBounds);c.inflate(m.Fa,m.Fa),u.inflate(m.Fa,m.Fa),c.unionPoint(t),u.unionPoint(s);const d=S.l(),f=S.l();0===i?h.x>l.x||270===n&&h.y<l.y&&u.right>l.x||90===n&&h.y>l.y&&u.right>l.x?(d.e(h.x,l.y),f.e(h.x,(l.y+h.y)/2),180===n?(d.x=this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!1),f.x=d.x,f.y=h.y):270===n&&h.y<l.y||90===n&&h.y>l.y?(d.x=l.x<u.left?this.computeMidOrthoPosition(l.x,l.y,u.left,h.y,!1):l.x<u.right&&(270===n&&l.y<u.top||90===n&&l.y>u.bottom)?this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!1):u.right,f.x=d.x,f.y=h.y):0===n&&l.x<u.left&&l.y>u.top&&l.y<u.bottom&&(d.x=l.x,d.y=l.y<h.y?Math.min(h.y,u.top):Math.max(h.y,u.bottom),f.y=d.y)):(d.e(l.x,h.y),f.e((l.x+h.x)/2,h.y),(180===n||90===n&&h.y<c.top||270===n&&h.y>c.bottom)&&(180===n&&(u.containsPoint(l)||c.containsPoint(h))?d.y=this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!0):h.y<l.y&&(180===n||90===n)?d.y=this.computeMidOrthoPosition(l.x,c.top,h.x,Math.min(h.y,u.bottom),!0):h.y>l.y&&(180===n||270===n)&&(d.y=this.computeMidOrthoPosition(l.x,c.bottom,h.x,Math.max(h.y,u.top),!0)),f.x=h.x,f.y=d.y),d.y>c.top&&d.y<c.bottom&&(h.x>=c.left&&h.x<=l.x||l.x<=u.right&&l.x>=h.x?(90===n||270===n)&&(d.e(Math.max((l.x+h.x)/2,l.x),l.y),f.e(d.x,h.y)):(d.y=270===n||(0===n||180===n)&&h.y<l.y?Math.min(h.y,0===n?c.top:Math.min(c.top,u.top)):Math.max(h.y,0===n?c.bottom:Math.max(c.bottom,u.bottom)),f.x=h.x,f.y=d.y))):180===i?h.x<l.x||270===n&&h.y<l.y&&u.left<l.x||90===n&&h.y>l.y&&u.left<l.x?(d.e(h.x,l.y),f.e(h.x,(l.y+h.y)/2),0===n?(d.x=this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!1),f.x=d.x,f.y=h.y):270===n&&h.y<l.y||90===n&&h.y>l.y?(d.x=l.x>u.right?this.computeMidOrthoPosition(l.x,l.y,u.right,h.y,!1):l.x>u.left&&(270===n&&l.y<u.top||90===n&&l.y>u.bottom)?this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!1):u.left,f.x=d.x,f.y=h.y):180===n&&l.x>u.right&&l.y>u.top&&l.y<u.bottom&&(d.x=l.x,d.y=l.y<h.y?Math.min(h.y,u.top):Math.max(h.y,u.bottom),f.y=d.y)):(d.e(l.x,h.y),f.e((l.x+h.x)/2,h.y),(0===n||90===n&&h.y<c.top||270===n&&h.y>c.bottom)&&(0===n&&(u.containsPoint(l)||c.containsPoint(h))?d.y=this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!0):h.y<l.y&&(0===n||90===n)?d.y=this.computeMidOrthoPosition(l.x,c.top,h.x,Math.min(h.y,u.bottom),!0):h.y>l.y&&(0===n||270===n)&&(d.y=this.computeMidOrthoPosition(l.x,c.bottom,h.x,Math.max(h.y,u.top),!0)),f.x=h.x,f.y=d.y),d.y>c.top&&d.y<c.bottom&&(h.x<=c.right&&h.x>=l.x||l.x>=u.left&&l.x<=h.x?(90===n||270===n)&&(d.e(Math.min((l.x+h.x)/2,l.x),l.y),f.e(d.x,h.y)):(d.y=270===n||(0===n||180===n)&&h.y<l.y?Math.min(h.y,180===n?c.top:Math.min(c.top,u.top)):Math.max(h.y,180===n?c.bottom:Math.max(c.bottom,u.bottom)),f.x=h.x,f.y=d.y))):90===i?h.y>l.y||180===n&&h.x<l.x&&u.bottom>l.y||0===n&&h.x>l.x&&u.bottom>l.y?(d.e(l.x,h.y),f.e((l.x+h.x)/2,h.y),270===n?(d.y=this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!0),f.x=h.x,f.y=d.y):180===n&&h.x<l.x||0===n&&h.x>l.x?(d.y=l.y<u.top?this.computeMidOrthoPosition(l.x,l.y,h.x,u.top,!0):l.y<u.bottom&&(180===n&&l.x<u.left||0===n&&l.x>u.right)?this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!0):u.bottom,f.x=h.x,f.y=d.y):90===n&&l.y<u.top&&l.x>u.left&&l.x<u.right&&(d.x=l.x<h.x?Math.min(h.x,u.left):Math.max(h.x,u.right),d.y=l.y,f.x=d.x)):(d.e(h.x,l.y),f.e(h.x,(l.y+h.y)/2),(270===n||0===n&&h.x<c.left||180===n&&h.x>c.right)&&(270===n&&(u.containsPoint(l)||c.containsPoint(h))?d.x=this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!1):h.x<l.x&&(270===n||0===n)?d.x=this.computeMidOrthoPosition(c.left,l.y,Math.min(h.x,u.right),h.y,!1):h.x>l.x&&(270===n||180===n)&&(d.x=this.computeMidOrthoPosition(c.right,l.y,Math.max(h.x,u.left),h.y,!1)),f.x=d.x,f.y=h.y),d.x>c.left&&d.x<c.right&&(h.y>=c.top&&h.y<=l.y||l.y<=u.bottom&&l.y>=h.y?(0===n||180===n)&&(d.e(l.x,Math.max((l.y+h.y)/2,l.y)),f.e(h.x,d.y)):(d.x=180===n||(90===n||270===n)&&h.x<l.x?Math.min(h.x,90===n?c.left:Math.min(c.left,u.left)):Math.max(h.x,90===n?c.right:Math.max(c.right,u.right)),f.x=d.x,f.y=h.y))):h.y<l.y||180===n&&h.x<l.x&&u.top<l.y||0===n&&h.x>l.x&&u.top<l.y?(d.e(l.x,h.y),f.e((l.x+h.x)/2,h.y),90===n?(d.y=this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!0),f.x=h.x,f.y=d.y):180===n&&h.x<l.x||0===n&&h.x>=l.x?(d.y=l.y>u.bottom?this.computeMidOrthoPosition(l.x,l.y,h.x,u.bottom,!0):l.y>u.top&&(180===n&&l.x<u.left||0===n&&l.x>u.right)?this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!0):u.top,f.x=h.x,f.y=d.y):270===n&&l.y>u.bottom&&l.x>u.left&&l.x<u.right&&(d.x=l.x<h.x?Math.min(h.x,u.left):Math.max(h.x,u.right),d.y=l.y,f.x=d.x)):(d.e(h.x,l.y),f.e(h.x,(l.y+h.y)/2),(90===n||0===n&&h.x<c.left||180===n&&h.x>c.right)&&(90===n&&(u.containsPoint(l)||c.containsPoint(h))?d.x=this.computeMidOrthoPosition(l.x,l.y,h.x,h.y,!1):h.x<l.x&&(90===n||0===n)?d.x=this.computeMidOrthoPosition(c.left,l.y,Math.min(h.x,u.right),h.y,!1):h.x>l.x&&(90===n||180===n)&&(d.x=this.computeMidOrthoPosition(c.right,l.y,Math.max(h.x,u.left),h.y,!1)),f.x=d.x,f.y=h.y),d.x>c.left&&d.x<c.right&&(h.y<=c.bottom&&h.y>=l.y||l.y>=u.top&&l.y<=h.y?(0===n||180===n)&&(d.e(l.x,Math.min((l.y+h.y)/2,l.y)),f.e(h.x,d.y)):(d.x=180===n||(90===n||270===n)&&h.x<l.x?Math.min(h.x,270===n?c.left:Math.min(c.left,u.left)):Math.max(h.x,270===n?c.right:Math.max(c.right,u.right)),f.x=d.x,f.y=h.y))),this.TC=n!==a,this.PC=i,this.SC=n,this.addPoint(d.copy()),this.addPoint(f.copy()),S.i(d),S.i(f),j.i(c),j.i(u)}computeMidOrthoPosition(t,i,s,n,o){let r=0;return this.hasCurviness()&&!this.computeSpot(!0,this.fromPort).isSide()&&!this.computeSpot(!1,this.toPort).isSide()&&(r=this.computeCurviness()),o?(i+n)/2+r:(t+s)/2+r}yT(){if(null===this.diagram||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;const t=this.points.r,i=t.length;if(i<4)return!1;const s=this.diagram.getPositions(!1,this.containingGroup,null);for(let n=1;n<i-2;n++){const o=t[n],r=t[n+1];if(!s.isUnoccupied(Math.min(o.x,r.x),Math.min(o.y,r.y),Math.abs(o.x-r.x),Math.abs(o.y-r.y)))return!0}return!1}findClosestSegment(t){const i=t.x,s=t.y;let n=this.getPoint(0),o=this.getPoint(1),r=S.distanceLineSegmentSquared(i,s,n.x,n.y,o.x,o.y),a=0;for(let l=1;l<this.pointsCount-1;l++){n=this.getPoint(l+1);const h=S.distanceLineSegmentSquared(i,s,o.x,o.y,n.x,n.y);o=n,h<r&&(a=l,r=h)}return a}invalidateGeometry(){this.ai()}ai(){this.Ra&&(this.Ra=!1,this.c())}get Ra(){return!!(128&this.Mt)}set Ra(t){!!(128&this.Mt)!==t&&(this.Mt=128^this.Mt)}get geometry(){if(!this.Ra){if(this.updateRoute(),this.pointsCount<2)return this.Ra=!0,this.ut;this.ut=this.makeGeometry(),this.Ra=!0}return this.ut}Td(t){if(!t){if(!1===this.Fi)return;const o=this.findMainElement();if(this.Ra&&(null===o||null!==o.geometry))return}this.pointsCount>=2&&(this.ut=this.makeGeometry()),this.Ra=!0;const i=this.path;if(null===i)return;i.ut=this.ut;const s=this.D.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];r!==i&&r.isPanelMain&&r instanceof rt&&(r.ut=this.ut)}}IE(t){return this._h()&&t.ra.has(this)&&(0!==this.va.width||0!==this.va.height)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){const t=this.ut,i=this.pointsCount;let s=!1;const n=this.diagram;null!==n&&this.IE(n)&&(s=!0);let o=0,r=0,a=S.bs(this.getPoint(0));const l=S.bs(a),h=this.Me.r,c=this.computeCurve();if(9===c&&i>=3&&!L.X(this.smoothness,0))if(3===i){let u=this.getPoint(1);o=Math.min(a.x,u.x),r=Math.min(a.y,u.y),u=this.getPoint(2),o=Math.min(o,u.x),r=Math.min(r,u.y)}else if(this.isOrthogonal){for(let u=0;u<i;u++){const d=h[u];l.x=Math.min(d.x,l.x),l.y=Math.min(d.y,l.y)}o=l.x,r=l.y}else{for(let u=3;u<i;u+=3){u+3>=i&&(u=i-1);const d=this.getPoint(u);l.x=Math.min(d.x,l.x),l.y=Math.min(d.y,l.y)}o=l.x,r=l.y}else{for(let u=0;u<i;u++){const d=h[u];l.x=Math.min(d.x,l.x),l.y=Math.min(d.y,l.y)}o=l.x,r=l.y}if(o-=this.gk.x,r-=this.gk.y,a.x-=o,a.y-=r,0!==this.computeShortLength(!0)&&(a=this.ec(a,!0,l)),2!==i||this._h()){t.type=4;const u=Ni.qL(t);if(u.Au(a.x,a.y,!1,!1),9===c&&i>=3&&!L.X(this.smoothness,0))if(3===i){const d=this.getPoint(1),f=d.x-o,p=d.y-r,g=S.bs(this.getPoint(2));g.x-=o,g.y-=r,0!==this.computeShortLength(!1)&&this.ec(g,!1,l),u.xr(f,p,f,p,g.x,g.y),S.i(g)}else if(this.isOrthogonal){const d=S.z(o,r),f=S.bs(this.getPoint(1)),p=S.z(o,r),g=S.z(o,r);let x,b=this.getPoint(0);const v=this.smoothness/3;for(let C=1;C<this.pointsCount-1;C++){x=this.getPoint(C);const N=b,I=x,T=this.getPoint(this.OC(x,C,!1));L.X(N.x,I.x)&&L.X(I.x,T.x)||L.X(N.y,I.y)&&L.X(I.y,T.y)||(this.EE(N,I,T,v,p,g),(1===C||2===C&&L.X(b.x,this.getPoint(0).x)&&L.X(b.y,this.getPoint(0).y))&&(f.x=.5*(b.x+x.x),f.y=.5*(b.y+x.y)),u.xr(f.x-o,f.y-r,p.x-o,p.y-r,x.x-o,x.y-r),d.h(p),f.h(g),b=x)}let P=b.x,w=b.y;const M=S.bs(this.getPoint(this.pointsCount-1));0!==this.computeShortLength(!1)&&this.ec(M,!1,S.gn),P=.5*(P+M.x),w=.5*(w+M.y),u.xr(g.x-o,g.y-r,P-o,w-r,M.x-o,M.y-r),S.i(M),S.i(d),S.i(f),S.i(p),S.i(g)}else for(let d=3;d<i;d+=3){const f=this.getPoint(d-2);d+3>=i&&(d=i-1);const p=this.getPoint(d-1),g=S.bs(this.getPoint(d));d===i-1&&0!==this.computeShortLength(!1)&&this.ec(g,!1,S.gn),u.xr(f.x-o,f.y-r,p.x-o,p.y-r,g.x-o,g.y-r),S.i(g)}else if(this.isOrthogonal||2===i){const d=S.bs(this.getPoint(0)),f=S.l(),p=S.bs(d),g=this.computeCorner();let b=1,x=0;for(;b<i;){if(b=this.OC(d,b,b>1),f.h(this.getPoint(b)),b>=i-1){if(d.equals(f)){if(0===x)for(b=1;b<i;)p.h(d),f.h(this.getPoint(b++)),this.On(u,-o,-r,d,f,s),d.h(f)}else 0!==this.computeShortLength(!1)&&this.ec(f,!1,S.gn),this.On(u,-o,-r,d,f,s);break}x=this.OC(f,b+1,b<i-3);const v=this.getPoint(x);this.UE(u,-o,-r,d,f,v,d,p,g,s),p.h(f),b=x}S.i(d),S.i(f),S.i(p)}else{const d=this.computeCorner();if(i>2&&d>=.5){const f=S.bs(h[i-1]);0!==this.computeShortLength(!1)&&this.ec(f,!1,S.gn),a.x+=o,a.y+=r;for(let p=1;p<i;p++){const g=1===p?a:h[p-1],b=p===i-1?f:h[p],v=d/Math.sqrt(g.distanceSquaredPoint(b));v<.5?(p>1&&u.Tu(g.x-o,g.y-r,g.x+(b.x-g.x)*v-o,g.y+(b.y-g.y)*v-r),u.Ks(b.x+(g.x-b.x)*v-o,b.y+(g.y-b.y)*v-r)):p>1&&u.Tu(g.x-o,g.y-r,(g.x+b.x)/2-o,(g.y+b.y)/2-r),p===i-1&&u.Ks(f.x-o,f.y-r)}S.i(f)}else if(i>=2){const f=S.bs(h[i-1]);0!==this.computeShortLength(!1)&&this.ec(f,!1,S.gn);for(let p=1;p<i-1;p++)u.Ks(h[p].x-o,h[p].y-r);u.Ks(f.x-o,f.y-r),S.i(f)}}return Ni.WL(u),S.i(a),S.i(l),t}{let u=S.bs(this.getPoint(1));return u.x-=o,u.y-=r,0!==this.computeShortLength(!1)&&(u=this.ec(u,!1,l)),t.type=1,t.startX=a.x,t.startY=a.y,t.endX=u.x,t.endY=u.y,S.i(u),S.i(a),S.i(l),t}}kk(t,i,s,n){let o=s-t;if(isNaN(o)||o===1/0||o===-1/0)return NaN;o<0&&(o=-o);let r=n-i;return isNaN(r)||r===1/0||r===-1/0?NaN:(r<0&&(r=-r),L.X(o,0)?r:L.X(r,0)?o:Math.sqrt(o*o+r*r))}EE(t,i,s,n,o,r){isNaN(n)&&(n=this.smoothness/3);const a=t.x,l=t.y,h=i.x,c=i.y,u=s.x,d=s.y,f=n*this.kk(a,l,h,c),p=n*this.kk(h,c,u,d);if(L.X(l,c)&&L.X(h,u)&&(h>a?d>c?(o.x=h-f,o.y=c-f,r.x=h+p,r.y=c+p):(o.x=h-f,o.y=c+f,r.x=h+p,r.y=c-p):d>c?(o.x=h+f,o.y=c-f,r.x=h-p,r.y=c+p):(o.x=h+f,o.y=c+f,r.x=h-p,r.y=c-p)),L.X(a,h)&&L.X(c,d)&&(c>l?u>h?(o.x=h-f,o.y=c-f,r.x=h+p,r.y=c+p):(o.x=h+f,o.y=c-f,r.x=h-p,r.y=c+p):u>h?(o.x=h-f,o.y=c+f,r.x=h+p,r.y=c-p):(o.x=h+f,o.y=c+f,r.x=h-p,r.y=c-p)),L.X(a,h)&&L.X(h,u)||L.X(l,c)&&L.X(c,d)){const g=.5*(a+u),b=.5*(l+d);o.x=g,o.y=b,r.x=g,r.y=b}}ec(t,i,s){const n=this.pointsCount;if(n<2)return t;if(i){const o=this.getPoint(1),r=o.x-s.x,a=o.y-s.y,l=this.kk(t.x,t.y,r,a);if(0===l)return t;const h=2===n?.5*l:l;let c=this.computeShortLength(!0);c>h&&(c=h);const d=c*(a-t.y)/l;t.x+=c*(r-t.x)/l,t.y+=d}else{const o=this.getPoint(n-2),r=o.x-s.x,a=o.y-s.y,l=this.kk(t.x,t.y,r,a);if(0===l)return t;const h=2===n?.5*l:l;let c=this.computeShortLength(!1);c>h&&(c=h);const d=c*(t.y-a)/l;t.x-=c*(t.x-r)/l,t.y-=d}return t}OC(t,i,s){const n=this.pointsCount;let o=t;for(;L.X(t.x,o.x)&&L.X(t.y,o.y);){if(i>=n)return n-1;o=this.getPoint(i++)}if(!L.X(t.x,o.x)&&!L.X(t.y,o.y))return i-1;let r=o;for(;L.X(t.x,o.x)&&L.X(o.x,r.x)&&(!s||(t.y>=o.y?o.y>=r.y:o.y<=r.y))||L.X(t.y,o.y)&&L.X(o.y,r.y)&&(!s||(t.x>=o.x?o.x>=r.x:o.x<=r.x));){if(i>=n)return n-1;r=this.getPoint(i++)}return i-2}UE(t,i,s,n,o,r,a,l,h,c){if(L.u(n.y,o.y)&&L.u(o.x,r.x)){let u=Math.min(h,Math.abs(o.x-l.x)/2);const d=Math.min(u,Math.abs(r.y-o.y)/2);if(u=d,L.u(u,0))return this.On(t,i,s,n,o,c),void a.h(o);let f=o.x;const p=o.y,g=f;let b=p;o.x>n.x?(f=o.x-u,b=r.y>o.y?o.y+d:o.y-d):(f=o.x+u,b=r.y>o.y?o.y+d:o.y-d);const x=S.z(f,p);this.On(t,i,s,n,x,c),S.i(x),t.Tu(o.x+i,o.y+s,g+i,b+s),a.e(g,b)}else if(L.u(n.x,o.x)&&L.u(o.y,r.y)){let u=Math.min(h,Math.abs(o.y-l.y)/2);const d=Math.min(u,Math.abs(r.x-o.x)/2);if(u=d,L.u(d,0))return this.On(t,i,s,n,o,c),void a.h(o);const f=o.x;let p=o.y,g=f;const b=p;o.y>n.y?(p=o.y-u,g=r.x>o.x?o.x+d:o.x-d):(p=o.y+u,g=r.x>o.x?o.x+d:o.x-d);const x=S.z(f,p);this.On(t,i,s,n,x,c),S.i(x),t.Tu(o.x+i,o.y+s,g+i,b+s),a.e(g,b)}else this.On(t,i,s,n,o,c),a.h(o)}On(t,i,s,n,o,r){if(r||!this._h())t.Ks(o.x+i,o.y+s);else{const a=m.nv,l=a/2,h=[];let c=0;this.isVisible()&&(c=this.VE(n,o,h));let u=n.x,d=n.y;if(c>0)if(L.u(n.y,o.y))if(n.x<o.x){let f=0;for(;f<c;){const p=Math.max(n.x,Math.min(h[f++]-l,o.x-a));t.Ks(p+i,o.y+s),u=p+i,d=o.y+s;let g=Math.min(p+a,o.x);for(;f<c;){const P=h[f];if(!(P<g+a))break;f++,g=Math.min(P+l,o.x)}const b=o.y-a+s,x=g+i,v=o.y+s;10===this.curve?t.Au(x,v,!1,!1):t.xr(u,b,x,b,x,v),u=x,d=v}}else{let f=c-1;for(;f>=0;){const p=Math.min(n.x,Math.max(h[f--]+l,o.x+a));t.Ks(p+i,o.y+s),u=p+i,d=o.y+s;let g=Math.max(p-a,o.x);for(;f>=0;){const P=h[f];if(!(P>g-a))break;f--,g=Math.max(P-l,o.x)}const b=o.y-a+s,x=g+i,v=o.y+s;10===this.curve?t.Au(x,v,!1,!1):t.xr(u,b,x,b,x,v),u=x,d=v}}else if(L.u(n.x,o.x))if(n.y<o.y){let f=0;for(;f<c;){const p=Math.max(n.y,Math.min(h[f++]-l,o.y-a));t.Ks(o.x+i,p+s),u=o.x+i,d=p+s;let g=Math.min(p+a,o.y);for(;f<c;){const P=h[f];if(!(P<g+a))break;f++,g=Math.min(P+l,o.y)}const b=o.x-a+i,x=o.x+i,v=g+s;10===this.curve?t.Au(x,v,!1,!1):t.xr(b,d,b,v,x,v),u=x,d=v}}else{let f=c-1;for(;f>=0;){const p=Math.min(n.y,Math.max(h[f--]+l,o.y+a));t.Ks(o.x+i,p+s),u=o.x+i,d=p+s;let g=Math.max(p-a,o.y);for(;f>=0;){const P=h[f];if(!(P>g-a))break;f--,g=Math.max(P-l,o.y)}const b=o.x-a+i,x=o.x+i,v=g+s;10===this.curve?t.Au(x,v,!1,!1):t.xr(b,d,b,v,x,v),u=x,d=v}}t.Ks(o.x+i,o.y+s)}}VE(t,i,s){const n=this.diagram;if(null===n||t.equals(i))return 0;const o=n.layers;for(;o.next();){const r=o.value;if(null!==r&&r.visible){const a=r.EM(),l=a.length;for(let h=0;h<l;h++){const c=a[h];if(!(c instanceof m))continue;if(c===this)return s.length>0&&s.sort((f,p)=>f-p),s.length;if(!c.isVisible()||!c._h())continue;const u=c.routeBounds;if(!u.isReal()||!this.routeBounds.intersectsRect(u)||this.usesSamePort(c))continue;const d=c.path;null!==d&&d.isVisibleObject()&&this.BE(t,i,s,c)}}}return s.length>0&&s.sort((r,a)=>r-a),s.length}BE(t,i,s,n){const o=L.u(t.y,i.y),r=n.pointsCount;let a=n.getPoint(0);const l=S.l();for(let h=1;h<r;h++){const c=n.getPoint(h);if(h<r-1){const u=n.getPoint(h+1);if(a.y===c.y&&c.y===u.y){if(c.x>a.x&&u.x>=c.x||c.x<a.x&&u.x<=c.x)continue}else if(a.x===c.x&&c.x===u.x&&(c.y>a.y&&u.y>=c.y||c.y<a.y&&u.y<=c.y))continue}this.zE(t,i,a,c,l)&&s.push(o?l.x:l.y),a=c}S.i(l)}zE(t,i,s,n,o){const r=t.x,a=t.y,l=i.x,h=i.y,c=s.x,u=s.y,d=n.x,f=n.y;if(L.u(r,l)){if(!L.u(a,h)&&L.u(u,f)&&Math.min(a,h)<u&&Math.max(a,h)>u&&Math.min(c,d)<r&&Math.max(c,d)>r&&!L.u(c,d))return o.x=r,o.y=u,!0}else if(L.u(a,h)&&L.u(c,d)&&Math.min(r,l)<c&&Math.max(r,l)>c&&Math.min(u,f)<a&&Math.max(u,f)>a&&!L.u(u,f))return o.x=c,o.y=a,!0;return o.x=0,o.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.bl(this.computeSpot(!0))?1:0}get lastPickIndex(){const t=this.pointsCount;return 0===t?0:t<=2?t-1:this.isOrthogonal||!this.bl(this.computeSpot(!1))?t-2:t-1}_h(){const t=this.curve;return 11===t||10===t}yk(t){if(t||this._h()){const i=this.diagram;null!==i&&!i.animationManager.isTicking&&!i.ra.has(this)&&(0!==this.va.width||0!==this.va.height)&&i.ra.set(this,this.va.copy())}}invalidateOtherJumpOvers(t){const i=this.layer;if(null===i||!i.visible||i.isTemporary)return;const s=i.diagram;if(null===s||s.animationManager.isTicking)return;let n=!1;const o=s.layers;for(;o.next();){const r=o.value;if(r.visible)if(r===i){n=!0;let a=!1;const l=r.EM(),h=l.length;for(let c=0;c<h;c++){const u=l[c];u instanceof m&&(u===this?a=!0:a&&this.pv(u,t))}}else if(n){const a=r.EM(),l=a.length;for(let h=0;h<l;h++){const c=a[h];c instanceof m&&this.pv(c,t)}}}}pv(t,i){if(null===t||!t.Ra||!t.Fi||!t._h())return;const s=t.routeBounds;s.isReal()&&(!this.routeBounds.intersectsRect(s)&&!i.intersectsRect(s)||this.usesSamePort(t)||t.ai())}usesSamePort(t){const i=this.pointsCount,s=t.pointsCount;if(i>0&&s>0){const n=this.getPoint(0),o=t.getPoint(0);if(n.equalsApprox(o))return!0;const r=this.getPoint(i-1),a=t.getPoint(s-1);if(r.equalsApprox(a)||n.equalsApprox(a)||r.equalsApprox(o))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;const t=this.containingGroup;let i=!0;const s=this.diagram;null!==s&&(i=s.isTreePathToChildren);const n=this.fromNode;if(null!==n){if(this.isTreeLink&&i&&!n.isTreeExpanded)return!1;if(n===t)return!0;let r=n;for(;null!==r;){if(r.labeledLink===this)return!0;r=r.containingGroup}const a=n.findVisibleNode();if(null===a||a===t)return!1}const o=this.toNode;if(null!==o){if(this.isTreeLink&&!i&&!o.isTreeExpanded)return!1;if(o===t)return!0;let r=o;for(;null!==r;){if(r.labeledLink===this)return!0;r=r.containingGroup}const a=o.findVisibleNode();if(null===a||a===t)return!1}return!0}Xe(t){if(super.Xe(t),t&&this.yk(!1),null!==this.sr&&this.sr.Jd(),null!==this.on){const i=this.on.iterator;for(;i.next();)i.value.Xe(t)}}get adjusting(){return this.Gf}set adjusting(t){const i=this.Gf;i!==t&&(this.Gf=t,this.t("adjusting",i,t))}computeAdjusting(){return this.isAvoiding&&null!==this.diagram&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Gf}get corner(){return this.Qd}set corner(t){const i=this.Qd;i!==t&&(this.Qd=t,this.ai(),this.t("corner",i,t))}get curve(){return this._d}set curve(t){const i=this._d;i!==t&&(this._d=t,this.$t(),this.ai(),this.yk(10===i||11===i||10===t||11===t),this.t("curve",i,t))}get curviness(){return this.tg}set curviness(t){const i=this.tg;i!==t&&(this.tg=t,this.$t(),this.ai(),this.t("curviness",i,t))}get routing(){return this.Jh}set routing(t){const i=this.Jh;i!==t&&(this.Jh=t,this.isAvoiding&&null!==this.diagram&&(this.diagram.lp=!0),this.ir=null,this.$t(),this.yk(m.MC(i)||m.MC(t)),this.t("routing",i,t))}get smoothness(){return this.eg}set smoothness(t){const i=this.eg;i!==t&&(this.eg=t,this.ai(),this.t("smoothness",i,t))}Qy(){const t=this.po;if(null===t)return;const i=this.wo;if(null===i||!isNaN(this.curviness))return;const s=this.yo,n=this.xo;let o=null,r=null;const a=t.ee.r,l=a.length;for(let h=0;h<l;h++){const c=a[h];(c.po!==t||c.yo!==s||c.wo!==i||c.xo!==n)&&(c.po!==i||c.yo!==n||c.wo!==t||c.xo!==s)||(null===r?r=c:(null===o&&(o=[],o.push(r)),o.push(c)))}if(null!==o){let h=t.KD(i,s,n);null===h&&(h=new yo(t,s,i,n),t.GD(h),i.GD(h)),h.rn=o;for(let c=0;c<o.length;c++)o[c].sr=h;h.Jd()}}Zy(){const t=this.sr;if(null!==t){if(!isNaN(this.curviness))return;this.sr=null;const i=t.rn.indexOf(this);i>=0&&(t.rn.splice(i,1),t.Jd())}}Ar(){return!0}get key(){const t=this.diagram;if(null!==t&&t.model.Wh())return t.model.getKeyForLinkData(this.data)}}return m})();class yo{Ko;qs;Gy;pC;fk;yC;rn;constructor(e,t,i,s){z.Je(this),this.Ko=!1,this.qs=!1,this.Gy=e,this.pC=t,this.fk=i,this.yC=s,this.rn=[]}Jd(){if(!this.Ko){const e=this.rn;if(e.length>0){const t=e[0].diagram;null!==t&&(t.o2.add(this),this.qs=t.undoManager.isUndoingRedoing)}}this.Ko=!0}P2(){if(this.Ko){this.Ko=!1;const e=this.rn;if(e.length>0){const t=e[0],i=t.diagram,s=null===i||i.Qa&&!this.qs;this.qs=!1,t.arrangeBundledLinks(e,s),1===e.length&&(t.sr=null,e.length=0)}0===e.length&&(this.Gy.YD(this),this.fk.YD(this))}}}class jt{ui;di;ic;sc;we;xe;Vt;Oa;Ia;Ah;I2;Ko;tw;hf;E2;U2;constructor(e){z.Je(this),this.Ah=null,this.I2=null,this.Ko=!0,this.tw=!1,this.ui=1,this.di=1,this.ic=-1,this.sc=-1,this.we=e.width,this.xe=e.height,this.Vt=[],this.Oa=0,this.Ia=0,this.hf=gt.fv,this.E2=2*this.hf,this.U2=2*this.hf}static ln=0;static nc=1;static sg=999999;static IC=jt.sg+1;static EC=jt.sg+2;f1(e){if(e.width<=0||e.height<=0)return;const i=e.y,s=e.x+e.width,n=e.y+e.height;this.ui=Math.floor((e.x-this.we)/this.we)*this.we,this.di=Math.floor((i-this.xe)/this.xe)*this.xe,this.ic=Math.ceil((s+2*this.we)/this.we)*this.we,this.sc=Math.ceil((n+2*this.xe)/this.xe)*this.xe;const o=1+(0|Math.ceil((this.ic-this.ui)/this.we)),r=1+(0|Math.ceil((this.sc-this.di)/this.xe));if(0===this.Vt.length||this.Oa<o-1||this.Ia<r-1){const a=[];for(let l=0;l<=o;l++)a[l]=new Uint32Array(r);this.Vt=a,this.Oa=o-1,this.Ia=r-1}this.XE(jt.IC)}get bounds(){return new j(this.ui,this.di,this.ic-this.ui,this.sc-this.di)}get cellWidth(){return this.we}set cellWidth(e){e>0&&e!==this.we&&(this.we=e,this.f1(this.bounds))}get cellHeight(){return this.xe}set cellHeight(e){e>0&&e!==this.xe&&(this.xe=e,this.f1(this.bounds))}ng(e,t){return this.ui<=e&&e<=this.ic&&this.di<=t&&t<=this.sc}bo(e,t){return this.ng(e,t)?(e-=this.ui,t-=this.di,this.Vt[0|(e/=this.we)][0|(t/=this.xe)]):jt.IC}vO(e,t,i,s){if(!this.ng(e,t))return;const n=(e-this.ui)/this.we|0,o=(t-this.di)/this.xe|0,a=(t+s-this.di)/this.xe|0,l=Math.min((e+i-this.ui)/this.we|0,this.Oa),h=Math.min(a,this.Ia);for(let c=n;c<=l;c++){const u=this.Vt[c];if(u.fill)u.fill(jt.ln,o,h+1);else for(let d=o;d<=h;d++)u[d]=jt.ln}}XE(e){for(let t=0;t<=this.Oa;t++){const i=this.Vt[t];if(i.fill)i.fill(e);else for(let s=0;s<=this.Ia;s++)i[s]=e}}TT(){for(let e=0;e<=this.Oa;e++){const t=this.Vt[e];for(let i=0;i<=this.Ia;i++)t[i]>=jt.nc&&(t[i]=jt.IC)}}GE(e,t){return this.bo(e,t)===jt.ln}isUnoccupied(e,t,i,s){if(e>this.ic||e+i<this.ui||t>this.sc||t+s<this.di)return!0;let n=(e-this.ui)/this.we|0,o=(t-this.di)/this.xe|0,r=Math.max(0,i)/this.we+1|0,a=Math.max(0,s)/this.xe+1|0;if(n<0&&(r+=n,n=0),o<0&&(a+=o,o=0),r<0||a<0)return!0;const l=0|Math.min(n+r-1,this.Oa),h=0|Math.min(o+a-1,this.Ia);for(let c=n;c<=l;c++){const u=this.Vt[c];for(let d=o;d<=h;d++)if(u[d]===jt.ln)return!1}return!0}maxAvoidsLinksSpaceH(e,t,i,s){if(e>this.ic||t<this.ui||i>this.sc||i<this.di)return 0;const n=(e-this.ui)/this.we|0,o=(t-this.ui)/this.we|0,r=(i-this.di)/this.xe|0,a=s/this.xe+1|0;let l;for(l=0;l<a/2;l++){let h=!1;for(let c=n;c<=o;c++)if(this.Vt[c][r+l]===jt.ln||this.Vt[c][r-l]===jt.ln){h=!0;break}if(h)return Math.max(0,(2*l-1)*this.xe)}return s}maxAvoidsLinksSpaceV(e,t,i,s){if(e>this.sc||t<this.di||i>this.ic||i<this.ui)return 0;const n=(e-this.di)/this.xe|0,o=(t-this.di)/this.xe|0,r=(i-this.ui)/this.we|0,a=s/this.we+1|0;let l;for(l=0;l<a/2;l++){let h=!1;for(let c=n;c<=o;c++)if(this.Vt[r+l][c]===jt.ln||this.Vt[r-l][c]===jt.ln){h=!0;break}if(h)return Math.max(0,(2*l-1)*this.we)}return s}YE(e,t,i,s,n,o,r,a){let l=this.Vt[e|=0][t|=0];if(l>=jt.nc&&l<jt.sg)for(s?t+=i:e+=i,l+=1;n<=e&&e<=o&&r<=t&&t<=a&&!(l>=this.Vt[e][t]);)this.Vt[e][t]=l,l+=1,s?t+=i:e+=i;return s?t:e}ko(e,t,i,s,n,o,r,a){if(e<n||e>o||t<r||t>a)return;const l=this.YE(e,t,i,s,n,o,r,a);if(s)if(i>0)for(let h=t+i;h<l;h+=i)this.ko(e,h,1,!s,n,o,r,a),this.ko(e,h,-1,!s,n,o,r,a);else for(let h=t+i;h>l;h+=i)this.ko(e,h,1,!s,n,o,r,a),this.ko(e,h,-1,!s,n,o,r,a);else if(i>0)for(let h=e+i;h<l;h+=i)this.ko(h,t,1,!s,n,o,r,a),this.ko(h,t,-1,!s,n,o,r,a);else for(let h=e+i;h>l;h+=i)this.ko(h,t,1,!s,n,o,r,a),this.ko(h,t,-1,!s,n,o,r,a)}Pk(e,t,i,s,n,o,r,a,l,h){let c=0|e,u=0|t,d=jt.ln,f=jt.nc;for(this.Vt[c][u]=f;d===jt.ln&&c>r&&c<a&&u>l&&u<h;)f+=1,this.Vt[c][u]=f,o?u+=n:c+=n,d=this.Vt[c][u];return o?u:c}Sk(e,t,i,s,n,o,r,a,l,h){let c=0|i,u=0|s,d=jt.ln;const f=jt.sg;for(this.Vt[c][u]=f;d===jt.ln&&c>r&&c<a&&u>l&&u<h;)this.Vt[c][u]=f,o?u+=n:c+=n,d=this.Vt[c][u]}yv(e,t,i,s,n,o){this.tw=!1;let r=e.x,a=e.y;if(!this.ng(r,a))return;r-=this.ui,r/=this.we,a-=this.di,a/=this.xe;let l=i.x,h=i.y;if(!this.ng(l,h))return;if(l-=this.ui,l/=this.we,h-=this.di,h/=this.xe,Math.abs(r-l)<=1&&Math.abs(a-h)<=1)return void(this.tw=!0);let c=n.x,u=n.y,d=n.x+n.width,f=n.y+n.height;c-=this.ui,c/=this.we,u-=this.di,u/=this.xe,d-=this.ui,d/=this.we,f-=this.di,f/=this.xe;const p=Math.max(0,Math.min(this.Oa,0|c)),g=Math.min(this.Oa,Math.max(0,0|d)),b=Math.max(0,Math.min(this.Ia,0|u)),x=Math.min(this.Ia,Math.max(0,0|f)),P=90,w=270,M=this.Vt,C=0|r,N=0|a,I=0|l,T=0|h,D=0===t||t===P?1:-1,F=t===P||t===w;M[C][N]===jt.ln?(this.Pk(C,N,I,T,D,F,p,g,b,x),this.Pk(C,N,I,T,1,!F,p,g,b,x),this.Pk(C,N,I,T,-1,!F,p,g,b,x)):this.Pk(C,N,I,T,D,F,C,N,C,N),M[I][T]===jt.ln?(this.Sk(C,N,I,T,0===s||s===P?1:-1,s===P||s===w,p,g,b,x),this.Sk(C,N,I,T,1,!(s===P||s===w),p,g,b,x),this.Sk(C,N,I,T,-1,!(s===P||s===w),p,g,b,x)):this.Sk(C,N,I,T,D,F,I,T,I,T);const E=y.nt();if(o&&this.wv(I,T,s,C,N,E)){(E[0]!==I||E[1]!==T)&&(E.unshift(T),E.unshift(I)),(E[E.length-2]!==C||E[E.length-1]!==N)&&(E.push(C),E.push(N));let B=jt.nc,Y=E[E.length-2],W=E[E.length-1];M[Y][W]=B++;for(let $=E.length-4;$>=0;$-=2){Y=E[$+2],W=E[$+3];const K=E[$],Z=E[$+1];for(;K>Y?Y++:K<Y?Y--:Z>W?W++:Z<W&&W--,M[Y][W]=B++,Y!==K||W!==Z;);}}else this.ko(C,N,1,!1,p,g,b,x),this.ko(C,N,-1,!1,p,g,b,x),this.ko(C,N,1,!0,p,g,b,x),this.ko(C,N,-1,!0,p,g,b,x);y.Z(E)}wv(e,t,i,s,n,o){const r=this.Vt;let a=e,l=t;for(;;){if(a===s&&l===n)return!0;let h=a,c=l;if(0===i){if(!(h<s))break;h++}else if(90===i){if(!(c<n))break;c++}else if(180===i){if(!(h>s))break;h--}else{if(!(c>n))break;c--}const u=r[h][c];if(0===u||u===jt.EC)break;a=h,l=c}for(;;){let h=i,c=a,u=l;0===i?u<n?(h=90,u++):u>n&&(h=270,u--):90===i?c<s?(h=0,c++):c>s&&(h=180,c--):180===i?u<n?(h=90,u++):u>n&&(h=270,u--):c<s?(h=0,c++):c>s&&(h=180,c--);const d=r[c][u];if(h!==i&&0!==d&&d!==jt.EC){if(o.push(a),o.push(l),this.wv(a,l,h,s,n,o))return!0;o.pop(),o.pop()}if(r[a][l]=jt.EC,0===i){if(a===e)return!1;a--}else if(90===i){if(l===t)return!1;l--}else if(180===i){if(a===e)return!1;a++}else{if(l===t)return!1;l++}}}}class $i{Ri;kl;Ei;og;constructor(e,t){z.Je(this),this.Ri=e,this.kl=t,this.Ei=[],this.og=!1}toString(){const e=this.Ei;let t=this.Ri.toString()+" "+e.length.toString()+":";for(let i=0;i<e.length;i++){const s=e[i];null!==s&&(t+="\n  "+s.toString())}return t}KE(e,t,i,s){const n=t.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let o=i;switch(n){case 9:return o>180?270:90;case 6:return o>90&&o<=270?180:0}const r=180*Math.atan2(e.height,e.width)/Math.PI;switch(n){case 3:return o>r&&o<=180+r?180:270;case 5:return o>180-r&&o<=360-r?270:0;case 12:return o>r&&o<=180+r?90:0;case 10:return o>180-r&&o<=360-r?180:90;case 7:return o>90&&o<=180+r?180:o>180+r&&o<=360-r?270:0;case 13:return o>180&&o<=360-r?270:o>r&&o<=180?90:0;case 14:return o>r&&o<=180-r?90:o>180-r&&o<=270?180:0;case 11:return o>180-r&&o<=180+r?180:o>180+r?270:90}return s&&15!==n&&(o-=15,o<0&&(o+=360)),o>r&&o<180-r?90:o>=180-r&&o<=180+r?180:o>180+r&&o<360-r?270:0}Jd(){this.Ei.length=0}dv(e){let t=this.Ei;0===t.length&&(this.HE(),t=this.Ei);for(let i=0;i<t.length;i++){const s=t[i];if(null!==s&&s.es===e)return s}return null}HE(){if(!this.og){const e=this.og;this.og=!0;let t,i=null;const s=this.Ri,n=s instanceof pt?s:null;if(null===n||n.isSubGraphExpanded)t=s.isTreeExpanded?s.findLinksConnected(this.kl.portId):s.findExternalTreeLinksConnected();else{if(!n.actualBounds.isReal())return this.og=e,this.Ei;i=n,t=i.findExternalLinksConnected()}this.Ei.length=0;let o=0;const r=this.kl.getDocumentPoint(A.TopLeft,S.l()),a=this.kl.getDocumentPoint(A.BottomRight,S.l()),l=j.z(r.x,r.y,0,0);l.unionPoint(a),S.i(r),S.i(a);const h=S.z(l.x+l.width/2,l.y+l.height/2),c=this.kl.getDocumentAngle(),u=t.iterator;for(;u.next();){const g=u.value;if(!g.isVisible()||g.fromPort===g.toPort)continue;const b=g.fromPort===this.kl||null!==i&&null!==g.fromNode&&g.fromNode.isMemberOf(i),x=g.computeSpot(b,this.kl);if(!x.isSide())continue;let v;if(v=b?g.toPort:g.fromPort,null===v)continue;let P=v.part;if(null===P)continue;const w=P.findVisibleNode();null!==w&&w!==P&&(P=w,v=P.port);const M=g.computeOtherPoint(P,v);let C=h.directionPoint(M);0!==c&&(C=L.Ee(C-c));const N=this.KE(l,x,C,g.isOrthogonal);let I=0;0===N?(I=4,C>180&&(C-=360)):90===N?(I=8,C>270&&(C-=360)):180===N?I=2:(I=1,C<90&&(C+=360));let T=this.Ei[o];void 0===T?(T=new xo(g,C,I),this.Ei[o]=T):(T.es=g,T.Xt=C,T.fi=I),T.Mk.h(M),o++}S.i(h),this.jE();const d=this.Ei.length;let f=-1,p=0;for(o=0;o<d;o++){const g=this.Ei[o];void 0!==g&&(g.fi!==f&&(f=g.fi,p=0),g.rg=p,p++)}for(f=-1,p=0,o=d-1;o>=0;o--){const g=this.Ei[o];void 0!==g&&(g.fi!==f&&(f=g.fi,p=g.rg+1),g.Kf=p)}this.qE(this.Ei),this.WE(this.Ei),this.og=e,j.i(l)}return this.Ei}JE(e,t){return e===t?0:null===e?-1:null===t?1:e.fi<t.fi?-1:e.fi>t.fi?1:e.Xt<t.Xt?-1:e.Xt>t.Xt?1:0}jE(){this.Ei.sort($i.prototype.JE)}qE(e){const t=this.kl,i=this.Ri.portSpreading,s=S.l(),n=S.l(),o=S.l(),r=S.l();t.getDocumentPoint(A.TopLeft,s),t.getDocumentPoint(A.TopRight,n),t.getDocumentPoint(A.BottomRight,o),t.getDocumentPoint(A.BottomLeft,r);let a=0,l=0,h=0,c=0;if(2===i)for(let v=0;v<e.length;v++){const P=e[v];if(null===P)continue;const w=P.es.computeThickness();switch(P.fi){case 8:h+=w;break;case 2:c+=w;break;case 1:a+=w;break;default:l+=w}}let u=0,d=0,f=1,p=n,g=o,b=0,x=0;for(let v=0;v<e.length;v++){const P=e[v];if(null===P)continue;if(u!==P.fi){switch(u=P.fi,u){case 8:p=o,g=r;break;case 2:p=r,g=s;break;case 1:p=s,g=n;break;default:p=n,g=o}switch(b=g.x-p.x,x=g.y-p.y,u){case 8:h>Math.abs(b)?(f=Math.abs(b)/h,h=Math.abs(b)):f=1;break;case 2:c>Math.abs(x)?(f=Math.abs(x)/c,c=Math.abs(x)):f=1;break;case 1:a>Math.abs(b)?(f=Math.abs(b)/a,a=Math.abs(b)):f=1;break;default:l>Math.abs(x)?(f=Math.abs(x)/l,l=Math.abs(x)):f=1}d=0}const w=P.tc;if(2===i){let M=P.es.computeThickness();switch(M*=f,w.h(p),u){case 8:w.x=p.x+b/2+h/2-d-M/2;break;case 2:w.y=p.y+x/2+c/2-d-M/2;break;case 1:w.x=p.x+b/2-a/2+d+M/2;break;default:w.y=p.y+x/2-l/2+d+M/2}d+=M}else{let M=.5;1===i&&(M=(P.rg+1)/(P.Kf+1)),w.x=p.x+b*M,w.y=p.y+x*M}}S.i(s),S.i(n),S.i(o),S.i(r)}WE(e){for(let t=0;t<e.length;t++){const i=e[t];null!==i&&(i.bk=this.$E(i,t))}}$E(e,t){const i=e.es,s=i.fromPort===this.kl;let n=0;switch(e.fi){case 1:n=270;break;case 2:n=180;break;case 4:n=0;break;case 8:n=90}const o=i.wk(this.Ri,this.kl,A.None,s,n);let r=e.rg;if(r<0)return o;const a=e.Kf;if(a<=1||!i.isOrthogonal)return o;const l=e.Mk,h=e.tc,c=2===e.fi||8===e.fi;c&&(r=a-1-r);const u=gt.tv,d=2===e.fi||4===e.fi,f=r<=0?h:this.Ei[c?t+1:t-1].tc,p=r>=a-1?h:this.Ei[c?t-1:t+1].tc;return(d?l.y>=f.y&&l.y<=p.y:l.x>=f.x&&l.x<=p.x)?o:(d?l.y<h.y:l.x<h.x)?o+r*u:o+(a-1-r)*u}}class xo{es;Xt;fi;Mk;rg;Kf;tc;bk;constructor(e,t,i){this.es=e,this.Xt=t,this.fi=i,this.Mk=new S,this.rg=0,this.Kf=0,this.tc=new S,this.bk=0}toString(){return this.es.toString()+" "+this.Xt.toString()+" "+this.fi.toString()+":"+this.rg.toString()+"/"+this.Kf.toString()+" "+this.tc.toString()+" "+this.bk.toString()+" "+this.Mk.toString()}}class Ti{Dh;vh;Fh;Rh;Oh;Ih;c0;a0;f0;h0;constructor(){this.Dh=A.Default,this.vh=A.Default,this.Fh=NaN,this.Rh=NaN,this.Oh=NaN,this.Ih=NaN,this.c0=null,this.a0=null,this.f0=1/0,this.h0=1/0}copy(){const e=new Ti;return e.Dh=this.Dh.N(),e.vh=this.vh.N(),e.Fh=this.Fh,e.Rh=this.Rh,e.Oh=this.Oh,e.Ih=this.Ih,e.c0=this.c0,e.a0=this.a0,e.f0=this.f0,e.h0=this.h0,e}}class Ee{t0;e0;i0;_p;j0;q0;constructor(){this.t0=-1/0,this.e0=0,this.i0=S.gn,this._p=0,this.j0="None",this.q0="None"}copy(){const e=new Ee;return e.t0=this.t0,e.e0=this.e0,e.i0=this.i0.N(),e._p=this._p,e.j0=this.j0,e.q0=this.q0,e}}class pt extends nt{lg;Dt;Ch;Fp;he;li;constructor(e,t){let i;void 0===e||e instanceof Rt||"string"==typeof e?i=e:e&&(t=e),super(i),this.E=4608|this.E,this.lg=new z,this.Dt=null,this.li=new se,this.li.group=this,this.Ch=new z,this.Fp=null,this.he=null,t&&Object.assign(this,t)}cloneProtected(e){super.cloneProtected(e),this.E=-32769&this.E;const t=e.findInVisualTree(i=>i instanceof de);e.Dt=t instanceof de?t:null,null!==this.li?(e.li=this.li.copy(),e.li.group=e):(null!==e.li&&(e.li.group=null),e.li=null),null!==this.he&&(e.he=this.he.copy())}jo(e){super.jo(e);const t=e.findSubGraphParts(),i=e.memberParts;for(;i.next();){const s=i.value;if(s.c(),s.invalidateLayout(8),s.clearAdornments(),s instanceof nt)s.invalidateConnectedLinks(t);else if(s instanceof gt){const n=s.labelNodes;for(;n.next();)n.value.invalidateConnectedLinks(t)}}}gf(e,t,i,s,n,o,r){if(3===e&&"elements"===t){if(n instanceof de)null===this.Dt?this.Dt=n:this.Dt!==n&&y.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(n instanceof J){const a=n.findInVisualTree(l=>l instanceof de);a instanceof de&&(null===this.Dt?this.Dt=a:this.Dt!==a&&y.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else 4===e&&"elements"===t&&null!==this.Dt&&(s===this.Dt||s instanceof J&&this.Dt.isContainedBy(s))&&(this.Dt=null);super.gf(e,t,i,s,n,o,r)}kd(e,t){if(super.kd(e,t),this.isClipping&&this.type!==J.Spot&&this.isSubGraphExpanded){let i=this.resizeObject;i instanceof J&&(i=i.findMainElement()),null===this.he&&(this.he=new j),i.getDocumentBounds(this.he),i instanceof rt&&this.he.inflate(-i.strokeWidth,-i.strokeWidth)}}Pa(e,t,i,s){this.hasPlaceholder()&&(this.er=this.placeholder),super.Pa(e,t,i,s)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each(e=>{e.ensureBounds()}),super.ensureBounds()}_r(){if(!super._r())return!1;const e=this.memberParts;for(;e.next();){const t=e.value;if(t instanceof nt){if(!t.isVisible())continue;if(t.as())return!1}else if(t instanceof gt){if(!t.isVisible())continue;if(t.as()&&t.fromNode!==this&&t.toNode!==this)return!1}}return!0}hasPlaceholder(){return null!==this.Dt&&this.Dt.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.Dt}get computesBoundsAfterDrag(){return!!(2048&this.E)}set computesBoundsAfterDrag(e){const t=!!(2048&this.E);t!==e&&(this.E=2048^this.E,this.t("computesBoundsAfterDrag",t,e))}get computesBoundsIncludingLinks(){return!!(4096&this.E)}set computesBoundsIncludingLinks(e){const t=!!(4096&this.E);t!==e&&(this.E=4096^this.E,this.t("computesBoundsIncludingLinks",t,e))}get computesBoundsIncludingLocation(){return!!(8192&this.E)}set computesBoundsIncludingLocation(e){const t=!!(8192&this.E);t!==e&&(this.E=8192^this.E,this.t("computesBoundsIncludingLocation",t,e))}get handlesDragDropForMembers(){return!!(16384&this.E)}set handlesDragDropForMembers(e){const t=!!(16384&this.E);t!==e&&(this.E=16384^this.E,this.t("handlesDragDropForMembers",t,e))}get avoidableMembers(){return!!(131072&this.E)}set avoidableMembers(e){const t=!!(131072&this.E);t!==e&&(this.E=131072^this.E,this.t("avoidableMembers",t,e))}get memberParts(){return this.lg.iterator}uC(e){if(this.lg.add(e)){e instanceof pt&&this.Ch.add(e);const i=this.memberAdded;if(null!==i){let s=!0;const n=this.diagram;null!==n&&(s=n.G,n.G=!0),i(this,e),null!==n&&(n.G=s)}(!this.isVisible()||!this.isSubGraphExpanded)&&e.Xe(!1)}if(e instanceof gt&&!this.computesBoundsIncludingLinks)return;let t=this.Dt;null===t&&(t=this),t.c()}fC(e){if(this.lg.delete(e)){e instanceof pt&&this.Ch.delete(e);const i=this.memberRemoved;if(null!==i){let s=!0;const n=this.diagram;null!==n&&(s=n.G,n.G=!0),i(this,e),null!==n&&(n.G=s)}(!this.isVisible()||!this.isSubGraphExpanded)&&e.Xe(!0)}if(e instanceof gt&&!this.computesBoundsIncludingLinks)return;let t=this.Dt;null===t&&(t=this),t.c()}lf(){if(this.lg.count>0){const e=this.diagram;if(null!==e){const t=this.lg.copy().iterator;for(;t.next();)e.remove(t.value)}}super.lf()}get layout(){return this.li}set layout(e){const t=this.li;if(t!==e){null!==e&&null!==e.diagram&&e.diagram.layout===e&&y.o("A layout cannot be both the Diagram.layout and a Group.layout: "+e),null!==t&&(t.diagram=null,t.group=null),this.li=e;const i=this.diagram;null!==e&&(e.diagram=i,e.group=this),null!==i&&(i.$r=!0),this.t("layout",t,e),null!==i&&i.requestUpdate()}}get memberAdded(){return null!==this.vt?this.vt.Wy:null}set memberAdded(e){const t=this.memberAdded;t!==e&&(null!==e&&y.S(e,pt,"memberAdded"),this.wl().Wy=e,this.t("memberAdded",t,e))}get memberRemoved(){return null!==this.vt?this.vt.Jy:null}set memberRemoved(e){const t=this.memberRemoved;t!==e&&(null!==e&&y.S(e,pt,"memberRemoved"),this.wl().Jy=e,this.t("memberRemoved",t,e))}get memberValidation(){return null!==this.vt?this.vt.da:null}set memberValidation(e){const t=this.memberValidation;t!==e&&(null!==e&&y.S(e,pt,"memberValidation"),this.wl().da=e,this.t("memberValidation",t,e))}canAddMembers(e){const t=this.diagram;if(null===t)return!1;const i=t.commandHandler,s=i.wN(e).iterator;for(;s.next();)if(!i.isValidMember(this,s.value))return!1;return!0}addMembers(e,t){const i=this.diagram;if(null===i)return!1;const s=i.commandHandler;let o=!0;const r=s.wN(e).iterator;for(;r.next();){const a=r.value;!t||s.isValidMember(this,a)?a.containingGroup=this:o=!1}return o}get ungroupable(){return!!(256&this.E)}set ungroupable(e){const t=!!(256&this.E);t!==e&&(this.E=256^this.E,this.t("ungroupable",t,e))}canUngroup(){if(!this.ungroupable)return!1;const e=this.layer;if(null===e||!e.allowUngroup)return!1;const t=e.diagram;return!(null!==t&&!t.allowUngroup)}invalidateConnectedLinks(e){const t=this.ZE();if(super.invalidateConnectedLinks(e),t)return;this.cT(!0);const i=this.findExternalLinksConnected();for(;i.next();){const s=i.value;if(void 0!==e&&e.has(s))continue;const n=s.fromNode;if(null!==n&&n!==this&&n.isMemberOf(this)&&!n.isVisible())n.Ze(s.fromPort),n.Ze(s.toPort),s.$t();else{const o=s.toNode;null!==o&&o!==this&&o.isMemberOf(this)&&!o.isVisible()&&(o.Ze(s.fromPort),o.Ze(s.toPort),s.$t())}}}findExternalLinksConnected(){const e=null!==this.diagram&&this.diagram.u2;if(e&&null!==this.Fp)return this.Fp.iterator;const t=this.findSubGraphParts();t.add(this);const i=new z,s=t.iterator;for(;s.next();){const n=s.value;if(!(n instanceof nt))continue;const o=n.linksConnected;for(;o.next();){const r=o.value;t.has(r)||i.add(r)}}return e&&(this.Fp=i),i.iterator}findExternalNodesConnected(){const e=this.findSubGraphParts();e.add(this);const t=new z,i=e.iterator;for(;i.next();){const s=i.value;if(!(s instanceof nt))continue;const n=s.linksConnected;for(;n.next();){const o=n.value,r=o.fromNode;null!==r&&(!e.has(r)||r===this)&&t.add(r);const a=o.toNode;null!==a&&(!e.has(a)||a===this)&&t.add(a)}}return t.iterator}XU(){const t=new z;return function e(i,s){null!==i&&(s.add(i),e(i.containingGroup,s))}(this,t),t}findSubGraphParts(){const e=new z;return At.ga(e,this,!0,0,!0),e.delete(this),e}Xe(e){super.Xe(e);const t=this.memberParts;for(;t.next();)t.value.Xe(e)}collapseSubGraph(){const e=this.diagram;if(null===e||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;const t=this.findSubGraphParts();this.xv(t,e,this),e.isCollapsingExpanding=!1}xv(e,t,i){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Xe(!1),n instanceof pt&&n.isSubGraphExpanded&&(n.wasSubGraphExpanded=n.isSubGraphExpanded,n.xv(e,t,i)),n instanceof nt)n.invalidateConnectedLinks(e),t.Kc(n,i);else if(n instanceof gt){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(e)}}this.isSubGraphExpanded=!1}expandSubGraph(){const e=this.diagram;if(null===e||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;const t=this.findSubGraphParts();this.bv(t,e,this),e.isCollapsingExpanding=!1}bv(e,t,i){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Xe(!0),n instanceof pt&&n.wasSubGraphExpanded&&(n.wasSubGraphExpanded=!1,n.bv(e,t,i)),n instanceof nt)n.invalidateConnectedLinks(e);else if(n instanceof gt){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(e)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return!!(512&this.E)}set isSubGraphExpanded(e){const t=!!(512&this.E);if(t!==e){this.E=512^this.E;const i=this.diagram;this.t("isSubGraphExpanded",t,e);const s=this.subGraphExpandedChanged;if(null!==s){let n=!0;null!==i&&(n=i.G,i.G=!0),s(this),null!==i&&(i.G=n)}if(null!==i&&i.undoManager.isUndoingRedoing)return null!==this.Dt&&this.Dt.c(),void this.memberParts.each(n=>n.updateAdornments());e?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return!!(1024&this.E)}set wasSubGraphExpanded(e){const t=!!(1024&this.E);t!==e&&(this.E=1024^this.E,this.t("wasSubGraphExpanded",t,e))}get subGraphExpandedChanged(){return null!==this.vt?this.vt.$y:null}set subGraphExpandedChanged(e){const t=this.subGraphExpandedChanged;t!==e&&(null!==e&&y.S(e,pt,"subGraphExpandedChanged"),this.wl().$y=e,this.t("subGraphExpandedChanged",t,e))}move(e,t){void 0===t&&(t=!1);const i=t?this.location:this.position,s=i.x,n=i.y,o=e.x,r=e.y;if((s===o||isNaN(s)&&isNaN(o))&&(n===r||isNaN(n)&&isNaN(r)))return;const a=o-(isNaN(s)?0:s),l=r-(isNaN(n)?0:n),h=S.l();super.move(e,t);const c=new z,u=this.findSubGraphParts().iterator;for(;u.next();){const d=u.value;d instanceof gt&&(d.suspendsRouting&&c.add(d),(d.Fi||d.fromNode!==this&&d.toNode!==this)&&(d.suspendsRouting=!0))}for(u.reset();u.next();){const d=u.value;if(d.Ar()||d instanceof nt&&d.isLinkLabel)continue;const f=d.position,p=d.location;f.isReal()?(h.x=f.x+a,h.y=f.y+l,d.position=h):p.isReal()&&(h.x=p.x+a,h.y=p.y+l,d.location=h)}for(u.reset();u.next();){const d=u.value;if(!(d instanceof gt&&(d.suspendsRouting=c.has(d),d.Fi||d.fromNode!==this&&d.toNode!==this)))continue;const f=d.position;h.x=f.x+a,h.y=f.y+l,h.isReal()?d.move(h):d.$t()}S.i(h)}ZE(){return!!(65536&this.E)}cT(e){!!(65536&this.E)!==e&&(this.E=65536^this.E)}get Lh(){return!!(32768&this.E)}set Lh(e){!!(32768&this.E)!==e&&(this.E=32768^this.E)}}class de extends st{Qt;ag;constructor(e){super(),this.Qt=It.im,this.ag=new j(NaN,NaN,NaN,NaN),e&&Object.assign(this,e)}cloneProtected(e){super.cloneProtected(e),e.Qt=this.Qt.N(),e.ag=this.ag.copy()}ka(e){if(null===this.background)return!1;const t=this.naturalBounds;return j.contains(0,0,t.width,t.height,e.x,e.y)}bd(e,t,i,s){const n=this.part;if((null===n||!(n instanceof pt)&&!(n instanceof Nt))&&y.o("Placeholder is not inside a Group or Adornment."),n instanceof pt){const o=this.computeBorder(this.ag),r=this.minSize,a=isFinite(r.width)?Math.max(r.width,o.width):o.width,l=isFinite(r.height)?Math.max(r.height,o.height):o.height,h=this.Ke;h.jn(a||0,l||0),this.lo(0,0,h.width,h.height);const c=n.memberParts;let u=!1;for(;c.next();)if(c.value.isVisible()){u=!0;break}const d=n.diagram;if(u&&null!==d&&!d.animationManager.CM(n)&&!isNaN(o.x)&&!isNaN(o.y)){const f=S.l();f.setRectSpot(o,n.locationSpot),n.location=f,S.i(f)}}else{const o=n,r=this.Ke,a=this.Qt,l=a.left+a.right,h=a.top+a.bottom,c=o.adornedObject,u=c.getDocumentAngle();o.angle=u;let d=0;c instanceof rt&&(d=c.strokeWidth);const f=c.getDocumentScale(),p=c.naturalBounds,g=(p.width+d)*f,b=(p.height+d)*f;if(o.type!==J.Link){const v=c.getDocumentPoint("Selection"===o.category?A.TopLeft:o.locationSpot,S.l());o.location=v,S.i(v)}if(isNaN(g)||isNaN(b)){const x=c.getDocumentPoint(A.TopLeft,S.l()),v=j.z(x.x,x.y,0,0);v.unionPoint(c.getDocumentPoint(A.BottomRight,x)),v.unionPoint(c.getDocumentPoint(A.TopRight,x)),v.unionPoint(c.getDocumentPoint(A.BottomLeft,x)),r.jn(v.width+l||0,v.height+h||0),this.lo(-a.left,-a.top,r.width,r.height),S.i(x),j.i(v)}else r.jn(g+l||0,b+h||0),this.lo(-a.left,-a.top,r.width,r.height)}}Pa(e,t,i,s){this.actualBounds.e(e,t,i,s)}computeBorder(e){const t=this.part,i=t.diagram;if(null===i||i.animationManager.isAnimating)return e;if(t instanceof pt&&!t.layer.isTemporary&&t.computesBoundsAfterDrag&&this.ag.isReal()){const r=i.toolManager.findTool("Dragging");if(r===i.currentTool&&r.mR(t,this.ag,e))return e}const s=j.l(),n=this.computeMemberBounds(s),o=this.Qt;return t instanceof pt&&!t.isSubGraphExpanded?e.e(n.x-o.left,n.y-o.top,0,0):e.e(n.x-o.left,n.y-o.top,Math.max(n.width+o.left+o.right,0),Math.max(n.height+o.top+o.bottom,0)),j.i(s),t instanceof pt&&t.computesBoundsIncludingLocation&&t.location.isReal()&&e.unionPoint(t.location),e}computeMemberBounds(e){if(!(this.part instanceof pt))return e.e(0,0,0,0),e;const t=this.part;let i=1/0,s=1/0,n=-1/0,o=-1/0;const r=t.memberParts;for(;r.next();){const a=r.value;if(!a.isVisible()||a instanceof gt&&(!t.computesBoundsIncludingLinks||a.Go()||a.fromNode===t||a.toNode===t))continue;const l=a.actualBounds;l.left<i&&(i=l.left),l.top<s&&(s=l.top),l.right>n&&(n=l.right),l.bottom>o&&(o=l.bottom)}if(isFinite(i)&&isFinite(s))e.e(i,s,n-i,o-s);else{const a=t.location;e.e(a.x,a.y,0,0)}return e}get padding(){return this.Qt}set padding(e){"number"==typeof e&&(e=new It(e));const t=this.Qt;t.equals(e)||(e=e.N(),this.Qt=e,this.t("padding",t,e),this.c())}}class se{a;Ah;hg;Tr;cg;fg;Vo;Pl;ug;dg;Po;constructor(e){z.Je(this),this.a=null,this.Ah=null,this.hg=!0,this.Tr=!0,this.cg=!1,this.fg=new S(0,0),this.Vo=!0,this.Pl=null,this.ug=null,this.dg=!1,this.Po=null,e&&Object.assign(this,e)}cloneProtected(e){e.hg=this.hg,e.Tr=this.Tr,e.cg=this.cg,e.fg.h(this.fg),e.Vo=this.Vo,e.Pl=this.Pl,e.ug=this.ug,e.dg=!0}copy(){const e=new this.constructor;return this.cloneProtected(e),e}fe(e){y.dr(this,e)}toString(){let e=y.Hn(this.constructor);return e+="(",null!==this.group&&(e+=" in "+this.group),null!==this.diagram&&(e+=" for "+this.diagram),e+=")",e}get diagram(){return this.a}set diagram(e){this.a=e}get group(){return this.Ah}set group(e){this.Ah!==e&&(this.Ah=e,null!==e&&(this.a=e.diagram))}get isOngoing(){return this.hg}set isOngoing(e){this.hg!==e&&(y.s(e,"boolean",se,"isOngoing"),this.hg=e)}get isInitial(){return this.Tr}set isInitial(e){y.s(e,"boolean",se,"isInitial"),this.Tr=e,e||(this.dg=!0)}get isViewportSized(){return this.cg}set isViewportSized(e){this.cg!==e&&(y.s(e,"boolean",se,"isViewportSized"),this.cg=e,e&&this.p())}get isRouting(){return this.Vo}set isRouting(e){this.Vo!==e&&(y.s(e,"boolean",se,"isRouting"),this.Vo=e)}get isRealtime(){return this.Pl}set isRealtime(e){this.Pl!==e&&(null!==e&&y.s(e,"boolean",se,"isRealtime"),this.Pl=e)}get isValidLayout(){return this.dg}set isValidLayout(e){if(this.dg!==e&&(y.s(e,"boolean",se,"isValidLayout"),this.dg=e,!e)){const t=this.diagram;null!==t&&(t.$r=!0)}}invalidateLayout(){if(!this.isValidLayout)return;const e=this.diagram;if(null===e||e.undoManager.isUndoingRedoing)return;const t=e.animationManager;t.isTicking||(t.defaultAnimation.isAnimating&&t.stopAnimation(),(this.isOngoing&&e.Qa||this.isInitial&&!e.Qa)&&(this.isValidLayout=!1,e.requestUpdate()))}p(){this.invalidateLayout()}get network(){return this.Po}set network(e){this.Po!==e&&(this.Po=e,null!==e&&(e.layout=this))}createNetwork(){return new Ie(this)}makeNetwork(e){const t=this.createNetwork();return e instanceof U?(t.addParts(e.nodes,!0),t.addParts(e.links,!0)):t.addParts(e instanceof pt?e.memberParts:e.iterator),t}updateParts(){this.isValidLayout=!0;let e=this.diagram;if(null===e&&null!==this.network){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value.node;if(null!==i&&(e=i.diagram,null!==e))break}}try{null!==e&&e.startTransaction("Layout"),this.commitLayout()}finally{null!==e&&e.commitTransaction("Layout")}}commitLayout(){if(null===this.network)return;const e=this.network.vertexes.iterator;for(;e.next();)e.value.commit();if(this.isRouting){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}doLayout(e){const t=new z;if(e instanceof U?(this.Ea(t,e.nodes,!0,this.Lh,!0,!1,!0),this.Ea(t,e.parts,!0,this.Lh,!0,!1,!0)):e instanceof pt?this.Ea(t,e.memberParts,!1,this.Lh,!0,!1,!0):t.addAll(e.iterator),t.count>0){const i=this.diagram;null!==i&&i.startTransaction("Layout"),this.doMinimalNoNetworkLayout(t),null!==i&&i.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(e){const i=Math.ceil(Math.sqrt(e.count));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const s=this.arrangementOrigin.x;let o=s,r=this.arrangementOrigin.y,a=0,l=0;const h=e.iterator;for(;h.next();){const c=h.value;c.ensureBounds();const u=c.measuredBounds,d=u.width,f=u.height;c.moveTo(o,r),c instanceof pt&&(c.Lh=!1),o+=Math.max(d,50)+20,l=Math.max(l,Math.max(f,50)),a>=i-1?(a=0,o=s,r+=l+20,l=0):a++}}Lh(e){return!!(!e.location.isReal()&&!e.position.isReal()||e instanceof pt&&e.Lh)}Ea(e,t,i,s,n,o,r){const a=t.iterator;for(;a.next();){const l=a.value;if((!i||l.isTopLevel)&&(null===s||s(l))&&l.canLayout())if(n&&l instanceof nt){if(l.isLinkLabel)continue;l instanceof pt&&null===l.layout?this.Ea(e,l.memberParts,!1,s,n,o,r):(l.ensureBounds(),e.add(l))}else o&&l instanceof gt?e.add(l):r&&l.Di()&&!(l instanceof nt)&&(l.ensureBounds(),e.add(l))}}getLayoutBounds(e,t){const i=this.boundsComputation;return null!==i?(t||(t=new j),i(e,this,t)):!t&&e.margin.equalTo(0,0,0,0)?e.actualBounds:(t||(t=new j),t.set(e.actualBounds),t.addMargin(e.margin),t)}get boundsComputation(){return this.ug}set boundsComputation(e){this.ug!==e&&(null!==e&&y.S(e,se,"boundsComputation"),this.ug=e,this.p())}collectParts(e){const t=new z;return e instanceof U?(this.Ea(t,e.nodes,!0,null,!0,!0,!0),this.Ea(t,e.links,!0,null,!0,!0,!0),this.Ea(t,e.parts,!0,null,!0,!0,!0)):this.Ea(t,e instanceof pt?e.memberParts:e.iterator,!1,null,!0,!0,!0),t}get arrangementOrigin(){return this.fg}set arrangementOrigin(e){this.fg.equals(e)||(this.fg.h(e),this.p())}initialOrigin(e){const t=this.group;if(null!==t){if(t.hasPlaceholder()){const i=t.placeholder,s=i.getDocumentPoint(A.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(e);const n=i.padding;return s.x+=n.left,s.y+=n.top,s}{const i=t.position.copy();return(isNaN(i.x)||isNaN(i.y))&&i.set(e),i}}return e}}class Ie{li;So;In;ew;iw;constructor(e){z.Je(this),this.li=e,this.So=new z,this.In=new z,this.ew=new xt,this.iw=new xt}clear(){if(this.So){const e=this.So.iterator;for(;e.next();)e.value.clear()}if(this.In){const e=this.In.iterator;for(;e.next();)e.value.clear()}this.So=new z,this.In=new z,this.ew=new xt,this.iw=new xt}toString(e){void 0===e&&(e=0);let t="LayoutNetwork"+(null!==this.layout?"("+this.layout.toString()+")":"");if(e<=0)return t;if(t+=" vertexes: "+this.So.count+" edges: "+this.In.count,e>1){const i=this.So.iterator;for(;i.next();)t+="\n    "+i.value.toString(e-1);const s=this.In.iterator;for(;s.next();)t+="\n    "+s.value.toString(e-1)}return t}get layout(){return this.li}set layout(e){null!==e&&(this.li=e)}get vertexes(){return this.So}get edges(){return this.In}createVertex(){return new Be(this)}createEdge(){return new si(this)}addParts(e,t,i){if(null===e)return;void 0===t&&(t=!1),y.s(t,"boolean",Ie,"addParts:toplevelonly"),void 0===i&&(i=null),null===i&&(i=n=>{if(n instanceof nt)return!n.isLinkLabel;if(n instanceof gt){const o=n.fromNode;if(null===o||o.isLinkLabel)return!1;const r=n.toNode;return!(null===r||r.isLinkLabel)}return!1});const s=e.iterator;for(;s.next();){const n=s.value;if(n instanceof nt&&(!t||n.isTopLevel)&&n.canLayout()&&i(n))if(n instanceof pt&&null===n.layout)this.addParts(n.memberParts,!1);else{if(null!==this.findVertex(n))continue;const o=this.createVertex();o.node=n,this.addVertex(o)}}for(s.reset();s.next();){const n=s.value;if(!(n instanceof gt)||t&&!n.isTopLevel||!n.canLayout()||!i(n)||null!==this.findEdge(n))continue;const o=n.fromNode,r=n.toNode;if(null===o||null===r||o===r)continue;const a=this.findGroupVertex(o),l=this.findGroupVertex(r);this.linkVertexes(a,l,n)}}findGroupVertex(e){const t=e.findVisibleNode();if(null===t)return null;let i=this.findVertex(t);if(null!==i)return i;let s=t.containingGroup;for(;null!==s;){if(i=this.findVertex(s),null!==i)return i;s=s.containingGroup}return null}addVertex(e){this.So.add(e);const t=e.node;null!==t&&this.ew.set(t,e),e.network=this}addNode(e){let t=this.findVertex(e);return null===t&&(t=this.createVertex(),t.node=e,this.addVertex(t)),t}deleteVertex(e){if(this.kv(e)){let t=e.nr;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}t=e.or;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}}}kv(e){const t=this.So.delete(e);if(t){const i=e.node;null!==i&&this.ew.delete(i)}return t}deleteNode(e){const t=this.findVertex(e);null!==t&&this.deleteVertex(t)}findVertex(e){return this.ew.get(e)}addEdge(e){this.UC(e);const t=e.toVertex;null!==t&&t.addSourceEdge(e);const i=e.fromVertex;null!==i&&i.addDestinationEdge(e)}UC(e){this.In.add(e);const t=e.link;null!==t&&null===this.findEdge(t)&&this.iw.set(t,e),e.network=this}addLink(e){const t=e.fromNode,i=e.toNode;let s=this.findEdge(e);return null===s?(s=this.createEdge(),s.link=e,null!==t&&(s.fromVertex=this.addNode(t)),null!==i&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(s.fromVertex=null!==t?this.addNode(t):null,s.toVertex=null!==i?this.addNode(i):null),s}deleteEdge(e){const t=e.toVertex;null!==t&&t.deleteSourceEdge(e);const i=e.fromVertex;null!==i&&i.deleteDestinationEdge(e),this.VC(e)}VC(e){const t=this.In.delete(e);if(t){const i=e.link;null!==i&&this.iw.delete(i)}return t}deleteLink(e){const t=this.findEdge(e);null!==t&&this.deleteEdge(t)}findEdge(e){return this.iw.get(e)}linkVertexes(e,t,i){if(null===e||null===t)return null;if(e.network===this&&t.network===this){const s=this.createEdge();return s.link=i,s.fromVertex=e,s.toVertex=t,this.addEdge(s),s}return null}reverseEdge(e){const t=e.fromVertex,i=e.toVertex;null===t||null===i||(t.deleteDestinationEdge(e),i.deleteSourceEdge(e),e.reverseEdge(),t.addSourceEdge(e),i.addDestinationEdge(e))}deleteSelfEdges(){const e=y.nt(),t=this.In.iterator;for(;t.next();){const s=t.value;s.fromVertex===s.toVertex&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);y.Z(e)}deleteArtificialVertexes(){const e=y.nt(),t=this.So.iterator;for(;t.next();){const o=t.value;null===o.node&&null===o.data&&e.push(o)}let i=e.length;for(let o=0;o<i;o++)this.deleteVertex(e[o]);const s=y.nt(),n=this.In.iterator;for(;n.next();){const o=n.value;null===o.link&&null===o.data&&s.push(o)}i=s.length;for(let o=0;o<i;o++)this.deleteEdge(s[o]);y.Z(e),y.Z(s)}deleteUselessEdges(){const e=y.nt(),t=this.In.iterator;for(;t.next();){const s=t.value;(null===s.fromVertex||null===s.toVertex)&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);y.Z(e)}isSingleton(e){return!(e.nr.count>0||e.or.count>0)}splitIntoSubNetworks(e){void 0===e&&(e=!0),e&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());const t=new H;let i=!0;for(;i;){i=!1;const s=this.So.iterator;for(;s.next();){const n=s.value;if(this.isSingleton(n))continue;const o=this.layout.createNetwork();t.add(o),this.QE(o,n),i=!0;break}}return t.sort((s,n)=>null===s||null===n||s===n?0:n.vertexes.count-s.vertexes.count),t}QE(e,t){if(null===t)return;const i=new H;for(i.add(t);i.count>0;){const s=i.first();if(i.removeAt(0),!s||s.network===e)continue;this.kv(s),e.addVertex(s);let n=s.sourceEdges;for(;n.next();){const o=n.value;o.network!==e&&(this.VC(o),e.UC(o),o.fromVertex&&i.add(o.fromVertex))}for(n=s.destinationEdges;n.next();){const o=n.value;o.network!==e&&(this.VC(o),e.UC(o),o.toVertex&&i.add(o.toVertex))}}}findAllParts(){const e=new z,t=this.So.iterator;for(;t.next();){const s=t.value;s.node&&e.add(s.node)}const i=this.In.iterator;for(;i.next();){const s=i.value;s.link&&e.add(s.link)}return e}}class Be{Po;te;Ri;Ui;is;nr;or;constructor(e){z.Je(this),this.Po=e,this.Ui=new j(0,0,10,10),this.is=new S(5,5),this.te=null,this.Ri=null,this.nr=new H,this.or=new H}clear(){this.te=null,this.Ri=null,this.nr=new H,this.or=new H}toString(e){void 0===e&&(e=0);let t="LayoutVertex#"+z.xs(this);if(e>0&&(t+=null!==this.node?"("+this.node.toString()+")":"",e>1)){let i="",s=!0,n=this.nr.iterator;for(;n.next();)s?s=!1:i+=",",i+=n.value.toString(0);let o="";for(s=!0,n=this.or.iterator;n.next();)s?s=!1:o+=",",o+=n.value.toString(0);t+=" sources: "+i+" destinations: "+o}return t}get Mo(){return this.nr.AL}get rr(){return this.or.AL}get data(){return this.te}set data(e){if(this.te=e,null!==e&&e.bounds){const t=e.bounds,i=t.x,s=t.y,n=t.width,o=t.height;this.is.e(n/2,o/2),this.Ui.e(i,s,n,o)}}get node(){return this.Ri}set node(e){if(this.Ri!==e){if(this.Ri=e,null===e)return;e.ensureBounds();const t=this.network.layout,i=j.l(),s=t.getLayoutBounds(e,i);let n=s.x,o=s.y;const r=s.width,a=s.height;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this.Ui.e(n,o,r,a),j.i(i),!(e instanceof pt)){const l=e.locationObject.getDocumentPoint(A.Center);if(l.isReal())return void this.is.e(l.x-n,l.y-o)}this.is.e(r/2,a/2)}}get bounds(){return this.Ui}set bounds(e){this.Ui.equals(e)||this.Ui.h(e)}get focus(){return this.is}set focus(e){this.is.equals(e)||this.is.h(e)}get centerX(){return this.Ui.x+this.is.x}set centerX(e){const t=this.Ui;t.x+this.is.x!==e&&(t.x=e-this.is.x)}get centerY(){return this.Ui.y+this.is.y}set centerY(e){const t=this.Ui;t.y+this.is.y!==e&&(t.y=e-this.is.y)}get focusX(){return this.is.x}set focusX(e){const t=this.is;t.x!==e&&(t.x=e)}get focusY(){return this.is.y}set focusY(e){const t=this.is;t.y!==e&&(t.y=e)}get x(){return this.Ui.x}set x(e){const t=this.Ui;t.x!==e&&(t.x=e)}get y(){return this.Ui.y}set y(e){const t=this.Ui;t.y!==e&&(t.y=e)}get width(){return this.Ui.width}set width(e){const t=this.Ui;t.width!==e&&(t.width=e)}get height(){return this.Ui.height}set height(e){const t=this.Ui;t.height!==e&&(t.height=e)}commit(){const e=this.te;if(null!==e){const i=this.bounds,s=e.bounds;return void(y.$(s)?(s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height):e.bounds=i.copy())}const t=this.node;if(null!==t){const i=this.bounds;if(!(t instanceof pt)){const s=j.l();t.ensureBounds();const n=this.network.layout.getLayoutBounds(t,s),o=t.locationObject.getDocumentPoint(A.Center);if(n.isReal()&&o.isReal())return t.moveTo(i.x+this.focusX-(o.x-n.x)+t.margin.left,i.y+this.focusY-(o.y-n.y+t.margin.top)),void j.i(s);j.i(s)}t.moveTo(i.x+t.margin.left,i.y+t.margin.top)}}addSourceEdge(e){null!==e&&(this.nr.has(e)||this.nr.add(e))}deleteSourceEdge(e){null!==e&&this.nr.delete(e)}addDestinationEdge(e){null!==e&&(this.or.has(e)||this.or.add(e))}deleteDestinationEdge(e){null!==e&&this.or.delete(e)}get network(){return this.Po}set network(e){this.Po=e}get sourceVertexes(){const e=new z,t=this.sourceEdges;for(;t.next();){const i=t.value;i.fromVertex&&e.add(i.fromVertex)}return e.iterator}get destinationVertexes(){const e=new z,t=this.destinationEdges;for(;t.next();){const i=t.value;i.toVertex&&e.add(i.toVertex)}return e.iterator}get vertexes(){const e=new z;let t=this.sourceEdges;for(;t.next();){const i=t.value;i.fromVertex&&e.add(i.fromVertex)}for(t=this.destinationEdges;t.next();){const i=t.value;i.toVertex&&e.add(i.toVertex)}return e.iterator}get sourceEdges(){return this.nr.iterator}get destinationEdges(){return this.or.iterator}get edges(){const e=new H;let t=this.sourceEdges;for(;t.next();)e.add(t.value);for(t=this.destinationEdges;t.next();)e.add(t.value);return e.iterator}get edgesCount(){return this.nr.count+this.or.count}static standardComparer(e,t){const i=e.Ri,s=t.Ri;if(i){if(s){const n=i.text,o=s.text;return n<o?-1:n>o?1:0}return 1}return null!==s?-1:0}static smartComparer(e,t){if(null!==e){if(null!==t){const i=e.Ri,s=t.Ri;if(null!==i){if(null!==s){const n=i.text.toLocaleLowerCase(),o=s.text.toLocaleLowerCase(),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),a=o.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let l=0;for(;l<r.length;l++){if(""!==a[l]&&void 0!==a[l]){const h=parseFloat(r[l]),c=parseFloat(a[l]);if(isNaN(h)){if(isNaN(c)){if(0!==r[l].localeCompare(a[l]))return r[l].localeCompare(a[l]);continue}return 1}if(isNaN(c))return-1;if(h-c!==0)return h-c;continue}if(""!==r[l])return 1}return""!==a[l]&&void 0!==a[l]?-1:0}return 1}return null!==s?-1:0}return 1}return null!==t?-1:0}}class si{Po;te;es;ss;ns;constructor(e){z.Je(this),this.Po=e,this.te=null,this.es=null,this.ss=null,this.ns=null}clear(){this.te=null,this.es=null,this.ss=null,this.ns=null}toString(e){void 0===e&&(e=0);let t="LayoutEdge#"+z.xs(this);return e>0&&(t+=null!==this.es?"("+this.es.toString()+")":"",e>1&&(t+=" "+(this.ss?this.ss.toString():"null")+" --\x3e "+(this.ns?this.ns.toString():"null"))),t}reverseEdge(){const e=this.ss;this.ss=this.ns,this.ns=e}commit(){}getOtherVertex(e){return this.ns===e?this.ss:this.ss===e?this.ns:null}get network(){return this.Po}set network(e){this.Po=e}get data(){return this.te}set data(e){this.te!==e&&(this.te=e)}get link(){return this.es}set link(e){this.es!==e&&(this.es=e)}get fromVertex(){return this.ss}set fromVertex(e){this.ss!==e&&(this.ss=e)}get toVertex(){return this.ns}set toVertex(e){this.ns!==e&&(this.ns=e)}}var Ji=(m=>(m[m.Position=0]="Position",m[m.Location=1]="Location",m))(Ji||{}),Zi=(m=>(m[m.LeftToRight=10]="LeftToRight",m[m.RightToLeft=11]="RightToLeft",m))(Zi||{}),Qi=(m=>(m[m.Forwards=20]="Forwards",m[m.Reverse=21]="Reverse",m[m.Ascending=22]="Ascending",m[m.Descending=23]="Descending",m))(Qi||{});let Ys=(()=>{class m extends se{gg;mg;Oo;En;de;He;Si;Mi;constructor(t){super(),this.isViewportSized=!0,this.gg=NaN,this.mg=NaN,this.Oo=new lt(NaN,NaN).k(),this.En=new lt(10,10).k(),this.de=1,this.He=10,this.Si=22,this.Mi=m.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.gg=this.gg,t.mg=this.mg,t.Oo.h(this.Oo),t.En.h(this.En),t.de=this.de,t.He=this.He,t.Si=this.Si,t.Mi=this.Mi}fe(t){t in Qi?this.sorting=t:t in Zi?this.arrangement=t:t in Ji?this.alignment=t:super.fe(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.collectParts(t),s=this.diagram,n=i.copy().iterator;for(;n.next();){const p=n.value;if(!p.Ar()||null===p.fromNode&&null===p.toNode){if(p.ensureBounds(),p instanceof pt){const g=p.memberParts;for(;g.next();)i.delete(g.value)}}else i.delete(p)}const o=i.toArray();if(0===o.length)return;switch(this.sorting){case 20:break;case 21:o.reverse();break;case 22:o.sort(this.comparer);break;case 23:o.sort(this.comparer),o.reverse()}let r=this.wrappingColumn;isNaN(r)&&(r=0);let a=this.wrappingWidth;if(isNaN(a)&&null!==s){const g=s.padding;a=Math.max(s.viewportBounds.width-g.left-g.right,0)}else a=Math.max(this.wrappingWidth,0);r<=0&&a<=0&&(r=1);let l=this.spacing.width;isFinite(l)||(l=0);let h=this.spacing.height;isFinite(h)||(h=0),null!==s&&s.startTransaction("Layout");const c=[];switch(this.alignment){case 0:this._E(o,a,r,l,h,c);break;case 1:this.t3(o,a,r,l,h,c)}let u=0,d=0,f=0;for(let p=0;p<c.length;p++){const g=c[p];u=Math.min(u,g.x),d=Math.min(d,g.y),f=Math.max(f,g.x+g.width)}this.commitLayers(c,new S(11===this.arrangement?u+l/2-(f+u):u-l/2,d-h/2)),null!==s&&s.commitTransaction("Layout"),this.isValidLayout=!0}_E(t,i,s,n,o,r){const a=j.l();let l=Math.max(this.cellSize.width,1);if(!isFinite(l)){l=0;for(let x=0;x<t.length;x++){const P=this.getLayoutBounds(t[x],a);l=Math.max(l,P.width)}}l+=n,l=Math.max(l,1);let h=Math.max(this.cellSize.height,1);if(!isFinite(h)){h=0;for(let x=0;x<t.length;x++){const P=this.getLayoutBounds(t[x],a);h=Math.max(h,P.height)}}h+=o,h=Math.max(h,1);const c=this.arrangement,u=this.arrangementOrigin.x;let f=u,p=this.arrangementOrigin.y,g=0,b=0;for(let x=0;x<t.length;x++){const v=t[x],P=this.getLayoutBounds(v,a),C=Math.ceil((P.width+n)/l)*l,N=Math.ceil((P.height+o)/h)*h;let I=0;I=11===c?Math.abs(f-P.width):f+P.width,(s>0&&g>s-1||i>0&&g>0&&I-u>i)&&(r.push(new j(0,p,i+n,b)),g=0,f=u,p+=b,b=0),b=Math.max(b,N);let T=0;T=11===c?-P.width:0,11===(v.moveTo(f+T+v.margin.left,p+v.margin.top),c)?f-=C:f+=C,g++}r.push(new j(0,p,i+n,b)),j.i(a)}t3(t,i,s,n,o,r){const a=j.l();let l=Math.max(this.cellSize.width,1),h=0,c=0,u=0;const d=S.l();for(let T=0;T<t.length;T++){const D=t[T],F=this.getLayoutBounds(D,a),E=D.getRelativePoint(D.locationObject,D.locationSpot,d);h=Math.max(h,E.x),c=Math.max(c,F.width-E.x),u=Math.max(u,E.y)}const f=this.arrangement;11===f?h+=n:c+=n,l=isFinite(l)?Math.max(l+n,1):Math.max(h+c,1);const p=this.arrangementOrigin.x;let b=p,x=this.arrangementOrigin.y,v=0;i>=h&&(i-=h);let P=0,w=0;const M=Math.max(this.cellSize.height,1);u=0;let C=0,N=!0;const I=S.l();for(let T=0;T<t.length;T++){const D=t[T],F=this.getLayoutBounds(D,a),E=D.getRelativePoint(D.locationObject,D.locationSpot,d);if(v>0)switch(f){case 11:{let Y=(b-p-(F.width-E.x))/l;Y=L.X(Math.round(Y),Y)?Math.round(Y):Math.floor(Y),b=Y*l+p;break}default:{let Y=(b-p+E.x)/l;Y=L.X(Math.round(Y),Y)?Math.round(Y):Math.ceil(Y),b=Y*l+p;break}}else P=11===f?b+E.x+F.width:b-E.x;let B=0;if(B=11===f?-(b+E.x)+P:b+F.width-E.x-P,s>0&&v>s-1||i>0&&v>0&&B>i){r.push(new j(0,N?x-u:x,i+n,C+u+o));for(let Y=0;Y<v&&T!==v;Y++){const W=t[T-v+Y],$=W.getRelativePoint(W.locationObject,W.locationSpot,I);W.moveTo(W.position.x,W.position.y+u-$.y)}C+=o,x+=N?C:C+u,u=0,C=0,v=0,b=p,N=!1}11===(b===p&&(w=11===f?Math.max(w,F.width-E.x):Math.min(w,-E.x)),u=Math.max(u,E.y),C=Math.max(C,F.height-E.y),isFinite(M)&&(C=Math.max(C,Math.max(F.height,M)-E.y)),D.moveTo(b-E.x,N?x-E.y:x),f)?b-=E.x+n:b+=F.width-E.x+n,v++}if(r.push(new j(0,x,i+n,(N?C:C+u)+o)),t.length!==v)for(let T=0;T<v;T++){const D=t[t.length-v+T],F=D.getRelativePoint(D.locationObject,D.locationSpot,d);D.moveTo(D.position.x,D.position.y+u-F.y)}if(S.i(d),S.i(I),11===f)for(let T=0;T<r.length;T++){const D=r[T];D.width+=w,D.x-=w}else for(let T=0;T<r.length;T++){const D=r[T];D.x>w&&(D.width+=D.x-w,D.x=w)}j.i(a)}commitLayers(t,i){}get wrappingWidth(){return this.gg}set wrappingWidth(t){this.gg!==t&&(y.s(t,"number",m,"wrappingWidth"),(t>0||isNaN(t))&&(this.gg=t,this.isViewportSized=isNaN(t),this.p()))}get wrappingColumn(){return this.mg}set wrappingColumn(t){this.mg!==t&&(y.s(t,"number",m,"wrappingColumn"),(t>0||isNaN(t))&&(this.mg=t,this.p()))}get cellSize(){return this.Oo}set cellSize(t){this.Oo.equals(t)||(this.Oo.h(t),this.p())}get spacing(){return this.En}set spacing(t){this.En.equals(t)||(this.En.h(t),this.p())}get alignment(){return this.de}set alignment(t){this.de!==t&&(1===t||0===t)&&(this.de=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(10===t||11===t)&&(this.He=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(20===t||21===t||22===t||23===t)&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(y.S(t,m,"comparer"),this.Mi=t,this.p())}static standardComparer(t,i){const s=t.text,n=i.text;return s<n?-1:s>n?1:0}static smartComparer(t,i){if(null!==t){if(null!==i){const s=t.text.toLocaleLowerCase(),n=i.text.toLocaleLowerCase(),o=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let a=0;for(;a<o.length;a++){if(""!==r[a]&&void 0!==r[a]){const l=parseFloat(o[a]),h=parseFloat(r[a]);if(isNaN(l)){if(isNaN(h)){if(0!==o[a].localeCompare(r[a]))return o[a].localeCompare(r[a]);continue}return 1}if(isNaN(h))return-1;if(l-h!==0)return l-h;continue}if(""!==o[a])return 1}return""!==r[a]&&void 0!==r[a]?-1:0}return 1}return null!==i?-1:0}static Position=0;static Location=1;static LeftToRight=10;static RightToLeft=11;static Forward=20;static Reverse=21;static Ascending=22;static Descending=23}return m})(),pi=(()=>{class m{pg;rn;Ct;No;yg;wg;a;BC;constructor(){this.pg=new z,this.rn=new z,this.Ct=new z,this.No=new xt,this.yg=new xt,this.wg=new xt,this.a=null,this.BC=!1}clear(){this.pg.clear(),this.rn.clear(),this.Ct.clear(),this.No.clear(),this.yg.clear(),this.wg.clear()}Eo(t){this.a=t}ch(t){if(t instanceof nt){if(this.pg.add(t),t instanceof pt){const s=t.containingGroup;null===s?this.diagram.Zr.add(t):s.Ch.add(t);const n=t.layout;null!==n&&(n.diagram=this.diagram)}}else t instanceof gt?(this.rn.add(t),t.isAvoiding&&(this.diagram.lp=!0)):t instanceof Nt||this.Ct.add(t);const i=t.data;null!==i&&(t instanceof Nt||(t instanceof gt?this.Pv(i,t):this.No.set(i,t)))}ri(t){if(t.clearAdornments(),t instanceof nt){if(this.pg.delete(t),t instanceof pt){const s=t.containingGroup;null===s?this.diagram.Zr.delete(t):s.Ch.delete(t);const n=t.layout;null!==n&&(n.diagram=null)}}else t instanceof gt?this.rn.delete(t):t instanceof Nt||this.Ct.delete(t);const i=t.data;null!==i&&(t instanceof Nt||(t instanceof gt?this.Sv(i,t):this.No.delete(i)))}Pv(t,i){this.yg.set(t,i)}Sv(t,i){this.yg.delete(t)}rebuildParts(){const t=this.diagram;if(null===t)return;const i=t.nodeTemplateMap.iterator;for(;i.next();){const f=i.value,p=i.key;(!f.Di()||f instanceof pt)&&y.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${p}" must be a Node or a simple Part, not a Group or Link: ${f}`)}const s=t.groupTemplateMap.iterator;for(;s.next();){const f=s.value;f instanceof pt||y.o(`Invalid group template in Diagram.groupTemplateMap: template for "${s.key}" must be a Group, not a normal Node or Link: ${f}`)}const n=t.linkTemplateMap.iterator;for(;n.next();){const f=n.value;f instanceof gt||y.o(`Invalid link template in Diagram.linkTemplateMap: template for "${n.key}" must be a Link, not a normal Node or simple Part: ${f}`)}const o=y.nt(),r=t.selection.iterator;for(;r.next();){const f=r.value.data;f&&o.push(f)}const a=y.nt(),l=t.highlighteds.iterator;for(;l.next();){const f=l.value.data;f&&a.push(f)}const h=y.nt(),c=this.nodes.iterator;for(;c.next();){const f=c.value;null!==f.data&&(h.push(f.data),h.push(f.location))}const u=this.links.iterator;for(;u.next();){const f=u.value;null!==f.data&&(h.push(f.data),h.push(f.location))}const d=this.parts.iterator;for(;d.next();){const f=d.value;null!==f.data&&(h.push(f.data),h.push(f.location))}this.Mv(),this.D2();for(let f=0;f<o.length;f++){const p=this.findPartForData(o[f]);null!==p&&(p.isSelected=!0)}for(let f=0;f<a.length;f++){const p=this.findPartForData(a[f]);null!==p&&(p.isHighlighted=!0)}for(let f=0;f<h.length;f+=2){const p=this.findPartForData(h[f]);null!==p&&(p.location=h[f+1])}y.Z(o),y.Z(a),y.Z(h)}D2(){this.nw(this.diagram.model.nodeDataArray)}nw(t,i){const s=this.diagram.model;t.forEach(n=>{s.containsNodeData(n)&&this.Nv(n,!1)}),t.forEach(n=>{s.containsNodeData(n)&&this.Nk(n)}),!1!==i&&this.diagram.c1(!1)}Nv(t,i){if(null==t||this.diagram.undoManager.isUndoingRedoing||this.No.has(t))return null;void 0===i&&(i=!0);const s=this.e3(t);return null!==s&&i&&this.Nk(t),s}e3(t){if(null==t||this.diagram.undoManager.isUndoingRedoing||this.No.has(t))return null;const i=this.i3(t),s=this.findTemplateForNodeData(t,i);if(null!==s){s.It();const n=s.copy();if(null!==n){const o=this.diagram.wi;return this.diagram.wi=!0,n._o=i,n.te=t,this.addsToTemporaryLayer&&(n.dl="Tool"),this.diagram.add(n),n.te=null,n.data=t,this.diagram.wi=o,n}}return null}insertLink(t,i,s,n){return null}Nk(t){}i3(t){return this.diagram.model.getCategoryForNodeData(t)}static Cv=!1;static Lv=!1;findTemplateForNodeData(t,i){const s=this.diagram,n=s.model;let r=null;return n.uf()&&n.isGroupForData(t)?(r=s.groupTemplateMap.get(i),null===r&&(r=s.groupTemplateMap.get(""),null===r&&(m.Lv||(m.Lv=!0,y.ne('No Group template found for category "'+i+'"'),y.ne("  Using default group template")),r=s.s2))):(r=s.nodeTemplateMap.get(i),null===r&&(r=s.nodeTemplateMap.get(""),null===r&&(m.Cv||(m.Cv=!0,y.ne('No Node template found for category "'+i+'"'),y.ne("  Using default node template")),r=s.t2))),r}getLinkCategoryForData(t){return""}setLinkCategoryForData(t,i){}setFromNodeForLink(t,i,s){}setToNodeForLink(t,i,s){}static Av=!1;findLinkTemplateForCategory(t){const i=this.diagram;let s=i.linkTemplateMap.get(t);return null===s&&(s=i.linkTemplateMap.get(""),null===s&&(m.Av||(m.Av=!0,y.ne('No Link template found for category "'+t+'"'),y.ne("  Using default link template")),s=i.e2)),s}WI(t,i,s){t instanceof gt?(null!==i&&this.Sv(i,t),null!==s&&this.Pv(s,t)):t instanceof At&&(null!==i&&this.No.delete(i),null!==s&&this.No.set(s,t))}Mv(){this.zC(this.diagram.model.nodeDataArray)}zC(t){t.forEach(i=>{this.Ck(i)})}Ck(t){const i=this.findPartForData(t);null!==i&&(this.diagram.L2(i,!1),this.XC(i))}XC(t){}AC(t){}findPartForKey(t){if(null==t)return null;const i=this.diagram.model.findNodeDataForKey(t);return null!==i?this.No.get(i):null}findNodeForKey(t){if(null==t)return null;const i=this.diagram.model.findNodeDataForKey(t);if(null===i)return null;const s=this.No.get(i);return s instanceof nt?s:null}findLinkForKey(t){return null}findPartForData(t){if(null===t)return null;let i=this.No.get(t);return null!==i||(i=this.yg.get(t)),i}findNodeForData(t){if(null===t)return null;const i=this.No.get(t);return i instanceof nt?i:null}findLinkForData(t,i){return null===t?null:this.yg.get(t)}findNodesByExample(...t){const i=new z,s=this.pg.iterator;for(;s.next();){const n=s.value,o=n.data;if(null!==o)for(let r=0;r<arguments.length;r++){const a=arguments[r];if(y.$(a)&&this.GC(o,a)){i.add(n);break}}}return i.iterator}findLinksByExample(...t){const i=new z,s=this.rn.iterator;for(;s.next();){const n=s.value,o=n.data;if(null!==o)for(let r=0;r<arguments.length;r++){const a=arguments[r];if(y.$(a)&&this.GC(o,a)){i.add(n);break}}}return i.iterator}GC(t,i){for(const s in i){const n=t[s],o=i[s];if(Array.isArray(o)){if(!Array.isArray(n))return!1;const r=n,a=o;if(r.length<a.length)return!1;for(let l=0;l<r.length;l++){const c=a[l];if(void 0!==c&&!this.Tv(r[l],c))return!1}}else if(!this.Tv(n,o))return!1}return!0}Tv(t,i){if(y.st(i)){if(!i(t))return!1}else if(i instanceof RegExp){if(!t||!i.test(t.toString()))return!1}else if(y.$(t)&&y.$(i)){if(!this.GC(t,i))return!1}else if(t!==i)return!1;return!0}doModelDataChanged(t){if(t.model===this.diagram.model&&this.diagram.G){this.diagram.G=!1;try{""===t.modelChange&&null!==t.object&&2===t.change&&this.ow(t.object,t.propertyName)}finally{this.diagram.G=!0}}}doModelChanged(t){const i=this.diagram;if(!i||t.model!==i.model)return;const s=t.change;if(i.LO(t),i.G){i.G=!1;try{const n=t.modelChange;if(""!==n)if(2===s){if("nodeCategory"===n){const o=t.object;if(null!==o){const r=this.findPartForData(o),a=t.newValue;null!==r&&"string"==typeof a&&(r.category=a)}}else"nodeDataArray"===n&&(this.zC(t.oldValue),this.nw(t.newValue));i.isModified=!0}else if(3===s){const o=t.newValue;"nodeDataArray"===n&&y.$(o)&&this.Nv(o),i.isModified=!0}else if(4===s){const o=t.oldValue;"nodeDataArray"===n&&y.$(o)&&this.Ck(o),i.isModified=!0}else 1===s&&("SourceChanged"===n?null!==t.object?this.ow(t.object,t.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):"ModelDisplaced"===n&&this.rebuildParts());else if(2===s){const o=t.propertyName,r=t.object;r===i.model?("nodeKeyProperty"===o||"nodeCategoryProperty"===o)&&(i.undoManager.isUndoingRedoing||this.rebuildParts()):null!==r&&this.ow(r,o),i.isModified=!0}else(3===s||4===s)&&(this.s3(t,i.model),i.isModified=!0)}finally{i.G=!0}}}updateAllTargetBindings(t){void 0===t&&(t="");let i=this.parts.iterator;for(;i.next();)i.value.updateTargetBindings(t);for(i=this.nodes.iterator;i.next();)i.value.updateTargetBindings(t);for(i=this.links.iterator;i.next();)i.value.updateTargetBindings(t)}updateAllThemeBindings(){let t=this.parts.iterator;for(;t.next();)t.value.Yo();for(t=this.nodes.iterator;t.next();)t.value.Yo();for(t=this.links.iterator;t.next();)t.value.Yo()}updateAllRelationshipsFromData(){const t=this.diagram.model,i=new z,s=t.nodeDataArray;for(let r=0;r<s.length;r++)i.add(s[r]);const n=[];this.nodes.each(r=>{null!==r.data&&!i.has(r.data)&&n.push(r.data)}),this.parts.each(r=>{null!==r.data&&!i.has(r.data)&&n.push(r.data)}),n.forEach(r=>t.Dv(r,!1));for(let r=0;r<s.length;r++){const a=s[r];null===this.findPartForData(a)&&t.vv(a,!1)}this.Fv();let o=this.parts.iterator;for(;o.next();)o.value.updateRelationshipsFromData();for(o=this.nodes.iterator;o.next();)o.value.updateRelationshipsFromData();for(o=this.links.iterator;o.next();)o.value.updateRelationshipsFromData()}Fv(){}updateRelationshipsFromData(t){}ow(t,i){if("string"==typeof i){const s=this.findPartForData(t);if(null!==s)s.updateTargetBindings(i);else{const n=this.o3(t);if(null!==n&&n.length>0){for(let r=0;r<n.length;r++)n[r].updateTargetBindings(i);const o=n[0].part;if(null!==o){const r=o.adornments;for(;r.next();)r.value.updateTargetBindings(i)}y.Z(n)}}t===this.diagram.model.modelData&&this.updateAllTargetBindings(i)}}o3(t){let i=null;const s=this.wg.iterator;for(;s.next();){const n=s.value;for(let o=0;o<n.length;o++){const r=n[o].findItemPanelForData(t);null!==r&&(null===i&&(i=y.nt()),i.push(r))}if(null!==i)break}return i}YC(t){return this.wg.get(t)}s3(t,i){const s=t.object;if(!Array.isArray(s))return;const n=3===t.change,o=n?t.newParam:t.oldParam,r=n?t.newValue:t.oldValue,a=this.YC(s);if(Array.isArray(a))for(let l=0;l<a.length;l++){const h=a[l];n?h.Q1(r,o,!0):h.ZI(o)}}N2(t,i){null!==i&&t.Sn(n=>i.uT(n));const s=t.Aa;if(Array.isArray(s)){const n=this.YC(s);if(null===n)this.wg.set(s,[t]);else{for(let o=0;o<n.length;o++)if(n[o]===t)return;n.push(t)}}}C2(t,i){t.Sn(n=>i.TO(n));const s=t.Aa;if(Array.isArray(s)){const n=this.YC(s);if(null!==n)for(let o=0;o<n.length;o++)if(n[o]===t)return n.splice(o,1),void(0===n.length&&this.wg.delete(s))}}copyParts(t,i,s){void 0===s&&(s=!1);const n=new xt;if(Array.isArray(t))for(let r=0;r<t.length;r++)this.Lk(t[r],i,n,s);else{const r=t.iterator;for(;r.next();)this.Lk(r.value,i,n,s)}if(null!==i){const r=i.model,a=i.Tp().dragsLink,l=new z,h=new xt,c=n.iterator;for(;c.next();){const u=c.value;if(u instanceof gt)!a&&(null===u.fromNode||null===u.toNode)&&l.add(u);else if(u instanceof nt&&null!==u.data)if(r.Vm()){const d=u,f=c.key,p=f.findTreeParentNode();if(null!==p){const g=n.get(p);if(null!==g){r.setParentKeyForNodeData(d.data,r.getKeyForNodeData(g.data));const b=i.findLinkForData(d.data),x=f.findTreeParentLink();null!==x&&null!==b&&h.set(x,b)}}}else if(r.a1()){const d=u,f=c.key,p=r.isRelatedKeysPathTo?f.findNodesOutOf():f.findNodesInto();for(;p.next();){const g=p.value,b=n.get(g);if(null!==b){r.addRelatedKeyForNodeData(d.data,b.key);const x=i.partManager.findLinkForData(d.data,b.key),v=this.findLinkForData(f.data,g.key);null!==v&&null!==x&&h.set(v,x)}else r.removeRelatedKeyForNodeData(d.data,g.key)}}}if(l.count>0&&i.removeParts(l,!1),h.count>0){const u=h.iterator;for(;u.next();)n.set(u.key,u.value)}}if(null!==i&&null!==this.diagram){const r=i.model,a=r.afterCopyFunction;if(null!==a){const l=new xt;n.each(c=>{null!==c.key.data&&l.set(c.key.data,c.value.data)}),a(l,r,this.diagram.model)}}const o=n.iterator;for(;o.next();)o.value.updateTargetBindings();return n}Lk(t,i,s,n){if(null===t||n&&!t.canCopy())return null;if(s.has(t))return s.get(t);const o=this.KC(t,i);if(!(o instanceof At))return null;if(o.isSelected=!1,o.isHighlighted=!1,s.set(t,o),t instanceof nt){const r=t.linksConnected;for(;r.next();){const a=r.value;if(a.fromNode===t){const l=s.get(a);null!==l&&(l.fromNode=o)}if(a.toNode===t){const l=s.get(a);null!==l&&(l.toNode=o)}}if(t instanceof pt&&o instanceof pt){const a=t.memberParts;for(;a.next();){const h=this.Lk(a.value,i,s,n);h instanceof gt||null!==h&&(h.containingGroup=o)}}}else if(t instanceof gt&&o instanceof gt){const r=t.fromNode;if(null!==r){const h=s.get(r);null!==h&&(o.fromNode=h)}const a=t.toNode;if(null!==a){const h=s.get(a);null!==h&&(o.toNode=h)}const l=t.labelNodes;for(;l.next();){const c=this.Lk(l.value,i,s,n);null!==c&&c instanceof nt&&(c.labeledLink=o)}}return o}KC(t,i){let s=null;const n=t.data;if(null!==n&&null!==i){const o=i.model;if(!(t instanceof gt)){const r=o.copyNodeData(n);o.addNodeData(r),s=i.findPartForData(r)}}else if(t.It(),s=t.copy(),null!==s){const o=this.diagram;if(null!==i)i.add(s);else if(null!==n&&null!==o&&null!==o.commandHandler&&o.commandHandler.copiesClipboardData){let a=null;s instanceof gt||(a=o.model.copyNodeData(n)),s.data=a}}return s}get nodes(){return this.pg}get links(){return this.rn}get parts(){return this.Ct}get diagram(){return this.a}get addsToTemporaryLayer(){return this.BC}set addsToTemporaryLayer(t){this.BC=t}}return m})();var Ai=(m=>(m[m.OneWay=1]="OneWay",m[m.TwoWay=2]="TwoWay",m))(Ai||{});let We=(()=>{class m{n;HC;oc;Hf;Va;jf;qf;Wf;Dk;Ti;Id;vf;constructor(t,i,s,n){z.Je(this),void 0===t?t="":y.s(t,"string",m,"constructor:targetprop"),void 0===i?i=t:y.s(i,"string",m,"constructor:sourceprop"),void 0===s?s=null:null!==s&&y.S(s,m,"constructor:conv"),this.HC=-1,this.Ti=null,this.oc=t,this.Id=0,this.vf=0,this.Hf=null,this.Va=i,this.jf=s,void 0===n?(this.qf=1,this.Wf=null):(this.qf=2,this.Wf=n),this.Dk=new z,this.n=2}copy(){const t=new this.constructor;return this.cloneProtected(t),t}cloneProtected(t){t.oc=this.oc,t.Id=this.Id,t.vf=this.vf,t.Hf=this.Hf,t.Va=this.Va,t.jf=this.jf,t.qf=this.qf,t.Wf=this.Wf,t.n=-2&this.n}static OneWay=1;static TwoWay=2;static parseEnum(t,i){return y.S(t,m,"parseEnum:ctor"),s=>{let n=parseInt(s);return isNaN(n)&&(n=y.$a(t,s),null===n)?i:n}}fe(t){t in Ai?this.mode=t:y.dr(this,t)}static toString(t){return y.toString(t)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(-1!==this.targetId?" "+this.targetId:"")+" "+Ai[this.mode]+")"}k(){return this.n=1|this.n,this}get targetId(){return this.HC}set targetId(t){this.f&&y.L(this),this.HC=t}get targetProperty(){return this.oc}set targetProperty(t){this.f&&y.L(this),y.s(t,"string",m,"targetProperty"),this.oc=t}get sourceProperty(){return this.Va}set sourceProperty(t){this.f&&y.L(this),y.s(t,"string",m,"sourceProperty"),this.Va=t}get f(){return!!(1&this.n)}get isToData(){return!!(2&this.n)}get isToObject(){return!!(4&this.n)}get isToModel(){return!!(8&this.n)}get isToTheme(){return!!(16&this.n)}get jC(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}xd(){return!1}get sourceName(){return this.Hf}set sourceName(t){this.f&&y.L(this),null!==t&&y.s(t,"string",m,"sourceName"),this.Hf=t,this.n=null!==t?-3&this.n|4:2|this.n}get converter(){return this.jf}set converter(t){this.f&&y.L(this),null!==t&&y.S(t,m,"converter"),this.jf=t}get backConverter(){return this.Wf}set backConverter(t){this.f&&y.L(this),null!==t&&y.S(t,m,"backConverter"),this.Wf=t}get mode(){return this.qf}set mode(t){this.f&&y.L(this),this.isToTheme&&2===t&&y.o("Theme Bindings cannot be TwoWay."),this.qf=t}makeTwoWay(t){return this.isToTheme&&y.o("Theme Bindings cannot be TwoWay."),this.mode=2,t&&(y.S(t,m,"makeTwoWay"),this.backConverter=t),this}ofObject(t){return this.f&&y.L(this),void 0===t&&(t=""),this.sourceName=t,this}ofModel(){return this.f&&y.L(this),this.n=-3&this.n&-5|8,this.Hf=null,this}WT(t,i){const s=this.sourceName;let n=null;return n=null===s||""===s?t:"/"===s?i.part:"."===s?i:".."===s?i.panel:t.findObject(s),n}check(t){const i=this.oc,s=this.Va,n=this.jf;(this.xd()&&null===n&&null===this.Ba&&""===i||null===n&&""===i)&&y.ne("Binding error: target property is the empty string: "+this.toString()),this.xd()&&this.jC&&""===s&&null===n&&null===this.Ba&&y.ne("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),t&&"string"==typeof i&&(!y.st(["setAttribute"])&&i.length>0&&"_"!==i[0]&&!y.jw(t,i)?y.ne("Binding error: undefined target property: "+i+" on "+t.toString()):"name"===i&&t instanceof st&&y.ne("Binding error: cannot modify GraphObject.name on "+t.toString()))}updateTarget(t,i,s,n){const o=this.Va;if(void 0!==s&&""!==o&&o!==s||this.isToTheme&&null===t.diagram)return;const r=this.oc,a=this.jf;let l=i;if(""!==o&&!this.jC&&(l=bt.St(i,o)),void 0!==l)if(null===a){if(""!==r){if(this.xd()){const h=t.diagram?.themeManager;if(l=this.Vv(h,l,t,r),void 0===l)return}n?n.et(t,r,l):(i instanceof st||i instanceof ee)&&bt.et(t,r,l)}}else try{if(""!==r){let h=a(l,t);if(this.xd()){const c=t.diagram?.themeManager;if(h=this.Vv(c,h,t,r),void 0===h)return}n?n.et(t,r,h):(i instanceof st||i instanceof ee)&&bt.et(t,r,h)}else a(l,t)}catch{}}updateSource(t,i,s,n){if(2!==this.qf)return;const o=this.oc;if(void 0!==s&&o!==s)return;const r=this.Va,a=this.Wf,l=null!==n?n.diagram:null,h=null!==l?l.model:null;let c=t;if(""!==o&&(c=bt.St(t,o)),void 0!==c&&!this.Dk.has(t))try{if(this.Dk.add(t),null===a){if(""!==r)null!==h?h.setDataProperty(i,r,c):(i instanceof st||i instanceof ee)&&(i[r]=c);else if(null!==h&&null!==n&&n.itemIndex>=0&&null!==n.panel&&Array.isArray(n.panel.itemArray)){const u=n.itemIndex,d=n.panel.itemArray;h.removeArrayItem(d,u),h.insertArrayItem(d,u,c)}}else try{if(""!==r){const u=a(c,i,h);null!==h?h.setDataProperty(i,r,u):(i instanceof st||i instanceof ee)&&(i[r]=u)}else{const u=a(c,i,h);if(void 0!==u&&null!==h&&null!==n&&n.itemIndex>=0&&null!==n.panel&&Array.isArray(n.panel.itemArray)){const d=n.itemIndex,f=n.panel.itemArray;h.removeArrayItem(f,d),h.insertArrayItem(f,d,u)}}}catch{}}finally{this.Dk.delete(t)}}}return m})();class ni extends We{aw;Ba;rc;constructor(e,t,i,s,n){super(e,t,s),null==i&&(i=""),void 0===n&&(n=null),this.aw=i,this.Ba=n,this.rc=null,this.n=16}cloneProtected(e){super.cloneProtected(e),e.aw=this.aw,e.Ba=this.Ba,e.rc=this.rc}xd(){return!0}get themeSource(){return this.aw}set themeSource(e){this.f&&y.L(this),null!==e&&y.s(e,"string",ni,"themeSource"),this.aw=e,this.rc=null,this.n=null!==e?16|this.n:-17&this.n}get themeConverter(){return this.Ba}set themeConverter(e){this.f&&y.L(this),null!==e&&y.S(e,ni,"themeConverter"),this.Ba=e}ofData(){return this.f&&y.L(this),this.n=2|this.n,this.Hf=null,this}Vv(e,t,i,s){if(!e||(this.jC&&(t=this.Va),!t&&0!==t))return;let n=this.themeSource;null!==this.rc?n=this.rc:"string"==typeof n&&n.includes(".")&&(this.rc=n.split("."),n=this.rc);let o=e.findValue(t,n,s);if(void 0===o&&y.ne(`Theme warning: ${t} could not be found when setting target property ${s}.`),e.readsCssVariables&&"string"==typeof o&&o.startsWith("var(")){const r=o.match(this.r3);r&&(o=getComputedStyle(X.document.documentElement).getPropertyValue(r[1]))}return y.st(this.Ba)&&(o=this.Ba(o,i)),o}r3=/var\((.*)\)/}class bt{Pt;kg;zo;qC;Bi;be;za;Jf;$f;Pg;Sg;Mg;Ng;hw;lc;lr;cw;Bo;vk;constructor(e,t){if(z.Je(this),this.Pt="",this.kg="",this.zo=!1,this.qC={},this.Bi=[],this.be=new xt,this.za="key",this.Jf=null,this.$f=null,this.Pg=!1,this.Sg=!1,this.Mg=!1,this.Ng=null,this.hw=100,this.lc="category",this.lr=new xt,this.cw=[],this.Bo=!1,this.vk=null,this.undoManager=new Pi,void 0!==e&&(Array.isArray(e)?this.nodeDataArray=e:t=e),t){Object.assign(this,t);const i=t.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(e){e.Pt=this.Pt,e.kg=this.kg,e.zo=this.zo,e.za=this.za,e.Jf=this.Jf,e.$f=this.$f,e.Pg=this.Pg,e.Sg=this.Sg,e.Mg=this.Mg,e.Ng=this.Ng,e.hw=this.hw,e.lc=this.lc}copy(){const e=new this.constructor;return this.cloneProtected(e),e}clear(){this.Bi=[],this.be.clear(),this.lr.clear(),this.undoManager.clear()}toString(e){if(void 0===e&&(e=0),e>1)return this.toJson();{let t=(""!==this.name?this.name:"")+" Model";if(e>0){t+="\n node data:";const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+this.getKeyForNodeData(o)+":"+y.toString(o)}}return t}}toIncrementalData(e){1!==e.change&&y.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+e.toString());const t=e.object;if(!(e.isTransactionFinished&&t instanceof hi))return null;const i=this.Bv(t);return this.WC(t,"FinishedUndo"===e.propertyName,i)}WC(e,t,i){const s=this;let n=!1;const o=new z,r=new z,a=new z;e.changes.each(d=>{if(d.model===s)if("nodeDataArray"===d.modelChange)3===d.change?o.add(d.newValue):4===d.change&&a.add(d.oldValue);else if(s.containsNodeData(d.object))null!==d.object&&r.add(d.object);else if(2!==d.change||s.modelData!==d.object&&"modelData"!==d.propertyName){if(null!==d.object)if(i.has(d.object)){const f=i.get(d.object);f&&f.each(p=>{s.containsNodeData(p)&&r.add(p)})}else{if(d.object instanceof bt||s.Wh()&&s.containsLinkData(d.object))return;s.zv(d.object).each(f=>{r.add(f)})}}else n=!0});const l=new z;o.each(d=>{const f=s.getKeyForNodeData(d);void 0!==f&&l.add(f),t||r.add(d)});const h=new z;a.each(d=>{const f=s.getKeyForNodeData(d);void 0!==f&&h.add(f),t&&r.add(d)});const c=s.cloneDeep(r.toArray());let u=null;return n&&(null===u&&(u={}),u.modelData=this.cloneDeep(this.modelData)),l.count>0&&(null===u&&(u={}),t?u.removedNodeKeys=l.toArray():u.insertedNodeKeys=l.toArray()),c.length>0&&(null===u&&(u={}),u.modifiedNodeData=c),h.count>0&&(null===u&&(u={}),t?u.insertedNodeKeys=h.toArray():u.removedNodeKeys=h.toArray()),u}cloneDeep(e){return this.Cg(e,!0)}Cg(e,t,i,s){if(!y.$(e))return e;i||(i=new xt);const n=i.get(e);if(n)return n;let o;if(Array.isArray(e)){o=[],i.set(e,o);for(let r=0;r<e.length;r++)o.push(this.Cg(e[r],!1,i,s))}else if(e instanceof S||e instanceof lt||e instanceof j||e instanceof It||e instanceof A)o=e.copy(),i.set(e,o);else{if(e instanceof V||e instanceof Ct)return e;if(e instanceof H)o=(new H).addAll(this.Cg(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof z)o=(new z).addAll(this.Cg(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof xt)o=(new xt).addAll(this.Cg(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof Date)o=new Date(e),i.set(e,o);else if(e instanceof RegExp)o=new RegExp(e),i.set(e,o),o.lastIndex=e.lastIndex;else if(bt.JC(null,"",e))o=e;else if(y.st(e.copy))o=e.copy(),i.set(e,o);else{o={},i.set(e,o);for(const r in e)"__gohashid"!==r&&(o[r]=this.Cg(e[r],!1,i,s))}}return o}zi(e){return JSON.stringify(e).replace(/[\u007F-\uFFFF]/g,t=>{const i="0000"+t.charCodeAt(0).toString(16);return"\\u"+i.substring(i.length-4)})}Lg(){let e="";return""!==this.name&&(e+=',\n  "name": '+this.zi(this.name)),""!==this.dataFormat&&(e+=',\n  "dataFormat": '+this.zi(this.dataFormat)),this.isReadOnly&&(e+=',\n  "isReadOnly": '+this.isReadOnly),"key"!==this.nodeKeyProperty&&"string"==typeof this.nodeKeyProperty&&(e+=',\n  "nodeKeyProperty": '+this.zi(this.nodeKeyProperty)),this.copiesArrays&&(e+=',\n  "copiesArrays": true'),this.copiesArrayObjects&&(e+=',\n  "copiesArrayObjects": true'),this.copiesKey&&(e+=',\n  "copiesKey": true'),100!==this.pointsDigits&&(e+=',\n  "pointsDigits": '+this.pointsDigits.toString()),"category"!==this.nodeCategoryProperty&&"string"==typeof this.nodeCategoryProperty&&(e+=',\n  "nodeCategoryProperty": '+this.zi(this.nodeCategoryProperty)),e}fw(e){e.name&&(this.name=e.name),e.dataFormat&&(this.dataFormat=e.dataFormat),e.isReadOnly&&(this.isReadOnly=!0),e.nodeKeyProperty&&(this.nodeKeyProperty=e.nodeKeyProperty),e.copiesArrays&&(this.copiesArrays=!0),e.copiesArrayObjects&&(this.copiesArrayObjects=!0),void 0!==e.copiesKey&&(this.copiesKey=e.copiesKey),void 0!==e.pointsDigits&&(this.pointsDigits=parseInt(e.pointsDigits)),e.nodeCategoryProperty&&(this.nodeCategoryProperty=e.nodeCategoryProperty)}Xv(){return',\n  "modelData": '+this.Gv(this.modelData)}Yv(e){const t=e.modelData;y.$(t)&&(this.replaceJsonObjects(t),this.modelData=t)}$C(){const e=this.modelData;let t=!1;for(const s in e)if(!this.Fk(e,s,e[s])){t=!0;break}let i="";return t&&(i=this.Xv()),i+',\n  "nodeDataArray": '+this.Xa(this.nodeDataArray,!0)}ZC(e){this.Yv(e);const t=e.nodeDataArray;Array.isArray(t)&&(this.replaceJsonObjects(t),this.nodeDataArray=t)}QC(e,t,i){if(e===t)return!0;if(typeof e!=typeof t||y.st(e)||y.st(t))return!1;if(Array.isArray(e)&&Array.isArray(t)){if(i.get(e)===t)return!0;if(i.set(e,t),e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!this.QC(e[s],t[s],i))return!1;return!0}if(y.$(e)&&y.$(t)){if(i.get(e)===t)return!0;i.set(e,t);for(const s in e){const n=e[s];if(this.Fk(e,s,n))continue;const o=t[s];if(void 0===o||!this.QC(n,o,i))return!1}for(const s in t){const n=t[s];if(this.Fk(t,s,n))continue;const o=e[s];if(void 0===o||!this.QC(o,n,i))return!1}return!0}return!1}static Kv=',\n  "insertedNodeKeys": ';static l3=',\n  "modifiedNodeData": ';static Hv=',\n  "removedNodeKeys": ';Bv(e){let t=new xt;const i=(s,n)=>{const o=n.part;if(!o)return;const r=o.data;if(s===r)return;let a=t.get(s);null===a?(a=new z,a.add(r),t.set(s,a)):a.add(r)};return e.changes.each(s=>{if(null!==s.diagram){const n=s.change;if(2===n){if(null!==s.object){const o=s.object.panel;if(o){const r=o.data;r&&i(r,o)}}}else if(3===n||4===n){const o=s.object,r=o.itemArray;r&&i(r,o)}}}),t}zv(e){const t=new z;for(let i=0;i<this.nodeDataArray.length;i++){const s=this.nodeDataArray[i];this.Rk(e,s,s,t)}return t}Rk(e,t,i,s){if(Array.isArray(t))for(let n=0;n<t.length;n++){const o=t[n];if(o===e)return s.add(i),!0;if(this.Rk(e,o,i,s))return!0}else if(y.$(t)&&Object.getPrototypeOf(t)===Object.prototype)for(const n in t){const o=t[n];if(o===e)return s.add(i),!0;if(this.Rk(e,o,i,s))return!0}return!1}_C(e,t,i){const s=this;let n=!1;const o=new z,r=new z,a=new z;e.changes.each(u=>{if(u.model===s)if("nodeDataArray"===u.modelChange)3===u.change?o.add(u.newValue):4===u.change&&a.add(u.oldValue);else if(s.containsNodeData(u.object))null!==u.object&&r.add(u.object);else if(2!==u.change||s.modelData!==u.object&&"modelData"!==u.propertyName){if(null!==u.object)if(i.has(u.object)){const d=i.get(u.object);d&&d.each(f=>{s.containsNodeData(f)&&r.add(f)})}else{if(u.object instanceof bt||s.Wh()&&s.containsLinkData(u.object))return;s.zv(u.object).each(d=>{r.add(d)})}}else n=!0});const l=new z;o.each(u=>{const d=s.getKeyForNodeData(u);void 0!==d&&l.add(d),t||r.add(u)});const h=new z;a.each(u=>{const d=s.getKeyForNodeData(u);void 0!==d&&h.add(d),t&&r.add(u)});let c="";return n&&(c+=this.Xv()),l.count>0&&(c+=(t?bt.Hv:bt.Kv)+this.Xa(l.toArray(),!0)),r.count>0&&(c+=bt.l3+this.Xa(r.toArray(),!0)),h.count>0&&(c+=(t?bt.Kv:bt.Hv)+this.Xa(h.toArray(),!0)),c}uw(e){(void 0!==e.name&&e.name!==this.name||void 0!==e.dataFormat&&e.dataFormat!==this.dataFormat||void 0!==e.isReadOnly&&e.isReadOnly!==this.isReadOnly||void 0!==e.nodeKeyProperty&&e.nodeKeyProperty!==this.nodeKeyProperty||void 0!==e.copiesArrays&&e.copiesArrays!==this.copiesArrays||void 0!==e.copiesArrayObjects&&e.copiesArrayObjects!==this.copiesArrayObjects||void 0!==e.copiesKey&&e.copiesKey!==this.copiesKey||void 0!==e.nodeCategoryProperty&&e.nodeCategoryProperty!==this.nodeCategoryProperty)&&y.o("applyIncrementalJson cannot change Model properties"),this.Yv(e);const t=e.insertedNodeKeys,i=e.modifiedNodeData,s=new xt;if(Array.isArray(i))for(let o=0;o<i.length;o++){const r=i[o],a=this.getKeyForNodeData(r);null!=a&&s.set(a,r)}if(Array.isArray(t)){const o=t.length;for(let r=0;r<o;r++){const a=t[r];let l=this.findNodeDataForKey(a);null===l&&(l=s.get(a)||this.copyNodeData({}),null!==l&&(this.setKeyForNodeData(l,a),this.addNodeData(l)))}}if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const a=i[r],l=this.getKeyForNodeData(a),h=this.findNodeDataForKey(l);if(null!==h){for(const c in a)"__gohashid"===c||c===this.nodeKeyProperty||(this.Um()||this.a1())&&c===this.nodeIsGroupProperty||this.setDataProperty(h,c,a[c]);this.Ag(a,h)}}}const n=e.removedNodeKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const l=this.findNodeDataForKey(n[r]);null!==l&&this.removeNodeData(l)}}}toIncrementalJson(e,t){1!==e.change&&y.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+e.toString());const i=e.object;if(!(e.isTransactionFinished&&i instanceof hi))return'{ "incremental": 0 }';void 0===t&&(t=y.Hn(this));const s=this.Bv(i),n=this._C(i,"FinishedUndo"===e.propertyName,s);return'{ "class": '+this.zi(t)+', "incremental": 1'+this.Lg()+n+"}"}toIncrementalJSON(e,t){return this.toIncrementalJson(e,t)}toJson(e){return void 0===e&&(e=y.Hn(this)),'{ "class": '+this.zi(e)+this.Lg()+this.$C()+"}"}toJSON(e){return this.toJson(e)}applyIncrementalJson(e){let t=null;if("string"==typeof e)try{t=X.JSON.parse(e)}catch{}else y.$(e)?t=e:y.o("Unable to modify a Model from: "+e);const i=t.incremental;"number"!=typeof i&&y.o("Unable to apply non-incremental changes to Model: "+e),0!==i&&(this.startTransaction("applyIncrementalJson"),this.uw(t),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(e){return this.applyIncrementalJson(e)}static fromJson(e,t){void 0===t&&(t=null),null!==t&&y.se(t,bt,bt,"fromJson:model");let i=null;if("string"==typeof e)try{i=X.JSON.parse(e)}catch{}else y.$(e)?i=e:y.o("Unable to construct a Model from: "+e);if(null===t){const s=bt.a3(i);null===s||s instanceof bt?t=s:y.o("Unable to construct a Model of declared class: "+i.class)}return null===t&&(t=bt.jv()),t.fw(i),t.ZC(i),t}static fromJSON(e,t){return this.fromJson(e,t)}static jv(){return new bt}static a3(e){let t=null,i=e.class;if("string"==typeof i)try{let s=null;0===i.indexOf("go.")?s=bt.tL(i.substring(3)):(s=bt.tL(i),null===s&&(s=X[i])),y.st(s)&&(t=new s)}catch{}return t}replaceJsonObjects(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];y.$(s)&&this.qv(e,i,this.replaceJsonObjects(s))}}else if(y.$(e)){for(const t in e){const i=e[t];if(y.$(i)){const s=this.replaceJsonObjects(i);e[t]=s,this.replaceJsonPropertyValue(e,t,s)}}return this.h3(e)}return e}replaceJsonPropertyValue(e,t,i){if("points"===t&&Array.isArray(i)){let s=i.length%2==0;for(let n=0;n<i.length;n++)if("number"!=typeof i[n]){s=!1;break}if(s){const n=new H;for(let o=0;o<i.length/2;o++)n.add(new S(i[2*o],i[2*o+1]));e[t]=n}}}writeJsonValue(e){return void 0===e?"undefined":null===e?"null":!0===e?"true":!1===e?"false":"string"==typeof e?this.zi(e):"number"==typeof e?e===1/0?"9e9999":e===-1/0?"-9e9999":isNaN(e)?'{"class":"NaN"}':e.toString():e instanceof Boolean||e instanceof String||e instanceof Number?this.writeJsonValue(e.valueOf()):e instanceof Date?'{"class":"Date", "value":"'+e.toJSON()+'"}':Array.isArray(e)?this.Xa(e):y.$(e)?this.Gv(e):y.st(e)?"null":'"'+e.toString()+'"'}Xa(e,t){void 0===t&&(t=!1);const i=e.length;if(i<=0)return"[]";const s=new Q;s.add("["),t&&i>1&&s.add("\n");for(let n=0;n<i;n++){const o=e[n];void 0!==o&&(n>0&&(s.add(","),t&&s.add("\n")),s.add(this.writeJsonValue(o)))}return t&&i>1&&s.add("\n"),s.add("]"),s.toString()}Fk(e,t,i){return!(void 0!==i&&"__gohashid"!==t&&"_"!==t[0]&&!y.st(i))}je(e){return isNaN(e)?"NaN":e===1/0?"9e9999":e===-1/0?"-9e9999":e}Gv(e){const t=e;if(t instanceof S)e={class:"go.Point",x:this.je(t.x),y:this.je(t.y)};else if(t instanceof lt)e={class:"go.Size",width:this.je(t.width),height:this.je(t.height)};else if(t instanceof j)e={class:"go.Rect",x:this.je(t.x),y:this.je(t.y),width:this.je(t.width),height:this.je(t.height)};else if(t instanceof It)e={class:"go.Margin",top:this.je(t.top),right:this.je(t.right),bottom:this.je(t.bottom),left:this.je(t.left)};else if(t instanceof A)e=t.isSpot()?{class:"go.Spot",x:this.je(t.x),y:this.je(t.y),offsetX:this.je(t.offsetX),offsetY:this.je(t.offsetY)}:{class:"go.Spot",enum:t.toString()};else if(t instanceof V){if(e={class:"go.Brush",type:Re[t.type]},1===t.type?e.color=t.color:(2===t.type||3===t.type)&&(e.start=t.start,e.end=t.end,3===t.type&&(0!==t.startRadius&&(e.startRadius=this.je(t.startRadius)),isNaN(t.endRadius)||(e.endRadius=this.je(t.endRadius)))),null!==t.colorStops){const n={},o=t.colorStops.iterator;for(;o.next();)n[o.key]=o.value;e.colorStops=n}}else if(t instanceof Ct)e={class:"go.Geometry",type:Ke[t.type]},0!==t.startX&&(e.startX=this.je(t.startX)),0!==t.startY&&(e.startY=this.je(t.startY)),0!==t.endX&&(e.endX=this.je(t.endX)),0!==t.endY&&(e.endY=this.je(t.endY)),t.spot1.equals(A.TopLeft)||(e.spot1=t.spot1),t.spot2.equals(A.BottomRight)||(e.spot2=t.spot2),4===t.type&&(e.path=Ct.stringify(t));else if(bt.JC(null,"",t))return"{}";let i="{",s=!0;for(const n in e){const o=this.St(e,n);this.Fk(e,n,o)||(s?s=!1:i+=",",i+=this.zi(n)+":"+this.writeJsonPropertyValue(n,o))}return i+="}",i}writeJsonPropertyValue(e,t){if("points"===e&&t instanceof H){let s="[";const n=t.iterator;for(;n.next();){const o=n.value;s.length>1&&(s+=","),s+=this.Wv(o.x),s+=",",s+=this.Wv(o.y)}return s+="]",s}return this.writeJsonValue(t)}Wv(e){if(e===1/0)return"9e9999";if(e===-1/0)return"-9e9999";if(isNaN(e))return"0";const t=this.pointsDigits;return t>16?e.toString():e.toFixed(t)}get pointsDigits(){return this.hw}set pointsDigits(e){e<0?e=0:e>100&&(e=100),this.hw=e}qe(e){return"number"==typeof e?e:"NaN"===e?NaN:"9e9999"===e?1/0:"-9e9999"===e?-1/0:parseFloat(e)}h3(e){if(!y.$(e))return e;let t=e.class||"";if("string"!=typeof t||""===t)return e;if("NaN"===t)return NaN;if("Date"===t)return new Date(e.value);if(0!==t.indexOf("go."))return e;t=t.substring(3);let i=e;if("Point"===t)i=new S(this.qe(e.x),this.qe(e.y));else if("Size"===t)i=new lt(this.qe(e.width),this.qe(e.height));else if("Rect"===t)i=new j(this.qe(e.x),this.qe(e.y),this.qe(e.width),this.qe(e.height));else if("Margin"===t)i=new It(this.qe(e.top),this.qe(e.right),this.qe(e.bottom),this.qe(e.left));else if("Spot"===t)i="string"==typeof e.enum?A.parse(e.enum):new A(this.qe(e.x),this.qe(e.y),this.qe(e.offsetX),this.qe(e.offsetY));else if("Brush"===t){const s=new V;s.type=y.$a(Re,e.type)??1,"string"==typeof e.color&&(s.color=e.color),e.start instanceof A&&(s.start=e.start),e.end instanceof A&&(s.end=e.end),"number"==typeof e.startRadius&&(s.startRadius=this.qe(e.startRadius)),"number"==typeof e.endRadius&&(s.endRadius=this.qe(e.endRadius));const n=e.colorStops;if(y.$(n))for(const o in n){const r=parseFloat(o);s.addColorStop(r,n[o])}i=s}else if("Geometry"===t){let s=null;s="string"==typeof e.path?Ct.parse(e.path):new Ct,s.type=y.$a(Ke,e.type)??1,"number"==typeof e.startX&&(s.startX=this.qe(e.startX)),"number"==typeof e.startY&&(s.startY=this.qe(e.startY)),"number"==typeof e.endX&&(s.endX=this.qe(e.endX)),"number"==typeof e.endY&&(s.endY=this.qe(e.endY)),e.spot1 instanceof A&&(s.spot1=e.spot1),e.spot2 instanceof A&&(s.spot2=e.spot2),i=s}else if("EnumValue"===t){let s=e.classType;0===s.indexOf("go.")&&(s=s.substring(3));const n=bt.tL(s);y.st(n)&&(i=y.$a(n,e.name))}return i}get name(){return this.Pt}set name(e){const t=this.Pt;t!==e&&(y.s(e,"string",bt,"name"),this.Pt=e,this.t("name",t,e))}get dataFormat(){return this.kg}set dataFormat(e){const t=this.kg;t!==e&&(y.s(e,"string",bt,"dataFormat"),this.kg=e,this.t("dataFormat",t,e))}get isReadOnly(){return this.zo}set isReadOnly(e){const t=this.zo;t!==e&&(y.s(e,"boolean",bt,"isReadOnly"),this.zo=e,this.t("isReadOnly",t,e))}get modelData(){return this.qC}set modelData(e){const t=this.modelData;t!==e&&(y.xc(e,bt,"modelData"),this.containsNodeData(e)&&y.o("Model.modelData Object must not be used by the rest of the model: "+e),this.qC=e,this.t("modelData",t,e),this.updateTargetBindings(e))}addChangedListener(e){return y.S(e,bt,"addChangedListener:listener"),this.cw.push(e),this}removeChangedListener(e){y.S(e,bt,"removeChangedListener:listener");const t=this.cw.indexOf(e);t>=0&&this.cw.splice(t,1)}T2(e){this.skipsUndoManager||this.undoManager.handleChanged(e),this.Jv(e)}Jv(e){this.cw.forEach(t=>t(e))}rR(e){this.Jv(e)}raiseChangedEvent(e,t,i,s,n,o,r){this.Ft("",e,t,i,s,n,o,r)}raiseChanged(e,t,i,s,n){this.Ft("",2,e,this,t,i,s,n)}t(e,t,i,s,n){this.Ft("",2,e,this,t,i,s,n)}raiseDataChanged(e,t,i,s,n,o){this.Ft("",2,t,e,i,s,n,o)}Ft(e,t,i,s,n,o,r,a){void 0===r&&(r=null),void 0===a&&(a=null);const l=new li;l.model=this,l.change=t,l.modelChange=e,l.propertyName=i,l.object=s,l.oldValue=n,l.oldParam=r,l.newValue=o,l.newParam=a,this.T2(l)}get undoManager(){return this.vk}set undoManager(e){const t=this.vk;t!==e&&(t&&t.removeModel(this),this.vk=e,e.addModel(this))}get skipsUndoManager(){return this.Bo}set skipsUndoManager(e){y.s(e,"boolean",bt,"skipsUndoManager"),this.Bo=e}changeState(e,t){if(null!==e&&e.model===this)if(2===e.change){const i=e.object,s=e.propertyName,n=e.getValue(t);if(null!==i&&s===this.nodeKeyProperty&&this.containsNodeData(i)){const o=e.getValue(!t);void 0!==o&&this.be.delete(o),void 0!==n&&this.be.set(n,i)}this.et(i,s,n)}else if(3===e.change){const i=e.newParam;if("nodeDataArray"===e.modelChange){const s=e.newValue;if(y.$(s)&&"number"==typeof i){const n=this.getKeyForNodeData(s);t?(this.Bi[i]===s&&this.Co(this.Bi,i),void 0!==n&&this.be.delete(n)):(this.Bi[i]!==s&&this.ar(this.Bi,i,s),void 0!==n&&this.be.set(n,s))}}else if(""===e.modelChange){let s=e.object;if(s&&!Array.isArray(s)&&e.propertyName&&(s=this.St(s,e.propertyName)),Array.isArray(s)&&"number"==typeof i){const n=e.newValue;t?this.Co(s,i):this.ar(s,i,n)}}else y.o("unknown ChangeType.Insert modelChange: "+e.toString())}else if(4===e.change){const i=e.oldParam;if("nodeDataArray"===e.modelChange){const s=e.oldValue;if(y.$(s)&&"number"==typeof i){const n=this.getKeyForNodeData(s);t?(this.Bi[i]!==s&&this.ar(this.Bi,i,s),void 0!==n&&this.be.set(n,s)):(this.Bi[i]===s&&this.Co(this.Bi,i),void 0!==n&&this.be.delete(n))}}else if(""===e.modelChange){let s=e.object;s&&!Array.isArray(s)&&e.propertyName&&(s=this.St(s,e.propertyName)),Array.isArray(s)&&"number"==typeof i&&(t?this.ar(s,i,e.oldValue):this.Co(s,i))}else y.o("unknown ChangeType.Remove modelChange: "+e.toString())}else 1===e.change||y.o("unknown ChangedEvent: "+e.toString())}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;void 0===i&&(i="");const s=this.skipsUndoManager;null===i&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(e,t){void 0===t&&(t=""),this.Ft("SourceChanged",1,t,e,null,null)}get nodeKeyProperty(){return this.za}set nodeKeyProperty(e){const t=this.za;t!==e&&(this.Un(e,bt,"nodeKeyProperty"),""===e&&y.o("Model.nodeKeyProperty may not be the empty string"),this.be.count>0&&y.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.za=e,this.t("nodeKeyProperty",t,e))}Un(e,t,i){"string"!=typeof e&&!y.st(e)&&y.si(e,"string or function",t,i)}getKeyForNodeData(e){if(null===e)return;const t=this.za;if(""===t)return;const i=this.St(e,t);if(void 0!==i){if(this.isKeyType(i))return i;y.o("Key value for node data "+e+" is not a number or a string: "+i)}}setKeyForNodeData(e,t){if((null==t||!this.isKeyType(t))&&y.si(t,"number or string",bt,"setKeyForNodeData:key"),null===e)return;const i=this.za;if(""===i)return;if(!this.containsNodeData(e))return void this.et(e,i,t);const s=this.St(e,i);if(s!==t){if(null!==this.findNodeDataForKey(t))return;this.et(e,i,t),void 0!==s&&this.be.delete(s),this.be.set(t,e),this.Ft("nodeKey",2,i,e,s,t),"string"==typeof i&&this.updateTargetBindings(e,i),this.dw(s,t)}}get makeUniqueKeyFunction(){return this.Jf}set makeUniqueKeyFunction(e){const t=this.Jf;t!==e&&(null!==e&&y.S(e,bt,"makeUniqueKeyFunction"),this.Jf=e,this.t("makeUniqueKeyFunction",t,e))}isKeyType(e){return"number"==typeof e||"string"==typeof e}containsNodeData(e){if(null===e)return!1;const t=this.getKeyForNodeData(e);return void 0!==t&&this.be.get(t)===e}findNodeDataForKey(e){return null===e&&y.o("Model.findNodeDataForKey:key must not be null"),void 0!==e&&this.isKeyType(e)?this.be.get(e):null}get nodeDataArray(){return this.Bi}set nodeDataArray(e){const t=this.Bi;if(t!==e){this.eL(e,bt,"nodeDataArray"),this.be.clear(),this.iL();const i=e.length;for(let o=0;o<i;o++){const r=e[o];y.$(r)||y.o("Model.nodeDataArray must only contain Objects, not: "+r),r===this.modelData&&y.o("nodeDataArray Objects must not be the shared Model.modelData")}this.Bi=e;const s=new H;for(let o=0;o<i;o++){const r=e[o],a=this.getKeyForNodeData(r);void 0===a||null!==this.be.get(a)?s.add(r):this.be.set(a,r)}const n=s.iterator;for(;n.next();){const o=n.value;this.makeNodeDataKeyUnique(o);const r=this.getKeyForNodeData(o);void 0!==r&&this.be.set(r,o)}this.Ft("nodeDataArray",2,"nodeDataArray",this,t,e);for(let o=0;o<i;o++){const r=e[o];this.Tg(r),this.Dg(r)}}}Ok(e){return void 0!==e&&this.be.has(e)}makeNodeDataKeyUnique(e){if(null===e)return;const t=this.za;if(""===t)return;let i=this.getKeyForNodeData(e);if(void 0!==i&&!this.Ok(i))return;const s=this.Jf;if(null===s||(i=s(this,e),null==i||this.Ok(i))){if("string"==typeof i){let n=2;for(;this.Ok(i+n);)n++;this.et(e,t,i+n)}else if(void 0===i||"number"==typeof i){let n=-this.be.count-1;for(;this.Ok(n);)n--;this.et(e,t,n)}}else this.et(e,t,i)}addNodeData(e){null!==e&&(e===this.modelData&&y.o("Model.addNodeData cannot add the shared Model.modelData Object"),this.containsNodeData(e)||this.vv(e,!0))}vv(e,t){let i=this.getKeyForNodeData(e);if(void 0===i)this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e);else{if(this.be.get(i)===e)return;this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e)}void 0===i&&y.o("Model.makeNodeDataKeyUnique failed on "+e+".  Data not added to Model."),this.be.set(i,e);let s=null;t&&(s=this.Bi.length,this.ar(this.Bi,s,e)),this.Ft("nodeDataArray",3,"nodeDataArray",this,null,e,null,s),this.Tg(e),this.Dg(e)}addNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.addNodeData(e[i])}else{const t=e.iterator;for(;t.next();)this.addNodeData(t.value)}}removeNodeData(e){null!==e&&this.Dv(e,!0)}Dv(e,t){const i=this.getKeyForNodeData(e);void 0!==i&&this.be.delete(i);let s=null;if(t){if(s=this.Bi.indexOf(e),s<0)return;this.Co(this.Bi,s)}this.Ft("nodeDataArray",4,"nodeDataArray",this,e,null,s,null),this.gw(e)}removeNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.removeNodeData(e[i])}else{const t=e.iterator;for(;t.next();)this.removeNodeData(t.value)}}mergeNodeDataArray(e){if(e===this.nodeDataArray||!Array.isArray(e))return;const t=new z;t.addAll(this.be.iteratorKeys);const i=new z,s=e.length;for(let o=0;o<s;o++){const r=e[o],a=this.getKeyForNodeData(r);if(void 0!==a){i.add(a);const l=this.findNodeDataForKey(a);if(l===r)continue;if(null!==l)this.assignAllDataProperties(l,r),this.Ag(r,l);else{const h=this.cloneDeep(r);this.setKeyForNodeData(h,a),this.addNodeData(h)}}else{const l=this.cloneDeep(r);this.addNodeData(l);const h=this.getKeyForNodeData(l);void 0!==h&&i.add(h)}}const n=t.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const r=this.findNodeDataForKey(o);r&&this.removeNodeData(r)}}}dw(e,t){if(void 0===t)return;const i=this.lw(e);i instanceof z&&this.lr.set(t,i)}iL(){}Tg(e){}Dg(e){}gw(e){}hn(e,t){if(void 0===e)return;let i=this.lr.get(e);null===i&&(i=new z,this.lr.set(e,i)),i.add(t)}an(e,t){if(void 0===e)return;const i=this.lr.get(e);i instanceof z&&(null==t?this.lr.delete(e):(i.delete(t),0===i.count&&this.lr.delete(e)))}lw(e){if(void 0===e)return null;const t=this.lr.get(e);return t instanceof z?t:null}GU(e){void 0===e?this.lr.clear():this.lr.delete(e)}get copyNodeDataFunction(){return this.$f}set copyNodeDataFunction(e){const t=this.$f;t!==e&&(null!==e&&y.S(e,bt,"copyNodeDataFunction"),this.$f=e,this.t("copyNodeDataFunction",t,e))}get copiesArrays(){return this.Pg}set copiesArrays(e){const t=this.Pg;t!==e&&(null!==e&&y.s(e,"boolean",bt,"copiesArrays"),this.Pg=e,this.t("copiesArrays",t,e))}get copiesArrayObjects(){return this.Sg}set copiesArrayObjects(e){const t=this.Sg;t!==e&&(null!==e&&y.s(e,"boolean",bt,"copiesArrayObjects"),this.Sg=e,this.t("copiesArrayObjects",t,e))}get copiesKey(){return this.Mg}set copiesKey(e){const t=this.Mg;t!==e&&(null!==e&&y.s(e,"boolean",bt,"copiesKey"),this.Mg=e,this.t("copiesKey",t,e))}copyNodeData(e){let t=null;const i=this.$f;return t=null!==i?i(e,this):this.Ik(e,!0),t}Ik(e,t){if(y.$(e)){if(Array.isArray(e)){if(this.copiesArrays){const i=e,s=[];for(let n=0;n<i.length;n++){const r=this.Ik(i[n],this.copiesArrayObjects);s.push(r)}return s}return e}if(e instanceof S||e instanceof lt||e instanceof j||e instanceof It||e instanceof A)return e.copy();if(t){const i=e,s=i.constructor,n=s?new s:{},o=this.copiesKey||"string"!=typeof this.nodeKeyProperty?null:this.nodeKeyProperty;for(const r in i){if("__gohashid"===r){n.__gohashid=void 0;continue}if(r===o){n[o]=void 0;continue}const a=this.St(i,r);if(y.$(a))if(bt.JC(i,r,a))this.et(n,r,a);else{const l=this.Ik(a,!1);this.et(n,r,l)}else n[r]=a}return n}return e}return e}get afterCopyFunction(){return this.Ng}set afterCopyFunction(e){const t=this.Ng;t!==e&&(null!==e&&y.S(e,bt,"afterCopyFunction"),this.Ng=e,this.t("afterCopyFunction",t,e))}static JC(e,t,i){const s=y.Hn(i);return i instanceof bt||i instanceof Pi||i instanceof hi||i instanceof li||i instanceof st||i instanceof ee||i instanceof U||i instanceof EventTarget||"Layer"===s||"RowColumnDefinition"===s||s.indexOf("Animation")>=0||s.indexOf("Tool")>=0||s.indexOf("CommandHandler")>=0||s.indexOf("Layout")>=0}static $v=!1;setDataProperty(e,t,i){if(this.containsNodeData(e)){if(t===this.nodeKeyProperty)return void this.setKeyForNodeData(e,i);if(t===this.nodeCategoryProperty)return void this.setCategoryForNodeData(e,i)}else!bt.$v&&e instanceof st&&(bt.$v=!0,y.ne('Model.setDataProperty is modifying a GraphObject, "'+e.toString()+'"'),y.ne("  Is that really your intent?"));const s=this.St(e,t);s!==i&&(this.et(e,t,i),this.raiseDataChanged(e,t,s,i))}set(e,t,i){this.setDataProperty(e,t,i)}assignAllDataProperties(e,t){if(!t)return;const i=this.containsNodeData(e);for(const s in t)"__gohashid"!==s&&(i&&s===this.nodeKeyProperty||this.setDataProperty(e,s,t[s]))}addArrayItem(e,t){this.insertArrayItem(e,-1,t)}insertArrayItem(e,t,i){t<0&&(t=e.length),e=this.ar(e,t,i),this.Ft("",3,"",e,null,i,null,t)}removeArrayItem(e,t){void 0===t&&(t=-1),e===this.Bi&&y.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),-1===t&&(t=e.length-1);const i=e[t];e=this.Co(e,t),this.Ft("",4,"",e,i,null,t,null)}get nodeCategoryProperty(){return this.lc}set nodeCategoryProperty(e){const t=this.lc;t!==e&&(this.Un(e,bt,"nodeCategoryProperty"),this.lc=e,this.t("nodeCategoryProperty",t,e))}getCategoryForNodeData(e){if(null===e)return"";const t=this.lc;if(""===t)return"";const i=this.St(e,t);return void 0===i?"":"string"==typeof i?i:void y.o("getCategoryForNodeData found a non-string category for "+e+": "+i)}setCategoryForNodeData(e,t){if(y.s(t,"string",bt,"setCategoryForNodeData:cat"),null===e)return;const i=this.lc;if(""===i)return;if(!this.containsNodeData(e))return void this.et(e,i,t);let s=this.St(e,i);void 0===s&&(s=""),s!==t&&(this.et(e,i,t),this.Ft("nodeCategory",2,i,e,s,t))}Ag(e,t){this.setCategoryForNodeData(t,this.getCategoryForNodeData(e))}get type(){return"Model"}Vm(){return!1}Um(){return!1}a1(){return!1}Wh(){return!1}Ax(){return!1}uf(){return!1}static m2(){return new bt}St(e,t){return bt.St(e,t)}static St(e,t){if(!e||!t)return null;let i;try{y.st(t)?i=t(e):y.st(e.getAttribute)?(i=e.getAttribute(t),null===i&&(i=void 0)):i=e[t]}catch{}return i}et(e,t,i){bt.et(e,t,i)}static et(e,t,i){if(e&&t){try{y.st(t)?t(e,i):y.st(e.setAttribute)?e.setAttribute(t,i):e[t]=i}catch{}return e}}eL(e,t,i){Array.isArray(e)||y.si(e,"Array",t,i)}qv(e,t,i){return e[t]=i,e}ar(e,t,i){return t>=e.length?e.push(i):e.splice(t,0,i),e}Co(e,t){return t>=e.length?e.pop():e.splice(t,1),e}static tL(e){return bt.sL[e]?bt.sL[e]:void 0!==X.go&&X.go[e]?X.go[e]:null}static Sl(e,t){bt.sL[t]=e}static sL={}}bt.fromJSON=bt.fromJson=bt.fromJson,bt.Sl(V,"Brush"),bt.Sl(Ct,"Geometry"),bt.Sl(It,"Margin"),bt.Sl(S,"Point"),bt.Sl(j,"Rect"),bt.Sl(lt,"Size"),bt.Sl(A,"Spot"),bt.Sl(bt,"Model");class Ut extends bt{Is;hr;Oe;Ga;Zf;Qf;Vl;Lo;Ao;ac;hc;cc;cn;_f;Vn;vg;constructor(e,t,i){if(super(),this.Is=[],this.hr=new z,this.Oe=new xt,this.Ga="",this.Zf=null,this.Qf=null,this.Vl=null,this.Lo="from",this.Ao="to",this.ac="",this.hc="",this.cc="category",this.cn="",this._f="isGroup",this.Vn="group",this.vg=!1,void 0!==t&&(this.linkDataArray=t),void 0!==e&&(Array.isArray(e)?this.nodeDataArray=e:i=e),i){Object.assign(this,i);const s=i.Changed;s&&(delete this.Changed,this.addChangedListener(s))}}cloneProtected(e){super.cloneProtected(e),e.Ga=this.Ga,e.Zf=this.Zf,e.Qf=this.Qf,e.Lo=this.Lo,e.Ao=this.Ao,e.ac=this.ac,e.hc=this.hc,e.cc=this.cc,e.cn=this.cn,e._f=this._f,e.Vn=this.Vn,e.vg=this.vg}clear(){this.Is=[],this.Oe.clear(),this.hr.clear(),super.clear()}toString(e){if(void 0===e&&(e=0),e>=2)return this.toJson();{let t=(""!==this.name?this.name:"")+" GraphLinksModel";if(e>0){t+="\n node data:";let i=this.nodeDataArray,s=i.length,n=0;for(n=0;n<s;n++){const o=i[n];t+=" "+this.getKeyForNodeData(o)+":"+We.toString(o)}for(t+="\n link data:",i=this.linkDataArray,s=i.length,n=0;n<s;n++){const o=i[n];t+=" "+this.Vi(o,!0)+"--\x3e"+this.Vi(o,!1)}}return t}}WC(e,t,i){if(""===this.linkKeyProperty){const u=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=u}let s=super.WC(e,t,i);const n=this,o=new z,r=new z,a=new z;e.changes.each(u=>{if(u.model===n)if("linkDataArray"===u.modelChange)3===u.change?o.add(u.newValue):4===u.change&&a.add(u.oldValue);else if(n.containsLinkData(u.object))null!==u.object&&r.add(u.object);else if(null!==u.object)if(null!==u.object&&i.has(u.object)){const d=i.get(u.object);d&&d.each(f=>{n.containsLinkData(f)&&r.add(f)})}else{if(u.object instanceof bt||n.containsNodeData(u.object))return;n.Zv(u.object).each(d=>r.add(d))}});const l=new z;o.each(u=>{const d=n.getKeyForLinkData(u);void 0!==d&&l.add(d),t||r.add(u)});const h=new z;a.each(u=>{const d=n.getKeyForLinkData(u);void 0!==d&&h.add(d),t&&r.add(u)});const c=n.cloneDeep(r.toArray());return l.count>0&&(null===s&&(s={}),t?s.removedLinkKeys=l.toArray():s.insertedLinkKeys=l.toArray()),c.length>0&&(null===s&&(s={}),s.modifiedLinkData=c),h.count>0&&(null===s&&(s={}),t?s.insertedLinkKeys=h.toArray():s.removedLinkKeys=h.toArray()),s}Lg(){const e=super.Lg();let t="";return"category"!==this.linkCategoryProperty&&"string"==typeof this.linkCategoryProperty&&(t+=',\n  "linkCategoryProperty": '+this.zi(this.linkCategoryProperty)),""!==this.linkKeyProperty&&"string"==typeof this.linkKeyProperty&&(t+=',\n  "linkKeyProperty": '+this.zi(this.linkKeyProperty)),"from"!==this.linkFromKeyProperty&&"string"==typeof this.linkFromKeyProperty&&(t+=',\n  "linkFromKeyProperty": '+this.zi(this.linkFromKeyProperty)),"to"!==this.linkToKeyProperty&&"string"==typeof this.linkToKeyProperty&&(t+=',\n  "linkToKeyProperty": '+this.zi(this.linkToKeyProperty)),""!==this.linkFromPortIdProperty&&"string"==typeof this.linkFromPortIdProperty&&(t+=',\n  "linkFromPortIdProperty": '+this.zi(this.linkFromPortIdProperty)),""!==this.linkToPortIdProperty&&"string"==typeof this.linkToPortIdProperty&&(t+=',\n  "linkToPortIdProperty": '+this.zi(this.linkToPortIdProperty)),""!==this.linkLabelKeysProperty&&"string"==typeof this.linkLabelKeysProperty&&(t+=',\n  "linkLabelKeysProperty": '+this.zi(this.linkLabelKeysProperty)),"isGroup"!==this.nodeIsGroupProperty&&"string"==typeof this.nodeIsGroupProperty&&(t+=',\n  "nodeIsGroupProperty": '+this.zi(this.nodeIsGroupProperty)),"group"!==this.nodeGroupKeyProperty&&"string"==typeof this.nodeGroupKeyProperty&&(t+=',\n  "nodeGroupKeyProperty": '+this.zi(this.nodeGroupKeyProperty)),e+t}fw(e){super.fw(e),e.linkKeyProperty&&(this.linkKeyProperty=e.linkKeyProperty),e.linkFromKeyProperty&&(this.linkFromKeyProperty=e.linkFromKeyProperty),e.linkToKeyProperty&&(this.linkToKeyProperty=e.linkToKeyProperty),e.linkFromPortIdProperty&&(this.linkFromPortIdProperty=e.linkFromPortIdProperty),e.linkToPortIdProperty&&(this.linkToPortIdProperty=e.linkToPortIdProperty),e.linkCategoryProperty&&(this.linkCategoryProperty=e.linkCategoryProperty),e.linkLabelKeysProperty&&(this.linkLabelKeysProperty=e.linkLabelKeysProperty),e.nodeIsGroupProperty&&(this.nodeIsGroupProperty=e.nodeIsGroupProperty),e.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=e.nodeGroupKeyProperty)}$C(){return super.$C()+',\n  "linkDataArray": '+this.Xa(this.linkDataArray,!0)}ZC(e){super.ZC(e);const t=e.linkDataArray;Array.isArray(t)&&(this.replaceJsonObjects(t),this.linkDataArray=t)}Qv=',\n  "insertedLinkKeys": ';c3=',\n  "modifiedLinkData": ';_v=',\n  "removedLinkKeys": ';Zv(e){const t=new z;for(let i=0;i<this.linkDataArray.length;i++){const s=this.linkDataArray[i];this.Rk(e,s,s,t)}return t}_C(e,t,i){if(""===this.linkKeyProperty){const u=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=u}const s=super._C(e,t,i),n=this,o=new z,r=new z,a=new z;e.changes.each(u=>{if(u.model===n)if("linkDataArray"===u.modelChange)3===u.change?o.add(u.newValue):4===u.change&&a.add(u.oldValue);else if(n.containsLinkData(u.object))null!==u.object&&r.add(u.object);else if(null!==u.object)if(null!==u.object&&i.has(u.object)){const d=i.get(u.object);d&&d.each(f=>{n.containsLinkData(f)&&r.add(f)})}else{if(u.object instanceof bt||n.containsNodeData(u.object))return;n.Zv(u.object).each(d=>r.add(d))}});const l=new z;o.each(u=>{const d=n.getKeyForLinkData(u);void 0!==d&&l.add(d),t||r.add(u)});const h=new z;a.each(u=>{const d=n.getKeyForLinkData(u);void 0!==d&&h.add(d),t&&r.add(u)});let c=s;return l.count>0&&(c+=(t?this._v:this.Qv)+this.Xa(l.toArray(),!0)),r.count>0&&(c+=this.c3+this.Xa(r.toArray(),!0)),h.count>0&&(c+=(t?this.Qv:this._v)+this.Xa(h.toArray(),!0)),c}uw(e){(void 0!==e.linkCategoryProperty&&e.linkCategoryProperty!==this.linkCategoryProperty||void 0!==e.linkKeyProperty&&e.linkKeyProperty!==this.linkKeyProperty||void 0!==e.linkFromKeyProperty&&e.linkFromKeyProperty!==this.linkFromKeyProperty||void 0!==e.linkToKeyProperty&&e.linkToKeyProperty!==this.linkToKeyProperty||void 0!==e.linkFromPortIdProperty&&e.linkFromPortIdProperty!==this.linkFromPortIdProperty||void 0!==e.linkToPortIdProperty&&e.linkToPortIdProperty!==this.linkToPortIdProperty||void 0!==e.linkLabelKeysProperty&&e.linkLabelKeysProperty!==this.linkLabelKeysProperty||void 0!==e.nodeIsGroupProperty&&e.nodeIsGroupProperty!==this.nodeIsGroupProperty||void 0!==e.nodeGroupKeyProperty&&e.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&y.o("applyIncrementalJson cannot change Model properties"),super.uw(e);const t=e.insertedLinkKeys;if(Array.isArray(t)){const n=t.length;for(let o=0;o<n;o++){const r=t[o];let a=this.findLinkDataForKey(r);null===a&&(a=this.copyLinkData({}),this.setKeyForLinkData(a,r),this.addLinkData(a))}}const i=e.modifiedLinkData;if(Array.isArray(i)){const n=i.length;for(let o=0;o<n;o++){const r=i[o],a=this.getKeyForLinkData(r),l=this.findLinkDataForKey(a);if(null!==l){for(const h in r)"__gohashid"===h||h===this.linkKeyProperty||this.setDataProperty(l,h,r[h]);this.tF(r,l)}}}const s=e.removedLinkKeys;if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++){const a=this.findLinkDataForKey(s[o]);null!==a&&this.removeLinkData(a)}}}changeState(e,t){if(null!==e&&e.model===this){if(2===e.change){const i=e.object,s=e.propertyName;if(null!==i&&s===this.linkKeyProperty&&this.containsLinkData(i)){const n=e.getValue(t),o=e.getValue(!t);return void 0!==o&&this.Oe.delete(o),void 0!==n&&this.Oe.set(n,i),void this.et(i,s,n)}}else if(3===e.change){let i=e.newParam;if("linkDataArray"===e.modelChange){const s=e.newValue;if(y.$(s)&&"number"==typeof i){const n=this.getKeyForLinkData(s);t?(this.hr.delete(s),this.Is[i]===s&&this.Co(this.linkDataArray,i),void 0!==n&&this.Oe.delete(n)):(this.hr.add(s),this.Is[i]!==s&&this.ar(this.Is,i,s),void 0!==n&&this.Oe.set(n,s))}return}if("linkLabelKeys"===e.modelChange){const s=e.object,n=null!==s?this.getLabelKeysForLinkData(s):null;return void(Array.isArray(n)&&"number"==typeof i&&(t?(i=n.indexOf(e.newValue),i>=0&&this.Co(n,i)):n.indexOf(e.newValue)<0&&this.ar(n,i,e.newValue)))}}else if(4===e.change){let i=e.oldParam;if("linkDataArray"===e.modelChange){const s=e.oldValue;if(y.$(s)&&"number"==typeof i){const n=this.getKeyForLinkData(s);t?(this.hr.add(s),this.Is[i]!==s&&this.ar(this.Is,i,s),void 0!==n&&this.Oe.set(n,s)):(this.hr.delete(s),this.Is[i]===s&&this.Co(this.linkDataArray,i),void 0!==n&&this.Oe.delete(n))}return}if("linkLabelKeys"===e.modelChange){const s=e.object,n=null!==s?this.getLabelKeysForLinkData(s):null;return void(Array.isArray(n)&&"number"==typeof i&&(t?n.indexOf(e.oldValue)<0&&this.ar(n,i,e.oldValue):(i=n.indexOf(e.oldValue),i>=0&&this.Co(n,i))))}}super.changeState(e,t)}}get archetypeNodeData(){return this.Vl}set archetypeNodeData(e){const t=this.Vl;t!==e&&(null!==e&&y.xc(e,Ut,"archetypeNodeData"),this.Vl=e,this.t("archetypeNodeData",t,e))}nL(e){if(void 0===e)return;const t=this.Vl;if(null!==t){let i=this.findNodeDataForKey(e);null===i&&(i=this.copyNodeData(t),this.et(i,this.nodeKeyProperty,e),this.addNodeData(i))}return e}get linkFromKeyProperty(){return this.Lo}set linkFromKeyProperty(e){const t=this.Lo;t!==e&&(this.Un(e,Ut,"linkFromKeyProperty"),this.Lo=e,this.t("linkFromKeyProperty",t,e))}getFromKeyForLinkData(e){return this.Vi(e,!0)}setFromKeyForLinkData(e,t){this.xg(e,t,!0)}get linkToKeyProperty(){return this.Ao}set linkToKeyProperty(e){const t=this.Ao;t!==e&&(this.Un(e,Ut,"linkToKeyProperty"),this.Ao=e,this.t("linkToKeyProperty",t,e))}getToKeyForLinkData(e){return this.Vi(e,!1)}setToKeyForLinkData(e,t){this.xg(e,t,!1)}Vi(e,t){if(null===e)return;const i=t?this.Lo:this.Ao;if(""===i)return;const s=this.St(e,i);if(void 0!==s){if(this.isKeyType(s))return s;y.o((t?"FromKey":"ToKey")+" value for link data "+e+" is not a number or a string: "+s)}}xg(e,t,i){if(null===t&&(t=void 0),void 0!==t&&!this.isKeyType(t)&&y.si(t,"number or string",Ut,i?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),null===e)return;const s=i?this.Lo:this.Ao;if(""===s)return;if(t=this.nL(t),!this.containsLinkData(e))return void this.et(e,s,t);const n=this.St(e,s);n!==t&&(this.an(n,e),this.et(e,s,t),null===this.findNodeDataForKey(t)&&this.hn(t,e),this.Ft(i?"linkFromKey":"linkToKey",2,s,e,n,t),"string"==typeof s&&this.updateTargetBindings(e,s))}get linkFromPortIdProperty(){return this.ac}set linkFromPortIdProperty(e){const t=this.ac;t!==e&&(this.Un(e,Ut,"linkFromPortIdProperty"),this.ac=e,this.t("linkFromPortIdProperty",t,e))}getFromPortIdForLinkData(e){return this.Ak(e,!0)}setFromPortIdForLinkData(e,t){this.bg(e,t,!0)}get linkToPortIdProperty(){return this.hc}set linkToPortIdProperty(e){const t=this.hc;t!==e&&(this.Un(e,Ut,"linkToPortIdProperty"),this.hc=e,this.t("linkToPortIdProperty",t,e))}getToPortIdForLinkData(e){return this.Ak(e,!1)}setToPortIdForLinkData(e,t){this.bg(e,t,!1)}Ak(e,t){if(null===e)return"";const i=t?this.ac:this.hc;if(""===i)return"";const s=this.St(e,i);return void 0===s?"":s}bg(e,t,i){if(y.s(t,"string",Ut,i?"setFromPortIdForLinkData:portname":"setToPortIdForLinkData:portname"),null===e)return;const s=i?this.ac:this.hc;if(""===s)return;if(!this.containsLinkData(e))return void this.et(e,s,t);let n=this.St(e,s);void 0===n&&(n=""),n!==t&&(this.et(e,s,t),this.Ft(i?"linkFromPortId":"linkToPortId",2,s,e,n,t),"string"==typeof s&&this.updateTargetBindings(e,s))}get linkLabelKeysProperty(){return this.cn}set linkLabelKeysProperty(e){const t=this.cn;t!==e&&(this.Un(e,Ut,"linkLabelKeysProperty"),this.cn=e,this.t("linkLabelKeysProperty",t,e))}getLabelKeysForLinkData(e){if(null===e)return Ut.EmptyArray;const t=this.cn;if(""===t)return Ut.EmptyArray;const i=this.St(e,t);return void 0===i?Ut.EmptyArray:i}setLabelKeysForLinkData(e,t){if(this.eL(t,Ut,"setLabelKeysForLinkData:arr"),null===e)return;const i=this.cn;if(""===i)return;if(!this.containsLinkData(e))return void this.et(e,i,t);let s=this.St(e,i);if(void 0===s&&(s=Ut.EmptyArray),s!==t){if(Array.isArray(s)){const o=s.length;for(let r=0;r<o;r++)this.an(s[r],e)}this.et(e,i,t);const n=t.length;for(let o=0;o<n;o++){const r=t[o];null===this.findNodeDataForKey(r)&&this.hn(r,e)}this.Ft("linkLabelKeys",2,i,e,s,t),"string"==typeof i&&this.updateTargetBindings(e,i)}}addLabelKeyForLinkData(e,t){if(null==t||(this.isKeyType(t)||y.si(t,"number or string",Ut,"addLabelKeyForLinkData:key"),null===e))return;const i=this.cn;if(""===i)return;const s=this.St(e,i);if(void 0===s){const n=[];n.push(t),this.setLabelKeysForLinkData(e,n)}else if(Array.isArray(s)){let n=s.indexOf(t);if(n>=0)return;n=s.length,s.push(t),this.containsLinkData(e)&&(null===this.findNodeDataForKey(t)&&this.hn(t,e),this.Ft("linkLabelKeys",3,i,e,null,t,null,n))}else y.o(i+" property is not an Array; cannot addLabelKeyForLinkData: "+e)}removeLabelKeyForLinkData(e,t){if(null==t||(this.isKeyType(t)||y.si(t,"number or string",Ut,"removeLabelKeyForLinkData:key"),null===e))return;const i=this.cn;if(""===i)return;const s=this.St(e,i);if(Array.isArray(s)){const n=s.indexOf(t);if(n<0)return;this.Co(s,n),this.containsLinkData(e)&&(this.an(t,e),this.Ft("linkLabelKeys",4,i,e,t,null,n,null))}else void 0!==s&&y.o(i+" property is not an Array; cannot removeLabelKeyforLinkData: "+e)}get linkDataArray(){return this.Is}set linkDataArray(e){const t=this.Is;if(t!==e){this.eL(e,Ut,"linkDataArray"),this.Oe.clear();const i=e.length;for(let n=0;n<i;n++){const o=e[n];y.$(o)||y.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+o)}if(this.Is=e,""!==this.linkKeyProperty){const n=new H;for(let r=0;r<i;r++){const a=e[r],l=this.getKeyForLinkData(a);void 0===l||null!==this.Oe.get(l)?n.add(a):this.Oe.set(l,a)}const o=n.iterator;for(;o.next();){const r=o.value;this.makeLinkDataKeyUnique(r);const a=this.getKeyForLinkData(r);void 0!==a&&this.Oe.set(a,r)}}const s=new z;for(let n=0;n<i;n++)s.add(e[n]);this.hr=s,this.Ft("linkDataArray",2,"linkDataArray",this,t,e);for(let n=0;n<i;n++)this.oL(e[n])}}get linkKeyProperty(){return this.Ga}set linkKeyProperty(e){const t=this.Ga;if(t!==e){this.Un(e,Ut,"linkKeyProperty"),this.Ga=e,this.Oe.clear();const i=this.linkDataArray.length;for(let s=0;s<i;s++){const n=this.linkDataArray[s];let o=this.getKeyForLinkData(n);void 0===o&&(this.makeLinkDataKeyUnique(n),o=this.getKeyForLinkData(n)),void 0!==o&&this.Oe.set(o,n)}this.t("linkKeyProperty",t,e)}}getKeyForLinkData(e){if(null===e)return;const t=this.Ga;if(""===t)return;const i=this.St(e,t);if(void 0!==i){if(this.isKeyType(i))return i;y.o("Key value for link data "+e+" is not a number or a string: "+i)}}setKeyForLinkData(e,t){if((null==t||!this.isKeyType(t))&&y.si(t,"number or string",Ut,"setKeyForLinkData:key"),null===e)return;const i=this.Ga;if(""===i)return;if(!this.containsLinkData(e))return void this.et(e,i,t);const s=this.St(e,i);if(s!==t){if(null!==this.findLinkDataForKey(t))return;this.et(e,i,t),void 0!==s&&this.Oe.delete(s),this.Oe.set(t,e),this.Ft("linkKey",2,i,e,s,t),"string"==typeof i&&this.updateTargetBindings(e,i)}}get makeUniqueLinkKeyFunction(){return this.Zf}set makeUniqueLinkKeyFunction(e){const t=this.Zf;t!==e&&(null!==e&&y.S(e,Ut,"makeUniqueLinkKeyFunction"),this.Zf=e,this.t("makeUniqueLinkKeyFunction",t,e))}findLinkDataForKey(e){return null===e&&y.o("GraphLinksModel.findLinkDataForKey:key must not be null"),void 0!==e&&this.isKeyType(e)?this.Oe.get(e):null}Ek(e){return void 0!==e&&this.Oe.has(e)}makeLinkDataKeyUnique(e){if(null===e)return;const t=this.Ga;if(""===t)return;let i=this.getKeyForLinkData(e);if(void 0!==i&&!this.Ek(i))return;const s=this.Zf;if(null===s||(i=s(this,e),null==i||this.Ek(i))){if("string"==typeof i){let n=2;for(;this.Ek(i+n);)n++;this.et(e,t,i+n)}else if(void 0===i||"number"==typeof i){let n=-this.Oe.count-1;for(;this.Ek(n);)n--;this.et(e,t,n)}}else this.et(e,t,i)}containsLinkData(e){return null!==e&&this.hr.has(e)}addLinkData(e){null!==e&&(this.containsLinkData(e)||this.Uv(e,!0))}Uv(e,t){if(""!==this.linkKeyProperty){let s=this.getKeyForLinkData(e);if(void 0===s)this.makeLinkDataKeyUnique(e),s=this.getKeyForLinkData(e);else{if(this.Oe.get(s)===e)return;this.makeLinkDataKeyUnique(e),s=this.getKeyForLinkData(e)}void 0===s&&y.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+e+". Data not added to model."),this.Oe.set(s,e)}this.hr.add(e);let i=null;t&&(i=this.Is.length,this.ar(this.Is,i,e)),this.Ft("linkDataArray",3,"linkDataArray",this,null,e,null,i),this.oL(e)}addLinkDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.addLinkData(e[i])}else{const t=e.iterator;for(;t.next();)this.addLinkData(t.value)}}removeLinkData(e){null!==e&&this.Ev(e,!0)}Ev(e,t){this.hr.delete(e);const i=this.getKeyForLinkData(e);void 0!==i&&this.Oe.delete(i);let s=null;if(t){if(s=this.Is.indexOf(e),s<0)return;this.Co(this.Is,s)}this.Ft("linkDataArray",4,"linkDataArray",this,e,null,s,null),this.f3(e)}removeLinkDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.removeLinkData(e[i])}else{const t=e.iterator;for(;t.next();)this.removeLinkData(t.value)}}mergeLinkDataArray(e){if(""===this.linkKeyProperty&&y.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),e===this.linkDataArray||!Array.isArray(e))return;const t=new z;t.addAll(this.Oe.iteratorKeys);const i=new z,s=e.length;for(let o=0;o<s;o++){const r=e[o],a=this.getKeyForLinkData(r);if(void 0!==a){i.add(a);const l=this.findLinkDataForKey(a);if(l===r)continue;if(null!==l)this.assignAllDataProperties(l,r),this.tF(r,l);else{const h=this.cloneDeep(r);this.setKeyForLinkData(h,a),this.addLinkData(h)}}else{const l=this.cloneDeep(r);this.addLinkData(l);const h=this.getKeyForLinkData(l);void 0!==h&&i.add(h)}}const n=t.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const r=this.findLinkDataForKey(o);r&&this.removeLinkData(r)}}}oL(e){let t=this.Vi(e,!0);t=this.nL(t),null===this.findNodeDataForKey(t)&&this.hn(t,e),t=this.Vi(e,!1),t=this.nL(t),null===this.findNodeDataForKey(t)&&this.hn(t,e);const i=this.getLabelKeysForLinkData(e);if(Array.isArray(i)){const s=i.length;for(let n=0;n<s;n++)t=i[n],null===this.findNodeDataForKey(t)&&this.hn(t,e)}}f3(e){let t=this.Vi(e,!0);this.an(t,e),t=this.Vi(e,!1),this.an(t,e);const i=this.getLabelKeysForLinkData(e);if(Array.isArray(i)){const s=i.length;for(let n=0;n<s;n++)t=i[n],this.an(t,e)}}get copyLinkDataFunction(){return this.Qf}set copyLinkDataFunction(e){const t=this.Qf;t!==e&&(null!==e&&y.S(e,Ut,"copyLinkDataFunction"),this.Qf=e,this.t("copyLinkDataFunction",t,e))}copyLinkData(e){let t=null;const i=this.Qf;return t=null!==i?i(e,this):this.Ik(e,!0),y.$(t)&&(""!==this.Lo&&this.et(t,this.Lo,void 0),""!==this.Ao&&this.et(t,this.Ao,void 0),""!==this.cn&&this.et(t,this.cn,[])),t}get nodeIsGroupProperty(){return this._f}set nodeIsGroupProperty(e){const t=this._f;t!==e&&(this.Un(e,Ut,"nodeIsGroupProperty"),this._f=e,this.t("nodeIsGroupProperty",t,e))}isGroupForNodeData(e){if(null===e)return!1;const t=this._f;return""!==t&&!!this.St(e,t)}isGroupForData(e){return this.isGroupForNodeData(e)}get nodeGroupKeyProperty(){return this.Vn}set nodeGroupKeyProperty(e){const t=this.Vn;t!==e&&(this.Un(e,Ut,"nodeGroupKeyProperty"),this.Vn=e,this.t("nodeGroupKeyProperty",t,e))}get copiesGroupKeyOfNodeData(){return this.vg}set copiesGroupKeyOfNodeData(e){this.vg!==e&&(y.s(e,"boolean",Ut,"copiesGroupKeyOfNodeData"),this.vg=e)}getGroupKeyForNodeData(e){if(null===e)return;const t=this.Vn;if(""===t)return;const i=this.St(e,t);if(void 0!==i){if(this.isKeyType(i))return i;y.o("GroupKey value for node data "+e+" is not a number or a string: "+i)}}getGroupForData(e){return this.getGroupKeyForNodeData(e)}setGroupKeyForNodeData(e,t){if(null===t&&(t=void 0),void 0!==t&&!this.isKeyType(t)&&y.si(t,"number or string",Ut,"setGroupKeyForNodeData:key"),null===e)return;const i=this.Vn;if(""===i)return;if(!this.containsNodeData(e))return void this.et(e,i,t);const s=this.St(e,i);s!==t&&(this.an(s,e),this.et(e,i,t),null===this.findNodeDataForKey(t)&&this.hn(t,e),this.Ft("nodeGroupKey",2,i,e,s,t),"string"==typeof i&&this.updateTargetBindings(e,i))}setGroupForData(e,t){this.setGroupKeyForNodeData(e,t)}copyNodeData(e){const t=super.copyNodeData(e);return!this.copiesGroupKeyOfNodeData&&""!==this.Vn&&void 0!==this.St(t,this.Vn)&&this.et(t,this.Vn,void 0),t}setDataProperty(e,t,i){if(this.containsNodeData(e)){if(t===this.nodeKeyProperty)return void this.setKeyForNodeData(e,i);if(t===this.nodeCategoryProperty)return void this.setCategoryForNodeData(e,i);if(t===this.nodeGroupKeyProperty)return void this.setGroupKeyForNodeData(e,i)}else if(this.containsLinkData(e)){if(t===this.linkFromKeyProperty)return void this.xg(e,i,!0);if(t===this.linkToKeyProperty)return void this.xg(e,i,!1);if(t===this.linkFromPortIdProperty)return void this.bg(e,i,!0);if(t===this.linkToPortIdProperty)return void this.bg(e,i,!1);if(t===this.linkKeyProperty)return void this.setKeyForLinkData(e,i);if(t===this.linkCategoryProperty)return void this.setCategoryForLinkData(e,i);if(t===this.linkLabelKeysProperty)return void this.setLabelKeysForLinkData(e,i)}const s=this.St(e,t);s!==i&&(this.et(e,t,i),this.raiseDataChanged(e,t,s,i))}assignAllDataProperties(e,t){if(!t)return;const i=this.containsNodeData(e),s=this.containsLinkData(e);for(const n in t)if("__gohashid"!==n&&(!i||n!==this.nodeKeyProperty)){if(i&&n===this.nodeIsGroupProperty&&this.St(e,n)===t[n]||s&&n===this.linkKeyProperty)continue;this.setDataProperty(e,n,t[n])}}dw(e,t){super.dw(e,t);const i=this.be.iterator;for(;i.next();)this.rL(i.value,e,t);const s=this.hr.iterator;for(;s.next();)this.u3(s.value,e,t)}rL(e,t,i){if(this.getGroupKeyForNodeData(e)===t){const s=this.Vn;this.et(e,s,i),this.Ft("nodeGroupKey",2,s,e,t,i),"string"==typeof s&&this.updateTargetBindings(e,s)}}u3(e,t,i){if(this.Vi(e,!0)===t){const n=this.Lo;this.et(e,n,i),this.Ft("linkFromKey",2,n,e,t,i),"string"==typeof n&&this.updateTargetBindings(e,n)}if(this.Vi(e,!1)===t){const n=this.Ao;this.et(e,n,i),this.Ft("linkToKey",2,n,e,t,i),"string"==typeof n&&this.updateTargetBindings(e,n)}const s=this.getLabelKeysForLinkData(e);if(Array.isArray(s)){const n=s.length,o=this.cn;for(let r=0;r<n;r++)s[r]===t&&(this.qv(s,r,i),this.Ft("linkLabelKeys",3,o,e,t,i,r,r))}}iL(){super.iL();const e=this.linkDataArray,t=e.length;for(let i=0;i<t;i++)this.oL(e[i])}Tg(e){super.Tg(e);const t=this.getKeyForNodeData(e),i=this.lw(t);if(null!==i){const s=y.nt(),n=i.iterator;for(;n.next();){const o=n.value;if(this.containsNodeData(o)){if(this.getGroupKeyForNodeData(o)===t){const r=this.Vn;this.Ft("nodeGroupKey",2,r,o,t,t),"string"==typeof r&&this.updateTargetBindings(o,r),s.push(o)}}else{if(this.Vi(o,!0)===t){const a=this.Lo;this.Ft("linkFromKey",2,a,o,t,t),"string"==typeof a&&this.updateTargetBindings(o,a),s.push(o)}if(this.Vi(o,!1)===t){const a=this.Ao;this.Ft("linkToKey",2,a,o,t,t),"string"==typeof a&&this.updateTargetBindings(o,a),s.push(o)}const r=this.getLabelKeysForLinkData(o);if(Array.isArray(r)){const a=r.length,l=this.cn;for(let h=0;h<a;h++)r[h]===t&&(this.Ft("linkLabelKeys",3,l,o,t,t,h,h),s.push(o))}}}for(let o=0;o<s.length;o++)this.an(t,s[o]);y.Z(s)}}Dg(e){super.Dg(e);const t=this.getGroupKeyForNodeData(e);null===this.findNodeDataForKey(t)&&this.hn(t,e)}gw(e){super.gw(e);const t=this.getGroupKeyForNodeData(e);this.an(t,e)}get linkCategoryProperty(){return this.cc}set linkCategoryProperty(e){const t=this.cc;t!==e&&(this.Un(e,Ut,"linkCategoryProperty"),this.cc=e,this.t("linkCategoryProperty",t,e))}getCategoryForLinkData(e){if(null===e)return"";const t=this.cc;if(""===t)return"";const i=this.St(e,t);return void 0===i?"":"string"==typeof i?i:void y.o("getCategoryForLinkData found a non-string category for "+e+": "+i)}getLinkCategoryForData(e){return this.getCategoryForLinkData(e)}setCategoryForLinkData(e,t){if(y.s(t,"string",Ut,"setCategoryForLinkData:cat"),null===e)return;const i=this.cc;if(""===i)return;if(!this.containsLinkData(e))return void this.et(e,i,t);let s=this.St(e,i);void 0===s&&(s=""),s!==t&&(this.et(e,i,t),this.Ft("linkCategory",2,i,e,s,t),"string"==typeof i&&this.updateTargetBindings(e,i))}setLinkCategoryForData(e,t){this.setCategoryForLinkData(e,t)}Ag(e,t){super.Ag(e,t),this.setGroupKeyForNodeData(t,this.getGroupKeyForNodeData(e))}tF(e,t){this.setCategoryForLinkData(t,this.getCategoryForLinkData(e)),this.setFromKeyForLinkData(t,this.getFromKeyForLinkData(e)),this.setToKeyForLinkData(t,this.getToKeyForLinkData(e)),this.setLabelKeysForLinkData(t,this.getLabelKeysForLinkData(e)),this.setFromPortIdForLinkData(t,this.getFromPortIdForLinkData(e)),this.setToPortIdForLinkData(t,this.getToPortIdForLinkData(e))}get type(){return"GraphLinksModel"}Um(){return!0}Wh(){return!0}Ax(){return!0}uf(){return!0}static EmptyArray=Object.freeze([])}bt.Sl(Ut,"GraphLinksModel"),bt.jv=()=>new Ut,bt.m2=()=>new Ut;class Ve extends bt{Bn;Fg;fc;constructor(e,t){if(super(),this.Bn="parent",this.Fg=!1,this.fc="parentLinkCategory",void 0!==e&&(Array.isArray(e)?this.nodeDataArray=e:t=e),t){Object.assign(this,t);const i=t.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(e){super.cloneProtected(e),e.Bn=this.Bn,e.Fg=this.Fg,e.fc=this.fc}toString(e){if(void 0===e&&(e=0),e>=2)return this.toJson();{let t=(""!==this.name?this.name:"")+" TreeModel";if(e>0){t+="\n node data:";const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+this.getKeyForNodeData(o)+":"+We.toString(o)}}return t}}Lg(){const e=super.Lg();let t="";return"parent"!==this.nodeParentKeyProperty&&"string"==typeof this.nodeParentKeyProperty&&(t+=',\n  "nodeParentKeyProperty": '+this.zi(this.nodeParentKeyProperty)),e+t}fw(e){super.fw(e),e.nodeParentKeyProperty&&(this.nodeParentKeyProperty=e.nodeParentKeyProperty)}uw(e){void 0!==e.nodeParentKeyProperty&&e.nodeParentKeyProperty!==this.nodeParentKeyProperty&&y.o("applyIncrementalJson cannot change Model properties"),super.uw(e)}maybeEnsureLinkReference(e){return e}get nodeParentKeyProperty(){return this.Bn}set nodeParentKeyProperty(e){const t=this.Bn;t!==e&&(this.Un(e,Ve,"nodeParentKeyProperty"),this.Bn=e,this.t("nodeParentKeyProperty",t,e))}get copiesParentKeyOfNodeData(){return this.Fg}set copiesParentKeyOfNodeData(e){this.Fg!==e&&(y.s(e,"boolean",Ve,"copiesParentKeyOfNodeData"),this.Fg=e)}getParentKeyForNodeData(e){if(null===e)return;const t=this.Bn;if(""===t)return;const i=this.St(e,t);if(void 0!==i){if(this.isKeyType(i))return i;y.o("ParentKey value for node data "+e+" is not a number or a string: "+i)}}setParentKeyForNodeData(e,t){if(null===t&&(t=void 0),void 0!==t&&!this.isKeyType(t)&&y.si(t,"number or string",Ve,"setParentKeyForNodeData:key"),null===e)return;const i=this.Bn;if(""===i)return;if(t=this.maybeEnsureLinkReference(t),!this.containsNodeData(e))return void this.et(e,i,t);const s=this.St(e,i);s!==t&&(this.an(s,e),this.et(e,i,t),null===this.findNodeDataForKey(t)&&this.hn(t,e),this.Ft("nodeParentKey",2,i,e,s,t),"string"==typeof i&&this.updateTargetBindings(e,i))}get parentLinkCategoryProperty(){return this.fc}set parentLinkCategoryProperty(e){const t=this.fc;t!==e&&(this.Un(e,Ve,"parentLinkCategoryProperty"),this.fc=e,this.t("parentLinkCategoryProperty",t,e))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(e){this.parentLinkCategoryProperty=e}getParentLinkCategoryForNodeData(e){if(null===e)return"";const t=this.fc;if(""===t)return"";const i=this.St(e,t);return void 0===i?"":"string"==typeof i?i:void y.o("getParentLinkCategoryForNodeData found a non-string category for "+e+": "+i)}getLinkCategoryForData(e){return this.getParentLinkCategoryForNodeData(e)}setParentLinkCategoryForNodeData(e,t){if(y.s(t,"string",Ve,"setParentLinkCategoryForNodeData:cat"),null===e)return;const i=this.fc;if(""===i)return;if(!this.containsNodeData(e))return void this.et(e,i,t);let s=this.St(e,i);void 0===s&&(s=""),s!==t&&(this.et(e,i,t),this.Ft("parentLinkCategory",2,i,e,s,t),"string"==typeof i&&this.updateTargetBindings(e,i))}setLinkCategoryForData(e,t){this.setParentLinkCategoryForNodeData(e,t)}copyNodeData(e){const t=super.copyNodeData(e);return!this.copiesParentKeyOfNodeData&&""!==this.Bn&&void 0!==this.St(t,this.Bn)&&this.et(t,this.Bn,void 0),t}setDataProperty(e,t,i){if(this.containsNodeData(e)){if(t===this.nodeKeyProperty)return void this.setKeyForNodeData(e,i);if(t===this.nodeCategoryProperty)return void this.setCategoryForNodeData(e,i);if(t===this.nodeParentKeyProperty)return void this.setParentKeyForNodeData(e,i);if(t===this.parentLinkCategoryProperty)return void this.setParentLinkCategoryForNodeData(e,i)}const s=this.St(e,t);s!==i&&(this.et(e,t,i),this.raiseDataChanged(e,t,s,i))}dw(e,t){super.dw(e,t);const i=this.be.iterator;for(;i.next();)this.rL(i.value,e,t)}rL(e,t,i){if(this.getParentKeyForNodeData(e)===t){const s=this.Bn;this.et(e,s,i),this.Ft("nodeParentKey",2,s,e,t,i),"string"==typeof s&&this.updateTargetBindings(e,s)}}Tg(e){super.Tg(e);const t=this.getKeyForNodeData(e),i=this.lw(t);if(null!==i){const s=y.nt(),n=i.iterator;for(;n.next();){const o=n.value;if(this.containsNodeData(o)&&this.getParentKeyForNodeData(o)===t){const r=this.Bn;this.Ft("nodeParentKey",2,r,o,t,t),"string"==typeof r&&this.updateTargetBindings(o,r),s.push(o)}}for(let o=0;o<s.length;o++)this.an(t,s[o]);y.Z(s)}}Dg(e){super.Dg(e);let t=this.getParentKeyForNodeData(e);t=this.maybeEnsureLinkReference(t),null===this.findNodeDataForKey(t)&&this.hn(t,e)}gw(e){super.gw(e);const t=this.getParentKeyForNodeData(e);this.an(t,e)}Ag(e,t){super.Ag(e,t),this.setParentLinkCategoryForNodeData(t,this.getParentLinkCategoryForNodeData(e)),this.setParentKeyForNodeData(t,this.getParentKeyForNodeData(e))}get type(){return"TreeModel"}Vm(){return!0}Ax(){return!0}}bt.Sl(Ve,"TreeModel");var _i=(m=>(m[m.ConstantSpacing=0]="ConstantSpacing",m[m.ConstantDistance=1]="ConstantDistance",m[m.ConstantAngle=2]="ConstantAngle",m[m.Packed=3]="Packed",m))(_i||{}),ts=(m=>(m[m.Clockwise=10]="Clockwise",m[m.Counterclockwise=11]="Counterclockwise",m[m.BidirectionalLeft=12]="BidirectionalLeft",m[m.BidirectionalRight=13]="BidirectionalRight",m))(ts||{}),es=(m=>(m[m.Forwards=20]="Forwards",m[m.Reverse=21]="Reverse",m[m.Ascending=22]="Ascending",m[m.Descending=23]="Descending",m[m.Optimized=24]="Optimized",m))(es||{}),is=(m=>(m[m.Pythagorean=30]="Pythagorean",m[m.Circular=31]="Circular",m))(is||{});let vo=(()=>{class m extends se{gi;tu;Uk;Rg;Vk;Ya;lL;aL;hL;Es;mw;pw;uc;yw;eF;Og;Ig;Eg;eu;He;P;Si;Mi;En;Ug;constructor(t){super(),this.gi=0,this.tu=0,this.Uk=0,this.Rg=360,this.Vk=0,this.Ya=0,this.lL=new S,this.aL=30,this.hL=0,this.Es=0,this.mw=0,this.pw=new Gs,this.uc=0,this.yw=0,this.eF=600,this.Og=NaN,this.Ig=1,this.Eg=0,this.eu=360,this.He=0,this.P=10,this.Si=24,this.Mi=Be.standardComparer,this.En=6,this.Ug=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Og=this.Og,t.Ig=this.Ig,t.Eg=this.Eg,t.eu=this.eu,t.He=this.He,t.P=this.P,t.Si=this.Si,t.Mi=this.Mi,t.En=this.En,t.Ug=this.Ug}fe(t){t in es?this.sorting=t:t in ts?this.direction=t:t in _i?this.arrangement=t:t in is?this.nodeDiameterFormula=t:super.fe(t)}createNetwork(){return new Ks(this)}d3(t,i,s){t=this.g3(t);let n=this.Vk,o=this.aL,r=this.gi,a=this.tu,l=this.Uk,h=this.Rg,c=this.Ya,u=this.hL,d=this.Es,f=this.mw;if(n=this.arrangement,o=this.nodeDiameterFormula,r=this.radius,(!isFinite(r)||r<=0)&&(r=NaN),a=this.aspectRatio,(!isFinite(a)||a<=0)&&(a=1),l=this.startAngle,isFinite(l)||(l=0),h=this.sweepAngle,(!isFinite(h)||h>360||h<1)&&(h=360),c=this.spacing,isFinite(c)||(c=NaN),3===n&&31===o?n=0:3===n&&31!==o&&(o=31,n=this.arrangement),(12===this.direction||13===this.direction)&&24!==this.sorting){for(let b=0;!(b>=t.length||(i.add(t.elt(b)),b+1>=t.length));b+=2)s.add(t.elt(b+1));12===this.direction?(3===this.arrangement&&i.reverse(),(t=new H).addAll(i),t.addAll(s)):(3===this.arrangement&&s.reverse(),(t=new H).addAll(s),t.addAll(i))}const p=t.length;u=0;let g=0;for(let b=0;b<t.length;b++){const x=l+h*g*(10===this.direction?1:-1)/p;let v=t.elt(b).diameter;isNaN(v)&&(v=t.elt(b).Ka(x)),h<360&&(0===b||b===t.length-1)&&(v/=2),u+=v,g++}if(isNaN(r)||3===n){if(isNaN(c)&&(c=6),0!==n&&3!==n){let b=-1/0;for(let x=0;x<p;x++){const v=t.elt(x),P=t.elt(x===p-1?0:x+1);isNaN(v.diameter)&&v.Ka(0),isNaN(P.diameter)&&P.Ka(0),b=Math.max(b,(v.diameter+P.diameter)/2)}if(f=b+c,2===n){const v=(b+c)/(2*Math.PI/p);a>1?(r=v,d=r*a):(d=v,r=d)}else r=this.Bk(f*(h>=360?p:p-1),a,l*Math.PI/180,h*Math.PI/180)}else r=this.Bk(u+(h>=360?p:p-1)*(3!==n?c:1.6*c),a,l*Math.PI/180,h*Math.PI/180);d=r*a}else{d=r*a;const b=this.cL(r,d,l*Math.PI/180,h*Math.PI/180);if(isNaN(c))0===n&&(c=(b-u)/(h>=360?p:p-1));else if(0===n){const x=(b-u)/(h>=360?p:p-1);x<c?(r=this.Bk(u+c*(h>=360?p:p-1),a,l*Math.PI/180,h*Math.PI/180),d=r*a):c=x}else{let x=-1/0;for(let w=0;w<p;w++){const M=t.elt(w),C=t.elt(w===p-1?0:w+1);isNaN(M.diameter)&&M.Ka(0),isNaN(C.diameter)&&C.Ka(0),x=Math.max(x,(M.diameter+C.diameter)/2)}const v=x+c,P=this.Bk(v*(h>=360?p:p-1),a,l*Math.PI/180,h*Math.PI/180);P>r?(r=P,d=r*a,f=v):f=b/(h>=360?p:p-1)}}return this.Vk=n,this.aL=o,this.gi=r,this.tu=a,this.Uk=l,this.Rg=h,this.Ya=c,this.hL=u,this.Es=d,this.mw=f,t}doLayout(t){null===this.network&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.network.vertexes;if(i.count<=1){if(1===i.count){const f=i.first();f.centerX=0,f.centerY=0}return this.updateParts(),this.network=null,void(this.isValidLayout=!0)}let s=new H;s.addAll(i.iterator);const n=new H,o=new H;s=this.d3(s,n,o);const r=this.Vk,a=this.gi,l=this.Uk,h=this.Rg,c=this.Ya,u=this.Es,d=this.mw;if(12!==this.direction&&13!==this.direction||3!==r)if(12===this.direction||13===this.direction){let f=0;switch(r){case 1:f=180*this.zk(a,u,l,d)/Math.PI;break;case 0:{let p=0,g=0;const b=n.first();null!==b&&(p=b.Ka(Math.PI/2));const x=o.first();null!==x&&(g=x.Ka(Math.PI/2)),f=180*this.zk(a,u,l,c+(p+g)/2)/Math.PI;break}case 2:f=h/s.length}if(12===this.direction){switch(r){case 1:this.ww(n,h/2,l,11);break;case 0:this.xw(n,h/2,l,11);break;case 2:this.bw(n,h/2,l,11)}switch(r){case 1:this.ww(o,h/2,l+f,10);break;case 0:this.xw(o,h/2,l+f,10);break;case 2:this.bw(o,h/2,l+f,10)}}else{switch(r){case 1:this.ww(o,h/2,l,11);break;case 0:this.xw(o,h/2,l,11);break;case 2:this.bw(o,h/2,l,11)}switch(r){case 1:this.ww(n,h/2,l+f,10);break;case 0:this.xw(n,h/2,l+f,10);break;case 2:this.bw(n,h/2,l+f,10)}}}else switch(r){case 1:this.ww(s,h,l,this.direction);break;case 0:this.xw(s,h,l,this.direction);break;case 2:this.bw(s,h,l,this.direction);break;case 3:this.iF(s,h,l,this.direction)}else this.iF(s,h,l-h/2,10);this.updateParts(),this.network=null,this.isValidLayout=!0}bw(t,i,s,n){const o=this.Rg,r=this.gi,a=this.Es,l=s*Math.PI/180,h=i*Math.PI/180,c=t.length;for(let u=0;u<c;u++){const d=l+(10===n?u*h/(o>=360?c:c-1):-u*h/c),f=t.elt(u),p=r*Math.tan(d)/a,g=Math.sqrt((r*r+a*a*p*p)/(1+p*p));f.centerX=g*Math.cos(d),f.centerY=g*Math.sin(d),f.actualAngle=180*d/Math.PI}}xw(t,i,s,n){const o=this.gi,r=this.Es,a=this.Ya;let l=s*Math.PI/180;const h=t.length;for(let c=0;c<h;c++){const u=t.elt(c),d=t.elt(c===h-1?0:c+1),f=o*Math.cos(l),p=r*Math.sin(l);u.centerX=f,u.centerY=p,u.actualAngle=180*l/Math.PI,isNaN(u.diameter)&&u.Ka(0),isNaN(d.diameter)&&d.Ka(0);const b=this.zk(o,r,10===n?l:-l,(u.diameter+d.diameter)/2+a);l+=10===n?b:-b}}ww(t,i,s,n){const o=this.gi,r=this.Es,a=this.mw;let l=s*Math.PI/180;const h=t.length;for(let c=0;c<h;c++){const u=t.elt(c);u.centerX=o*Math.cos(l),u.centerY=r*Math.sin(l),u.actualAngle=180*l/Math.PI;const d=this.zk(o,r,10===n?l:-l,a);l+=10===n?d:-d}}iF(t,i,s,n){let o=this.yw;const r=this.Rg;if(this.uc=0,this.pw=new Gs,i<360){for(o=s+(10===n?r:-r);o<0;)o+=360;o%=360,o>180&&(o-=360),o*=Math.PI/180,this.yw=o,this.sF(t,i,s,n)}else this.nF(t,i,s,n);this.pw.commit(t)}nF(t,i,s,n){const o=this.gi,r=this.Es,a=this.Ya,l=this.tu;let h=o*Math.cos(s*Math.PI/180),c=r*Math.sin(s*Math.PI/180);const u=t.toArray();if(3===u.length)return u[0].centerX=o,u[0].centerY=0,u[1].centerX=u[0].centerX-u[0].width/2-u[1].width/2-a,u[1].y=u[0].y,u[2].centerX=(u[0].centerX+u[1].centerX)/2,void(u[2].y=u[0].y-u[2].height-a);if(4===u.length)return u[0].centerX=o,u[0].centerY=0,u[2].centerX=-u[0].centerX,u[2].centerY=u[0].centerY,u[1].centerX=0,u[1].y=Math.min(u[0].y,u[2].y)-u[1].height-a,u[3].centerX=0,void(u[3].y=Math.max(u[0].y+u[0].height+a,u[2].y+u[2].height+a));const d=S.l();for(let M=0;M<u.length&&(u[M].centerX=h,u[M].centerY=c,!(M>=u.length-1));M++)this.oF(h,c,u,M,n,d)||this.rF(h,c,u,M,n,d),h=d.x,c=d.y;if(S.i(d),this.uc++,this.uc>23)return;const f=u[0].centerX,p=u[0].centerY,g=u[u.length-1].centerX,b=u[u.length-1].centerY;let x=Math.abs(f-g)-((u[0].width+u[u.length-1].width)/2+a);const v=Math.abs(p-b)-((u[0].height+u[u.length-1].height)/2+a);let P=0;if(Math.abs(v)<1){const M=Math.abs(f-g),C=(u[0].width+u[u.length-1].width)/2;M<C&&(P=0),x=M-C}else P=v>0?v:Math.abs(x)<1?0:x;let w=!1;w=Math.abs(g)>Math.abs(b)?g>0!=p>b:b>0!=f<g,w=10===n?w:!w,w&&(P=-Math.abs(P),P=Math.min(P,-u[u.length-1].width),P=Math.min(P,-u[u.length-1].height)),this.pw.m3(P,u),Math.abs(P)>1&&(this.uc<8?this.gi-=P/(2*Math.PI):u.length<5&&P>10?this.gi/=2:this.gi-=P>0?1.7:-2.3,this.Es=this.gi*l,this.nF(t,i,s,n))}sF(t,i,s,n){const o=this.gi,r=this.Es,a=this.tu;let l=o*Math.cos(s*Math.PI/180),h=r*Math.sin(s*Math.PI/180);const c=S.l(),u=t.toArray();for(let g=0;g<u.length&&(u[g].centerX=l,u[g].centerY=h,!(g>=u.length-1));g++)this.oF(l,h,u,g,n,c)||this.rF(l,h,u,g,n,c),l=c.x,h=c.y;if(S.i(c),this.uc++,this.uc>23)return;const d=Math.atan2(h,l);let f=10===n?this.yw-d:d-this.yw;f=Math.abs(f)<Math.abs(f-2*Math.PI)?f:f-2*Math.PI;const p=f*(o+r)/2;this.pw.p3(p,u),Math.abs(p)>1&&(this.gi-=this.uc<8?p/(2*Math.PI):p>0?1.7:-2.3,this.Es=this.gi*a,this.sF(t,i,s,n))}oF(t,i,s,n,o,r){const l=this.gi,h=this.Es;let c=0,u=0;const d=(s[n].width+s[n+1].width)/2+this.Ya;let f=!1;if(i>=0!=(10===o)){if(c=t+d,c>l){if(c=t-d,c<-l)return r.x=c,r.y=u,!1;f=!0}}else if(c=t-d,c<-l){if(c=t+d,c>l)return r.x=c,r.y=u,!1;f=!0}return u=Math.sqrt(1-Math.min(1,c*c/(l*l)))*h,i<0!==f&&(u=-u),Math.abs(i-u)>(s[n].height+s[n+1].height)/2?(r.x=c,r.y=u,!1):(r.x=c,r.y=u,!0)}rF(t,i,s,n,o,r){const l=this.gi,h=this.Es;let c=0,u=0;const d=(s[n].height+s[n+1].height)/2+this.Ya;let f=!1;if(t>=0!=(10===o)){if(u=i-d,u<-h){if(u=i+d,u>h)return r.x=c,r.y=u,!1;f=!0}}else if(u=i+d,u>h){if(u=i-d,u<-h)return r.x=c,r.y=u,!1;f=!0}return c=Math.sqrt(1-Math.min(1,u*u/(h*h)))*l,t<0!==f&&(c=-c),Math.abs(t-c)>(s[n].width+s[n+1].width)/2?(r.x=c,r.y=u,!1):(r.x=c,r.y=u,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){const t=null!==this.group&&this.group.hasPlaceholder(),i=t?this.group.location.copy():null;let s=this.actualCenter;if(t?s=new S(0,0):(s.x=this.arrangementOrigin.x+this.gi,s.y=this.arrangementOrigin.y+this.Es),null!==this.network){const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;o.x+=s.x,o.y+=s.y,o.commit()}}if(t&&this.group&&i){this.group.ensureBounds();const n=this.group.position.copy(),o=this.group.location.copy(),r=i.subtract(o.subtract(n));this.group.move(r),this.lL=r.subtract(n)}}commitLinks(){if(null!==this.network){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}cL(t,i,s,n){const o=this.eF;if(Math.abs(this.tu-1)<.001)return void 0!==s&&void 0!==n?n*t:2*Math.PI*t;const r=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let a=0,l=0;l=void 0!==s&&void 0!==n?n/(o+1):Math.PI/(2*(o+1));let h=0;for(let c=0;c<=o;c++){h=void 0!==s&&void 0!==n?s+c*n/o:c*Math.PI/(2*o);const u=Math.sin(h);a+=Math.sqrt(1-r*r*u*u)*l}return void 0!==s&&void 0!==n?(t>i?t:i)*a:4*(t>i?t:i)*a}Bk(t,i,s,n){let o=0;return o=void 0!==s&&void 0!==n?this.cL(1,i,s,n):this.cL(1,i),t/o}zk(t,i,s,n){if(Math.abs(this.tu-1)<.001)return n/t;const o=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let r=0;const a=2*Math.PI/(700*this.network.vertexes.count);t>i&&(s+=Math.PI/2);for(let l=0;;l++){const c=Math.sin(s+l*a);if(r+=(t>i?t:i)*Math.sqrt(1-o*o*c*c)*a,r>=n)return l*a}}g3(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.y3(this.w3(t));default:y.o("Invalid sorting type.")}return t}w3(t){const i=[];for(let n=0;n<t.length;n++)i.push(0);const s=new H;for(let n=0;n<t.length;n++){let o=-1,r=-1;if(0===n)for(let u=0;u<t.length;u++){const d=t.elt(u).edgesCount;d>o&&(o=d,r=u)}else for(let u=0;u<t.length;u++){const d=i[u];d>o&&(o=d,r=u)}s.add(t.elt(r)),i[r]=-1;const a=t.elt(r);let l=0;const h=a.sourceEdges;for(;h.next();)l=t.indexOf(h.value.fromVertex),!(l<0)&&i[l]>=0&&i[l]++;const c=a.destinationEdges;for(;c.next();)l=t.indexOf(c.value.toVertex),!(l<0)&&i[l]>=0&&i[l]++}return s}y3(t){const i=[];for(let d=0;d<t.length;d++){const f=t.elt(d);i[d]=[];let p=0;const g=f.destinationEdges;for(;g.next();)p=t.indexOf(g.value.toVertex),p!==d&&i[d].indexOf(p)<0&&i[d].push(p);const b=f.sourceEdges;for(;b.next();)p=t.indexOf(b.value.fromVertex),p!==d&&i[d].indexOf(p)<0&&i[d].push(p)}const s=[];for(let d=0;d<i.length;d++)s[d]=0;const n=[],o=[],r=[],a=[],l=new H;let h=0;for(let d=0;d<i.length;d++){const f=i[d].length;if(1===f){a.push(d);continue}if(0===f){l.add(t.elt(d));continue}if(0===h){n.push(d),h++;continue}let p=1/0,g=1/0,b=-1;const x=[];for(let v=0;v<n.length;v++)i[n[v]].indexOf(n[v===n.length-1?0:v+1])<0&&x.push(v===n.length-1?0:v+1);if(0===x.length)for(let v=0;v<n.length;v++)x.push(v);for(let v=0;v<x.length;v++){const P=x[v],w=this.x3(i[d],o,r,s,P,n);let M=0;for(let C=0;C<i[d].length;C++){const I=n.indexOf(i[d][C]);if(I>=0){const T=Math.abs(P-(I>=P?I+1:I));M+=T<n.length+1-T?T:n.length+1-T}}for(let C=0;C<o.length;C++){let N=s[o[C]],I=s[r[C]];if(N>=P&&N++,I>=P&&I++,N>I){const T=I;I=N,N=T}I-N<(n.length+2)/2==(N<P&&P<=I)&&M++}(w<p||w===p&&M<g)&&(p=w,g=M,b=P)}n.splice(b,0,d);for(let v=0;v<n.length;v++)s[n[v]]=v;for(let v=0;v<i[d].length;v++){const P=i[d][v];n.indexOf(P)>=0&&(o.push(d),r.push(P))}h++}let c=!1;const u=n.length;for(;;){c=!0;for(let d=0;d<a.length;d++){const f=a[d],p=i[f][0],g=n.indexOf(p);if(g>=0){let b=0;for(let x=0;x<i[p].length;x++){const P=n.indexOf(i[p][x]);if(P<0||P===g)continue;const w=P>g?P-g:g-P;b+=P<g!=w>u-w?1:-1}n.splice(b<0?g:g+1,0,f),a.splice(d,1),d--}else c=!1}if(c)break;n.push(a[0]),a.splice(0,1)}for(let d=0;d<n.length;d++)l.add(t.elt(n[d]));return l}x3(t,i,s,n,o,r){let a=0;for(let l=0;l<i.length;l++){const u=n[i[l]],d=n[s[l]];let f=0,p=0;if(u<d?(f=u,p=d):(f=d,p=u),f<o&&o<=p)for(let g=0;g<t.length;g++){const b=t[g];r.indexOf(b)<0||f<n[b]&&n[b]<p||f===n[b]||p===n[b]||a++}else for(let g=0;g<t.length;g++){const b=t[g];r.indexOf(b)<0||!(f<n[b]&&n[b]<p)||f===n[b]||p===n[b]||a++}}return a}get radius(){return this.Og}set radius(t){this.Og!==t&&(y.s(t,"number",m,"radius"),(t>0||isNaN(t))&&(this.Og=t,this.p()))}get aspectRatio(){return this.Ig}set aspectRatio(t){this.Ig!==t&&(y.s(t,"number",m,"aspectRatio"),t>0&&(this.Ig=t,this.p()))}get startAngle(){return this.Eg}set startAngle(t){this.Eg!==t&&(y.s(t,"number",m,"startAngle"),this.Eg=t,this.p())}get sweepAngle(){return this.eu}set sweepAngle(t){this.eu!==t&&(y.s(t,"number",m,"sweepAngle"),this.eu=t>0&&t<=360?t:360,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(3===t||0===t||1===t||2===t)&&(this.He=t,this.p())}get direction(){return this.P}set direction(t){this.P!==t&&(10===t||11===t||12===t||13===t)&&(this.P=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(y.S(t,m,"comparer"),this.Mi=t,this.p())}get spacing(){return this.En}set spacing(t){this.En!==t&&(y.s(t,"number",m,"spacing"),this.En=t,this.p())}get nodeDiameterFormula(){return this.Ug}set nodeDiameterFormula(t){this.Ug!==t&&(30===t||31===t)&&(this.Ug=t,this.p())}get actualXRadius(){return this.gi}get actualYRadius(){return this.Es}get actualSpacing(){return this.Ya}get actualCenter(){return this.lL}static ConstantSpacing=0;static ConstantDistance=1;static ConstantAngle=2;static Packed=3;static Clockwise=10;static Counterclockwise=11;static BidirectionalLeft=12;static BidirectionalRight=13;static Forwards=20;static Reverse=21;static Ascending=22;static Descending=23;static Optimized=24;static Pythagorean=30;static Circular=31}return m})();class Gs{iu;dc;su;constructor(){this.iu=-1/0,this.dc=null,this.su=null}m3(e,t){if(e>0&&this.iu<0||Math.abs(e)<Math.abs(this.iu)&&!(e<0&&this.iu>0)){this.iu=e,this.dc=[],this.su=[];for(let i=0;i<t.length;i++)this.dc[i]=t[i].bounds.x,this.su[i]=t[i].bounds.y}}p3(e,t){if(Math.abs(e)<Math.abs(this.iu)){this.iu=e,this.dc=[],this.su=[];for(let i=0;i<t.length;i++)this.dc[i]=t[i].bounds.x,this.su[i]=t[i].bounds.y}}commit(e){if(null!==this.dc&&null!==this.su)for(let t=0;t<this.dc.length;t++){const i=e.elt(t);i.x=this.dc[t],i.y=this.su[t]}}}class Ks extends Ie{constructor(e){super(e)}createVertex(){return new mi(this)}createEdge(){return new Us(this)}}class mi extends Be{To;Xk;constructor(e){super(e),this.To=NaN,this.Xk=NaN}Ka(e){const t=this.network;if(null===t)return NaN;const i=t.layout;if(null===i)return NaN;if(3===i.arrangement){if(31===i.nodeDiameterFormula)return this.To=Math.max(this.width,this.height),this.To;{const s=Math.abs(Math.sin(e)),n=Math.abs(Math.cos(e));return 0===s?this.width:0===n?this.height:(this.To=Math.min(this.height/s,this.width/n),this.To)}}return 31===i.nodeDiameterFormula?(this.To=Math.max(this.width,this.height),this.To):(this.To=Math.sqrt(this.width*this.width+this.height*this.height),this.To)}get diameter(){return this.To}set diameter(e){this.To!==e&&(y.s(e,"number",mi,"diameter"),this.To=e)}get actualAngle(){return this.Xk}set actualAngle(e){this.Xk!==e&&(y.s(e,"number",mi,"actualAngle"),this.Xk=e)}}class Us extends si{constructor(e){super(e)}}class ne extends se{kw;Ha;Us;Vg;zn;Xi;Bg;zg;Xg;nu;Gg;Yg;ou;ru;lu;au;Kg;Hg;hu;gc;constructor(e){super(),this.kw=0,this.Ha=0,this.Us=new lt(100,100).k(),this.Vg=!1,this.zn=!0,this.Xi=!1,this.Bg=100,this.zg=300,this.Xg=1,this.nu=1e3,this.Gg=10,this.Yg=Math,this.ou=.05,this.ru=50,this.lu=150,this.au=0,this.Kg=10,this.Hg=5,this.hu=NaN,this.gc=10,e&&Object.assign(this,e)}cloneProtected(e){super.cloneProtected(e),e.Us.h(this.Us),e.Vg=this.Vg,e.zn=this.zn,e.Xi=this.Xi,e.Bg=this.Bg,e.zg=this.zg,e.Xg=this.Xg,e.nu=this.nu,e.Gg=this.Gg,e.Yg=this.Yg,e.ou=this.ou,e.ru=this.ru,e.lu=this.lu,e.au=this.au,e.Kg=this.Kg,e.Hg=this.Hg,e.hu=this.hu,e.gc=this.gc}createNetwork(){return new Hs(this)}doLayout(e){this.network=this.makeNetwork(e);let t=this.network.vertexes.iterator;const i=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),t=this.network.vertexes.iterator;t.next();){const n=t.value;n.charge=this.electricalCharge(n),n.mass=this.gravitationalMass(n)}const s=this.network.edges.iterator;for(;s.next();){const n=s.value;n.stiffness=this.springStiffness(n),n.length=this.springLength(n)}if(this.fL(),this.Ha=0,this.needsPrelayout()){const n=this.network,o=n.splitIntoSubNetworks(!1);let r=o.iterator;for(;r.next();)this.doConnectedSubnetLayout(r.value);for(r=o.iterator,this.b3(r,n),r=o.iterator;r.next();){const a=r.value,l=a.vertexes.iterator;for(;l.next();)n.addVertex(l.value);const h=a.edges.iterator;for(;h.next();)n.addEdge(h.value)}}else this.lF(this.network,this.maxIterations);this.updateParts()}this.maxIterations=i,this.isValidLayout=!0}needsPrelayout(){if(null===this.network||this.network.vertexes.count<3)return!1;let e=0,t=0;const i=this.network.vertexes.first().bounds,s=this.network.vertexes.iterator;for(;s.next();){const n=s.value,o=n.bounds;if(isNaN(n.x)||isNaN(n.y)||o.intersectsRect(i)&&(e++,e>2))return!0;if(t>10)return!1;t++}return!1}doConnectedSubnetLayout(e){let t=e.vertexes.iterator;for(;t.next();){const a=t.value;a.hierarchicalVertexes.add(a)}let i=e,s=this.hu;if(isNaN(s)&&(s=e.edges.count/e.vertexes.count),s<e.vertexes.count)for(;i.vertexes.count>Math.max(100,Math.sqrt(s*e.vertexes.count));)i=this.coarsenNetwork(i);let n=0;t=i.vertexes.iterator;let o=this.randomNumberGenerator;for(null===o&&(this.randomNumberGenerator=o=new qs(0));t.next();){t.value.idInCluster=n++;const a=10*(o.random()-.5),l=10*(o.random()-.5);this.isFixed(t.value)||(t.value.x=a,t.value.y=l);const h=t.value.hierarchicalVertexes.iterator;for(;h.next();)this.isFixed(h.value)||(h.value.x=a,h.value.y=l)}const r=this.computePairwiseDistances(i);this.k3(i,r,this.maxPrelayoutIterations,e.vertexes.count),this.lF(e,this.maxIterations)}computePairwiseDistances(e){const t=e.vertexes.count,i=new Array(t);for(let r=0;r<t;r++)i[r]=new Array(t).fill(-1),i[r][r]=0;const s=e.vertexes.iterator;let n=new Map,o=[];for(;s.next();){const r=s.value;for(o=[r],n=new Map,n.set(r.idInCluster,0);o.length>0;){const a=o.shift(),l=a.vertexes.iterator;for(;l.next();){const h=l.value;n.has(h.idInCluster)||(n.set(h.idInCluster,n.get(a.idInCluster)+1),o.push(h))}}for(let a=0;a<t;a++){const l=Math.min(i[r.idInCluster][a],i[a][r.idInCluster]),h=n.get(a);(l<0||h<l)&&(i[r.idInCluster][a]=h,i[a][r.idInCluster]=h)}}return i}coarsenNetwork(e){const t=this.createNetwork(),i=new Map;let s=0,n=e.vertexes.iterator;for(;n.next();)n.value.idInCluster=s++;for(n=e.vertexes.iterator;n.next();){const r=n.value;if(i.has(r.idInCluster))continue;let a=Number.MAX_SAFE_INTEGER,l=null;const h=r.vertexes.iterator;for(;h.next();){const u=h.value;i.has(u.idInCluster)||u.hierarchicalVertexes.length<a&&(a=u.hierarchicalVertexes.length,l=u)}const c=t.createVertex();c.hierarchicalVertexes.addAll(r.hierarchicalVertexes),null!=l&&c.hierarchicalVertexes.addAll(l.hierarchicalVertexes),i.set(r.idInCluster,c),null!=l&&i.set(l.idInCluster,c),t.addVertex(c)}const o=e.edges.iterator;for(;o.next();){const r=o.value,a=i.get(r.fromVertex.idInCluster),l=i.get(r.toVertex.idInCluster);if(a===l)continue;const h=t.createEdge();h.fromVertex=a||null,h.toVertex=l||null,t.addEdge(h)}return t}cx(e,t){let i=!0;const s=e.vertexes.iterator;for(;s.next();){const n=s.value;i?(i=!1,t.set(n.bounds)):t.unionRect(n.bounds)}return t}b3(e,t){const i=this.arrangementSpacing,s=e.count;let n=!0,o=0,r=0;const a=y.nt();for(let u=0;u<s+t.vertexes.count+2;u++)a[u]=null;let l=0;e.reset();const h=j.l();let c;for(;e.next();){const u=e.value;if(this.cx(u,h),n)n=!1,o=h.x+h.width/2,r=h.y+h.height/2,a[0]=new S(h.x+h.width+i.width,h.y),a[1]=new S(h.x,h.y+h.height+i.height),l=2;else{const d=this.aF(a,l,o,r,h.width,h.height,i),f=a[d],p=new S(f.x+h.width+i.width,f.y),g=new S(f.x,f.y+h.height+i.height);d+1<l&&a.splice(d+1,0,null),a[d]=p,a[d+1]=g,l++;const b=f.x-h.x,x=f.y-h.y;for(c=u.vertexes.iterator;c.next();){const v=c.value;this.isFixed(v)||(v.centerX+=b,v.centerY+=x)}}}for(j.i(h),c=t.vertexes.iterator;c.next();){const u=c.value,d=u.bounds;if(l<2){o=d.x+d.width/2,r=d.y+d.height/2,a[0]=new S(d.x+d.width+i.width,d.y),a[1]=new S(d.x,d.y+d.height+i.height),l=2;continue}const f=this.aF(a,l,o,r,d.width,d.height,i),p=a[f],g=new S(p.x+d.width+i.width,p.y),b=new S(p.x,p.y+d.height+i.height);f+1<l&&a.splice(f+1,0,null),a[f]=g,a[f+1]=b,l++,this.isFixed(u)||(u.centerX=p.x+u.width/2,u.centerY=p.y+u.height/2)}y.Z(a)}aF(e,t,i,s,n,o,r){let a=9e19,l=-1;t:for(let h=0;h<t;h++){const c=e[h],u=c.x-i,d=c.y-s,f=u*u+d*d;if(f<a){for(let p=h-1;p>=0;p--)if(e[p].y>c.y&&e[p].x-c.x<n+r.width)continue t;for(let p=h+1;p<t;p++)if(e[p].x>c.x&&e[p].y-c.y<o+r.height)continue t;l=h,a=f}}return l}fL(){if(null===this.network||!this.comments)return;const e=this.network.vertexes.iterator;for(;e.next();)this.addComments(e.value)}addComments(e){if(null===this.network)return;const t=e.node;if(null!==t){const i=t.findNodesConnected();for(;i.next();){const s=i.value;if("Comment"!==s.category||!s.isVisible())continue;let n=this.network.findVertex(s);null===n&&(n=this.network.addNode(s)),n.charge=this.defaultCommentElectricalCharge;let o=null;const r=n.destinationEdges;for(;r.next();){const a=r.value;if(a.toVertex===e){o=a;break}}if(null===o){const a=n.sourceEdges;for(;a.next();){const l=a.value;if(l.fromVertex===e){o=l;break}}}null===o&&(o=this.network.linkVertexes(e,n,null)),o.length=this.defaultCommentSpringLength}}}hF(e,t){const i=e.bounds,s=i.x,n=i.y,o=i.width,r=i.height,a=t.bounds,l=a.x,h=a.y,c=a.width,u=a.height;if(s+o<l){if(n>h+u){const d=s+o-l,f=n-h-u;return L.ix(d*d+f*f)}if(n+r<h){const d=s+o-l,f=n+r-h;return L.ix(d*d+f*f)}return l-(s+o)}if(s>l+c){if(n>h+u){const d=s-l-c,f=n-h-u;return L.ix(d*d+f*f)}if(n+r<h){const d=s-l-c,f=n+r-h;return L.ix(d*d+f*f)}return s-(l+c)}return n>h+u?n-(h+u):n+r<h?h-(n+r):.1}lF(e,t){const i=this.Ha+t;for(;this.Ha<i&&(this.Ha++,this.P3(e)););}P3(e){const t=e.vertexes.toArray();if(t.length<=0)return!1;const i=t[0];i.forceX=0,i.forceY=0;let s=i.centerX,n=s,o=i.centerY,r=o;for(let p=1;p<t.length;p++){const g=t[p];g.forceX=0,g.forceY=0;const b=g.centerX,x=g.centerY;s=Math.min(s,b),n=Math.max(n,b),o=Math.min(o,x),r=Math.max(r,x)}const a=n-s>r-o;t.sort(a?(p,g)=>null===p||null===g||p===g?0:p.centerX-g.centerX:(p,g)=>null===p||null===g||p===g?0:p.centerY-g.centerY);const l=this.nu;let h=0,c=0,u=0;for(let p=0;p<t.length;p++){const g=t[p],b=g.bounds,x=g.focus,v=b.x+x.x,P=b.y+x.y;c=g.charge*this.electricalFieldX(v,P),u=g.charge*this.electricalFieldY(v,P),c+=g.mass*this.gravitationalFieldX(v,P),u+=g.mass*this.gravitationalFieldY(v,P),g.forceX+=c,g.forceY+=u;for(let w=p+1;w<t.length;w++){const M=t[w];if(!this.shouldInteract(g,M)||w===p)continue;const C=M.bounds,N=M.focus,I=C.x+N.x,T=C.y+N.y;if(v-I>l||I-v>l){if(a)break;continue}if(P-T>l||T-P>l){if(!a)break;continue}const D=this.hF(g,M),F=2*g.charge,E=2*M.charge;if(D>1)h=F*E/(D*D),c=h*(v-I)/D,u=h*(P-T)/D;else{let B=this.randomNumberGenerator;null===B&&(this.randomNumberGenerator=B=new qs(0));const Y=B.random(),W=B.random();if(v>I)c=Math.abs(M.bounds.right-g.bounds.x),c=F*E*(1+c)*Y;else if(v<I)c=Math.abs(M.bounds.x-g.bounds.right),c=-F*E*(1+c)*Y;else{const $=Math.max(M.width,g.width);c=F*E*((1+$)*Y-$/2)}if(P>T)u=Math.abs(M.bounds.bottom-g.bounds.y),u=F*E*(1+u)*W;else if(v<I)u=Math.abs(M.bounds.y-g.bounds.bottom),u=-F*E*(1+u)*W;else{const $=Math.max(M.height,g.height);u=F*E*((1+$)*W-$/2)}}g.forceX+=c,g.forceY+=u,M.forceX-=c,M.forceY-=u}}const d=e.edges.iterator;for(;d.next();){const p=d.value,g=p.fromVertex,b=p.toVertex,x=g.bounds,v=g.focus,P=x.x+v.x,w=x.y+v.y,M=b.bounds,C=b.focus,N=M.x+C.x,I=M.y+C.y,T=this.hF(g,b);T>1&&(h=.1*p.stiffness*(T-p.length),c=.5*h*(g.width+b.height)*(P-N)/T,u=.5*h*(g.width+b.height)*(w-I)/T),g.forceX-=c,g.forceY-=u,b.forceX+=c,b.forceY+=u}let f=0;for(let p=0;p<t.length;p++){const g=t[p];this.isFixed(g)?this.moveFixedVertex(g):f=Math.max(f,this.moveVertex(g)||0)}return f>this.epsilonDistance*this.epsilonDistance}k3(e,t,i,s){const n=this.Ha+i,o=Math.sqrt(s);this.kw=this.gc*e.vertexes.count;const r=e.vertexes.toArray();let a=0,l=0,h=0;for(;this.Ha<n;){this.Ha++,l=a,a=0;for(let c=0;c<r.length;c++){r[c].forceX=0,r[c].forceY=0;for(let d=0;d<r.length;d++){if(c===d)continue;const f=Math.sqrt((r[c].centerX-r[d].centerX)**2+(r[c].centerY-r[d].centerY)**2),g=(f-this.gc*o*t[r[c].idInCluster][r[d].idInCluster])/f;r[c].forceX+=g*(r[d].x-r[c].x),r[c].forceY+=g*(r[d].y-r[c].y)}const u=Math.sqrt(r[c].forceX*r[c].forceX+r[c].forceY*r[c].forceY);if(u>0){r[c].forceX=this.kw*r[c].forceX/u,r[c].forceY=this.kw*r[c].forceY/u,this.isFixed(r[c])||(r[c].x+=r[c].forceX,r[c].y+=r[c].forceY);const d=r[c].hierarchicalVertexes.iterator;for(;d.next();){const f=d.value;this.isFixed(f)||(f.centerX+=r[c].forceX,f.centerY+=r[c].forceY)}}a+=u*u}if(a>=l){if(h++,h>=5)break}else h=0;this.kw*=.95}}moveVertex(e){let t=e.forceX,i=e.forceY;const s=this.moveLimit;return t<-s?t=-s:t>s&&(t=s),i<-s?i=-s:i>s&&(i=s),e.centerX+=t,e.centerY+=i,t*t+i*i}shouldInteract(e,t){return!0}moveFixedVertex(e){}commitLayout(){this.Pw(),this.commitNodes(),this.isRouting&&this.commitLinks()}Pw(){if(null===this.network||!this.setsPortSpots)return;const e=this.network.edges.iterator;for(;e.next();){const t=e.value.link;null!==t&&(t.fromSpot=A.Default,t.toSpot=A.Default)}}commitNodes(){if(!this.network)return;let e=0,t=0;if(this.arrangesToOrigin){const n=j.l();this.cx(this.network,n);const o=this.arrangementOrigin;e=o.x-n.x,t=o.y-n.y,j.i(n)}const i=j.l(),s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;(0!==e||0!==t)&&(i.h(n.bounds),i.x+=e,i.y+=t,n.bounds=i),n.commit()}j.i(i)}commitLinks(){if(!this.network)return;const e=this.network.edges.iterator;for(;e.next();)e.value.commit()}springStiffness(e){const t=e.stiffness;return isNaN(t)?this.ou:t}springLength(e){const t=e.length;return isNaN(t)?this.ru:t}electricalCharge(e){const t=e.charge;return isNaN(t)?this.lu:t}electricalFieldX(e,t){return 0}electricalFieldY(e,t){return 0}gravitationalMass(e){const t=e.mass;return isNaN(t)?this.au:t}gravitationalFieldX(e,t){return 0}gravitationalFieldY(e,t){return 0}isFixed(e){return e.isFixed}get currentIteration(){return this.Ha}get arrangementSpacing(){return this.Us}set arrangementSpacing(e){this.Us.equals(e)||(this.Us.h(e),this.p())}get arrangesToOrigin(){return this.Vg}set arrangesToOrigin(e){this.Vg!==e&&(y.s(e,"boolean",ne,"arrangesToOrigin"),this.Vg=e,this.p())}get setsPortSpots(){return this.zn}set setsPortSpots(e){this.zn!==e&&(y.s(e,"boolean",ne,"setsPortSpots"),this.zn=e,this.p())}get comments(){return this.Xi}set comments(e){this.Xi!==e&&(y.s(e,"boolean",ne,"comments"),this.Xi=e,this.p())}get maxPrelayoutIterations(){return this.Bg}set maxPrelayoutIterations(e){this.Bg!==e&&(y.s(e,"number",ne,"maxPrelayoutIterations"),e>=0&&(this.Bg=e,this.p()))}get maxIterations(){return this.zg}set maxIterations(e){this.zg!==e&&(y.s(e,"number",ne,"maxIterations"),e>=0&&(this.zg=e,this.p()))}get epsilonDistance(){return this.Xg}set epsilonDistance(e){this.Xg!==e&&(y.s(e,"number",ne,"epsilonDistance"),e>0&&(this.Xg=e,this.p()))}get infinityDistance(){return this.nu}set infinityDistance(e){this.nu!==e&&(y.s(e,"number",ne,"infinityDistance"),e>1&&(this.nu=e,this.p()))}get moveLimit(){return this.Gg}set moveLimit(e){this.Gg!==e&&(y.s(e,"number",ne,"moveLimit"),this.Gg=e,this.p())}get randomNumberGenerator(){return this.Yg}set randomNumberGenerator(e){this.Yg!==e&&(null!==e&&!y.st(e.random)&&y.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+e),this.Yg=e)}get defaultSpringStiffness(){return this.ou}set defaultSpringStiffness(e){this.ou!==e&&(y.s(e,"number",ne,"defaultSpringStiffness"),this.ou=e,this.p())}get defaultSpringLength(){return this.ru}set defaultSpringLength(e){this.ru!==e&&(y.s(e,"number",ne,"defaultSpringLength"),this.ru=e,this.p())}get defaultElectricalCharge(){return this.lu}set defaultElectricalCharge(e){this.lu!==e&&(y.s(e,"number",ne,"defaultElectricalCharge"),this.lu=e,this.p())}get defaultGravitationalMass(){return this.au}set defaultGravitationalMass(e){this.au!==e&&(y.s(e,"number",ne,"defaultGravitationalMass"),this.au=e,this.p())}get defaultCommentSpringLength(){return this.Kg}set defaultCommentSpringLength(e){this.Kg!==e&&(y.s(e,"number",ne,"defaultCommentSpringLength"),this.Kg=e,this.p())}get defaultCommentElectricalCharge(){return this.Hg}set defaultCommentElectricalCharge(e){this.Hg!==e&&(y.s(e,"number",ne,"defaultCommentElectricalCharge"),this.Hg=e,this.p())}get prelayoutQuality(){return this.hu}set prelayoutQuality(e){this.hu!==e&&(y.s(e,"number",ne,"prelayoutQuality"),this.hu=e,this.p())}get prelayoutSpread(){return this.gc}set prelayoutSpread(e){this.gc!==e&&(y.s(e,"number",ne,"prelayoutSpread"),this.gc=e,this.p())}}class Hs extends Ie{constructor(e){super(e)}createVertex(){return new je(this)}createEdge(){return new yi(this)}}class je extends Be{Gk;Yk;Kk;Hk;jk;hierarchicalVertexes;idInCluster;constructor(e){super(e),this.Gk=!1,this.Yk=NaN,this.Kk=NaN,this.Hk=0,this.jk=0,this.hierarchicalVertexes=new H,this.idInCluster=-1}get isFixed(){return this.Gk}set isFixed(e){this.Gk!==e&&(y.s(e,"boolean",je,"isFixed"),this.Gk=e)}get charge(){return this.Yk}set charge(e){this.Yk!==e&&(y.s(e,"number",je,"charge"),this.Yk=e)}get mass(){return this.Kk}set mass(e){this.Kk!==e&&(y.s(e,"number",je,"mass"),this.Kk=e)}get forceX(){return this.Hk}set forceX(e){this.Hk!==e&&(y.s(e,"number",je,"forceX"),this.Hk=e)}get forceY(){return this.jk}set forceY(e){this.jk!==e&&(y.s(e,"number",je,"forceY"),this.jk=e)}}class yi extends si{qk;Wk;constructor(e){super(e),this.qk=NaN,this.Wk=NaN}get stiffness(){return this.qk}set stiffness(e){this.qk!==e&&(y.s(e,"number",yi,"stiffness"),this.qk=e)}get length(){return this.Wk}set length(e){this.Wk!==e&&(y.s(e,"number",yi,"length"),this.Wk=e)}}class qs{I;R;Q;M;A;seed;constructor(e){void 0===e&&(e=42),this.seed=e,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){const i=this.A*(this.seed%this.Q)-this.R*(this.seed/this.Q);return this.seed=i>0?i:i+this.M,this.seed*this.I}}var ss=(m=>(m[m.DepthFirst=0]="DepthFirst",m[m.Greedy=1]="Greedy",m[m.FromLayers=2]="FromLayers",m))(ss||{}),ns=(m=>(m[m.OptimalLinkLength=10]="OptimalLinkLength",m[m.LongestPathSink=11]="LongestPathSink",m[m.LongestPathSource=12]="LongestPathSource",m))(ns||{}),os=(m=>(m[m.DepthFirstOut=20]="DepthFirstOut",m[m.DepthFirstIn=21]="DepthFirstIn",m[m.Naive=22]="Naive",m))(os||{}),rs=(m=>(m[m.None=30]="None",m[m.Less=31]="Less",m[m.More=32]="More",m))(rs||{}),Ws=(m=>(m[m.None=0]="None",m[m.Expand=1]="Expand",m[m.Straighten=2]="Straighten",m[m.Median=4]="Median",m[m.MaybeExpand=8]="MaybeExpand",m[m.All=15]="All",m))(Ws||{}),$s=(m=>(m[m.None=0]="None",m[m.UpperLeft=1]="UpperLeft",m[m.UpperRight=2]="UpperRight",m[m.LowerLeft=4]="LowerLeft",m[m.LowerRight=8]="LowerRight",m[m.All=15]="All",m))($s||{});let Po=(()=>{class m extends se{Vs;ti;P;cu;fu;uu;mc;du;cr;gu;zn;_;Sw;Bt;jg;Bs;ie;zs;ms;ps;Rt;qg;Wg;Jk;fn;mu;fr;Xn;Gn;uL;ja;constructor(t){super(),this.Vs=25,this.ti=25,this.P=0,this.cu=0,this.fu=10,this.uu=20,this.mc=4,this.du=31,this.cr=15,this.gu=10,this.zn=!0,this._=-1,this.Sw=-1,this.Bt=-1,this.jg=0,this.Bs=0,this.ie=new Int16Array(0),this.zs=new Float32Array(0),this.ms=new Float32Array(0),this.ps=new Float32Array(0),this.Rt=new Float32Array(0),this.qg=0,this.Wg=new Int16Array(0),this.Jk=new Int16Array(0),this.fn=0,this.mu=null,this.fr=new S,this.Xn=[],this.Xn.length=100,this.Gn=15,this.uL=0,this.ja=!0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Vs=this.Vs,t.ti=this.ti,t.P=this.P,t.cu=this.cu,t.fu=this.fu,t.uu=this.uu,t.mc=this.mc,t.du=this.du,t.cr=this.cr,t.gu=this.gu,t.zn=this.zn,t.Gn=this.Gn,t.ja=this.ja}fe(t){t in rs?this.aggressiveOption=t:t in ss?this.cycleRemoveOption=t:t in os?this.initializeOption=t:t in ns?this.layeringOption=t:super.fe(t)}createNetwork(){return new Js(this)}doLayout(t){null===this.network&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.S3(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),2!==this.cycleRemoveOption&&this.removeCycles(),this.M3(),2===this.cycleRemoveOption&&this.removeCycles(),this.N3(),this.C3(),this.L3(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){const i=t.fromVertex.node||t.fromVertex.data,s=t.toVertex.node||t.toVertex.data;return null===i&&null===s?8:null===i||null===s?4:1}nodeMinLayerSpace(t,i){return null===t.node&&null===t.data?0:90===this.P||270===this.P?i?t.focus.y+10:t.bounds.height-t.focus.y+10:i?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,i){if(null===t.node&&null===t.data)return 0;const s=i?t.$k:t.Zk;if(null!==s)return s;const n=this.P;return 90===n||270===n?i?t.$k=t.focus.x/this.ti+1|0:t.Zk=(t.bounds.width-t.focus.x)/this.ti+1|0:i?t.$k=t.focus.y/this.ti+1|0:t.Zk=(t.bounds.height-t.focus.y)/this.ti+1|0}ei(){const t=this.network.vertexes.count;this.Wg.length<2*t&&(this.Wg=new Int16Array(2*t));let i=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;this.Wg[i]=n.column,i++,this.Wg[i]=n.index,i++}return this.Wg}os(t){let i=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;n.column=t[i],i++,n.index=t[i],i++}}cF(t,i){const s=this.qa(t),n=this.ie[t];this.Jk.length<n*n&&(this.Jk=new Int16Array(n*n));const o=this.Jk;for(let r=0;r<n;r++){let a=0;const l=s[r],h=l.near;let c=0;null!==h&&h!==l&&h.layer===l.layer&&(a+=Math.max(0,Math.abs(h.index-l.index)-1));let u,f,x,P,N,d=0,p=0,g=0,b=0,v=0,w=0,M=0,C=0;if(i>=0)for(u=s[r].Mo,d=0;d<u.length;d++)if(f=u[d],f.valid&&f.fromVertex.layer!==t)for(p=f.fromVertex.index,g=f.portToPos,b=f.portFromPos,v=d+1;v<u.length;v++)P=u[v],P.valid&&P.fromVertex.layer!==t&&(w=P.fromVertex.index,M=P.portToPos,C=P.portFromPos,g<M&&(p>w||p===w&&b>C)&&a++,M<g&&(w>p||w===p&&C>b)&&a++);if(i<=0)for(u=s[r].rr,d=0;d<u.length;d++)if(f=u[d],f.valid&&f.toVertex.layer!==t)for(p=f.toVertex.index,g=f.portToPos,b=f.portFromPos,v=d+1;v<u.length;v++)P=u[v],P.valid&&P.toVertex.layer!==t&&(w=P.toVertex.index,M=P.portToPos,C=P.portFromPos,b<C&&(p>w||p===w&&g>M)&&a++,C<b&&(w>p||w===p&&M>g)&&a++);for(o[r*n+r]=a,c=r+1;c<n;c++){let I=0,T=0;if(i>=0)for(x=s[r].Mo,N=s[c].Mo,d=0;d<x.length;d++)if(f=x[d],f.valid&&f.fromVertex.layer!==t)for(p=f.fromVertex.index,g=f.portToPos,b=f.portFromPos,v=0;v<N.length;v++)P=N[v],P.valid&&P.fromVertex.layer!==t&&(w=P.fromVertex.index,M=P.portToPos,C=P.portFromPos,(p<w||p===w&&b<C)&&T++,(w<p||w===p&&C<b)&&I++);if(i<=0)for(x=s[r].rr,N=s[c].rr,d=0;d<x.length;d++)if(f=x[d],f.valid&&f.toVertex.layer!==t)for(p=f.toVertex.index,g=f.portToPos,b=f.portFromPos,v=0;v<N.length;v++)P=N[v],P.valid&&P.toVertex.layer!==t&&(w=P.toVertex.index,M=P.portToPos,C=P.portFromPos,(p<w||p===w&&g<M)&&T++,(w<p||w===p&&M<g)&&I++);o[r*n+c]=I,o[c*n+r]=T}}return this.Wa(t,s),o}countCrossings(){let t=0;for(let i=0;i<=this._;i++){const s=this.cF(i,1),n=this.ie[i];for(let o=0;o<n;o++)for(let r=o;r<n;r++)t+=s[o*n+r]}return t}A3(t,i,s){const n=this.qa(t),o=this.ie[t];let r=0;for(let a=0;a<o;a++){let l=null;i<=0&&(l=n[a].Mo);let h=null;i>=0&&(h=n[a].rr);let c,u=0,d=0;if(null!==l)for(let f=0;f<l.length;f++)c=l[f],c.valid&&c.fromVertex.layer!==t&&(u=c.fromVertex.column+c.portFromColOffset,d=c.toVertex.column+c.portToColOffset,r+=s?Math.abs(u-d)*this.linkStraightenWeight(c):Math.abs(u-d));if(null!==h)for(let f=0;f<h.length;f++)c=h[f],c.valid&&c.toVertex.layer!==t&&(u=c.fromVertex.column+c.portFromColOffset,d=c.toVertex.column+c.portToColOffset,r+=s?(Math.abs(u-d)+1)*this.linkStraightenWeight(c):Math.abs(u-d))}return this.Wa(t,n),r}Qk(t){let i=0;for(let s=0;s<=this._;s++)i+=this.A3(s,1,t);return i}Mw(){let t=1/0;this.Bt=-1;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;t=Math.min(t,s.column-this.nodeMinColumnSpace(s,!0)),this.Bt=Math.max(this.Bt,s.column+this.nodeMinColumnSpace(s,!1))}for(i.reset();i.next();)i.value.column-=t;this.Bt-=t}Nw(t,i){const s=this.qa(t),n=this.ie[t],o=new Float32Array(n);for(let r=0;r<n;r++){const a=s[r];let l=null;i<=0&&(l=a.Mo);let h=null;i>=0&&(h=a.rr);let c=0,u=0;const d=a.near;let f;if(null!==d&&d.layer===a.layer&&(c+=d.column-1,u++),null!==l)for(let p=0;p<l.length;p++){f=l[p];const g=f.fromVertex;f.valid&&!f.rev&&g.layer!==t&&(c+=g.column,u++)}if(null!==h)for(let p=0;p<h.length;p++){f=h[p];const g=f.toVertex;f.valid&&!f.rev&&g.layer!==t&&(c+=g.column,u++)}o[r]=0===u?-1:c/u}return this.Wa(t,s),o}fF(t,i){const s=this.qa(t),n=this.ie[t],o=new Int16Array(n);for(let r=0;r<n;r++){const a=s[r];let l=null;i<=0&&(l=a.Mo);let h=null;i>=0&&(h=a.rr);let c=0;const u=[],d=a.near;let f;if(null!==d&&d.layer===a.layer&&(u[c]=d.column-1,c++),null!==l)for(let p=0;p<l.length;p++){f=l[p];const g=f.fromVertex;f.valid&&!f.rev&&g.layer!==t&&(u[c]=g.column+f.portFromColOffset,c++)}if(null!==h)for(let p=0;p<h.length;p++){f=h[p];const g=f.toVertex;f.valid&&!f.rev&&g.layer!==t&&(u[c]=g.column+f.portToColOffset,c++)}if(0===c)o[r]=-1;else{u.sort((g,b)=>g-b);const p=c>>1;o[r]=1&c?u[p]:u[p-1]+u[p]>>1}}return this.Wa(t,s),o}Cw(t,i,s,n,o){if(t.component===s){t.component=i;let r=0,a=0;if(n){const l=t.destinationEdges;for(;l.next();){const h=l.value,c=h.toVertex;r=t.layer-c.layer,a=this.linkMinLength(h),r===a&&this.Cw(c,i,s,n,o)}}if(o){const l=t.sourceEdges;for(;l.next();){const h=l.value,c=h.fromVertex;r=c.layer-t.layer,a=this.linkMinLength(h),r===a&&this.Cw(c,i,s,n,o)}}}}dL(t,i,s,n,o){if(t.component===s){if(t.component=i,n){const r=t.destinationEdges;for(;r.next();)this.dL(r.value.toVertex,i,s,n,o)}if(o){const r=t.sourceEdges;for(;r.next();)this.dL(r.value.fromVertex,i,s,n,o)}}}removeCycles(){const t=this.network.edges.iterator;for(;t.next();)t.value.rev=!1;switch(this.cu){default:case 1:this.T3();break;case 0:this.D3();break;case 2:this.v3()}}v3(){const t=this.network,i=t.vertexes.iterator;let s=1/0;for(;i.next();)s=Math.min(s,i.value.layer);if(s<1/0){if(s<0)for(i.reset();i.next();)i.value.layer-=s;const n=[];for(i.reset();i.next();){const a=i.value,l=n[a.layer];void 0===l?n[a.layer]=[a]:l.push(a)}let o=0;for(let a=0;a<n.length;a++){const l=n[a];if(l&&0!==l.length){if(a>0)for(let h=0;h<l.length;h++)l[h].layer-=o}else o++}const r=t.edges.iterator;for(;r.next();){const a=r.value;a.fromVertex.layer<a.toVertex.layer&&(t.reverseEdge(a),a.rev=!0)}}}T3(){const t=this.network;let i=0,s=t.vertexes.count-1;const n=[];n.length=s+1;const o=t.vertexes.iterator;for(;o.next();)o.value.ii=!0;for(;null!==this.F3(t);){let a;for(a=this.uF(t);null!==a;)n[s]=a,s--,a.ii=!1,a=this.uF(t);for(a=this.dF(t);null!==a;)n[i]=a,i++,a.ii=!1,a=this.dF(t);a=this.R3(t),null!==a&&(n[i]=a,i++,a.ii=!1)}for(let a=0;a<t.vertexes.count;a++)n[a].index=a;const r=t.edges.iterator;for(;r.next();){const a=r.value;a.fromVertex.index>a.toVertex.index&&(t.reverseEdge(a),a.rev=!0)}}F3(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.ii)return s}return null}uF(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.ii){let n=!0;const o=s.destinationEdges;for(;o.next();)if(o.value.toVertex.ii){n=!1;break}if(n)return s}}return null}dF(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.ii){let n=!0;const o=s.sourceEdges;for(;o.next();)if(o.value.fromVertex.ii){n=!1;break}if(n)return s}}return null}R3(t){let i=null,s=0;const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;if(o.ii){let r=0;const a=o.destinationEdges;for(;a.next();)a.value.toVertex.ii&&r++;let l=0;const h=o.sourceEdges;for(;h.next();)h.value.fromVertex.ii&&l++;(null===i||s<r-l)&&(i=o,s=r-l)}}return i}D3(){const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.pu=-1,s.to=-1}const i=this.network.edges.iterator;for(;i.next();)i.value.forest=!1;for(this.qg=0,t.reset();t.next();){const s=t.value;0===s.sourceEdges.count&&this.gL(s)}for(t.reset();t.next();){const s=t.value;-1===s.pu&&this.gL(s)}for(i.reset();i.next();){const s=i.value;if(!s.forest){const n=s.fromVertex,a=s.toVertex;a.pu<n.pu&&n.to<a.to&&(this.network.reverseEdge(s),s.rev=!0)}}}gL(t){t.pu=this.qg,this.qg++;const i=t.destinationEdges;for(;i.next();){const s=i.value,n=s.toVertex;-1===n.pu&&(s.forest=!0,this.gL(n))}t.to=this.qg,this.qg++}M3(){const t=this.network.vertexes.iterator;for(;t.next();)t.value.layer=-1;for(this._=-1,this.assignLayers(),t.reset();t.next();)this._=Math.max(this._,t.value.layer);this._>=9999&&y.o("LayeredDigraphLayout, too many layers: "+this._);const i=0==this.direction||180==this.direction,s=[];for(const n=this.network.vertexes.iterator;n.next();){const o=n.value;if(null===o.node||o.centered)continue;const r=o.layer;let a=s[r];void 0===a&&(a=0);const l=i?o.width:o.height;l>a&&(s[r]=l)}for(const n=this.network.vertexes.iterator;n.next();){const o=n.value;if(null===o.node||o.centered)continue;const r=s[o.layer];i?(o.focusX=r/2,o.focusY=o.focus.y,o.width=r):(o.focusX=o.focus.x,o.focusY=r/2,o.height=r)}}assignLayers(){switch(this.fu){case 11:this.gF();break;case 12:this.O3();break;default:this.I3()}}gF(){const t=this.network.vertexes.iterator;for(;t.next();){const s=this.mF(t.value);this._=Math.max(s,this._)}}mF(t){let i=0;if(-1===t.layer){const s=t.destinationEdges;for(;s.next();){const n=s.value,o=n.toVertex,r=this.linkMinLength(n);i=Math.max(i,this.mF(o)+r)}t.layer=i}else i=t.layer;return i}O3(){let t=0;const i=this.network.vertexes.iterator;for(;i.next();)t=this.pF(i.value),this._=Math.max(t,this._);for(i.reset();i.next();){const s=i.value;s.layer=this._-s.layer}}pF(t){let i=0;if(-1===t.layer){const s=t.sourceEdges;for(;s.next();){const n=s.value,o=n.fromVertex,r=this.linkMinLength(n);i=Math.max(i,this.pF(o)+r)}t.layer=i}else i=t.layer;return i}I3(){this.gF();const t=this.network.vertexes.iterator;for(;t.next();)t.value.ii=!1;for(t.reset();t.next();){const s=t.value;0===s.sourceEdges.count&&this.yF(s)}let i=1/0;for(t.reset();t.next();)i=Math.min(i,t.value.layer);for(this._=-1,t.reset();t.next();){const s=t.value;s.layer-=i,this._=Math.max(this._,s.layer)}}yF(t){if(!t.ii){t.ii=!0;const i=t.destinationEdges;for(;i.next();)this.yF(i.value.toVertex);this.E3(t),this.U3(t)}}E3(t){const i=this.network.vertexes.iterator;for(;i.next();)i.value.component=-1;const o=t.Mo;let r=o.length;for(let a=0;a<r;a++){const l=o[a],h=l.fromVertex,c=l.toVertex,u=this.linkMinLength(l);h.layer-c.layer>u&&this.Cw(h,0,-1,!0,!1)}for(this.Cw(t,1,-1,!0,!0);0!==t.component;){let a=0,l=1/0,h=0,c=null;const u=this.network.vertexes.iterator;for(;u.next();){const d=u.value;if(1===d.component){let f=0,p=!1;const g=d.Mo;r=g.length;for(let x=0;x<r;x++){const v=g[x],P=v.fromVertex;if(f+=this.linkLengthWeight(v),1!==P.component){a+=this.linkLengthWeight(v);const w=P.layer-d.layer,M=this.linkMinLength(v);l=Math.min(l,w-M)}}const b=d.rr;r=b.length;for(let x=0;x<r;x++){const v=b[x],P=v.toVertex;f-=this.linkLengthWeight(v),1!==P.component?a-=this.linkLengthWeight(v):p=!0}(null===c||f<h)&&!p&&(c=d,h=f)}}if(a>0){for(i.reset();i.next();){const d=i.value;1===d.component&&(d.layer+=l)}t.component=0}else c.component=0}}U3(t){const i=this.network.vertexes.iterator;for(;i.next();)i.value.component=-1;for(this.Cw(t,1,-1,!0,!1);0!==t.component;){let o=0,r=1/0,a=0,l=null;const h=this.network.vertexes.iterator;for(;h.next();){const c=h.value;if(1===c.component){let u=0,d=!1;const f=c.Mo;let p=f.length;for(let b=0;b<p;b++){const x=f[b],v=x.fromVertex;u+=this.linkLengthWeight(x),1!==v.component?o+=this.linkLengthWeight(x):d=!0}const g=c.rr;p=g.length;for(let b=0;b<p;b++){const x=g[b],v=x.toVertex;if(u-=this.linkLengthWeight(x),1!==v.component){o-=this.linkLengthWeight(x);const P=c.layer-v.layer,w=this.linkMinLength(x);r=Math.min(r,P-w)}}(null===l||u>a)&&!d&&(l=c,a=u)}}if(o<0){for(i.reset();i.next();){const c=i.value;1===c.component&&(c.layer-=r)}t.component=0}else l.component=0}}N3(){const t=this.network,i=[],s=t.edges.iterator;for(;s.next();){const n=s.value;n.valid=!1,i.push(n)}for(let n=0;n<i.length;n++){const o=i[n];let r=o.fromVertex;const a=o.toVertex;if(o.valid||(null===r.node&&null===r.data||null===a.node&&null===a.data)&&r.layer===a.layer)continue;let l=0,h=0,c=0,u=0;if(null!==o.link){const C=o.link;if(null===C)continue;const N=r.node,I=a.node;if(null===N||null===I)continue;let T=C.fromNode,D=C.toNode,F=C.fromPort;for(;null!==F&&!F.isVisibleObject();)F=F.panel;let E=C.toPort;for(;null!==E&&!E.isVisibleObject();)E=E.panel;if(o.rev){const it=T,yt=F;T=D,F=E,D=it,E=yt}const B=r.focus,Y=a.focus,W=o.rev?a.bounds:r.bounds,$=S.l();N!==T?W.isReal()&&T.isVisible()?T.actualBounds.isReal()?(T.getRelativePoint(F,A.Center,$),$.x+=T.actualBounds.x-W.x,$.y+=T.actualBounds.y-W.y):(T.getRelativePoint(F,A.Center,$),$.isReal()||$.h(B)):$.h(B):W.isReal()?(T.getRelativePoint(F,A.Center,$),$.isReal()||$.h(B)):$.h(B);const K=o.rev?r.bounds:a.bounds,Z=S.l();I!==D?K.isReal()&&D.isVisible()?D.actualBounds.isReal()?(D.getRelativePoint(E,A.Center,Z),Z.x+=D.actualBounds.x-K.x,Z.y+=D.actualBounds.y-K.y):(D.getRelativePoint(E,A.Center,Z),Z.isReal()||Z.h(Y)):Z.h(Y):K.isReal()?(D.getRelativePoint(E,A.Center,Z),Z.isReal()||Z.h(Y)):Z.h(Y),90===this.P||270===this.P?(l=Math.round(($.x-B.x)/this.ti),c=$.x,h=Math.round((Z.x-Y.x)/this.ti),u=Z.x):(l=Math.round(($.y-B.y)/this.ti),c=$.y,h=Math.round((Z.y-Y.y)/this.ti),u=Z.y),S.i($),S.i(Z),o.portFromColOffset=l,o.portFromPos=c,o.portToColOffset=h,o.portToPos=u}else o.portFromColOffset=0,o.portFromPos=0,o.portToColOffset=0,o.portToPos=0;let d=r.layer;const f=a.layer,p=this.V3(o),g=1===p||3===p,b=2===p||3===p;let x,v,w,P=null;b&&(P=this.B3(r,a),w=1,v=t.createVertex(),v.node=null,v._k=1,v.layer=d,v.near=r,t.addVertex(v),x=t.linkVertexes(r,v,o.link),x.valid=!1,x.rev=o.rev,x.portFromColOffset=l,x.portToColOffset=0,x.portFromPos=c,x.portToPos=0,r=v);let M=1;if(g&&M--,d-f>M&&d>0){for(o.valid=!1,v=t.createVertex(),v.node=null,v._k=2,v.layer=d-1,P&&w<P.length&&v.layer===P[w].layer&&(v.near=P[w++]),t.addVertex(v),x=t.linkVertexes(r,v,o.link),x.valid=!0,x.rev=o.rev,x.portFromColOffset=b?0:l,x.portToColOffset=0,x.portFromPos=b?0:c,x.portToPos=0,r=v,d--;d-f>M&&d>0;)v=t.createVertex(),v.node=null,v._k=3,v.layer=d-1,P&&w<P.length&&v.layer===P[w].layer&&(v.near=P[w++]),t.addVertex(v),x=t.linkVertexes(r,v,o.link),x.valid=!0,x.rev=o.rev,x.portFromColOffset=0,x.portToColOffset=0,x.portFromPos=0,x.portToPos=0,r=v,d--;x=t.linkVertexes(v,a,o.link),x.valid=!g,g&&(v.near=a),x.rev=o.rev,x.portFromColOffset=0,x.portToColOffset=h,x.portFromPos=0,x.portToPos=u}else o.valid=!0}}V3(t){let i=0;const s=t.link;if(null!==s){const n=s.fromPort,o=s.toPort;if(null!==n&&null!==o){const r=s.fromNode,a=s.toNode;if(null!==r&&null!==a){const l=this.tP(!0),h=this.tP(!1),c=this.setsPortSpots?l:s.computeSpot(!0,n),u=this.setsPortSpots?h:s.computeSpot(!1,o),d=s.isOrthogonal;if(c.isSide()&&c.includesSide(h)&&u.isSide()&&u.includesSide(l))return 0;const f=s.getLinkPoint(r,n,c,!0,d,a,o,S.l()),p=s.getLinkDirection(r,n,f,c,!0,d,a,o);S.i(f),(!c.isNone()&&p===this.wF(t,!0)||this.setsPortSpots&&null!==r&&1===r.ports.count&&t.rev)&&(i+=1);const g=s.getLinkPoint(a,o,u,!1,d,r,n,S.l()),b=s.getLinkDirection(a,o,g,u,!1,d,r,n);S.i(g),(!u.isNone()&&b===this.wF(t,!1)||this.setsPortSpots&&null!==a&&1===a.ports.count&&t.rev)&&(i+=2)}}}return i}wF(t,i){return 90===this.P?i&&!t.rev||!i&&t.rev?270:90:180===this.P?i&&!t.rev||!i&&t.rev?0:180:270===this.P?i&&!t.rev||!i&&t.rev?90:270:i&&!t.rev||!i&&t.rev?180:0}B3(t,i){const s=[];return s.push(i),this.xF(t,s)?s.reverse():[]}xF(t,i){const s=i[i.length-1].sourceEdges.iterator;for(;s.next();){const n=s.value;if(n.rev||!n.valid)continue;const o=n.fromVertex;if(i.push(o),o===t||this.xF(t,i))return!0;i.pop()}return!1}C3(){this.ie.length!==this._+1&&(this.ie=new Int16Array(this._+1));const t=this.ie;for(let s=0;s<=this._;s++)t[s]=0;const i=this.network.vertexes.iterator;for(;i.next();)i.value.index=-1;this.initializeIndices(),this.Sw=-1,this.jg=0,this.Bs=0;for(let s=0;s<=this._;s++)t[s]>t[this.Bs]&&(this.Sw=t[s]-1,this.Bs=s),t[s]<t[this.jg]&&(this.jg=s);this.mu=[];for(let s=0;s<t.length;s++)this.mu[s]=[];for(i.reset();i.next();){const s=i.value;this.mu[s.layer][s.index]=s}}initializeIndices(){switch(this.uu){default:case 22:this.z3();break;case 20:this.X3();break;case 21:this.G3()}}z3(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(null===t&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(i.reset();i.next();){const s=i.value;if(s.near)continue;const n=s.layer;if(s.index=this.ie[n],this.ie[n]++,!t)continue;const o=t.get(s);Array.isArray(o)&&o.forEach(r=>{r.index=this.ie[n],this.ie[n]++})}}X3(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(null===t&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=this._;s>=0;s--)for(i.reset();i.next();){const n=i.value;n.layer===s&&-1===n.index&&this.bF(n,t)}}bF(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ie[s],this.ie[s]++,i){const r=i.get(t);Array.isArray(r)&&r.forEach(a=>{a.index=this.ie[s],this.ie[s]++})}const n=t.rr;let o=!0;for(;o;){o=!1;for(let r=0;r<n.length-1;r++){const a=n[r],l=n[r+1];a.portFromColOffset>l.portFromColOffset&&(o=!0,n[r]=l,n[r+1]=a)}}for(let r=0;r<n.length;r++){const a=n[r];if(a.valid){const l=a.toVertex;-1===l.index&&this.bF(l,i)}}}G3(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(null===t&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=0;s<=this._;s++)for(i.reset();i.next();){const n=i.value;n.layer===s&&-1===n.index&&this.kF(n,t)}}kF(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ie[s],this.ie[s]++,i){const h=i.get(t);Array.isArray(h)&&h.forEach(c=>{c.index=this.ie[s],this.ie[s]++})}const n=t.Mo;let a,l,o=!0,r=0;for(;o;)for(o=!1,r=0;r<n.length-1;r++){const h=n[r],c=n[r+1];h.portToColOffset>c.portToColOffset&&(o=!0,n[r]=c,n[r+1]=h)}for(r=0;r<n.length;r++)l=n[r],l.valid&&(a=l.fromVertex,-1===a.index&&this.kF(a,i))}L3(){this.Bt=-1;for(let t=0;t<=this._;t++){const i=this.qa(t);let s=0;const n=this.ie[t];for(let o=0;o<n;o++){const r=i[o];s+=this.nodeMinColumnSpace(r,!0),r.column=s,s+=1,s+=this.nodeMinColumnSpace(r,!1)}this.Bt=Math.max(this.Bt,s-1),this.Wa(t,i)}}reduceCrossings(){let t=this.countCrossings(),i=this.ei(),s=0,n=0,o=0;for(s=0;s<this.mc;s++){for(n=0;n<=this._;n++)this.eP(n,1),this.ys(n,1,!1,1);for(o=this.countCrossings(),o<t&&(t=o,i=this.ei()),n=this._;n>=0;n--)this.eP(n,-1),this.ys(n,-1,!1,-1);o=this.countCrossings(),o<t&&(t=o,i=this.ei())}for(this.os(i),s=0;s<this.mc;s++){for(n=0;n<=this._;n++)this.eP(n,0),this.ys(n,0,!1,0);for(o=this.countCrossings(),o<t&&(t=o,i=this.ei()),n=this._;n>=0;n--)this.eP(n,0),this.ys(n,0,!1,0);o=this.countCrossings(),o<t&&(t=o,i=this.ei())}this.os(i);let r=!1,a=0,l=0,h=0,c=0;switch(this.du){case 30:break;case 32:for(h=t+1;(c=this.countCrossings())<h;)for(h=c,a=this._;a>=0;a--)for(l=0;l<=a;l++){for(r=!0;r;)for(r=!1,n=a;n>=l;n--)r=this.ys(n,-1,!1,-1)||r;for(o=this.countCrossings(),o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=a;n>=l;n--)r=this.ys(n,1,!1,1)||r;for(o=this.countCrossings(),o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=l;n<=a;n++)r=this.ys(n,1,!1,1)||r;for(o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=l;n<=a;n++)r=this.ys(n,-1,!1,-1)||r;for(o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=a;n>=l;n--)r=this.ys(n,0,!1,0)||r;for(o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=l;n<=a;n++)r=this.ys(n,0,!1,0)||r;o>=t?this.os(i):(t=o,i=this.ei())}break;default:for(a=this._,l=0,h=t+1;(c=this.countCrossings())<h;){for(h=c,r=!0;r;)for(r=!1,n=a;n>=l;n--)r=this.ys(n,-1,!1,-1)||r;for(o=this.countCrossings(),o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=a;n>=l;n--)r=this.ys(n,1,!1,1)||r;for(o=this.countCrossings(),o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=l;n<=a;n++)r=this.ys(n,1,!1,1)||r;for(o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=l;n<=a;n++)r=this.ys(n,-1,!1,-1)||r;for(o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=a;n>=l;n--)r=this.ys(n,0,!1,0)||r;for(o>=t?this.os(i):(t=o,i=this.ei()),r=!0;r;)for(r=!1,n=l;n<=a;n++)r=this.ys(n,0,!1,0)||r;o>=t?this.os(i):(t=o,i=this.ei())}}this.os(i)}eP(t,i){let s=0,n=!1;const o=this.qa(t),r=this.ie[t],a=this.fF(t,i),l=this.Nw(t,i);for(s=0;s<r;s++)-1===l[s]&&(l[s]=o[s].column),-1===a[s]&&(a[s]=o[s].column);let c,h=!0;for(;h;)for(h=!1,s=0;s<r-1;s++)if(a[s+1]<a[s]||a[s+1]===a[s]&&l[s+1]<l[s]){n=!0,h=!0;const d=a[s];a[s]=a[s+1],a[s+1]=d;const f=l[s];l[s]=l[s+1],l[s+1]=f,c=o[s],o[s]=o[s+1],o[s+1]=c}let u=0;for(s=0;s<r;s++)c=o[s],c.index=s,u+=this.nodeMinColumnSpace(c,!0),c.column=u,u+=1,u+=this.nodeMinColumnSpace(c,!1);return this.Wa(t,o),n}ys(t,i,s,n){const o=this.qa(t),r=this.ie[t],a=this.cF(t,i);let h,c,l=0;if(!s||n>0)for(h=new Float32Array(r),l=0;l<r;l++)h[l]=-1;else h=this.Nw(t,-1);if(!s||n<0)for(c=new Float32Array(r),l=0;l<r;l++)c[l]=-1;else c=this.Nw(t,1);let u=!1,d=!0;for(;d;)for(d=!1,l=0;l<r-1;l++){const f=a[o[l].index*r+o[l+1].index],p=a[o[l+1].index*r+o[l].index];let g=0,b=0;const x=o[l].column,v=o[l+1].column,P=this.nodeMinColumnSpace(o[l],!0),w=this.nodeMinColumnSpace(o[l],!1),N=x-P+this.nodeMinColumnSpace(o[l+1],!0),I=v-w+this.nodeMinColumnSpace(o[l+1],!1);let $,Z,T=0,D=0,F=0,E=0,B=0,Y=0,W=0,K=0,it=0;const yt=o[l].sourceEdges.iterator;if(s&&n<=0)for(;yt.next();){const Tt=yt.value;$=Tt.fromVertex,Tt.valid&&$.layer!==t&&(F=this.linkStraightenWeight(Tt),E=Tt.portFromColOffset,B=Tt.portToColOffset,Y=$.column,T+=(Math.abs(x+B-(Y+E))+1)*F,D+=(Math.abs(I+B-(Y+E))+1)*F)}for(yt.reset();yt.next();){const Tt=yt.value;if($=Tt.fromVertex,Tt.valid&&$.layer===t){for(K=0;K<o.length&&o[K]!==$;)K++;K<l&&(g+=2*(l-K),b+=2*(l+1-K)),K===l+1&&(g+=1),K>l+1&&(g+=4*(K-l),b+=4*(K-(l+1)))}}const ot=o[l].destinationEdges.iterator;if(s&&n>=0)for(;ot.next();){const Tt=ot.value;Z=Tt.toVertex,Tt.valid&&Z.layer!==t&&(F=this.linkStraightenWeight(Tt),E=Tt.portFromColOffset,B=Tt.portToColOffset,W=Z.column,T+=(Math.abs(x+E-(W+B))+1)*F,D+=(Math.abs(I+E-(W+B))+1)*F)}for(ot.reset();ot.next();){const Tt=ot.value;if(Z=Tt.toVertex,Tt.valid&&Z.layer===t){for(it=0;it<o.length&&o[it]!==Z;)it++;it===l+1&&(b+=1)}}const at=o[l+1].sourceEdges.iterator;if(s&&n<=0)for(;at.next();){const Tt=at.value;$=Tt.fromVertex,Tt.valid&&$.layer!==t&&(F=this.linkStraightenWeight(Tt),E=Tt.portFromColOffset,B=Tt.portToColOffset,Y=$.column,T+=(Math.abs(v+B-(Y+E))+1)*F,D+=(Math.abs(N+B-(Y+E))+1)*F)}for(at.reset();at.next();){const Tt=at.value;if($=Tt.fromVertex,Tt.valid&&$.layer===t){for(K=0;K<o.length&&o[K]!==$;)K++;K<l&&(g+=2*(l+1-K),b+=2*(l-K)),K===l&&(b+=1),K>l+1&&(g+=4*(K-(l+1)),b+=4*(K-l))}}const ft=o[l+1].destinationEdges.iterator;if(s&&n>=0)for(;ft.next();){const Tt=ft.value;Z=Tt.toVertex,Tt.valid&&Z.layer!==t&&(F=this.linkStraightenWeight(Tt),E=Tt.portFromColOffset,B=Tt.portToColOffset,W=Z.column,T+=(Math.abs(v+E-(W+B))+1)*F,D+=(Math.abs(N+E-(W+B))+1)*F)}for(ft.reset();ft.next();){const Tt=ft.value;if(Z=Tt.toVertex,Tt.valid&&Z.layer===t){for(it=0;it<o.length&&o[it]!==Z;)it++;it===l&&(g+=1)}}let ut=0,kt=0;const Mt=h[o[l].index],et=c[o[l].index],Pt=h[o[l+1].index],zt=c[o[l+1].index];if(-1!==Mt&&(ut+=Math.abs(Mt-x),kt+=Math.abs(Mt-I)),-1!==et&&(ut+=Math.abs(et-x),kt+=Math.abs(et-I)),-1!==Pt&&(ut+=Math.abs(Pt-v),kt+=Math.abs(Pt-N)),-1!==zt&&(ut+=Math.abs(zt-v),kt+=Math.abs(zt-N)),b<g-.5||b===g&&p<f-.5||b===g&&p===f&&D<T-.5||b===g&&p===f&&D===T&&kt<ut-.5){u=!0,d=!0,o[l].column=I,o[l+1].column=N;const Tt=o[l];o[l]=o[l+1],o[l+1]=Tt}}for(l=0;l<r;l++)o[l].index=l;return this.Wa(t,o),u}straightenAndPack(){if(0!==this.Gn)return void this.Y3();let t=0,i=!1,s=!!(1&this.cr);if(this.network.edges.count>1e3&&!!(8&this.cr)&&(s=!1),s){const o=[];let r=0;for(r=0;r<=this._;r++)o[r]=0;let a=0;const l=this.network.vertexes.iterator;for(;l.next();){const c=l.value;t=c.layer,a=c.column;const u=this.nodeMinColumnSpace(c,!1);o[t]=Math.max(o[t],a+u)}const h=8;for(l.reset();l.next();){const c=l.value;t=c.layer,a=c.column,c.column=((this.Bt-o[t])*h>>1)+a*h}this.Bt*=h}if(2&this.cr){i=!0;let o=0;for(;i&&o<this.gu;){for(i=!1,t=this.Bs+1;t<=this._;t++)i=this.Jg(t,1)||i;for(t=this.Bs-1;t>=0;t--)i=this.Jg(t,-1)||i;i=this.Jg(this.Bs,0)||i,o++}}if(4&this.cr){for(t=this.Bs+1;t<=this._;t++)this.mL(t,1);for(t=this.Bs-1;t>=0;t--)this.mL(t,-1);this.mL(this.Bs,0)}if(s&&(this.PF(-1),this.PF(1)),2&this.cr){i=!0;let o=0;for(;i&&o<this.gu;){for(i=!1,i=this.Jg(this.Bs,0)||i,t=this.Bs+1;t<=this._;t++)i=this.Jg(t,0)||i;for(t=this.Bs-1;t>=0;t--)i=this.Jg(t,0)||i;o++}}}Jg(t,i){let s=!1;for(;this.K3(t,i);)s=!0;return s}K3(t,i){let s=0;const n=this.qa(t),o=this.ie[t],r=this.Nw(t,-1);if(i>0)for(s=0;s<o;s++)r[s]=-1;const a=this.Nw(t,1);if(i<0)for(s=0;s<o;s++)a[s]=-1;let l=!1,h=!0;for(;h;)for(h=!1,s=0;s<o;s++){const c=n[s].column,u=this.nodeMinColumnSpace(n[s],!0),d=this.nodeMinColumnSpace(n[s],!1);let f=0;f=s-1<0||c-n[s-1].column-1>u+this.nodeMinColumnSpace(n[s-1],!1)?c-1:c;let p=0;p=s+1>=o||n[s+1].column-c-1>d+this.nodeMinColumnSpace(n[s+1],!0)?c+1:c;let g=0,b=0,x=0,v=0,P=0,w=0;if(i<=0){const D=n[s].sourceEdges.iterator;for(;D.next();){const F=D.value,E=F.fromVertex;if(F.valid&&E.layer!==t){v=this.linkStraightenWeight(F),P=F.portFromColOffset,w=F.portToColOffset;const B=E.column;g+=(Math.abs(c+w-(B+P))+1)*v,b+=(Math.abs(f+w-(B+P))+1)*v,x+=(Math.abs(p+w-(B+P))+1)*v}}}if(i>=0){const D=n[s].destinationEdges.iterator;for(;D.next();){const F=D.value,E=F.toVertex;if(F.valid&&E.layer!==t){v=this.linkStraightenWeight(F),P=F.portFromColOffset,w=F.portToColOffset;const B=E.column;g+=(Math.abs(c+P-(B+w))+1)*v,b+=(Math.abs(f+P-(B+w))+1)*v,x+=(Math.abs(p+P-(B+w))+1)*v}}}let M=0,C=0,N=0;const I=r[n[s].index],T=a[n[s].index];-1!==I&&(M+=Math.abs(I-c),C+=Math.abs(I-f),N+=Math.abs(I-p)),-1!==T&&(M+=Math.abs(T-c),C+=Math.abs(T-f),N+=Math.abs(T-p)),b<g||b===g&&C<M?(l=!0,h=!0,n[s].column=f):(x<g||x===g&&N<M)&&(l=!0,h=!0,n[s].column=p)}return this.Wa(t,n),this.Mw(),l}mL(t,i){let s=0;const n=this.qa(t),o=this.ie[t],r=this.fF(t,i),a=new Int16Array(r);let l=!1,h=!0;for(;h;)for(h=!1,s=0;s<o;s++){const c=n[s].column,u=this.nodeMinColumnSpace(n[s],!0),d=this.nodeMinColumnSpace(n[s],!1);let f=0,p=0,g=0,b=0,x=0;-1===a[s]?0===s&&s===o-1?f=c:0===s?(p=n[s+1].column,f=p-c===d+this.nodeMinColumnSpace(n[s+1],!0)?c-1:c):s===o-1?(g=n[s-1].column,f=c-g===u+this.nodeMinColumnSpace(n[s-1],!1)?c+1:c):(g=n[s-1].column,x=g+this.nodeMinColumnSpace(n[s-1],!1)+u+1,p=n[s+1].column,b=p-this.nodeMinColumnSpace(n[s+1],!0)-d-1,f=(x+b)/2|0):0===s&&s===o-1?f=a[s]:0===s?(p=n[s+1].column,b=p-this.nodeMinColumnSpace(n[s+1],!0)-d-1,f=Math.min(a[s],b)):s===o-1?(g=n[s-1].column,x=g+this.nodeMinColumnSpace(n[s-1],!1)+u+1,f=Math.max(a[s],x)):(g=n[s-1].column,x=g+this.nodeMinColumnSpace(n[s-1],!1)+u+1,p=n[s+1].column,b=p-this.nodeMinColumnSpace(n[s+1],!0)-d-1,x<a[s]&&a[s]<b?f=a[s]:x>=a[s]?f=x:b<=a[s]&&(f=b)),f!==c&&(l=!0,h=!0,n[s].column=f)}return this.Wa(t,n),this.Mw(),l}H3(){for(let t=0;t<=this.Bt;t++)for(;this.j3(t,1););this.Mw()}j3(t,i){let s=!0;const n=this.network.vertexes.iterator;for(;n.next();){const r=n.value,a=this.nodeMinColumnSpace(r,!0),l=this.nodeMinColumnSpace(r,!1);if(r.column-a<=t&&r.column+l>=t){s=!1;break}}let o=!1;if(s){if(i>0)for(n.reset();n.next();){const r=n.value;r.column>t&&(r.column-=1,o=!0)}if(i<0)for(n.reset();n.next();){const r=n.value;r.column<t&&(r.column+=1,o=!0)}}return o}q3(){this.H3();for(let t=0;t<this.Bt;t++)for(;this.W3(t,1););this.Mw()}W3(t,i){let s=t;i>0&&(s=t+1),i<0&&(s=t-1);let n=0;const o=[],r=[];for(n=0;n<=this._;n++)o[n]=!1,r[n]=!1;const a=this.network.vertexes.iterator;for(;a.next();){const c=a.value,u=c.column-this.nodeMinColumnSpace(c,!0),d=c.column+this.nodeMinColumnSpace(c,!1);u<=t&&d>=t&&(o[c.layer]=!0),u<=s&&d>=s&&(r[c.layer]=!0)}let l=!0,h=!1;for(n=0;n<=this._;n++)l=l&&!(o[n]&&r[n]);if(l){if(i>0)for(a.reset();a.next();){const c=a.value;c.column>t&&(c.column-=1,h=!0)}if(i<0)for(a.reset();a.next();){const c=a.value;c.column<t&&(c.column+=1,h=!0)}}return h}PF(t){this.q3();let s,i=0,n=0,o=0,r=0;if(t>0)for(i=0;i<=this.Bt;i++)for(s=this.ei(),n=this.Qk(!0),o=n+1;n<o;)o=n,this.SF(i,1),r=this.Qk(!0),r>n?this.os(s):r<n&&(n=r,s=this.ei());if(t<0)for(i=this.Bt;i>=0;i--)for(s=this.ei(),n=this.Qk(!0),o=n+1;n<o;)o=n,this.SF(i,-1),r=this.Qk(!0),r>n?this.os(s):r<n&&(n=r,s=this.ei());this.Mw()}SF(t,i){this.fn=0;const s=this.network.vertexes.iterator;for(;s.next();)s.value.component=-1;if(i>0)for(s.reset();s.next();){const u=s.value;u.column-this.nodeMinColumnSpace(u,!0)<=t&&(u.component=this.fn)}if(i<0)for(s.reset();s.next();){const u=s.value;u.column+this.nodeMinColumnSpace(u,!1)>=t&&(u.component=this.fn)}for(this.fn++,s.reset();s.next();){const u=s.value;-1===u.component&&(this.dL(u,this.fn,-1,!0,!0),this.fn++)}let n=0;const o=[];for(n=0;n<this.fn*this.fn;n++)o[n]=!1;const r=[];for(n=0;n<(this._+1)*(this.Bt+1);n++)r[n]=-1;for(s.reset();s.next();){const u=s.value,d=u.layer,f=Math.max(0,u.column-this.nodeMinColumnSpace(u,!0)),p=Math.min(this.Bt,u.column+this.nodeMinColumnSpace(u,!1));for(let g=f;g<=p;g++)r[d*(this.Bt+1)+g]=u.component}for(let u=0;u<=this._;u++){if(i>0)for(let d=0;d<this.Bt;d++)-1!==r[u*(this.Bt+1)+d]&&-1!==r[u*(this.Bt+1)+d+1]&&r[u*(this.Bt+1)+d]!==r[u*(this.Bt+1)+d+1]&&(o[r[u*(this.Bt+1)+d]*this.fn+r[u*(this.Bt+1)+d+1]]=!0);if(i<0)for(let d=this.Bt;d>0;d--)-1!==r[u*(this.Bt+1)+d]&&-1!==r[u*(this.Bt+1)+d-1]&&r[u*(this.Bt+1)+d]!==r[u*(this.Bt+1)+d-1]&&(o[r[u*(this.Bt+1)+d]*this.fn+r[u*(this.Bt+1)+d-1]]=!0)}const a=[];for(n=0;n<this.fn;n++)a[n]=!0;const l=[];l.push(0);let h=0;for(;0!==l.length;)if(h=l[l.length-1],l.pop(),a[h])for(a[h]=!1,n=0;n<this.fn;n++)o[h*this.fn+n]&&l.splice(0,0,n);let c=!1;if(i>0)for(s.reset();s.next();){const u=s.value;a[u.component]&&(u.column-=1,c=!0)}if(i<0)for(s.reset();s.next();){const u=s.value;a[u.component]&&(u.column+=1,c=!0)}return c}Y3(){const t=y.nt(),i=this.mu.length;for(let f=0;f<=i;f++)t[f]=[];const s=this.network.vertexes.iterator;for(;s.next();){const f=s.value;t[i-f.layer][f.index]=f}const n=new z;this.J3(t,n);let o=null,r=null,a=null,l=null;const h=!!(1&this.Gn),c=!!(2&this.Gn),u=!!(4&this.Gn),d=!!(8&this.Gn);h&&(this.hl(t,n,!0),o=this.iP(t,!0,!1)),t.reverse(),u&&(this.hl(t,n,!1),a=this.iP(t,!1,!1));for(const f of t)f.reverse();d&&(this.hl(t,n,!1),l=this.iP(t,!1,!0)),t.reverse(),c&&(this.hl(t,n,!0),r=this.iP(t,!0,!0)),y.Z(t),this.$3(o,r,a,l),this.network.vertexes.each(f=>{const p=f,g=y.nt();h&&g.push(o.get(p)),c&&g.push(r.get(p)),u&&g.push(a.get(p)),d&&g.push(l.get(p)),g.sort((w,M)=>w-M);const b=g.length,x=Math.floor((b-1)/2),v=Math.ceil((b-1)/2),P=(g[x]+g[v])/2;y.Z(g),p.mi=P})}J3(t,i){const s=t.length;for(let n=1;n<s-1;n++){let o=0,r=0;const a=t[n],l=t[n+1];for(let h=0;r<l.length;h++){const c=l[h],u=this.Z3(c);if(h===l.length-1||u){let d=a.length-1;for(u&&(d=c.getProperSourceVertexes()[0].index);r<=h;){const f=l[r].getProperSourceEdges();for(const p of f){const g=p.fromVertex.index;(g<o||g>d)&&i.add(p)}r++}o=d}}}}Z3(t){if(null===t.node){const i=t.getProperSourceVertexes();if(i.length>0)return null===i[0].node}return!1}hl(t,i,s){this.Q3(t);for(const n of t){let o=-1;for(const r of n){const a=s?r.getProperSourceVertexes():r.getProperDestinationVertexes(),l=a.length;if(l>0){a.sort((c,u)=>c.Ja-u.Ja);const h=(l-1)/2;for(let c=Math.floor(h),u=Math.ceil(h);c<=u;c++)if(r.Yn===r){const d=a[c];let f;f=s?d.getDestinationEdge(r):r.getDestinationEdge(d),!i.has(f)&&o<d.Ja&&(d.Yn=r,r.pc=d.pc,r.Yn=d.pc,o=d.Ja)}}}}}Q3(t){for(let i=0;i<t.length;i++){const s=t[i];for(let n=0;n<s.length;n++){const o=s[n];o.pc=o,o.Yn=o,o.MF=i,o.Ja=n}}}iP(t,i,s){const n=90===this.P||270===this.P;for(const r of t)for(const a of r)a.rs=a,a.yu=1/0,a.mi=NaN,a.Kn=0;this._3(t,i,s);for(const r of t)for(const a of r)a.pc===a&&this.NF(a,t);for(let r=0;r<t.length;r++){if(t[r].length<=0)continue;const a=t[r][0];if(a.rs===a){a.rs.yu===1/0&&(a.rs.yu=0);let c,l=r,h=0;do{for(c=t[l][h];c.Yn!==c.pc;)if(c=c.Yn,l++,c.Ja>0){const u=this.CF(c,t);u.rs.yu=Math.min(u.rs.yu,c.rs.yu+c.mi+c.Kn-(u.mi+u.Kn+(n?u.width:u.height)+this.columnSpacing))}h=c.Ja+1}while(l<t.length&&h<t[l].length&&c.rs===t[l][h].rs)}}const o=new xt;for(const r of t)for(const a of r)a.mi=a.mi+a.rs.yu+a.Kn,o.set(a,s?-a.mi-(n?a.width:a.height):a.mi);return o}_3(t,i,s){const n=90===this.P||270===this.P;for(const o of t)for(const r of o)if(r.pc===r){let a=0,l=r;for(;l.Yn!==r;){const h=l.Yn,c=n?l.width:l.height,u=n?h.width:h.height;let d,f,p,g;i?(p=l.getDestinationEdge(h),d=p.portFromPos,f=p.portToPos,null!==p.link&&(l.node&&l.node!==p.link.fromNode&&(d=n?l.focusX:l.focusY),h.node&&h.node!==p.link.toNode&&(f=n?h.focusX:h.focusY)),g=s?l.Kn+(c-d)-(u-f):l.Kn+d-f):(p=h.getDestinationEdge(l),d=p.portToPos,f=p.portFromPos,null!==p.link&&(l.node&&l.node!==p.link.toNode&&(d=n?l.focusX:l.focusY),h.node&&h.node!==p.link.fromNode&&(f=n?h.focusX:h.focusY)),g=s?l.Kn+(c-d)-(u-f):l.Kn+d-f),h.Kn=g,a=Math.min(a,g),l=l.Yn}l=r;do{l.Kn=l.Kn-a,l=l.Yn}while(l!==r)}}NF(t,i){if(!isNaN(t.mi))return;t.mi=0;let s=t;do{if(s.Ja>0){const n=this.CF(s,i),o=n.pc;this.NF(o,i),t.rs===t&&(t.rs=o.rs),t.rs===o.rs&&(t.mi=Math.max(t.mi,o.mi+n.Kn+(90===this.P||270===this.P?n.width:n.height)-s.Kn+this.columnSpacing))}s=s.Yn}while(s!==t);for(;s.Yn!==t;)s=s.Yn,s.mi=t.mi,s.rs=t.rs}CF(t,i){const s=t.MF,n=t.Ja;return n<1&&y.o("Could not determine previous vertex in layer"),i[s][n-1]}$3(...t){let i=-1;const s=y.nt(),n=y.nt();let o=1/0;for(let r=0;r<4;r++){if(!t[r])continue;const a=this.tU(t[r],s,n,r);a<o&&(i=r,o=a)}for(let r=0;r<4;r++){const a=t[r];if(!a)continue;const l=0===r||2===r?s[i]-s[r]:n[i]-n[r];0!==l&&a.each(h=>{a.set(h.key,h.value+l)})}y.Z(s),y.Z(n)}tU(t,i,s,n){if(!t||0===t.count)return i[n]=0,s[n]=0,1/0;let o=1/0,r=-1/0;return t.each(a=>{const l=a.key,h=a.value,c=90===this.P||270===this.P?l.width:l.height;h<o&&(o=h),h+c>r&&(r=h+c)}),i[n]=o,s[n]=r,r-o}commitLayout(){this.Pw(),this.commitNodes(),this.pL(),this.isRouting&&this.commitLinks()}Pw(){if(!this.setsPortSpots)return;const t=this.tP(!0),i=this.tP(!1),s=this.network.edges.iterator;for(;s.next();){const n=s.value.link;null!==n&&(n.fromSpot=t,n.toSpot=i)}}tP(t){return 270===this.P?t?A.MiddleTop:A.MiddleBottom:90===this.P?t?A.MiddleBottom:A.MiddleTop:180===this.P?t?A.MiddleLeft:A.MiddleRight:t?A.MiddleRight:A.MiddleLeft}commitNodes(){this.zs.length!==this._+1&&(this.zs=new Float32Array(this._+1)),this.ms.length!==this._+1&&(this.ms=new Float32Array(this._+1)),this.ps.length!==this._+1&&(this.ps=new Float32Array(this._+1)),this.Rt.length!==this._+1&&(this.Rt=new Float32Array(this._+1));for(let p=0;p<=this._;p++)this.zs[p]=0,this.ms[p]=0,this.ps[p]=0,this.Rt[p]=0;const t=this.network.vertexes.iterator;for(;t.next();){const p=t.value,g=p.layer;this.zs[g]=Math.max(this.zs[g],this.nodeMinLayerSpace(p,!0)),this.ms[g]=Math.max(this.ms[g],this.nodeMinLayerSpace(p,!1))}let i=0;const s=this.Vs;for(let p=0;p<=this._;p++){let g=s;this.zs[p]+this.ms[p]<=0&&(g=0),p>0&&(i+=g/2),90===this.P||0===this.P?(i+=this.ms[p],this.ps[p]=i,i+=this.zs[p]):(i+=this.zs[p],this.ps[p]=i,i+=this.ms[p]),p<this._&&(i+=g/2),this.Rt[p]=i}const n=i,o=this.arrangementOrigin;for(let p=0;p<=this._;p++)270===this.P?this.ps[p]=o.y+this.ps[p]:90===this.P?(this.ps[p]=o.y+n-this.ps[p],this.Rt[p]=n-this.Rt[p]):180===this.P?this.ps[p]=o.x+this.ps[p]:(this.ps[p]=o.x+n-this.ps[p],this.Rt[p]=n-this.Rt[p]);const r=0!==this.Gn;t.reset();const a=270===this.P||90===this.P;let l=1/0,h=1/0,c=1/0,u=-1/0;for(;t.next();){const p=t.value,g=p.layer,b=0|p.column;let x=0,v=0;a?(x=o.x+this.ti*b,v=this.ps[g]):(x=this.ps[g],v=o.y+this.ti*b),p.centerX=x,p.centerY=v,r&&isFinite(p.mi)&&(a?p.node?p.x=o.x+p.mi:p.centerX=o.x+p.mi:p.node?p.y=o.y+p.mi:p.centerY=o.y+p.mi),l=Math.min(p.x,l),h=Math.min(p.y,h),a?(c=l,u=Math.max(u,p.bounds.right)):(c=h,u=Math.max(u,p.bounds.bottom))}this.uL=u-c;const d=o.x-l,f=o.y-h;for(this.fr=new S(r&&a?0:d,r&&!a?0:f),t.reset();t.next();){const p=t.value;p.x+=d,p.y+=f,p.commit()}}pL(){let t=0;const i=this.Vs;for(let o=0;o<=this._;o++)t+=this.zs[o],t+=this.ms[o];t+=this._*i;const s=[],n=0!==this.Gn?this.uL:this.ti*this.Bt;for(let o=this.maxLayer;o>=0;o--)s.push(270===this.P?0===o?new j(0,0,n,Math.abs(this.Rt[0])):new j(0,this.Rt[o-1],n,Math.abs(this.Rt[o-1]-this.Rt[o])):90===this.P?0===o?new j(0,this.Rt[0],n,Math.abs(this.Rt[0]-t)):new j(0,this.Rt[o],n,Math.abs(this.Rt[o-1]-this.Rt[o])):180===this.P?0===o?new j(0,0,Math.abs(this.Rt[0]),n):new j(this.Rt[o-1],0,Math.abs(this.Rt[o-1]-this.Rt[o]),n):0===o?new j(this.Rt[0],0,Math.abs(this.Rt[0]-t),n):new j(this.Rt[o],0,Math.abs(this.Rt[o-1]-this.Rt[o]),n));this.commitLayers(s,this.fr)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;let i=null;for(;t.next();)i=t.value.link,null!==i&&i.pointsCount>0&&(i.startRoute(),i.clearPoints(),i.commitRoute());for(t.reset();t.next();)i=t.value.link,null!==i&&i.updateRoute();for(t.reset();t.next();){const s=t.value;if(i=s.link,null===i||0===i.pointsCount)continue;i.startRoute();const n=i;let o=n.fromNode,r=n.toNode,a=n.fromPort,l=n.toPort;if(null!==o){const F=o.findVisibleNode();null!==F&&F!==o&&(o=F,a=F.port)}if(null!==r){const F=r.findVisibleNode();null!==F&&F!==r&&(r=F,l=F.port)}const h=i.computeSpot(!0,a),c=i.computeSpot(!1,l);let u=s.fromVertex,d=s.toVertex;if(s.valid){if(9===i.curve&&4===i.pointsCount)if(u.column===d.column&&0===this.alignOption){const F=i.getLinkPoint(o,a,h,!0,!1,r,l),E=i.getLinkPoint(r,l,c,!1,!1,o,a);F.isReal()||F.set(o.actualBounds.center),E.isReal()||E.set(r.actualBounds.center),i.clearPoints(),i.addPointAt(F.x,F.y),i.addPointAt((2*F.x+E.x)/3,(2*F.y+E.y)/3),i.addPointAt((F.x+2*E.x)/3,(F.y+2*E.y)/3),i.addPointAt(E.x,E.y)}else{let F=!1,E=!1;if(null!==a&&i.bl(h)&&(F=!0),null!==l&&i.bl(c)&&(E=!0),F||E){let B=null;F&&(B=i.getLinkPointFromPoint(o,a,a.getDocumentPoint(A.Center),i.getPoint(3),!0),B.isReal()||B.set(o.actualBounds.center),i.setPointAt(0,B.x,B.y));let Y=null;if(E&&(Y=i.getLinkPointFromPoint(r,l,l.getDocumentPoint(A.Center),i.getPoint(0),!1),Y.isReal()||Y.set(r.actualBounds.center),i.setPointAt(3,Y.x,Y.y)),B){const W=i.getPoint(2);i.setPointAt(1,(2*B.x+W.x)/3,(2*B.y+W.y)/3)}if(Y){const W=i.getPoint(1);i.setPointAt(2,(2*Y.x+W.x)/3,(2*Y.y+W.y)/3)}}}i.commitRoute();continue}if(u.layer===d.layer){i.commitRoute();continue}let f=!1,p=!1;const g=this.Vs;let b=0,x=i.firstPickIndex+1;if(i.isOrthogonal)p=!0,b=i.pointsCount,b>4&&i.points.removeRange(2,b-3);else if(9===i.curve)f=!0,b=i.pointsCount,b>4&&i.points.removeRange(2,b-3),4===b&&(x=2);else{b=i.pointsCount;const F=h===A.None,E=c===A.None;b>2&&F&&E?i.points.removeRange(1,b-2):b>3&&F&&!E?i.points.removeRange(1,b-3):b>3&&!F&&E?i.points.removeRange(2,b-2):b>4&&!F&&!E&&i.points.removeRange(2,b-3)}let v,P,w=0,M=0,C=0,N=0,I=0,T=0,D=0;if(s.rev){let F=0;for(;null!==d&&u!==d;){v=null,P=null;const E=d.sourceEdges.iterator;for(;E.next();){const B=E.value;if(B.link===s.link&&(v=B.fromVertex,P=B.toVertex,null===v.node))break}if(null===v)break;if(v!==u)if(w=i.getPoint(x-1).x,M=i.getPoint(x-1).y,C=v.centerX,N=v.centerY,p)180===this.P||0===this.P?x===i.firstPickIndex+1?(i.insertPointAt(x++,w,M),i.insertPointAt(x++,w,N)):(null!==P?P.centerY:M)!==N&&(I=this.Rt[v.layer-1]+this.fr.x,i.insertPointAt(x++,I,M),i.insertPointAt(x++,I,N)):x===i.firstPickIndex+1?(i.insertPointAt(x++,w,M),i.insertPointAt(x++,C,M)):(null!==P?P.centerX:w)!==C&&(I=this.Rt[v.layer-1]+this.fr.y,i.insertPointAt(x++,w,I),i.insertPointAt(x++,C,I));else if(x===i.firstPickIndex+1)if(T=Math.max(10,this.zs[d.layer]),D=Math.max(10,this.ms[d.layer]),f)180===this.P?C<=d.bounds.x?(F=d.bounds.x,i.insertPointAt(x++,F-T,N),i.insertPointAt(x++,F,N),i.insertPointAt(x++,F+D,N)):(i.insertPointAt(x++,C-T,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C+D,N)):90===this.P?N>=d.bounds.bottom?(F=d.bounds.y+d.bounds.height,i.insertPointAt(x++,C,F+D),i.insertPointAt(x++,C,F),i.insertPointAt(x++,C,F-T)):(i.insertPointAt(x++,C,N+D),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N-T)):270===this.P?N<=d.bounds.y?(F=d.bounds.y,i.insertPointAt(x++,C,F-T),i.insertPointAt(x++,C,F),i.insertPointAt(x++,C,F+D)):(i.insertPointAt(x++,C,N-T),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N+D)):0===this.P&&(C>=d.bounds.right?(F=d.bounds.x+d.bounds.width,i.insertPointAt(x++,F+D,N),i.insertPointAt(x++,F,N),i.insertPointAt(x++,F-T,N)):(i.insertPointAt(x++,C+D,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C-T,N)));else{i.insertPointAt(x++,w,M);let B=0;180===this.P||0===this.P?((180===this.P?C>=d.bounds.right:C<=d.bounds.x)&&(B=(0===this.P?-T:D)/2),i.insertPointAt(x++,w+B,N)):((270===this.P?N>=d.bounds.bottom:N<=d.bounds.y)&&(B=(90===this.P?-T:D)/2),i.insertPointAt(x++,C,M+B)),i.insertPointAt(x++,C,N)}else T=Math.max(10,this.zs[v.layer]),D=Math.max(10,this.ms[v.layer]),f?180===this.P?(i.insertPointAt(x++,C-T-Math.max(10,g),N),i.insertPointAt(x++,Math.min(C-T+g/2,C),N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,Math.max(C+D-g/2,C),N),i.insertPointAt(x++,C+D+g,N)):90===this.P?(i.insertPointAt(x++,C,N+D+Math.max(10,g)),i.insertPointAt(x++,C,Math.max(N+D-g/2,N)),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,Math.min(N-T+g/2,N)),i.insertPointAt(x++,C,N-T-g)):270===this.P?(i.insertPointAt(x++,C,N-T-Math.max(10,g)),i.insertPointAt(x++,C,Math.min(N-T+g/2,N)),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,Math.max(N+D-g/2,N)),i.insertPointAt(x++,C,N+D+g)):(i.insertPointAt(x++,C+D+Math.max(10,g),N),i.insertPointAt(x++,Math.max(C+D-g/2,C),N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,Math.min(C-T+g/2,C),N),i.insertPointAt(x++,C-T-g,N)):i.insertPointAt(x++,C,N);d=v}if(null===l||h!==A.None||p)if(w=i.getPoint(x-1).x,M=i.getPoint(x-1).y,C=i.getPoint(x).x,N=i.getPoint(x).y,p){const E=this.ms[u.layer];let B=0;180===this.P||0===this.P?(B=M,B>=u.bounds.y&&B<=u.bounds.bottom&&(180===this.P?C>=u.bounds.x:C<=u.bounds.right)&&(F=u.centerX+(180===this.P?-E:E),B=B<u.bounds.y+u.bounds.height/2?u.bounds.y-this.ti/2:u.bounds.bottom+this.ti/2,i.insertPointAt(x++,F,M),i.insertPointAt(x++,F,B)),i.insertPointAt(x++,C,B),i.insertPointAt(x++,C,N)):(B=w,B>=u.bounds.x&&B<=u.bounds.right&&(270===this.P?N>=u.bounds.y:N<=u.bounds.bottom)&&(F=u.centerY+(270===this.P?-E:E),B=B<u.bounds.x+u.bounds.width/2?u.bounds.x-this.ti/2:u.bounds.right+this.ti/2,i.insertPointAt(x++,w,F),i.insertPointAt(x++,B,F)),i.insertPointAt(x++,B,N),i.insertPointAt(x++,C,N))}else if(f)T=Math.max(10,this.zs[u.layer]),D=Math.max(10,this.ms[u.layer]),180===this.P&&C>=u.bounds.x?(F=u.bounds.x+u.bounds.width,i.setPointAt(x-2,F,M),i.setPointAt(x-1,F+D,M)):90===this.P&&N<=u.bounds.bottom?(F=u.bounds.y,i.setPointAt(x-2,w,F),i.setPointAt(x-1,w,F-T)):270===this.P&&N>=u.bounds.y?(F=u.bounds.y+u.bounds.height,i.setPointAt(x-2,w,F),i.setPointAt(x-1,w,F+D)):0===this.P&&C<=u.bounds.right&&(F=u.bounds.x,i.setPointAt(x-2,F,M),i.setPointAt(x-1,F-T,M));else{T=Math.max(10,this.zs[u.layer]),D=Math.max(10,this.ms[u.layer]);let E=0;180===this.P||0===this.P?((180===this.P?C<=u.bounds.x:C>=u.bounds.right)&&(E=(0===this.P?D:-T)/2),i.insertPointAt(x++,C+E,M)):((270===this.P?N<=u.bounds.y:N>=u.bounds.bottom)&&(E=(90===this.P?D:-T)/2),i.insertPointAt(x++,w,N+E)),i.insertPointAt(x++,C,N)}}else{for(;null!==u&&u!==d;){v=null,P=null;const F=u.destinationEdges.iterator;for(;F.next();){const E=F.value;if(E.link===s.link&&(v=E.toVertex,P=E.fromVertex,null!==P.node&&(P=null),null===v.node))break}if(null===v)break;v!==d&&(w=i.getPoint(x-1).x,M=i.getPoint(x-1).y,C=v.centerX,N=v.centerY,p?180===this.P||0===this.P?(null!==P?P.centerY:M)!==N&&(I=this.Rt[v.layer]+this.fr.x,x===i.firstPickIndex+1&&(I=0===this.P?Math.max(I,w):Math.min(I,w)),i.insertPointAt(x++,I,M),i.insertPointAt(x++,I,N)):(null!==P?P.centerX:w)!==C&&(I=this.Rt[v.layer]+this.fr.y,x===i.firstPickIndex+1&&(I=90===this.P?Math.max(I,M):Math.min(I,M)),i.insertPointAt(x++,w,I),i.insertPointAt(x++,C,I)):(T=Math.max(10,this.zs[v.layer]),D=Math.max(10,this.ms[v.layer]),f?180===this.P?(i.insertPointAt(x++,C+D+Math.max(10,g),N),i.insertPointAt(x++,Math.max(C+D-g/2,C),N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,Math.min(C-T+g/2,C),N),i.insertPointAt(x++,C-T-g,N)):90===this.P?(i.insertPointAt(x++,C,N-T-Math.max(10,g)),i.insertPointAt(x++,C,Math.min(N-T+g/2,N)),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,Math.max(N+D-g/2,N)),i.insertPointAt(x++,C,N+D+g)):270===this.P?(i.insertPointAt(x++,C,N+D+Math.max(10,g)),i.insertPointAt(x++,C,Math.max(N+D-g/2,N)),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,Math.min(N-T+g/2,N)),i.insertPointAt(x++,C,N-T-g)):(i.insertPointAt(x++,C-T-Math.max(10,g),N),i.insertPointAt(x++,Math.min(C-T+g/2,C),N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,C,N),i.insertPointAt(x++,Math.max(C+D-g/2,C),N),i.insertPointAt(x++,C+D+g,N)):180===this.P?(i.insertPointAt(x++,C+D,N),i.insertPointAt(x++,C-T,N)):90===this.P?(i.insertPointAt(x++,C,N-T),i.insertPointAt(x++,C,N+D)):270===this.P?(i.insertPointAt(x++,C,N+D),i.insertPointAt(x++,C,N-T)):(i.insertPointAt(x++,C-T,N),i.insertPointAt(x++,C+D,N)))),u=v}p&&(w=i.getPoint(x-1).x,M=i.getPoint(x-1).y,C=i.getPoint(x).x,N=i.getPoint(x).y,180===this.P||0===this.P?M!==N&&(I=0===this.P?Math.min(Math.max((C+w)/2,this.Rt[d.layer]+this.fr.x),C):Math.max(Math.min((C+w)/2,this.Rt[d.layer]+this.fr.x),C),i.insertPointAt(x++,I,M),i.insertPointAt(x++,I,N)):w!==C&&(I=90===this.P?Math.min(Math.max((N+M)/2,this.Rt[d.layer]+this.fr.y),N):Math.max(Math.min((N+M)/2,this.Rt[d.layer]+this.fr.y),N),i.insertPointAt(x++,w,I),i.insertPointAt(x++,C,I)))}if(null!==n&&f&&i.pointsCount>=4){if(null!==o&&null!==a&&n.bl(h)){const F=a.getDocumentPoint(A.Center);F.isReal()||F.setTo(o.actualBounds.centerX,o.actualBounds.centerY);const E=i.getPoint(3),B=i.getPoint(2);90===this.direction||270===this.direction?(i.setPointAt(1,E.x,(B.y+E.y)/2),i.setPointAt(2,E.x,(B.y+E.y)/2)):(i.setPointAt(1,(B.x+E.x)/2,E.y),i.setPointAt(2,(B.x+E.x)/2,E.y));const Y=i.getLinkPointFromPoint(o,a,F,i.getPoint(1),!0);i.setPointAt(0,Y.x,Y.y)}if(null!==r&&null!==l&&n.bl(c)){const F=l.getDocumentPoint(A.Center);F.isReal()||F.setTo(r.actualBounds.centerX,r.actualBounds.centerY);const E=i.getPoint(i.pointsCount-4),B=i.getLinkPointFromPoint(r,l,F,E,!1),Y=i.getPoint(i.pointsCount-3);90===this.direction||270===this.direction?(i.setPointAt(i.pointsCount-2,E.x,(Y.y+B.y)/2),i.setPointAt(i.pointsCount-3,E.x,(Y.y+B.y)/2)):(i.setPointAt(i.pointsCount-2,(Y.x+B.x)/2,E.y),i.setPointAt(i.pointsCount-3,(Y.x+B.x)/2,E.y));const W=i.getLinkPointFromPoint(r,l,F,i.getPoint(i.pointsCount-2),!1);i.setPointAt(i.pointsCount-1,W.x,W.y)}}i.commitRoute(),s.commit()}}S3(){this.Sw=-1,this.jg=0,this.Bs=0,this.mu=null;for(let t=0;t<this.Xn.length;t++)this.Xn[t]=null}qa(t){let i;const s=this.ie[t];if(s>=this.Xn.length){const o=[];for(let r=0;r<this.Xn.length;r++)o[r]=this.Xn[r];this.Xn=o}null==this.Xn[s]?i=[]:(i=this.Xn[s],this.Xn[s]=null);const n=this.mu[t];for(let o=0;o<n.length;o++){const r=n[o];i[r.index]=r}return i}Wa(t,i){this.Xn[this.ie[t]]=i}get layerSpacing(){return this.Vs}set layerSpacing(t){this.Vs!==t&&(y.s(t,"number",m,"layerSpacing"),t>=0&&(this.Vs=t,this.p()))}get columnSpacing(){return this.ti}set columnSpacing(t){this.ti!==t&&(y.s(t,"number",m,"columnSpacing"),t>0&&(this.ti=t,this.p()))}get direction(){return this.P}set direction(t){this.P!==t&&(y.s(t,"number",m,"direction"),0===t||90===t||180===t||270===t?(this.P=t,this.p()):y.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.cu}set cycleRemoveOption(t){this.cu!==t&&(1===t||0===t||2===t)&&(this.cu=t,this.p())}get layeringOption(){return this.fu}set layeringOption(t){this.fu!==t&&(10===t||11===t||12===t)&&(this.fu=t,this.p())}get initializeOption(){return this.uu}set initializeOption(t){this.uu!==t&&(20===t||21===t||22===t)&&(this.uu=t,this.p())}get iterations(){return this.mc}set iterations(t){this.mc!==t&&t>=0&&(this.mc=t,this.p())}get aggressiveOption(){return this.du}set aggressiveOption(t){this.du!==t&&(30===t||31===t||32===t)&&(this.du=t,this.p())}get packOption(){return this.cr}set packOption(t){this.cr!==t&&(y.s(t,"number",m,"packOption"),t>=0&&t<8&&(this.cr=t,this.p()))}get packIterations(){return this.gu}set packIterations(t){this.gu=t}get alignOption(){return this.Gn}set alignOption(t){this.Gn!==t&&(y.s(t,"number",m,"align"),t>=0&&t<16&&(this.Gn=t,this.p()))}get centered(){return this.ja}set centered(t){this.centered!==t&&(y.s(t,"boolean",m,"centered"),this.ja=t,this.p())}get setsPortSpots(){return this.zn}set setsPortSpots(t){this.zn!==t&&(y.s(t,"boolean",m,"setsPortSpots"),this.zn=t,this.p())}get maxLayer(){return this._}get maxIndex(){return this.Sw}get maxColumn(){return this.Bt}get minIndexLayer(){return this.jg}get maxIndexLayer(){return this.Bs}static CycleDepthFirst=0;static CycleGreedy=1;static CycleFromLayers=2;static LayerOptimalLinkLength=10;static LayerLongestPathSink=11;static LayerLongestPathSource=12;static InitDepthFirstOut=20;static InitDepthFirstIn=21;static InitNaive=22;static AggressiveNone=30;static AggressiveLess=31;static AggressiveMore=32;static PackNone=0;static PackExpand=1;static PackStraighten=2;static PackMedian=4;static PackAll=15;static AlignNone=0;static AlignUpperLeft=1;static AlignUpperRight=2;static AlignLowerLeft=4;static AlignLowerRight=8;static AlignAll=15}return m})();class Js extends Ie{constructor(e){super(e)}createVertex(){const e=new oi(this);return e.centered=this.layout.centered,e}createEdge(){return new Ae(this)}}class oi extends Be{pl;pa;Tt;sP;nP;ja;ii;pu;to;_k;$k;Zk;pc;Yn;MF;Ja;rs;yu;mi;Kn;Lw=null;Aw=null;Tw=null;Dw=null;constructor(e){super(e),this.pl=-1,this.pa=-1,this.Tt=-1,this.sP=NaN,this.nP=null,this.ja=!0,this.ii=!1,this.pu=NaN,this.to=NaN,this._k=0,this.$k=null,this.Zk=null}static LF(e,t){return e.index-t.index}getProperSourceEdges(){if(!this.Tw){const e=[];for(const t of this.Mo)t.valid&&e.push(t);this.Tw=e}return this.Tw}getProperDestinationEdges(){if(!this.Dw){const e=[];for(const t of this.rr)t.valid&&e.push(t);this.Dw=e}return this.Dw}getDestinationEdge(e){const t=this.getProperDestinationEdges();for(const i of t)if(i.toVertex===e)return i;y.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.Lw){const e=[];for(const t of this.Mo)!t.valid||t.fromVertex.layer<=t.toVertex.layer||e.push(t.fromVertex);e.sort(oi.LF),this.Lw=e}return this.Lw}getProperDestinationVertexes(){if(!this.Aw){const e=[];for(const t of this.rr)!t.valid||t.fromVertex.layer<=t.toVertex.layer||e.push(t.toVertex);e.sort(oi.LF),this.Aw=e}return this.Aw}addSourceEdge(e){super.addSourceEdge(e),this.Lw=null,this.Tw=null}deleteSourceEdge(e){super.deleteSourceEdge(e),this.Lw=null,this.Tw=null}addDestinationEdge(e){super.addDestinationEdge(e),this.Aw=null,this.Dw=null}deleteDestinationEdge(e){super.deleteDestinationEdge(e),this.Aw=null,this.Dw=null}commit(){if(this.centered)super.commit();else{const e=this.node;if(null!==e){const t=this.network.layout;if(!t)return;180===t.direction||270===t.direction?e.moveTo(this.bounds.right-e.actualBounds.width,this.bounds.bottom-e.actualBounds.height):e.moveTo(this.bounds.x,this.bounds.y)}}}get layer(){return this.pl}set layer(e){this.pl=e}get column(){return this.pa}set column(e){this.pa=e}get index(){return this.Tt}set index(e){this.Tt=e}get component(){return this.sP}set component(e){this.sP!==e&&(y.s(e,"number",oi,"component"),this.sP=e)}get near(){return this.nP}set near(e){this.nP!==e&&(this.nP=e)}get centered(){return this.ja}set centered(e){this.ja=e}}class Ae extends si{ii;oP;rP;lP;aP;hP;cP;constructor(e){super(e),this.ii=!1,this.oP=!1,this.rP=!1,this.lP=NaN,this.aP=NaN,this.hP=0,this.cP=0}get fromVertex(){return this.ss}set fromVertex(e){this.ss!==e&&(this.ss=e)}get toVertex(){return this.ns}set toVertex(e){this.ns!==e&&(this.ns=e)}get valid(){return this.ii}set valid(e){this.ii!==e&&(y.s(e,"boolean",Ae,"valid"),this.ii=e)}get rev(){return this.oP}set rev(e){this.oP!==e&&(y.s(e,"boolean",Ae,"rev"),this.oP=e)}get forest(){return this.rP}set forest(e){this.rP!==e&&(y.s(e,"boolean",Ae,"forest"),this.rP=e)}get portFromPos(){return this.lP}set portFromPos(e){this.lP!==e&&(y.s(e,"number",Ae,"portFromPos"),this.lP=e)}get portToPos(){return this.aP}set portToPos(e){this.aP!==e&&(y.s(e,"number",Ae,"portToPos"),this.aP=e)}get portFromColOffset(){return this.hP}set portFromColOffset(e){this.hP!==e&&(y.s(e,"number",Ae,"portFromColOffset"),this.hP=e)}get portToColOffset(){return this.cP}set portToColOffset(e){this.cP!==e&&(y.s(e,"number",Ae,"portToColOffset"),this.cP=e)}}var as=(m=>(m[m.Default=0]="Default",m[m.Destination=1]="Destination",m[m.Source=2]="Source",m))(as||{}),ls=(m=>(m[m.Forwards=10]="Forwards",m[m.Reverse=11]="Reverse",m[m.Ascending=12]="Ascending",m[m.Descending=13]="Descending",m))(ls||{}),hs=(m=>(m[m.CenterSubtrees=20]="CenterSubtrees",m[m.CenterChildren=21]="CenterChildren",m[m.Start=22]="Start",m[m.End=23]="End",m[m.Bus=24]="Bus",m[m.BusBranching=25]="BusBranching",m[m.TopLeftBus=26]="TopLeftBus",m[m.BottomRightBus=27]="BottomRightBus",m[m.Custom=28]="Custom",m))(hs||{}),cs=(m=>(m[m.None=30]="None",m[m.Block=31]="Block",m))(cs||{}),us=(m=>(m[m.Layered=40]="Layered",m[m.LastParents=41]="LastParents",m[m.Alternating=42]="Alternating",m[m.RootOnly=43]="RootOnly",m))(us||{}),ds=(m=>(m[m.Vertical=50]="Vertical",m[m.Horizontal=51]="Horizontal",m[m.FixedRoots=52]="FixedRoots",m))(ds||{}),Zs=(m=>(m[m.Individual=60]="Individual",m[m.Siblings=61]="Siblings",m[m.Uniform=62]="Uniform",m))(Zs||{});let ko=(()=>{class m extends se{Ie;Fe;wu;$g;yL;Xi;He;Us;V;B;fP;ws;constructor(t){super(),this.Ie=new z,this.Fe=0,this.ws=1,this.wu=40,this.$g=60,this.yL=[],this.Xi=!0,this.He=50,this.Us=new lt(10,10).k();const i=new fs(this);this.V=new Xt(i),this.B=new Xt(i),this.fP=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Fe=this.Fe,t.wu=this.wu,t.$g=this.$g,t.Xi=this.Xi,t.He=this.He,t.Us.h(this.Us),t.V.copyInheritedPropertiesFrom(this.V),t.B.copyInheritedPropertiesFrom(this.B)}fe(t){t in hs?this.alignment=t:t in ds?this.arrangement=t:t in cs?this.compaction=t:t in as?this.path=t:t in ls?this.sorting=t:t in us?this.treeStyle=t:super.fe(t)}createNetwork(){return new fs(this)}makeNetwork(t){const i=this.createNetwork(),s=n=>{if(n instanceof nt)return!n.isLinkLabel&&"Comment"!==n.category;if(n instanceof gt){const o=n.fromNode;if(null===o||o.isLinkLabel||"Comment"===o.category)return!1;const r=n.toNode;return!(null===r||r.isLinkLabel||"Comment"===r.category)}return!1};return t instanceof U?(i.addParts(t.nodes,!0,s),i.addParts(t.links,!0,s)):i.addParts(t instanceof pt?t.memberParts:t.iterator,!1,s),i}doLayout(t){null===this.network&&(this.network=this.makeNetwork(t)),52!==this.arrangement&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let i=this.diagram;null===i&&t instanceof U&&(i=t),this.ws=0===this.path&&null!==i?i.isTreePathToChildren?1:2:0===this.path?1:this.path,this.network.vertexes.count>0&&(this.oU(),this.rU(),this.lU(),this.aU(),this.fL(),this.hU(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Ie=new z,this.isValidLayout=!0}oU(){if(null===this.network)return;this.network.deleteSelfEdges();const t=this.network.vertexes.iterator;for(;t.next();){const o=t.value;o.initialized=!1,o.level=0,o.parent=null,o.children=[]}if(this.Ie.count>0){const o=new z,r=this.Ie.iterator;for(;r.next();){const a=r.value;if(a instanceof nt){const l=this.network.findVertex(a);null!==l&&o.add(l)}else a instanceof Xt&&o.add(a)}this.Ie=o}0===this.Ie.count&&this.findRoots();const i=this.Ie.copy().iterator;for(;i.next();){const o=i.value;o.initialized||(o.initialized=!0,this.wL(o))}let s=this.network.vertexes,n=null;for(;n=this.cU(s),n.count>0;){const o=this.AF(n);null!==o&&(this.Ie.add(o),o.initialized=!0,this.wL(o)),s=n}}cU(t){const i=new z,s=t.iterator;for(;s.next();){const n=s.value;n.initialized||i.add(n)}return i}findRoots(){if(null===this.network)return;const t=this.network.vertexes,i=t.iterator;for(;i.next();){const s=i.value;switch(this.ws){case 1:0===s.sourceEdges.count&&this.Ie.add(s);break;case 2:0===s.destinationEdges.count&&this.Ie.add(s);break;default:y.o("Unhandled path value "+this.ws.toString())}}if(0===this.Ie.count){const s=this.AF(t);null!==s&&this.Ie.add(s)}}AF(t){let i=999999,s=null;const n=t.iterator;for(;n.next();){const o=n.value;switch(this.ws){case 1:o.sourceEdges.count<i&&(i=o.sourceEdges.count,s=o);break;case 2:o.destinationEdges.count<i&&(i=o.destinationEdges.count,s=o);break;default:y.o("Unhandled path value "+this.ws.toString())}}return s}wL(t){if(null===t)return;switch(this.ws){case 1:if(t.destinationEdges.count>0){const n=new H,o=t.destinationVertexes;for(;o.next();){const r=o.value;this.TF(t,r)&&n.add(r)}n.count>0&&(t.children=n.toArray())}break;case 2:if(t.sourceEdges.count>0){const n=new H,o=t.sourceVertexes;for(;o.next();){const r=o.value;this.TF(t,r)&&n.add(r)}n.count>0&&(t.children=n.toArray())}break;default:y.o("Unhandled path value"+this.ws.toString())}const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];o.initialized=!0,o.level=t.level+1,o.parent=t,this.Ie.delete(o)}for(let n=0;n<s;n++)this.wL(i[n])}TF(t,i){return!i.initialized||!(this.fU(i,t)||i.level>t.level)&&(this.uU(i.parent,i),!0)}fU(t,i){if(null===i)return!1;let s=i.parent;for(;null!==s&&s!==t;)s=s.parent;return s===t}uU(t,i){if(null===t||null===i)return;const s=t.children;let n=0;for(let o=0;o<s.length;o++)s[o]===i&&n++;if(n>0){const o=new Array(s.length-n);let r=0;for(let a=0;a<s.length;a++)s[a]!==i&&(o[r++]=s[a]);t.children=o}}rU(){const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof Xt&&this.DF(i)}}DF(t){if(null===t)return;this.initializeTreeVertexValues(t),25===t.alignment&&this.sortTreeVertexChildren(t);let i=0,s=t.childrenCount,n=0;const o=t.children,r=o.length;for(let a=0;a<r;a++){const l=o[a];this.DF(l),i+=l.descendantCount+1,s=Math.max(s,l.maxChildrenCount),n=Math.max(n,l.maxGenerationCount)}t.descendantCount=i,t.maxChildrenCount=s,t.maxGenerationCount=s>0?n+1:0}dU(t){switch(this.wu){default:case 40:return null!==t.parent?t.parent:this.V;case 43:return null===t.parent?this.V:null===t.parent.parent?this.B:t.parent;case 42:return null!==t.parent?null!==t.parent.parent?t.parent.parent:this.B:this.V;case 41:{let i=!0;if(0===t.childrenCount)i=!1;else{const s=t.children,n=s.length;for(let o=0;o<n;o++)if(s[o].childrenCount>0){i=!1;break}}return i&&null!==t.parent?this.B:null!==t.parent?t.parent:this.V}}}initializeTreeVertexValues(t){const i=this.dU(t);if(t.copyInheritedPropertiesFrom(i),null!==t.parent&&25===t.parent.alignment){let s=t.angle;const n=t.parent.children;let o=0;for(;o<n.length&&t!==n[o];)o++;o%2==0?o!==n.length-1&&(s=90===s?180:180===s?270:270===s?180:270):s=90===s?0:180===s?90:270===s?0:90,t.angle=s}t.initialized=!0}lU(){const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof Xt&&this.vF(i)}}vF(t){if(null===t)return;this.assignTreeVertexValues(t);const i=t.children,s=i.length;for(let n=0;n<s;n++)this.vF(i[n])}assignTreeVertexValues(t){}aU(){const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof Xt&&this.FF(i)}}FF(t){if(null===t)return;25!==t.alignment&&this.sortTreeVertexChildren(t);const i=t.children,s=i.length;for(let n=0;n<s;n++)this.FF(i[n])}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse()}}fL(){if(!this.comments||null===this.network)return;const t=this.network.vertexes.iterator;for(;t.next();)this.addComments(t.value)}addComments(t){const i=t.angle,s=t.parent;let n=0,o=21,r=!1;null!==s&&(n=s.angle,o=s.alignment,r=this.isBusAlignment(o));const a=90===i||270===i,l=90===n||270===n,h=0===t.childrenCount;let c=0,u=0,d=0;const f=t.commentSpacing;if(null!==t.node){const p=t.node.findNodesConnected();for(;p.next();){const g=p.value;if("Comment"!==g.category||!g.canLayout())continue;null===t.comments&&(t.comments=[]),t.comments.push(g),g.ensureBounds();const b=g.measuredBounds;a&&!h||!r&&!l&&h||r&&l&&h?(c=Math.max(c,b.width),u+=b.height+Math.abs(d)):(c+=b.width+Math.abs(d),u=Math.max(u,b.height)),d=f}}if(null!==t.comments){a&&!h||!r&&!l&&h||r&&l&&h?(c+=Math.abs(t.commentMargin),u=Math.max(0,u-t.height)):(u+=Math.abs(t.commentMargin),c=Math.max(0,c-t.width));const p=j.z(0,0,t.bounds.width+c,t.bounds.height+u);t.bounds=p,j.i(p)}}isBusAlignment(t){return 24===t||25===t||26===t||27===t}vw(t){return 24===t||25===t}xL(t){const i=t.parent;if(null!==i){const s=i.alignment;if(this.isBusAlignment(s)){if(this.vw(s)){const n=i.children;let o=0;for(;o<n.length&&t!==n[o];)o++;return o%2==0}return 26===s}}return!1}layoutComments(t){if(null!==t.comments){const i=t.node.measuredBounds,s=t.parent,n=t.angle;let o=0,r=21,a=!1;null!==s&&(o=s.angle,r=s.alignment,a=this.isBusAlignment(r));const l=90===n||270===n,h=90===o||270===o,c=0===t.childrenCount,u=this.xL(t);let d=0;const f=t.comments,p=f.length,g=S.l();for(let x=0;x<p;x++){const v=f[x],P=v.measuredBounds;if(l&&!c||!a&&!h&&c||a&&h&&c){if(o>135&&!a||h&&u)if(t.commentMargin>=0){g.e(t.bounds.x-t.commentMargin-P.width,t.bounds.y+d),v.move(g);const w=v.findLinksInto();for(;w.next();){const M=w.value;M.fromSpot=A.MiddleLeft,M.toSpot=A.MiddleRight}}else{g.e(t.bounds.x+2*t.focus.x-t.commentMargin,t.bounds.y+d),v.move(g);const w=v.findLinksInto();for(;w.next();){const M=w.value;M.fromSpot=A.MiddleRight,M.toSpot=A.MiddleLeft}}else if(t.commentMargin>=0){g.e(t.bounds.x+2*t.focus.x+t.commentMargin,t.bounds.y+d),v.move(g);const w=v.findLinksInto();for(;w.next();){const M=w.value;M.fromSpot=A.MiddleRight,M.toSpot=A.MiddleLeft}}else{g.e(t.bounds.x+t.commentMargin-P.width,t.bounds.y+d),v.move(g);const w=v.findLinksInto();for(;w.next();){const M=w.value;M.fromSpot=A.MiddleLeft,M.toSpot=A.MiddleRight}}d+=t.commentSpacing>=0?P.height+t.commentSpacing:t.commentSpacing-P.height}else{if(o>135&&!a||!h&&u)if(t.commentMargin>=0){g.e(t.bounds.x+d,t.bounds.y-t.commentMargin-P.height),v.move(g);const w=v.findLinksInto();for(;w.next();){const M=w.value;M.fromSpot=A.MiddleTop,M.toSpot=A.MiddleBottom}}else{g.e(t.bounds.x+d,t.bounds.y+2*t.focus.y-t.commentMargin),v.move(g);const w=v.findLinksInto();for(;w.next();){const M=w.value;M.fromSpot=A.MiddleBottom,M.toSpot=A.MiddleTop}}else if(t.commentMargin>=0){g.e(t.bounds.x+d,t.bounds.y+2*t.focus.y+t.commentMargin),v.move(g);const w=v.findLinksInto();for(;w.next();){const M=w.value;M.fromSpot=A.MiddleBottom,M.toSpot=A.MiddleTop}}else{g.e(t.bounds.x+d,t.bounds.y+t.commentMargin-P.height),v.move(g);const w=v.findLinksInto();for(;w.next();){const M=w.value;M.fromSpot=A.MiddleTop,M.toSpot=A.MiddleBottom}}d+=t.commentSpacing>=0?P.width+t.commentSpacing:t.commentSpacing-P.width}}S.i(g);const b=d-t.commentSpacing-(l?i.height:i.width);if(1===this.ws){const x=t.destinationEdges;for(;x.next();){const v=x.value.link;null!==v&&!v.isAvoiding&&(v.fromEndSegmentLength=b>0?b:NaN)}}else{const x=t.sourceEdges;for(;x.next();){const v=x.value.link;null!==v&&!v.isAvoiding&&(v.toEndSegmentLength=b>0?b:NaN)}}}}hU(){if(null===this.network)return;if(62===this.layerStyle){const i=[];let s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;let o=n.parent;null===o&&(o=n);let a=i[n.level];void 0===a&&(a=0),i[n.level]=Math.max(a,0===o.angle||180===o.angle?n.width:n.height)}for(let n=0;n<i.length;n++)void 0===i[n]&&(i[n]=0);for(this.yL=i,s=this.network.vertexes.iterator;s.next();){const n=s.value;let o=n.parent;null===o&&(o=n),0===o.angle||180===o.angle?(180===o.angle&&(n.focusX+=i[n.level]-n.width),n.width=i[n.level]):(270===o.angle&&(n.focusY+=i[n.level]-n.height),n.height=i[n.level])}}else if(61===this.layerStyle){const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value,n=0===s.angle||180===s.angle;let o=-1;for(let r=0;r<s.children.length;r++){const a=s.children[r];o=Math.max(o,n?a.width:a.height)}if(o>=0)for(let r=0;r<s.children.length;r++){const a=s.children[r];n?(180===s.angle&&(a.focusX+=o-a.width),a.width=o):(270===s.angle&&(a.focusY+=o-a.height),a.height=o)}}}const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof Xt&&this.layoutTree(i)}}layoutTree(t){if(null===t)return;const i=t.children,s=i.length;for(let n=0;n<s;n++)this.layoutTree(i[n]);30===t.compaction||25===t.alignment?this.RF(t):this.gU(t)}RF(t){if(0===t.childrenCount){let $=!1,K=0,Z=21;null!==t.parent&&(K=t.parent.angle,Z=t.parent.alignment,$=this.isBusAlignment(Z));const it=this.xL(t);return t.U.e(0,0),t.dt.e(t.width,t.height),void(null===t.parent||null===t.comments||(180!==K&&270!==K||$)&&!it?t.at.e(0,0):180===K&&!$||(90===K||270===K)&&it?t.at.e(t.width-2*t.focus.x,0):t.at.e(0,t.height-2*t.focus.y))}const i=this.orthoAngle(t),s=90===i||270===i;let n=0;const o=t.children,r=o.length;for(let $=0;$<r;$++){const K=o[$];n=Math.max(n,s?K.dt.width:K.dt.height)}const a=t.alignment,l=22===a,h=23===a,c=this.isBusAlignment(a),u=Math.max(0,t.breadthLimit),d=this.computeLayerSpacing(t),f=t.nodeSpacing,p=this.computeNodeIndent(t),g=l||h?0:p/2,b=t.rowSpacing;let x=0;(l||h)&&(x=Math.max(0,t.rowIndent));const v=t.width,P=t.height;let w=0,M=0,C=0,N=0,I=0,T=0,D=0,F=0,E=0,B=0;if(c&&!this.vw(a)&&i>135&&o.reverse(),this.vw(a))if(r>1)for(let $=0;$<r;$++){const K=o[$],Z=K.dt;$%2==0&&$!==r-1?E=Math.max(E,(s?Z.width:Z.height)+this.computeBusNodeSpacing(K)-f):$%2!=0&&(B=Math.max(B,(s?Z.width:Z.height)+this.computeBusNodeSpacing(K)-f))}else 1===r&&(E=s?o[0].dt.width:o[0].dt.height);if(c)switch(a){case 24:case 25:const $=j.l();i<135?this.OF(t,o,E,B,w,M,$):this.IF(t,o,E,B,w,M,$),E=$.x,w=$.width,M=$.height,j.i($);break;case 26:for(let K=0;K<r;K++){const Z=o[K],it=Z.dt,yt=0===D?0:b;s?(Z.U.e(n-it.width,I+yt),w=Math.max(w,it.width),M=Math.max(M,I+yt+it.height),I+=yt+it.height):(Z.U.e(N+yt,n-it.height),w=Math.max(w,N+yt+it.width),M=Math.max(M,it.height),N+=yt+it.width),D++}break;case 27:for(let K=0;K<r;K++){const Z=o[K],it=Z.dt,yt=0===D?0:b;s?(Z.U.e(f/2+t.focus.x,I+yt),w=Math.max(w,it.width),M=Math.max(M,I+yt+it.height),I+=yt+it.height):(Z.U.e(N+yt,f/2+t.focus.y),w=Math.max(w,N+yt+it.width),M=Math.max(M,it.height),N+=yt+it.width),D++}}else for(let $=0;$<r;$++){const K=o[$],Z=K.dt;if(s){u>0&&D>0&&N+f+Z.width>u&&(N<n&&this.yc(t,a,n-N,0,F,$-1),T++,D=0,F=$,C=M,N=0,I=i>135?-M-b:M+b);const it=0===D?g:f;this.uP(K,0,I),K.U.e(N+it,I),w=Math.max(w,N+it+Z.width),M=Math.max(M,C+(0===T?0:b)+Z.height),N+=it+Z.width}else{u>0&&D>0&&I+f+Z.height>u&&(I<n&&this.yc(t,a,0,n-I,F,$-1),T++,D=0,F=$,C=w,I=0,N=i>135?-w-b:w+b);const it=0===D?g:f;this.uP(K,N,0),K.U.e(N,I+it),M=Math.max(M,I+it+Z.height),w=Math.max(w,C+(0===T?0:b)+Z.width),I+=it+Z.height}D++}T>0&&(s?(M+=Math.max(0,d),N<w&&this.yc(t,a,w-N,0,F,r-1),x>0&&(h||this.xu(t,x,0,0,r-1),w+=x)):(w+=Math.max(0,d),I<M&&this.yc(t,a,0,M-I,F,r-1),x>0&&(h||this.xu(t,0,x,0,r-1),M+=x)));let Y=0,W=0;switch(a){case 20:s?Y+=w/2-t.focus.x-p/2:W+=M/2-t.focus.y-p/2;break;default:case 21:if(T>0)s?Y+=w/2-t.focus.x-p/2:W+=M/2-t.focus.y-p/2;else if(s){const Z=o[0].U.x+o[0].at.x;Y+=Z+(o[r-1].U.x+o[r-1].at.x+2*o[r-1].focus.x-Z)/2-t.focus.x-p/2}else{const Z=o[0].U.y+o[0].at.y;W+=Z+(o[r-1].U.y+o[r-1].at.y+2*o[r-1].focus.y-Z)/2-t.focus.y-p/2}break;case 22:s?(Y-=p,w+=p):(W-=p,M+=p);break;case 23:s?(Y+=w-t.width+p,w+=p):(W+=M-t.height+p,M+=p);break;case 24:case 25:s?Y+=r>1?E+f/2-t.focus.x:o[0].focus.x-t.focus.x+o[0].at.x:W+=r>1?E+f/2-t.focus.y:o[0].focus.y-t.focus.y+o[0].at.y;break;case 26:s?Y+=w+f/2-t.focus.x:W+=M+f/2-t.focus.y;break;case 27:break;case 28:const $=this.customAlignment(t,Y,W,w,M);Y=$[0],W=$[1],w=$[2],M=$[3]}for(let $=0;$<r;$++){const K=o[$];s?K.U.e(K.U.x+K.at.x-Y,K.U.y+(i>135?(c?-M:-K.dt.height)+K.at.y-d:P+d+K.at.y)):K.U.e(K.U.x+(i>135?(c?-w:-K.dt.width)+K.at.x-d:v+d+K.at.x),K.U.y+K.at.y-W)}s?(w=this.bL(t,w,Y),Y<0&&(Y=0),i>135&&(W+=M+d),M=Math.max(Math.max(M,P),M+P+d)):(i>135&&(Y+=w+d),w=Math.max(Math.max(w,v),w+v+d),M=this.kL(t,M,W),W<0&&(W=0)),t.at.e(Y,W),t.dt.e(w,M)}customAlignment(t,i,s,n,o){return[i,s,n,o]}OF(t,i,s,n,o,r,a){const l=i.length;if(0===l)return a.e(s,0,o,r),a;if(1===l){const x=i[0];return a.e(s,0,o=x.dt.width,r=x.dt.height),a}const h=t.nodeSpacing,c=t.rowSpacing,u=90===this.orthoAngle(t);let d=0,f=0,p=0;for(let x=0;x<l;x++){if(x%2!=0||l>1&&x===l-1)continue;const v=i[x],P=v.dt,w=0===d?0:c;if(u){const M=this.computeBusNodeSpacing(v)-h;v.U.e(s-(P.width+M),p+w),o=Math.max(o,P.width+M),r=Math.max(r,p+w+P.height),p+=w+P.height}else{const M=this.computeBusNodeSpacing(v)-h;v.U.e(f+w,s-(P.height+M)),r=Math.max(r,P.height+M),o=Math.max(o,f+w+P.width),f+=w+P.width}d++}d=0;const g=f,b=p;u?(f=s+h,p=0):(f=0,p=s+h);for(let x=0;x<l;x++){if(x%2==0)continue;const v=i[x],P=v.dt,w=0===d?0:c;if(u){const M=this.computeBusNodeSpacing(v)-h;v.U.e(f+M,p+w),o=Math.max(o,f+P.width+M),r=Math.max(r,p+w+P.height),p+=w+P.height}else{const M=this.computeBusNodeSpacing(v)-h;v.U.e(f+w,p+M),o=Math.max(o,f+w+P.width),r=Math.max(r,p+P.height+M),f+=w+P.width}d++}if(l>1&&l%2==1){const x=i[l-1],v=x.dt,P=this.computeBusLastRowSpacing(x,u?Math.max(Math.abs(b),Math.abs(p)):Math.max(Math.abs(g),Math.abs(f)));if(u){x.U.e(s+h/2-x.focus.x-x.at.x,r+P);const w=s+h/2-x.focus.x-x.at.x;o=Math.max(o,w+v.width),w<0&&(o-=w),r=Math.max(r,Math.max(b,p)+P+v.height),x.U.x<0&&(s=this.dP(t,x.U.x,!1,s,h))}else{x.U.e(o+P,s+h/2-x.focus.y-x.at.y),o=Math.max(o,Math.max(g,f)+P+v.width);const w=s+h/2-x.focus.y-x.at.y;r=Math.max(r,w+v.height),w<0&&(r-=w),x.U.y<0&&(s=this.dP(t,x.U.y,!0,s,h))}}return a.e(s,0,o,r),a}IF(t,i,s,n,o,r,a){const l=i.length;if(0===l)return a.e(s,0,o,r),a;if(1===l){const x=i[0];return a.e(s,0,o=x.dt.width,r=x.dt.height),a}const h=t.nodeSpacing,c=t.rowSpacing,u=270===this.orthoAngle(t);let d=0,f=0,p=0;for(let x=0;x<l;x++){if(x%2!=0||l>1&&x===l-1)continue;const v=i[x],P=v.dt,w=0===d?0:c;if(u){const M=this.computeBusNodeSpacing(v)-h;p-=w+P.height,v.U.e(s-(P.width+M),p),o=Math.max(o,P.width+M),r=Math.max(r,Math.abs(p))}else{const M=this.computeBusNodeSpacing(v)-h;f-=w+P.width,v.U.e(f,s-(P.height+M)),r=Math.max(r,P.height+M),o=Math.max(o,Math.abs(f))}d++}d=0;const g=f,b=p;u?(f=s+h,p=0):(f=0,p=s+h);for(let x=0;x<l;x++){if(x%2==0)continue;const v=i[x],P=v.dt,w=0===d?0:c;if(u){const M=this.computeBusNodeSpacing(v)-h;p-=w+P.height,v.U.e(f+M,p),o=Math.max(o,f+P.width+M),r=Math.max(r,Math.abs(p))}else{const M=this.computeBusNodeSpacing(v)-h;f-=w+P.width,v.U.e(f,p+M),r=Math.max(r,p+P.height+M),o=Math.max(o,Math.abs(f))}d++}if(l>1&&l%2==1){const x=i[l-1],v=x.dt,P=this.computeBusLastRowSpacing(x,u?Math.max(Math.abs(b),Math.abs(p)):Math.max(Math.abs(g),Math.abs(f)));if(u){x.U.e(s+h/2-x.focus.x-x.at.x,-r-v.height-P);const w=s+h/2-x.focus.x-x.at.x;o=Math.max(o,w+v.width),w<0&&(o-=w),r=Math.max(r,Math.abs(Math.min(b,p))+P+v.height),x.U.x<0&&(s=this.dP(t,x.U.x,!1,s,h))}else{x.U.e(-o-v.width-P,s+h/2-x.focus.y-x.at.y),o=Math.max(o,Math.abs(Math.min(g,f))+P+v.width);const w=s+h/2-x.focus.y-x.at.y;r=Math.max(r,w+v.height),w<0&&(r-=w),x.U.y<0&&(s=this.dP(t,x.U.y,!0,s,h))}}for(let x=0;x<l;x++){const v=i[x];u?v.U.e(v.U.x,v.U.y+r):v.U.e(v.U.x+o,v.U.y)}return a.e(s,0,o,r),a}computeBusNodeSpacing(t){return null===t.parent?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,i){return null===t.parent?0:t.parent.rowSpacing}dP(t,i,s,n,o){const r=t.children,a=r.length;for(let h=0;h<a;h++)s?r[h].U.e(r[h].U.x,r[h].U.y-i):r[h].U.e(r[h].U.x-i,r[h].U.y);const l=r[a-1];return Math.max(n,s?l.at.y+l.focus.y-o/2:l.at.x+l.focus.x-o/2)}bL(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.width>n&&(n=s+t.width),s<0&&(n-=s),n;case 22:return t.width>i?t.width:i;case 23:return 2*t.focus.x>i?t.width:i+t.width-2*t.focus.x;case 24:case 25:const o=Math.min(0,s),r=Math.max(i,s+t.width);return Math.max(t.width,r-o);case 26:return t.width-t.focus.x+t.nodeSpacing/2+i;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+i);default:return i}}kL(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.height>n&&(n=s+t.height),s<0&&(n-=s),n;case 22:return t.height>i?t.height:i;case 23:return 2*t.focus.y>i?t.height:i+t.height-2*t.focus.y;case 24:case 25:const o=Math.min(0,s),r=Math.max(i,s+t.height);return Math.max(t.height,r-o);case 26:return t.height-t.focus.y+t.nodeSpacing/2+i;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+i);default:return i}}PL(t,i,s){switch(t){case 20:case 21:i/=2,s/=2;break;case 22:i=0,s=0;break;case 23:break;default:y.o("Unhandled alignment value "+t.toString())}return new S(i,s)}yc(t,i,s,n,o,r){const a=this.PL(i,s,n);this.xu(t,a.x,a.y,o,r)}xu(t,i,s,n,o){if(0===i&&0===s)return;const r=t.children;for(let a=n;a<=o;a++){const l=r[a].U;l.x+=i,l.y+=s}}uP(t,i,s){const n=t.parent;switch(this.ws){case 1:{const o=t.sourceEdges;for(;o.next();){const r=o.value;r.fromVertex===n&&r.relativePoint.e(i,s)}break}case 2:{const o=t.destinationEdges;for(;o.next();){const r=o.value;r.toVertex===n&&r.relativePoint.e(i,s)}break}default:y.o("Unhandled path value "+this.ws.toString())}}gU(t){if(0===t.childrenCount){const ft=t.parent;let ut=!1,kt=0,Mt=21;null!==ft&&(kt=ft.angle,Mt=ft.alignment,ut=this.isBusAlignment(Mt));const et=this.xL(t);return t.U.e(0,0),t.dt.e(t.width,t.height),null===t.parent||null===t.comments||(180!==kt&&270!==kt||ut)&&!et?t.at.e(0,0):180===kt&&!ut||(90===kt||270===kt)&&et?t.at.e(t.width-2*t.focus.x,0):t.at.e(0,t.height-2*t.focus.y),t.Zg=null,void(t.Qg=null)}const i=this.orthoAngle(t),s=90===i||270===i;let n=0;const o=t.children,r=o.length;for(let ft=0;ft<r;ft++){const ut=o[ft];n=Math.max(n,s?ut.dt.width:ut.dt.height)}const a=t.alignment,l=22===a,h=23===a,c=this.isBusAlignment(a),u=Math.max(0,t.breadthLimit),d=this.computeLayerSpacing(t),f=t.nodeSpacing,p=this.computeNodeIndent(t),g=t.rowSpacing;let b=0;(l||h)&&(b=Math.max(0,t.rowIndent));const x=t.width,v=t.height;let P=0,w=0,M=0,C=null,N=null,I=0,T=0,D=0,F=0,E=0,B=0,Y=0,W=0,$=0;if(c&&!this.vw(a)&&i>135&&o.reverse(),this.vw(a))if(r>1)for(let ft=0;ft<r;ft++)ft%2==0&&ft!==r-1?W=Math.max(W,s?o[ft].dt.width:o[ft].dt.height):ft%2!=0&&($=Math.max($,s?o[ft].dt.width:o[ft].dt.height));else 1===r&&(W=s?o[0].dt.width:o[0].dt.height);if(c){switch(a){case 24:const ft=j.l();i<135?this.OF(t,o,W,$,P,w,ft):this.IF(t,o,W,$,P,w,ft),W=ft.x,P=ft.width,w=ft.height,j.i(ft);break;case 26:for(let ut=0;ut<r;ut++){const kt=o[ut],Mt=kt.dt,et=0===B?0:g;s?(kt.U.e(n-Mt.width,F+et),P=Math.max(P,Mt.width),w=Math.max(w,F+et+Mt.height),F+=et+Mt.height):(kt.U.e(D+et,n-Mt.height),P=Math.max(P,D+et+Mt.width),w=Math.max(w,Mt.height),D+=et+Mt.width),B++}break;case 27:for(let ut=0;ut<r;ut++){const kt=o[ut],Mt=kt.dt,et=0===B?0:g;s?(kt.U.e(f/2+t.focus.x,F+et),P=Math.max(P,Mt.width),w=Math.max(w,F+et+Mt.height),F+=et+Mt.height):(kt.U.e(D+et,f/2+t.focus.y),P=Math.max(P,D+et+Mt.width),w=Math.max(w,Mt.height),D+=et+Mt.width),B++}}C=this.pi(2),N=this.pi(2),s?(C[0].e(0,0),C[1].e(0,w),N[0].e(P,0),N[1].e(P,w)):(C[0].e(0,0),C[1].e(P,0),N[0].e(0,w),N[1].e(P,w))}else for(let ft=0;ft<r;ft++){const ut=o[ft],kt=ut.dt;if(s){u>0&&B>0&&D+f+kt.width>u&&(D<n&&this.yc(t,a,n-D,0,Y,ft-1),E++,B=0,Y=ft,M=w,D=0,F=i>135?-w-g:w+g),this.uP(ut,0,F);let Mt=0;if(0===B)C=ut.Zg,N=ut.Qg,I=kt.width,T=kt.height,(null===C||null===N||i!==this.orthoAngle(ut))&&(C=this.pi(2),N=this.pi(2),C[0].e(0,0),C[1].e(0,T),N[0].e(I,0),N[1].e(I,T));else{const et=y.nt(),Pt=j.l();this.EF(t,ut,C,N,I,T,et,Pt),Mt=Pt.x,C=et[0],N=et[1],I=Pt.width,T=Pt.height,y.Z(et),D<kt.width&&Mt<0&&(this.xu(t,-Mt,0,Y,ft-1),this.gP(C,-Mt,0),this.gP(N,-Mt,0),Mt=0),j.i(Pt)}ut.U.e(Mt,F),P=Math.max(P,I),w=Math.max(w,M+(0===E?0:g)+kt.height),D=I}else{u>0&&B>0&&F+f+kt.height>u&&(F<n&&this.yc(t,a,0,n-F,Y,ft-1),E++,B=0,Y=ft,M=P,F=0,D=i>135?-P-g:P+g),this.uP(ut,D,0);let Mt=0;if(0===B)C=ut.Zg,N=ut.Qg,I=kt.width,T=kt.height,(null===C||null===N||i!==this.orthoAngle(ut))&&(C=this.pi(2),N=this.pi(2),C[0].e(0,0),C[1].e(I,0),N[0].e(0,T),N[1].e(I,T));else{const et=y.nt(),Pt=j.l();this.EF(t,ut,C,N,I,T,et,Pt),Mt=Pt.x,C=et[0],N=et[1],I=Pt.width,T=Pt.height,y.Z(et),F<kt.height&&Mt<0&&(this.xu(t,0,-Mt,Y,ft-1),this.gP(C,0,-Mt),this.gP(N,0,-Mt),Mt=0),j.i(Pt)}ut.U.e(D,Mt),w=Math.max(w,T),P=Math.max(P,M+(0===E?0:g)+kt.width),F=T}B++}E>0&&(s?(w+=Math.max(0,d),D<P&&this.yc(t,a,P-D,0,Y,r-1),b>0&&(h||this.xu(t,b,0,0,r-1),P+=b)):(P+=Math.max(0,d),F<w&&this.yc(t,a,0,w-F,Y,r-1),b>0&&(h||this.xu(t,0,b,0,r-1),w+=b)));let K=0,Z=0;switch(a){case 20:s?K+=P/2-t.focus.x-p/2:Z+=w/2-t.focus.y-p/2;break;default:case 21:if(E>0)s?K+=P/2-t.focus.x-p/2:Z+=w/2-t.focus.y-p/2;else if(s){const kt=o[0].U.x+o[0].at.x;K+=kt+(o[r-1].U.x+o[r-1].at.x+2*o[r-1].focus.x-kt)/2-t.focus.x-p/2}else{const kt=o[0].U.y+o[0].at.y;Z+=kt+(o[r-1].U.y+o[r-1].at.y+2*o[r-1].focus.y-kt)/2-t.focus.y-p/2}break;case 22:s?(K-=p,P+=p):(Z-=p,w+=p);break;case 23:s?(K+=P-t.width+p,P+=p):(Z+=w-t.height+p,w+=p);break;case 24:s?K+=r>1?W+f/2-t.focus.x:o[0].focus.x-t.focus.x+o[0].at.x:Z+=r>1?W+f/2-t.focus.y:o[0].focus.y-t.focus.y+o[0].at.y;break;case 26:s?K+=P+f/2-t.focus.x:Z+=w+f/2-t.focus.y;break;case 27:break;case 28:const ft=this.customAlignment(t,K,Z,P,w);K=ft[0],Z=ft[1],P=ft[2],w=ft[3]}for(let ft=0;ft<r;ft++){const ut=o[ft];s?ut.U.e(ut.U.x+ut.at.x-K,ut.U.y+(i>135?(c?-w:-ut.dt.height)+ut.at.y-d:v+d+ut.at.y)):ut.U.e(ut.U.x+(i>135?(c?-P:-ut.dt.width)+ut.at.x-d:x+d+ut.at.x),ut.U.y+ut.at.y-Z)}let ot,at,it=0,yt=0;if(c)s?(P=this.bL(t,P,K),K<0&&(K=0),i>135&&(Z+=w+d),w+=v+d,27===a&&(it+=f/2+t.focus.x),yt+=v+d):(i>135&&(K+=P+d),P+=x+d,w=this.kL(t,w,Z),Z<0&&(Z=0),27===a&&(yt+=f/2+t.focus.y),it+=x+d);else if(s){if(null===t.comments){if(x>P){const ft=this.PL(a,x-P,0);it=ft.x,yt=ft.y,P=x,K=0}}else P=this.bL(t,P,K);K<0&&(it-=K,K=0),i>135&&(Z+=w+d),w=Math.max(Math.max(w,v),w+v+d),yt+=v+d}else{if(i>135&&(K+=P+d),P=Math.max(Math.max(P,x),P+x+d),null===t.comments){if(v>w){const ft=this.PL(a,0,v-w);it=ft.x,yt=ft.y,w=v,Z=0}}else w=this.kL(t,w,Z);Z<0&&(yt-=Z,Z=0),it+=x+d}if(E>0)ot=this.pi(4),at=this.pi(4),s?(ot[2].e(0,v+d),ot[3].e(ot[2].x,w),at[2].e(P,ot[2].y),at[3].e(at[2].x,ot[3].y)):(ot[2].e(x+d,0),ot[3].e(P,ot[2].y),at[2].e(ot[2].x,w),at[3].e(ot[3].x,at[2].y));else{ot=this.pi(C.length+2),at=this.pi(N.length+2);for(let ft=0;ft<C.length;ft++){const ut=C[ft];ot[ft+2].e(ut.x+it,ut.y+yt)}for(let ft=0;ft<N.length;ft++){const ut=N[ft];at[ft+2].e(ut.x+it,ut.y+yt)}}s?(ot[0].e(K,0),ot[1].e(ot[0].x,v),ot[2].y<ot[1].y&&(ot[2].x>ot[0].x?ot[2].h(ot[1]):ot[1].h(ot[2])),ot[3].y<ot[2].y&&(ot[3].x>ot[0].x?ot[3].h(ot[2]):ot[2].h(ot[3])),at[0].e(K+x,0),at[1].e(at[0].x,v),at[2].y<at[1].y&&(at[2].x<at[0].x?at[2].h(at[1]):at[1].h(at[2])),at[3].y<at[2].y&&(at[3].x<at[0].x?at[3].h(at[2]):at[2].h(at[3])),ot[2].y-=d/2,at[2].y-=d/2):(ot[0].e(0,Z),ot[1].e(x,ot[0].y),ot[2].x<ot[1].x&&(ot[2].y>ot[0].y?ot[2].h(ot[1]):ot[1].h(ot[2])),ot[3].x<ot[2].x&&(ot[3].y>ot[0].y?ot[3].h(ot[2]):ot[2].h(ot[3])),at[0].e(0,Z+v),at[1].e(x,at[0].y),at[2].x<at[1].x&&(at[2].y<at[0].y?at[2].h(at[1]):at[1].h(at[2])),at[3].x<at[2].x&&(at[3].y<at[0].y?at[3].h(at[2]):at[2].h(at[3])),ot[2].x-=d/2,at[2].x-=d/2),this.un(C),this.un(N),t.Zg=ot,t.Qg=at,t.at.e(K,Z),t.dt.e(P,w)}gP(t,i,s){for(let n=0;n<t.length;n++){const o=t[n];o.x+=i,o.y+=s}}EF(t,i,s,n,o,r,a,l){const h=this.orthoAngle(t),c=90===h||270===h,u=t.nodeSpacing,d=s,f=n,p=o,g=r;let b=i.Zg,x=i.Qg;const v=i.dt,P=c?Math.max(g,v.height):Math.max(p,v.width);if((null===b||h!==this.orthoAngle(i))&&(b=this.pi(2),x=this.pi(2),c?(b[0].e(0,0),b[1].e(0,v.height),x[0].e(v.width,0),x[1].e(x[0].x,b[1].y)):(b[0].e(0,0),b[1].e(v.width,0),x[0].e(0,v.height),x[1].e(b[1].x,x[0].y))),c){let M=p-this.mU(f,b,p);return M+=u,s=this.pU(d,b,M),n=this.yU(f,x,M),o=Math.max(0,M)+v.width,r=P,this.un(d),this.un(b),this.un(f),this.un(x),a[0]=s,a[1]=n,l.e(M,0,o,r),l}{let M=g-this.wU(f,b,g);return M+=u,s=this.xU(d,b,M),n=this.bU(f,x,M),o=P,r=Math.max(0,M)+v.height,this.un(d),this.un(b),this.un(f),this.un(x),a[0]=s,a[1]=n,l.e(M,0,o,r),l}}xU(t,i,s){if(null===t||t.length<2||null===i||i.length<2)return null;const n=this.pi(t.length+i.length);let o=0,r=0,a=0;for(;r<i.length&&i[r].x<t[0].x;){const c=i[r++];n[a++].e(c.x,c.y+s)}for(;o<t.length;){const c=t[o++];n[a++].e(c.x,c.y)}const l=t[t.length-1].x;for(;r<i.length&&i[r].x<=l;)r++;for(;r<i.length&&i[r].x>l;){const c=i[r++];n[a++].e(c.x,c.y+s)}const h=this.pi(a);for(o=0;o<a;o++)h[o].h(n[o]);return this.un(n),h}pU(t,i,s){if(null===t||t.length<2||null===i||i.length<2)return null;const n=this.pi(t.length+i.length);let o=0,r=0,a=0;for(;r<i.length&&i[r].y<t[0].y;){const c=i[r++];n[a++].e(c.x+s,c.y)}for(;o<t.length;){const c=t[o++];n[a++].e(c.x,c.y)}const l=t[t.length-1].y;for(;r<i.length&&i[r].y<=l;)r++;for(;r<i.length&&i[r].y>l;){const c=i[r++];n[a++].e(c.x+s,c.y)}const h=this.pi(a);for(o=0;o<a;o++)h[o].h(n[o]);return this.un(n),h}bU(t,i,s){if(null===t||t.length<2||null===i||i.length<2)return null;const n=this.pi(t.length+i.length);let o=0,r=0,a=0;for(;o<t.length&&t[o].x<i[0].x;){const c=t[o++];n[a++].e(c.x,c.y)}for(;r<i.length;){const c=i[r++];n[a++].e(c.x,c.y+s)}const l=i[i.length-1].x;for(;o<t.length&&t[o].x<=l;)o++;for(;o<t.length&&t[o].x>l;){const c=t[o++];n[a++].e(c.x,c.y)}const h=this.pi(a);for(o=0;o<a;o++)h[o].h(n[o]);return this.un(n),h}yU(t,i,s){if(null===t||t.length<2||null===i||i.length<2)return null;const n=this.pi(t.length+i.length);let o=0,r=0,a=0;for(;o<t.length&&t[o].y<i[0].y;){const c=t[o++];n[a++].e(c.x,c.y)}for(;r<i.length;){const c=i[r++];n[a++].e(c.x+s,c.y)}const l=i[i.length-1].y;for(;o<t.length&&t[o].y<=l;)o++;for(;o<t.length&&t[o].y>l;){const c=t[o++];n[a++].e(c.x,c.y)}const h=this.pi(a);for(o=0;o<a;o++)h[o].h(n[o]);return this.un(n),h}wU(t,i,s){let n=9999999;if(null===t||t.length<2||null===i||i.length<2)return n;let o=0,r=0;for(;o<t.length&&r<i.length;){const a=t[o],l=i[r],h=l.x;let c=l.y;c+=s;let u=a;o+1<t.length&&(u=t[o+1]);let d=l,f=d.x,p=d.y;r+1<i.length&&(d=i[r+1],f=d.x,p=d.y,p+=s);let g=n;a.x===h?g=c-a.y:a.x>h&&a.x<f?g=c+(a.x-h)/(f-h)*(p-c)-a.y:h>a.x&&h<u.x&&(g=c-(a.y+(h-a.x)/(u.x-a.x)*(u.y-a.y))),g<n&&(n=g),u.x<=a.x?o++:f<=h?r++:(u.x<=f&&o++,f<=u.x&&r++)}return n}mU(t,i,s){let n=9999999;if(null===t||t.length<2||null===i||i.length<2)return n;let o=0,r=0;for(;o<t.length&&r<i.length;){const a=t[o],l=i[r];let h=l.x;const c=l.y;h+=s;let u=a;o+1<t.length&&(u=t[o+1]);let d=l,f=d.x,p=d.y;r+1<i.length&&(d=i[r+1],f=d.x,p=d.y,f+=s);let g=n;a.y===c?g=h-a.x:a.y>c&&a.y<p?g=h+(a.y-c)/(p-c)*(f-h)-a.x:c>a.y&&c<u.y&&(g=h-(a.x+(c-a.y)/(u.y-a.y)*(u.x-a.x))),g<n&&(n=g),u.y<=a.y?o++:p<=c?r++:(u.y<=p&&o++,p<=u.y&&r++)}return n}pi(t){const i=this.fP[t];if(void 0!==i){const n=i.pop();if(void 0!==n)return n}const s=[];for(let n=0;n<t;n++)s[n]=new S;return s}un(t){if(!t)return;const i=t.length;let s=this.fP[i];void 0===s&&(s=[],this.fP[i]=s),s.push(t)}arrangeTrees(){if(52===this.He){const t=this.Ie.iterator;for(;t.next();){const i=t.value;if(!(i instanceof Xt))continue;const s=i.node;if(null===s)continue;const n=s.position;let o=n.x,r=n.y;isFinite(o)||(o=0),isFinite(r)||(r=0),this.SL(i,o,r)}}else{const t=[],i=this.Ie.iterator;for(;i.next();){const r=i.value;r instanceof Xt&&t.push(r)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse()}const s=this.arrangementOrigin;let n=s.x,o=s.y;for(let r=0;r<t.length;r++){const a=t[r];50===(this.SL(a,n+a.at.x,o+a.at.y),this.He)?o+=a.dt.height+this.Us.height:n+=a.dt.width+this.Us.width}}}SL(t,i,s){if(null===t)return;t.x=i,t.y=s;const n=t.children,o=n.length;for(let r=0;r<o;r++){const a=n[r];this.SL(a,i+a.U.x,s+a.U.y)}}commitLayout(){this.Pw(),this.commitNodes(),this.pL(),this.isRouting&&this.commitLinks()}commitNodes(){if(null===this.network)return;const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();)this.layoutComments(t.value)}pL(){if(null===this.network||62!==this.layerStyle)return;const t=this.yL,i=[];let s;const n=this.network.vertexes.iterator;for(;n.next();){const h=n.value;void 0===s?s=h.bounds.copy():s.unionRect(h.bounds);let c=i[h.level];c=void 0===c?this.computeLayerSpacing(h):Math.max(c,this.computeLayerSpacing(h)),i[h.level]=c}if(!s)return;for(let h=0;h<i.length;h++)void 0===i[h]&&(i[h]=0);let o;90===this.angle||270===this.angle?(s.inflate(this.nodeSpacing/2,this.layerSpacing),o=new S(-this.nodeSpacing/2,-this.layerSpacing/2)):(s.inflate(this.layerSpacing,this.nodeSpacing/2),o=new S(-this.layerSpacing/2,-this.nodeSpacing/2));const r=[],a=90===this.angle||270===this.angle?s.width:s.height;let l=0;if(180===this.angle||270===this.angle)for(let h=0;h<t.length;h++)l+=t[h]+i[h];for(let h=0;h<t.length;h++){const c=t[h]+i[h];270===this.angle?(l-=c,r.push(new j(0,l,a,c))):90===this.angle?(r.push(new j(0,l,a,c)),l+=c):180===this.angle?(l-=c,r.push(new j(l,0,c,a))):(r.push(new j(l,0,c,a)),l+=c)}this.commitLayers(r,o)}commitLayers(t,i){}commitLinks(){if(null===this.network)return;const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}Pw(){const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof Xt&&this.UF(i)}}UF(t){if(null===t)return;this.setPortSpots(t);const i=t.children,s=i.length;for(let n=0;n<s;n++)this.UF(i[n])}setPortSpots(t){const i=t.alignment;if(this.isBusAlignment(i))this.kU(t,i);else{const s=this.orthoAngle(t);if(1===this.ws){const n=t.destinationEdges;for(;n.next();){const o=n.value.link;if(null!==o){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.fromSpot=A.MiddleRight;break;case 90:o.fromSpot=A.MiddleBottom;break;case 180:o.fromSpot=A.MiddleLeft;break;default:o.fromSpot=A.MiddleTop}else o.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.toSpot=A.MiddleLeft;break;case 90:o.toSpot=A.MiddleTop;break;case 180:o.toSpot=A.MiddleRight;break;default:o.toSpot=A.MiddleBottom}else o.toSpot=t.childPortSpot}}}else{const n=t.sourceEdges;for(;n.next();){const o=n.value.link;if(null!==o){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.toSpot=A.MiddleRight;break;case 90:o.toSpot=A.MiddleBottom;break;case 180:o.toSpot=A.MiddleLeft;break;default:o.toSpot=A.MiddleTop}else o.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.fromSpot=A.MiddleLeft;break;case 90:o.fromSpot=A.MiddleTop;break;case 180:o.fromSpot=A.MiddleRight;break;default:o.fromSpot=A.MiddleBottom}else o.fromSpot=t.childPortSpot}}}}}kU(t,i){const s=1===this.ws,n=this.orthoAngle(t);let o;switch(n){case 0:o=A.MiddleRight;break;case 90:o=A.MiddleBottom;break;case 180:o=A.MiddleLeft;break;default:o=A.MiddleTop}const r=t.children,a=r.length;switch(i){case 24:case 25:for(let l=0;l<a;l++){const h=r[l],c=(s?h.sourceEdges:h.destinationEdges).first();if(null===c)continue;const u=c.link;if(null!==u){let d=90===n||270===n?A.MiddleLeft:A.MiddleTop;if(1===a||l===a-1&&a%2==1)switch(n){case 0:d=A.MiddleLeft;break;case 90:d=A.MiddleTop;break;case 180:d=A.MiddleRight;break;default:d=A.MiddleBottom}else l%2==0&&(d=90===n||270===n?A.MiddleRight:A.MiddleBottom);s?(t.setsPortSpot&&(u.fromSpot=o),t.setsChildPortSpot&&(u.toSpot=d)):(t.setsPortSpot&&(u.fromSpot=d),t.setsChildPortSpot&&(u.toSpot=o))}}break;case 26:{const l=90===n||270===n?A.MiddleRight:A.MiddleBottom,h=s?t.destinationEdges:t.sourceEdges;for(;h.next();){const c=h.value.link;null!==c&&(s?(t.setsPortSpot&&(c.fromSpot=o),t.setsChildPortSpot&&(c.toSpot=l)):(t.setsPortSpot&&(c.fromSpot=l),t.setsChildPortSpot&&(c.toSpot=o)))}break}case 27:{const l=90===n||270===n?A.MiddleLeft:A.MiddleTop,h=s?t.destinationEdges:t.sourceEdges;for(;h.next();){const c=h.value.link;null!==c&&(s?(t.setsPortSpot&&(c.fromSpot=o),t.setsChildPortSpot&&(c.toSpot=l)):(t.setsPortSpot&&(c.fromSpot=l),t.setsChildPortSpot&&(c.toSpot=o)))}break}}}orthoAngle(t){const i=t.angle;return i<=45?0:i<=135?90:i<=225?180:i<=315?270:0}computeLayerSpacing(t){const i=this.orthoAngle(t),s=90===i||270===i;let n=t.layerSpacing;if(t.layerSpacingParentOverlap>0){const o=Math.min(1,t.layerSpacingParentOverlap);n-=s?t.height*o:t.width*o}return n<(s?-t.height:-t.width)&&(n=s?-t.height:-t.width),n}computeNodeIndent(t){const i=this.orthoAngle(t),s=90===i||270===i;let n=t.nodeIndent;if(t.nodeIndentPastParent>0){const o=Math.min(1,t.nodeIndentPastParent);n+=s?t.width*o:t.height*o}return n=Math.max(0,n),n}get roots(){return this.Ie}set roots(t){this.Ie!==t&&(this.Ie=t,this.p())}get path(){return this.Fe}set path(t){this.Fe!==t&&(this.Fe=t,this.p())}get treeStyle(){return this.wu}set treeStyle(t){this.wu!==t&&(40===t||42===t||41===t||43===t)&&(this.wu=t,this.p())}get layerStyle(){return this.$g}set layerStyle(t){this.$g!==t&&(60===t||61===t||62===t)&&(this.$g=t,this.p())}get comments(){return this.Xi}set comments(t){this.Xi!==t&&(y.s(t,"boolean",m,"comments"),this.Xi=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(50===t||51===t||52===t)&&(this.He=t,this.p())}get arrangementSpacing(){return this.Us}set arrangementSpacing(t){this.Us.equals(t)||(this.Us.h(t),this.p())}get rootDefaults(){return this.V}set rootDefaults(t){this.V!==t&&(this.V=t,this.p())}get alternateDefaults(){return this.B}set alternateDefaults(t){this.B!==t&&(this.B=t,this.p())}get sorting(){return this.V.sorting}set sorting(t){this.V.sorting!==t&&(this.V.sorting=t,this.p())}get comparer(){return this.V.comparer}set comparer(t){this.V.comparer!==t&&(y.S(t,m,"comparer"),this.V.comparer=t,this.p())}get angle(){return this.V.angle}set angle(t){this.V.angle!==t&&(y.s(t,"number",m,"angle"),0===t||90===t||180===t||270===t?(this.V.angle=t,this.p()):y.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.V.alignment}set alignment(t){this.V.alignment!==t&&(this.V.alignment=t,this.p())}get nodeIndent(){return this.V.nodeIndent}set nodeIndent(t){this.V.nodeIndent!==t&&(y.s(t,"number",m,"nodeIndent"),t>=0&&(this.V.nodeIndent=t,this.p()))}get nodeIndentPastParent(){return this.V.nodeIndentPastParent}set nodeIndentPastParent(t){this.V.nodeIndentPastParent!==t&&(y.s(t,"number",m,"nodeIndentPastParent"),t>=0&&t<=1&&(this.V.nodeIndentPastParent=t,this.p()))}get nodeSpacing(){return this.V.nodeSpacing}set nodeSpacing(t){this.V.nodeSpacing!==t&&(y.s(t,"number",m,"nodeSpacing"),this.V.nodeSpacing=t,this.p())}get layerSpacing(){return this.V.layerSpacing}set layerSpacing(t){this.V.layerSpacing!==t&&(y.s(t,"number",m,"layerSpacing"),this.V.layerSpacing=t,this.p())}get layerSpacingParentOverlap(){return this.V.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.V.layerSpacingParentOverlap!==t&&(y.s(t,"number",m,"layerSpacingParentOverlap"),t>=0&&t<=1&&(this.V.layerSpacingParentOverlap=t,this.p()))}get compaction(){return this.V.compaction}set compaction(t){this.V.compaction!==t&&(30===t||31===t)&&(this.V.compaction=t,this.p())}get breadthLimit(){return this.V.breadthLimit}set breadthLimit(t){this.V.breadthLimit!==t&&(y.s(t,"number",m,"breadthLimit"),t>=0&&(this.V.breadthLimit=t,this.p()))}get rowSpacing(){return this.V.rowSpacing}set rowSpacing(t){this.V.rowSpacing!==t&&(y.s(t,"number",m,"rowSpacing"),this.V.rowSpacing=t,this.p())}get rowIndent(){return this.V.rowIndent}set rowIndent(t){this.V.rowIndent!==t&&(y.s(t,"number",m,"rowIndent"),t>=0&&(this.V.rowIndent=t,this.p()))}get commentSpacing(){return this.V.commentSpacing}set commentSpacing(t){this.V.commentSpacing!==t&&(y.s(t,"number",m,"commentSpacing"),this.V.commentSpacing=t,this.p())}get commentMargin(){return this.V.commentMargin}set commentMargin(t){this.V.commentMargin!==t&&(y.s(t,"number",m,"commentMargin"),this.V.commentMargin=t,this.p())}get setsPortSpot(){return this.V.setsPortSpot}set setsPortSpot(t){this.V.setsPortSpot!==t&&(y.s(t,"boolean",m,"setsPortSpot"),this.V.setsPortSpot=t,this.p())}get portSpot(){return this.V.portSpot}set portSpot(t){this.V.portSpot.equals(t)||(this.V.portSpot=t,this.p())}get setsChildPortSpot(){return this.V.setsChildPortSpot}set setsChildPortSpot(t){this.V.setsChildPortSpot!==t&&(y.s(t,"boolean",m,"setsChildPortSpot"),this.V.setsChildPortSpot=t,this.p())}get childPortSpot(){return this.V.childPortSpot}set childPortSpot(t){this.V.childPortSpot.equals(t)||(this.V.childPortSpot=t,this.p())}get alternateSorting(){return this.B.sorting}set alternateSorting(t){this.B.sorting!==t&&(this.B.sorting=t,this.p())}get alternateComparer(){return this.B.comparer}set alternateComparer(t){this.B.comparer!==t&&(y.S(t,m,"alternateComparer"),this.B.comparer=t,this.p())}get alternateAngle(){return this.B.angle}set alternateAngle(t){this.B.angle!==t&&(y.s(t,"number",m,"alternateAngle"),(0===t||90===t||180===t||270===t)&&(this.B.angle=t,this.p()))}get alternateAlignment(){return this.B.alignment}set alternateAlignment(t){this.B.alignment!==t&&(this.B.alignment=t,this.p())}get alternateNodeIndent(){return this.B.nodeIndent}set alternateNodeIndent(t){this.B.nodeIndent!==t&&(y.s(t,"number",m,"alternateNodeIndent"),t>=0&&(this.B.nodeIndent=t,this.p()))}get alternateNodeIndentPastParent(){return this.B.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.B.nodeIndentPastParent!==t&&(y.s(t,"number",m,"alternateNodeIndentPastParent"),t>=0&&t<=1&&(this.B.nodeIndentPastParent=t,this.p()))}get alternateNodeSpacing(){return this.B.nodeSpacing}set alternateNodeSpacing(t){this.B.nodeSpacing!==t&&(y.s(t,"number",m,"alternateNodeSpacing"),this.B.nodeSpacing=t,this.p())}get alternateLayerSpacing(){return this.B.layerSpacing}set alternateLayerSpacing(t){this.B.layerSpacing!==t&&(y.s(t,"number",m,"alternateLayerSpacing"),this.B.layerSpacing=t,this.p())}get alternateLayerSpacingParentOverlap(){return this.B.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.B.layerSpacingParentOverlap!==t&&(y.s(t,"number",m,"alternateLayerSpacingParentOverlap"),t>=0&&t<=1&&(this.B.layerSpacingParentOverlap=t,this.p()))}get alternateCompaction(){return this.B.compaction}set alternateCompaction(t){this.B.compaction!==t&&(30===t||31===t)&&(this.B.compaction=t,this.p())}get alternateBreadthLimit(){return this.B.breadthLimit}set alternateBreadthLimit(t){this.B.breadthLimit!==t&&(y.s(t,"number",m,"alternateBreadthLimit"),t>=0&&(this.B.breadthLimit=t,this.p()))}get alternateRowSpacing(){return this.B.rowSpacing}set alternateRowSpacing(t){this.B.rowSpacing!==t&&(y.s(t,"number",m,"alternateRowSpacing"),this.B.rowSpacing=t,this.p())}get alternateRowIndent(){return this.B.rowIndent}set alternateRowIndent(t){this.B.rowIndent!==t&&(y.s(t,"number",m,"alternateRowIndent"),t>=0&&(this.B.rowIndent=t,this.p()))}get alternateCommentSpacing(){return this.B.commentSpacing}set alternateCommentSpacing(t){this.B.commentSpacing!==t&&(y.s(t,"number",m,"alternateCommentSpacing"),this.B.commentSpacing=t,this.p())}get alternateCommentMargin(){return this.B.commentMargin}set alternateCommentMargin(t){this.B.commentMargin!==t&&(y.s(t,"number",m,"alternateCommentMargin"),this.B.commentMargin=t,this.p())}get alternateSetsPortSpot(){return this.B.setsPortSpot}set alternateSetsPortSpot(t){this.B.setsPortSpot!==t&&(y.s(t,"boolean",m,"alternateSetsPortSpot"),this.B.setsPortSpot=t,this.p())}get alternatePortSpot(){return this.B.portSpot}set alternatePortSpot(t){this.B.portSpot.equals(t)||(this.B.portSpot=t,this.p())}get alternateSetsChildPortSpot(){return this.B.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.B.setsChildPortSpot!==t&&(y.s(t,"boolean",m,"alternateSetsChildPortSpot"),this.B.setsChildPortSpot=t,this.p())}get alternateChildPortSpot(){return this.B.childPortSpot}set alternateChildPortSpot(t){this.B.childPortSpot.equals(t)||(this.B.childPortSpot=t,this.p())}static PathDefault=0;static PathDestination=1;static PathSource=2;static SortingForwards=10;static SortingReverse=11;static SortingAscending=12;static SortingDescending=13;static AlignmentCenterSubtrees=20;static AlignmentCenterChildren=21;static AlignmentStart=22;static AlignmentEnd=23;static AlignmentBus=24;static AlignmentBusBranching=25;static AlignmentTopLeftBus=26;static AlignmentBottomRightBus=27;static CompactionNone=30;static CompactionBlock=31;static StyleLayered=40;static StyleLastParents=41;static StyleAlternating=42;static StyleRootOnly=43;static ArrangementVertical=50;static ArrangementHorizontal=51;static ArrangementFixedRoots=52;static LayerIndividual=60;static LayerSiblings=61;static LayerUniform=62}return m})();class fs extends Ie{constructor(e){super(e)}createVertex(){return new Xt(this)}createEdge(){return new Qs(this)}}class Xt extends Be{U;dt;at;mP;pP;yP;wP;xP;bP;kP;Xi;Zg;Qg;Si;Mi;Xt;de;Fw;Rw;Ow;Vs;Iw;Ew;Uw;Vw;Bw;zw;Xw;Gw;Yw;Kw;Hw;constructor(e){super(e),this.mP=!1,this.pP=null,this.yP=[],this.wP=0,this.xP=0,this.bP=0,this.kP=0,this.Xi=null,this.U=new S(0,0),this.dt=new lt(0,0),this.at=new S(0,0),this.Zg=null,this.Qg=null,this.Si=10,this.Mi=Be.standardComparer,this.Xt=0,this.de=21,this.Fw=0,this.Rw=0,this.Ow=20,this.Vs=50,this.Iw=0,this.Ew=31,this.Uw=0,this.Vw=25,this.Bw=10,this.zw=10,this.Xw=20,this.Gw=!0,this.Yw=A.Default,this.Kw=!0,this.Hw=A.Default}copyInheritedPropertiesFrom(e){null!==e&&(this.Si=e.sorting,this.Mi=e.comparer,this.Xt=e.angle,this.de=e.alignment,this.Fw=e.nodeIndent,this.Rw=e.nodeIndentPastParent,this.Ow=e.nodeSpacing,this.Vs=e.layerSpacing,this.Iw=e.layerSpacingParentOverlap,this.Ew=e.compaction,this.Uw=e.breadthLimit,this.Vw=e.rowSpacing,this.Bw=e.rowIndent,this.zw=e.commentSpacing,this.Xw=e.commentMargin,this.Gw=e.setsPortSpot,this.Yw=e.portSpot,this.Kw=e.setsChildPortSpot,this.Hw=e.childPortSpot)}get initialized(){return this.mP}set initialized(e){this.mP!==e&&(y.s(e,"boolean",Xt,"initialized"),this.mP=e)}get parent(){return this.pP}set parent(e){this.pP!==e&&(this.pP=e)}get children(){return this.yP}set children(e){if(this.yP!==e){if(null!==e&&!Array.isArray(e)&&y.si(e,"Array",Xt,"children:value"),null!==e){const t=e.length;for(let i=0;i<t;i++);}this.yP=e}}get level(){return this.wP}set level(e){this.wP!==e&&(y.s(e,"number",Xt,"level"),this.wP=e)}get descendantCount(){return this.xP}set descendantCount(e){this.xP!==e&&(y.s(e,"number",Xt,"descendantCount"),this.xP=e)}get maxChildrenCount(){return this.bP}set maxChildrenCount(e){this.bP!==e&&(y.s(e,"number",Xt,"maxChildrenCount"),this.bP=e)}get maxGenerationCount(){return this.kP}set maxGenerationCount(e){this.kP!==e&&(y.s(e,"number",Xt,"maxGenerationCount"),this.kP=e)}get comments(){return this.Xi}set comments(e){if(this.Xi!==e){if(null!==e&&!Array.isArray(e)&&y.si(e,"Array",Xt,"comments:value"),null!==e){const t=e.length;for(let i=0;i<t;i++);}this.Xi=e}}get sorting(){return this.Si}set sorting(e){this.Si!==e&&(this.Si=e)}get comparer(){return this.Mi}set comparer(e){this.Mi!==e&&(y.S(e,Xt,"comparer"),this.Mi=e)}get angle(){return this.Xt}set angle(e){this.Xt!==e&&(y.s(e,"number",Xt,"angle"),this.Xt=e)}get alignment(){return this.de}set alignment(e){this.de!==e&&(this.de=e)}get nodeIndent(){return this.Fw}set nodeIndent(e){this.Fw!==e&&(y.s(e,"number",Xt,"nodeIndent"),this.Fw=e)}get nodeIndentPastParent(){return this.Rw}set nodeIndentPastParent(e){this.Rw!==e&&(y.s(e,"number",Xt,"nodeIndentPastParent"),this.Rw=e)}get nodeSpacing(){return this.Ow}set nodeSpacing(e){this.Ow!==e&&(y.s(e,"number",Xt,"nodeSpacing"),this.Ow=e)}get layerSpacing(){return this.Vs}set layerSpacing(e){this.Vs!==e&&(y.s(e,"number",Xt,"layerSpacing"),this.Vs=e)}get layerSpacingParentOverlap(){return this.Iw}set layerSpacingParentOverlap(e){this.Iw!==e&&(y.s(e,"number",Xt,"layerSpacingParentOverlap"),this.Iw=e)}get compaction(){return this.Ew}set compaction(e){this.Ew!==e&&(this.Ew=e)}get breadthLimit(){return this.Uw}set breadthLimit(e){this.Uw!==e&&(y.s(e,"number",Xt,"breadthLimit"),this.Uw=e)}get rowSpacing(){return this.Vw}set rowSpacing(e){this.Vw!==e&&(y.s(e,"number",Xt,"rowSpacing"),this.Vw=e)}get rowIndent(){return this.Bw}set rowIndent(e){this.Bw!==e&&(y.s(e,"number",Xt,"rowIndent"),this.Bw=e)}get commentSpacing(){return this.zw}set commentSpacing(e){this.zw!==e&&(y.s(e,"number",Xt,"commentSpacing"),this.zw=e)}get commentMargin(){return this.Xw}set commentMargin(e){this.Xw!==e&&(y.s(e,"number",Xt,"commentMargin"),this.Xw=e)}get setsPortSpot(){return this.Gw}set setsPortSpot(e){this.Gw!==e&&(y.s(e,"boolean",Xt,"setsPortSpot"),this.Gw=e)}get portSpot(){return this.Yw}set portSpot(e){this.Yw.equals(e)||(this.Yw=e)}get setsChildPortSpot(){return this.Kw}set setsChildPortSpot(e){this.Kw!==e&&(y.s(e,"boolean",Xt,"setsChildPortSpot"),this.Kw=e)}get childPortSpot(){return this.Hw}set childPortSpot(e){this.Hw.equals(e)||(this.Hw=e)}get childrenCount(){return this.children.length}get relativePosition(){return this.U}set relativePosition(e){this.U.set(e)}get subtreeSize(){return this.dt}set subtreeSize(e){this.dt.set(e)}get subtreeOffset(){return this.at}set subtreeOffset(e){this.at.set(e)}}class Qs extends si{PP;constructor(e){super(e),this.PP=new S(0,0)}commit(){const e=this.link;if(null===e||e.isAvoiding)return;const t=this.network.layout;let i=null,s=null;switch(t.ws){case 1:i=this.fromVertex,s=this.toVertex;break;case 2:i=this.toVertex,s=this.fromVertex;break;default:y.o("Unhandled path value "+t.ws.toString())}if(null===i||null===s)return;const n=this.PP;if(0===n.x&&0===n.y)return void this.PU(i,s);const o=i.bounds,r=t.orthoAngle(i),a=t.computeLayerSpacing(i),l=i.rowSpacing;e.updateRoute();const h=9===e.curve,c=e.isOrthogonal;let d,f,u=0;if(e.startRoute(),c||h){for(u=2;e.pointsCount>4;)e.removePoint(2);d=e.getPoint(1),f=e.getPoint(2)}else{for(u=1;e.pointsCount>3;)e.removePoint(1);d=e.getPoint(0),f=e.getPoint(e.pointsCount-1)}const p=e.getPoint(e.pointsCount-1);let g=0;0===r?(23===i.alignment?(g=o.bottom+n.y,0===n.y&&d.y>p.y+i.rowIndent&&(g=Math.min(g,Math.max(d.y,g-t.computeNodeIndent(i))))):22===i.alignment?(g=o.top+n.y,0===n.y&&d.y<p.y-i.rowIndent&&(g=Math.max(g,Math.min(d.y,g+t.computeNodeIndent(i))))):g=o.y+o.height/2+n.y,h?(e.insertPointAt(u,d.x,g),u++,e.insertPointAt(u,o.right+a,g),u++,e.insertPointAt(u,o.right+a+(n.x-l)/3,g),u++,e.insertPointAt(u,o.right+a+2*(n.x-l)/3,g),u++,e.insertPointAt(u,o.right+a+(n.x-l),g),u++,e.insertPointAt(u,f.x,g),u++):(c&&(e.insertPointAt(u,o.right+a/2,d.y),u++),e.insertPointAt(u,o.right+a/2,g),u++,e.insertPointAt(u,o.right+a+n.x-(c?l/2:l),g),u++,c&&(e.insertPointAt(u,e.getPoint(u-1).x,f.y),u++))):90===r?(23===i.alignment?(g=o.right+n.x,0===n.x&&d.x>p.x+i.rowIndent&&(g=Math.min(g,Math.max(d.x,g-t.computeNodeIndent(i))))):22===i.alignment?(g=o.left+n.x,0===n.x&&d.x<p.x-i.rowIndent&&(g=Math.max(g,Math.min(d.x,g+t.computeNodeIndent(i))))):g=o.x+o.width/2+n.x,h?(e.insertPointAt(u,g,d.y),u++,e.insertPointAt(u,g,o.bottom+a),u++,e.insertPointAt(u,g,o.bottom+a+(n.y-l)/3),u++,e.insertPointAt(u,g,o.bottom+a+2*(n.y-l)/3),u++,e.insertPointAt(u,g,o.bottom+a+(n.y-l)),u++,e.insertPointAt(u,g,f.y),u++):(c&&(e.insertPointAt(u,d.x,o.bottom+a/2),u++),e.insertPointAt(u,g,o.bottom+a/2),u++,e.insertPointAt(u,g,o.bottom+a+n.y-(c?l/2:l)),u++,c&&(e.insertPointAt(u,f.x,e.getPoint(u-1).y),u++))):180===r?(23===i.alignment?(g=o.bottom+n.y,0===n.y&&d.y>p.y+i.rowIndent&&(g=Math.min(g,Math.max(d.y,g-t.computeNodeIndent(i))))):22===i.alignment?(g=o.top+n.y,0===n.y&&d.y<p.y-i.rowIndent&&(g=Math.max(g,Math.min(d.y,g+t.computeNodeIndent(i))))):g=o.y+o.height/2+n.y,h?(e.insertPointAt(u,d.x,g),u++,e.insertPointAt(u,o.left-a,g),u++,e.insertPointAt(u,o.left-a+(n.x+l)/3,g),u++,e.insertPointAt(u,o.left-a+2*(n.x+l)/3,g),u++,e.insertPointAt(u,o.left-a+(n.x+l),g),u++,e.insertPointAt(u,f.x,g),u++):(c&&(e.insertPointAt(u,o.left-a/2,d.y),u++),e.insertPointAt(u,o.left-a/2,g),u++,e.insertPointAt(u,o.left-a+n.x+(c?l/2:l),g),u++,c&&(e.insertPointAt(u,e.getPoint(u-1).x,f.y),u++))):270===r?(23===i.alignment?(g=o.right+n.x,0===n.x&&d.x>p.x+i.rowIndent&&(g=Math.min(g,Math.max(d.x,g-t.computeNodeIndent(i))))):22===i.alignment?(g=o.left+n.x,0===n.x&&d.x<p.x-i.rowIndent&&(g=Math.max(g,Math.min(d.x,g+t.computeNodeIndent(i))))):g=o.x+o.width/2+n.x,h?(e.insertPointAt(u,g,d.y),u++,e.insertPointAt(u,g,o.top-a),u++,e.insertPointAt(u,g,o.top-a+(n.y+l)/3),u++,e.insertPointAt(u,g,o.top-a+2*(n.y+l)/3),u++,e.insertPointAt(u,g,o.top-a+(n.y+l)),u++,e.insertPointAt(u,g,f.y),u++):(c&&(e.insertPointAt(u,d.x,o.top-a/2),u++),e.insertPointAt(u,g,o.top-a/2),u++,e.insertPointAt(u,g,o.top-a+n.y+(c?l/2:l)),u++,c&&(e.insertPointAt(u,f.x,e.getPoint(u-1).y),u++))):y.o("Invalid angle "+r),e.commitRoute()}PU(e,t){const i=this.link;if(null===i)return;const s=this.network.layout,n=s.orthoAngle(e);if(n===s.orthoAngle(t))return;const r=s.computeLayerSpacing(e),a=e.bounds,l=t.bounds;if(0===n&&l.left-a.right<r+1||90===n&&l.top-a.bottom<r+1||180===n&&a.left-l.right<r+1||270===n&&a.top-l.bottom<r+1)return;i.updateRoute();const h=9===i.curve,c=i.isOrthogonal,d=s.isBusAlignment(this.fromVertex.alignment);if(i.startRoute(),0===n){const f=a.right+r/2;if(h){if(4===i.pointsCount){const p=i.getPoint(3).y;i.setPointAt(1,f-20,i.getPoint(1).y),i.insertPointAt(2,f-20,p),i.insertPointAt(3,f,p),i.insertPointAt(4,f+20,p),i.setPointAt(5,i.getPoint(5).x,p)}}else c?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,f,i.getPoint(2).y),i.setPointAt(3,f,i.getPoint(3).y)):4===i.pointsCount?i.insertPointAt(2,f,i.getPoint(2).y):3===i.pointsCount?i.setPointAt(1,f,i.getPoint(2).y):2===i.pointsCount&&i.insertPointAt(1,f,i.getPoint(1).y)}else if(90===n){const f=a.bottom+r/2;if(h){if(4===i.pointsCount){const p=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,f-20),i.insertPointAt(2,p,f-20),i.insertPointAt(3,p,f),i.insertPointAt(4,p,f+20),i.setPointAt(5,p,i.getPoint(5).y)}}else c?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,i.getPoint(2).x,f),i.setPointAt(3,i.getPoint(3).x,f)):4===i.pointsCount?i.insertPointAt(2,i.getPoint(2).x,f):3===i.pointsCount?i.setPointAt(1,i.getPoint(2).x,f):2===i.pointsCount&&i.insertPointAt(1,i.getPoint(1).x,f)}else if(180===n){const f=a.left-r/2;if(h){if(4===i.pointsCount){const p=i.getPoint(3).y;i.setPointAt(1,f+20,i.getPoint(1).y),i.insertPointAt(2,f+20,p),i.insertPointAt(3,f,p),i.insertPointAt(4,f-20,p),i.setPointAt(5,i.getPoint(5).x,p)}}else c?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,f,i.getPoint(2).y),i.setPointAt(3,f,i.getPoint(3).y)):4===i.pointsCount?i.insertPointAt(2,f,i.getPoint(2).y):3===i.pointsCount?i.setPointAt(1,f,i.getPoint(2).y):2===i.pointsCount&&i.insertPointAt(1,f,i.getPoint(1).y)}else if(270===n){const f=a.top-r/2;if(h){if(4===i.pointsCount){const p=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,f+20),i.insertPointAt(2,p,f+20),i.insertPointAt(3,p,f),i.insertPointAt(4,p,f-20),i.setPointAt(5,p,i.getPoint(5).y)}}else c?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,i.getPoint(2).x,f),i.setPointAt(3,i.getPoint(3).x,f)):4===i.pointsCount?i.insertPointAt(2,i.getPoint(2).x,f):3===i.pointsCount?i.setPointAt(1,i.getPoint(2).x,f):2===i.pointsCount&&i.insertPointAt(1,i.getPoint(1).x,f)}i.commitRoute()}get fromVertex(){return this.ss}set fromVertex(e){this.ss!==e&&(this.ss=e)}get toVertex(){return this.ns}set toVertex(e){this.ns!==e&&(this.ns=e)}get relativePoint(){return this.PP}set relativePoint(e){this.PP.set(e)}}class ke{constructor(){}static Light={colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new It(5)},arrowheads:{toArrow:"Standard"}};static Dark={colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new It(5)},arrowheads:{toArrow:"Standard"}}}class $e{hs=new Set;bu=new xt;SP="light";MP="light";NP=!1;ML=!0;_g="light";VF=e=>{const t=e.matches?"dark":"light";t!==this._g&&(this._g=t,"system"===this.MP&&this.updateDiagrams())};constructor(e){e&&Object.assign(this,e),e?.themeMap||(this.bu.set("light",{colors:{...ke.Light.colors},fonts:{...ke.Light.fonts},numbers:{...ke.Light.numbers},margins:{...ke.Light.margins},arrowheads:{...ke.Light.arrowheads}}),this.bu.set("dark",{colors:{...ke.Dark.colors},fonts:{...ke.Dark.fonts},numbers:{...ke.Dark.numbers},margins:{...ke.Dark.margins},arrowheads:{...ke.Dark.arrowheads}})),X.matchMedia&&(this._g=X.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.bu}set themeMap(e){this.bu!==e&&(this.bu=e,this.updateDiagrams())}get defaultTheme(){return this.SP}set defaultTheme(e){this.SP!==e&&(y.s(e,"string",$e,"defaultTheme"),this.SP=e,this.updateDiagrams())}get currentTheme(){return this.MP}set currentTheme(e){this.MP!==e&&(y.s(e,"string",$e,"currentTheme"),this.MP=e,this.updateDiagrams())}get changesDivBackground(){return this.NP}set changesDivBackground(e){if(this.NP!==e&&(this.NP=e,e))for(const t of this.hs)t.setDivBackground(this.findValue("div","","fill")),t.T("ThemeChanged",this)}get readsCssVariables(){return this.ML}set readsCssVariables(e){this.ML!==e&&(this.ML=e,this.updateDiagrams())}get preferredColorScheme(){return this._g}addDiagram(e){return this.hs.add(e),this.NL(e),this}removeDiagram(e){return this.hs.delete(e),this.NL(e),this}tO(){0===this.hs.size&&X.matchMedia&&X.matchMedia("(prefers-color-scheme: dark)")?.addEventListener("change",this.VF)}eO(){0===this.hs.size&&X.matchMedia&&X.matchMedia("(prefers-color-scheme: dark)")?.removeEventListener("change",this.VF)}set(e,t){""===e&&(e=this.SP),"system"===e&&(e=this._g);let i=this.bu.get(e);return i=i?this.BF(i,t):t,this.bu.set(e,i),this.updateDiagrams(),this}findValue(e,t,i){return this.getValue(this.findTheme(this.currentTheme),e,t,i)||this.getValue(this.findTheme(this.defaultTheme),e,t,i)}getValue(e,t,i,s){if(!e)return;null==i&&(i="");let n=e;const o=a=>{if(void 0===n||""===a)return;if("number"==typeof a||!Array.isArray(a)&&!a.includes("."))return n[a];const l=Array.isArray(a)?a:a.split(".");for(let h=0;h<l.length;h++){const c=l[h];if(""!==c&&(n=n[c],void 0===n))return}return n},r=()=>{if(""===i||(n=o(i),void 0!==n))return n=Array.isArray(n)&&"number"==typeof t?n[t%n.length]:o(t),n};if(n=r(),void 0===n&&"string"==typeof s&&s.length>0){let a=e.targetPropertyMap?.get(s);if(a?n=e[a]:(a=$e.SU.get(s),n=a?e[a]:e.colors),n=r(),void 0!==n)return n}return n}findTheme(e){return this.themeMap.get("system"===e?this._g:e)}updateDiagrams(){for(const e of this.hs)this.NL(e)}NL(e){const t=e.skipsUndoManager;e.skipsUndoManager=!0,e.updateAllThemeBindings(),this.NP&&e.setDivBackground(this.findValue("div","","fill")),e.skipsUndoManager=t,e.T("ThemeChanged",this)}BF(e,t){for(const i in t)if(y.jw(t,i))try{e[i]=t[i]?.constructor===Object?this.BF(e[i]??{},t[i]):t[i]}catch{delete e[i]}return e}static SU=new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]])}class _s{Pt;a;Be;Pl;constructor(){this.a=U.Om(),this.Pt="",this.Be=!0,this.Pl=!0}get name(){return this.Pt}set name(e){this.Pt=e}get isEnabled(){return this.Be}set isEnabled(e){this.Be=e}get isRealtime(){return this.Pl}set isRealtime(e){this.Pl=e}get diagram(){return this.a}set diagram(e){this.a!==e&&(this.a=e,e.Fl=!0,e.requestUpdate())}invalidateRouter(){null!==this.a&&(this.a.Fl=!0,this.a.requestUpdate())}canRoute(e){if(!this.isEnabled)return!1;const t=this.diagram;return!(t&&(!this.isRealtime&&t.Iu||t.animationManager.isTicking))}isRoutable(e,t){return!0}routeLinks(e,t){}toString(){return""!==this.name?this.name+" Router":y.Hn(this.constructor)}}class So extends _s{constructor(e){super(),this.name="AvoidsNodes",e&&Object.assign(this,e)}canRoute(e){return!!(e instanceof U?e.lp:e.diagram?.lp)&&super.canRoute(e)}isRoutable(e,t){return!(!e.isAvoiding||e.containingGroup!==(t instanceof pt?t:null)||null===e.toNode||null===e.fromNode||e.pointsCount<4)}routeLinks(e,t){const s=e.iterator,n=this.diagram.getPositions(!0,t instanceof U?null:t,null);for(;s.next();){const o=s.value;if(!this.isRoutable(o,t))continue;o.startRoute();const r=o.pointsCount,a=o.getPoint(1),l=o.getPoint(r-2),h=o.fromNode.actualBounds.copy();h.inflate(gt.Fa,gt.Fa),h.unionPoint(o.getPoint(0));const c=o.toNode.actualBounds.copy();c.inflate(gt.Fa,gt.Fa),c.unionPoint(o.getPoint(r-1)),this.MU(o,h,c,n)&&this.NU(o,a,o.PC,l,o.SC,h,c,n),o.commitRoute()}}MU(e,t,i,s){const o=e.pointsCount;if(null===e.diagram||!e.fromNode||!e.toNode||e.fromNode===e.toNode||!e.layer||e.layer.isTemporary||t.containsPoint(e.getPoint(o-1))&&!e.toNode.isMemberOf(e.fromNode)||i.containsPoint(e.getPoint(0))&&!e.fromNode.isMemberOf(e.toNode)||!e.isOrthogonal)return!1;if(17===e.segmentIndex)return!0;const r=e.getPoint(1),a=e.getPoint(o-2),l=e.getPoint(2);if(!s.isUnoccupied(Math.min(r.x,l.x),Math.min(r.y,l.y),Math.abs(r.x-l.x),Math.abs(r.y-l.y)))return!0;for(let c=2;c<o-3;c++){const u=e.getPoint(c),d=e.getPoint(c+1);if(!s.isUnoccupied(Math.min(u.x,d.x),Math.min(u.y,d.y),Math.abs(u.x-d.x),Math.abs(u.y-d.y)))return!0}const h=e.getPoint(o-3);return!s.isUnoccupied(Math.min(h.x,a.x),Math.min(h.y,a.y),Math.abs(h.x-a.x),Math.abs(h.y-a.y))}NU(e,t,i,s,n,o,r,a){const l=e.diagram;if(null===l)return;const h=t,c=s;let u=S.mn,d=S.mn;if(l.isVirtualized){const g=a.bounds.copy(),b=e.getPoint(2),x=e.getPoint(e.pointsCount-3);g.inflate(-a.cellWidth,-a.cellHeight);const v=S.l();a.ng(t.x,t.y)||(L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,t.x,t.y,b.x,b.y,v)?(u=t=v.copy(),i=v.directionPoint(b)):L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,b.x,b.y,x.x,x.y,v)?(u=t=v.copy(),i=v.directionPoint(x)):L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,x.x,x.y,s.x,s.y,v)&&(u=t=v.copy(),i=v.directionPoint(s))),a.ng(s.x,s.y)||(L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,s.x,s.y,x.x,x.y,v)?(d=s=v.copy(),n=x.directionPoint(v)):L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,x.x,x.y,b.x,b.y,v)?(d=s=v.copy(),n=b.directionPoint(v)):L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,b.x,b.y,t.x,t.y,v)&&(d=s=v.copy(),n=t.directionPoint(v))),S.i(v)}const f=o.copy().unionRect(r);f.inflate(a.cellWidth*a.hf,a.cellHeight*a.hf),a.yv(t,i,s,n,f,!0);let p=a.bo(s.x,s.y);if(!a.tw&&p>=jt.sg&&(a.TT(),f.inflate(a.cellWidth*a.E2,a.cellHeight*a.U2),a.yv(t,i,s,n,f,!1),p=a.bo(s.x,s.y)),!a.tw&&p<jt.sg&&!a.GE(s.x,s.y)){e.points.removeRange(2,e.pointsCount-3),this.CL(e,a,s.x,s.y,n,!0);const g=0,b=90,x=180,v=270,P=e.getPoint(2);if(e.pointsCount<4)i===g||i===x?(P.x=t.x,P.y=s.y):(P.x=s.x,P.y=t.y),e.setPointAt(2,P.x,P.y),e.insertPointAt(3,P.x,P.y);else{const w=e.getPoint(3);if(i===g||i===x)if(L.u(P.x,w.x)){const M=i===g?Math.max(P.x,t.x):Math.min(P.x,t.x);e.setPointAt(2,M,t.y),e.setPointAt(3,M,w.y)}else L.u(P.y,w.y)?(Math.abs(t.y-P.y)<=a.cellHeight/2&&(e.setPointAt(2,P.x,t.y),e.setPointAt(3,w.x,t.y)),e.insertPointAt(2,P.x,t.y)):e.setPointAt(2,t.x,P.y);else if(i===b||i===v)if(L.u(P.y,w.y)){const M=i===b?Math.max(P.y,t.y):Math.min(P.y,t.y);e.setPointAt(2,t.x,M),e.setPointAt(3,w.x,M)}else L.u(P.x,w.x)?(Math.abs(t.x-P.x)<=a.cellWidth/2&&(e.setPointAt(2,t.x,P.y),e.setPointAt(3,t.x,w.y)),e.insertPointAt(2,t.x,P.y)):e.setPointAt(2,P.x,t.y)}if(u.isReal()){const w=e.getPoint(1),M=e.getPoint(2);w.x!==M.x&&w.y!==M.y?i===g||i===x?e.insertPointAt(2,w.x,M.y):e.insertPointAt(2,M.x,w.y):i===g||i===x?e.insertPointAt(2,h.x,u.y):e.insertPointAt(2,u.x,h.y)}d.isReal()&&(n===g||n===x?e.insertPointAt(e.pointsCount-2,c.x,d.y):e.insertPointAt(e.pointsCount-2,d.x,c.y))}}CL(e,t,i,s,n,o){const r=t.cellWidth,a=t.cellHeight;let l=t.bo(i,s),h=i,c=s,u=h,d=c;for(0===n?u+=r:90===n?d+=a:180===n?u-=r:d-=a,e.TC&&l>jt.nc&&t.bo(u,d)!==l-1&&(t.bo(h-r,c)===l-1?(n=180,u=h-r,d=c):t.bo(h+r,c)===l-1?(n=0,u=h+r,d=c):t.bo(h,c-a)===l-1?(n=270,u=h,d=c-a):t.bo(h,c+a)===l-1&&(n=90,u=h,d=c+a));l>jt.nc&&t.bo(u,d)===l-1;)h=u,c=d,0===n?u+=r:90===n?d+=a:180===n?u-=r:d-=a,l-=1;if(o?l>jt.nc&&(180===n||0===n?h=Math.floor(h/r)*r+r/2:(90===n||270===n)&&(c=Math.floor(c/a)*a+a/2)):(h=Math.floor(h/r)*r+r/2,c=Math.floor(c/a)*a+a/2),l>jt.nc){let f=n,p=h,g=c;if(0===n?(f=90,g+=a):90===n?(f=180,p-=r):180===n?(f=270,g-=a):270===n&&(f=0,p+=r),t.bo(p,g)===l-1)this.CL(e,t,p,g,f,!1);else{let b=h,x=c;0===n?(f=270,x-=a):90===n?(f=0,b+=r):180===n?(f=90,x+=a):270===n&&(f=180,b-=r),t.bo(b,x)===l-1&&this.CL(e,t,b,x,f,!1)}}e.insertPointAt(e.pointsCount-2,h,c)}}Ue.prototype.initializeStandardTools=function(){return this.Jt("Action",new Cs,this.mouseDownTools),this.Jt("Relinking",new Ze,this.mouseDownTools),this.Jt("LinkReshaping",new Ss,this.mouseDownTools),this.Jt("Rotating",new Fe,this.mouseDownTools),this.Jt("Resizing",new Qe,this.mouseDownTools),this.Jt("Linking",new Ps,this.mouseMoveTools),this.Jt("Dragging",new Ft,this.mouseMoveTools),this.Jt("DragSelecting",new ci,this.mouseMoveTools),this.Jt("Panning",new ki,this.mouseMoveTools),this.Jt("ContextMenu",new ti,this.mouseUpTools),this.Jt("TextEditing",new Ls,this.mouseUpTools),this.Jt("ClickCreating",new _e,this.mouseUpTools),this.Jt("ClickSelecting",new Ms,this.mouseUpTools),this},U.g2("GraphLinksModel",class bo extends pi{D2(){const e=this.diagram.model;this.nw(e.nodeDataArray),this.Rv(e.linkDataArray)}nw(e){super.nw(e,!1);const t=this.links.iterator;for(;t.next();)t.value.Wd();this.diagram.c1(!1)}Rv(e){e.forEach(t=>{this.Ov(t)}),this.diagram.c1(!1)}Ov(e){if(null==e||this.diagram.undoManager.isUndoingRedoing||this.findLinkForData(e))return null;const t=this.getLinkCategoryForData(e),i=this.findLinkTemplateForCategory(t);if(null!==i){i.It();const s=i.copy();if(null!==s){const n=this.diagram.wi;this.diagram.wi=!0,s._o=t,s.te=e;const o=this.diagram.model,r=o.Ak(e,!0);""!==r&&(s.fromPortId=r);const a=o.Vi(e,!0);if(void 0!==a){const u=this.findNodeForKey(a);u instanceof nt&&(s.fromNode=u)}const l=o.Ak(e,!1);""!==l&&(s.toPortId=l);const h=o.Vi(e,!1);if(void 0!==h){const u=this.findNodeForKey(h);u instanceof nt&&(s.toNode=u)}const c=o.getLabelKeysForLinkData(e);return Array.isArray(c)&&c.forEach(u=>{const d=this.findNodeForKey(u);null!==d&&(d.labeledLink=s)}),this.addsToTemporaryLayer&&(s.dl="Tool"),this.diagram.add(s),s.te=null,s.data=e,this.diagram.wi=n,s}}return null}Mv(){const e=this.diagram.model;this.Iv(e.linkDataArray),this.zC(e.nodeDataArray)}Iv(e){e.forEach(t=>{this.Ck(t)})}getLinkCategoryForData(e){return this.diagram.model.getCategoryForLinkData(e)}setLinkCategoryForData(e,t){return this.diagram.model.setCategoryForLinkData(e,t)}setFromNodeForLink(e,t,i){const s=this.diagram.model;s.setFromKeyForLinkData(e.data,s.getKeyForNodeData(null!==t?t.data:null))}setToNodeForLink(e,t,i){const s=this.diagram.model;s.setToKeyForLinkData(e.data,s.getKeyForNodeData(null!==t?t.data:null))}AC(e){this.diagram.model.removeLinkData(e.data)}findPartForKey(e){const t=super.findPartForKey(e);if(null===t){const i=this.diagram.model.findLinkDataForKey(e);if(null!==i)return this.findLinkForData(i)}return t}findLinkForKey(e){if(null==e)return null;const t=this.diagram.model.findLinkDataForKey(e);return null!==t?this.findLinkForData(t):null}doModelChanged(e){if(super.doModelChanged(e),!this.diagram)return;const t=this.diagram;if(e.model!==t.model)return;const i=e.change;if(t.G){t.G=!1;try{const s=e.modelChange;if(""!==s){if(2===i){if("linkFromKey"===s){const o=this.findLinkForData(e.object);if(null!==o){const a=this.findNodeForKey(e.newValue);o.fromNode=a}}else if("linkToKey"===s){const o=this.findLinkForData(e.object);if(null!==o){const a=this.findNodeForKey(e.newValue);o.toNode=a}}else if("linkFromPortId"===s){const o=this.findLinkForData(e.object);if(null!==o){const r=e.newValue;"string"==typeof r&&(o.fromPortId=r)}}else if("linkToPortId"===s){const o=this.findLinkForData(e.object);if(null!==o){const r=e.newValue;"string"==typeof r&&(o.toPortId=r)}}else if("nodeGroupKey"===s){const o=this.findPartForData(e.object);if(null!==o){const r=e.newValue;if(void 0!==r){const a=this.findNodeForKey(r);o.containingGroup=a instanceof pt?a:null}else o.containingGroup=null}}else if("linkLabelKeys"===s){const o=this.findLinkForData(e.object);if(null!==o){const r=e.oldValue,a=e.newValue;Array.isArray(r)&&r.forEach(l=>{if(a.indexOf(l)>=0)return;const h=this.findNodeForKey(l);null!==h&&(h.labeledLink=null)}),Array.isArray(a)&&a.forEach(l=>{const h=this.findNodeForKey(l);null!==h&&(h.labeledLink=o)})}}else if("linkCategory"===s){const o=this.findLinkForData(e.object),r=e.newValue;null!==o&&"string"==typeof r&&(o.category=r)}else"linkDataArray"===s&&(this.Iv(e.oldValue),this.Rv(e.newValue));t.isModified=!0}else if(3===i){const n=e.newValue;if("linkDataArray"===s&&y.$(n))this.Ov(n);else if("linkLabelKeys"===s&&e.model.isKeyType(n)){const r=this.findLinkForData(e.object),a=this.findNodeForKey(n);null!==r&&null!==a&&(a.labeledLink=r)}t.isModified=!0}else if(4===i){const n=e.oldValue;if("linkDataArray"===s&&y.$(n))this.Ck(n);else if("linkLabelKeys"===s&&e.model.isKeyType(n)){const o=this.findNodeForKey(n);null!==o&&(o.labeledLink=null)}t.isModified=!0}}else if(2===i){const n=e.propertyName;e.object===t.model&&("linkFromKeyProperty"===n||"linkToKeyProperty"===n||"linkFromPortIdProperty"===n||"linkToPortIdProperty"===n||"linkLabelKeysProperty"===n||"nodeIsGroupProperty"===n||"nodeGroupKeyProperty"===n||"linkCategoryProperty"===n)&&(t.undoManager.isUndoingRedoing||this.rebuildParts()),t.isModified=!0}}finally{t.G=!0}}}Fv(){const e=this.diagram.model,t=new Set,i=e.linkDataArray;i.forEach(n=>{t.add(n)});const s=[];this.links.each(n=>{null!==n.data&&!t.has(n.data)&&s.push(n.data)}),s.forEach(n=>{e.Ev(n,!1)}),i.forEach(n=>{null===this.findLinkForData(n)&&e.Uv(n,!1)})}updateRelationshipsFromData(e){const t=e.data;if(null===t)return;const i=e.diagram;if(null===i)return;const s=i.model;if(e instanceof gt){let n=s.Vi(t,!0),o=i.findNodeForKey(n);e.fromNode=o,n=s.Vi(t,!1),o=i.findNodeForKey(n),e.toNode=o;const r=s.getLabelKeysForLinkData(t);if(r.length>0||e.labelNodes.count>0){if(1===r.length&&1===e.labelNodes.count){const u=r[0],d=e.labelNodes.first();if(null!==d&&s.getKeyForNodeData(d.data)===u)return}const a=(new z).addAll(r),l=new z;e.labelNodes.each(u=>{if(null!==u.data){const d=s.getKeyForNodeData(u.data);void 0!==d&&l.add(d)}});const h=l.copy();h.removeAll(a);const c=a.copy();if(c.removeAll(l),h.count>0||c.count>0){const u=e;h.each(d=>{const f=i.findNodeForKey(d);null!==f&&f.labeledLink===u&&(f.labeledLink=null)}),c.each(d=>{const f=i.findNodeForKey(d);null!==f&&f.labeledLink!==u&&(f.labeledLink=u)})}}}else if(!(e instanceof Nt)){const n=s.getGroupKeyForNodeData(t),o=i.findPartForKey(n);(null===o||o instanceof pt)&&(e.containingGroup=o)}}Nk(e){const t=this.diagram.model,i=t.getKeyForNodeData(e);if(void 0!==i){const s=t.lw(i),n=this.findPartForData(e);if(null!==s&&null!==n){const r=s.iterator;for(;r.next();){const a=r.value;if(t.containsNodeData(a)){if(n instanceof pt&&t.getGroupKeyForNodeData(a)===i){const l=this.findPartForData(a);null!==l&&(l.containingGroup=n)}}else{const l=this.findLinkForData(a);if(null!==l&&n instanceof nt){t.Vi(a,!0)===i&&(l.fromNode=n),t.Vi(a,!1)===i&&(l.toNode=n);const h=t.getLabelKeysForLinkData(a);Array.isArray(h)&&h.some(c=>c===i&&(n.labeledLink=l,!0))}}}t.an(i)}const o=t.getGroupKeyForNodeData(e);if(void 0!==o){const r=this.findNodeForKey(o);null!==n&&r instanceof pt&&(n.containingGroup=r)}}}XC(e){const t=this.diagram.model;if(e instanceof nt){const i=t.getKeyForNodeData(e.data);if(void 0!==i){const s=e.linksConnected;for(;s.next();)t.hn(i,s.value.data);if(e.isLinkLabel){const n=e.labeledLink;null!==n&&t.hn(i,n.data)}if(e instanceof pt){const n=e.memberParts;for(;n.next();){const o=n.value.data;t.containsNodeData(o)&&t.hn(i,o)}}}}}KC(e,t){let i=super.KC(e,t);if(e instanceof gt){const s=e.data;if(null!==s&&null!==t){const n=t.model,o=n.copyLinkData(s);n.addLinkData(o),i=t.findLinkForData(o)}else if(null!==i){const n=this.diagram;if(null!==s&&null!==n&&null!==n.commandHandler&&n.commandHandler.copiesClipboardData){const o=n.model.copyLinkData(s);i.data=o}}}return i}insertLink(e,t,i,s){const n=this.diagram,o=n.model,r=n.toolManager.findTool("Linking");let a="";null!==e&&(null===t&&(t=e),a=t.portId,null===a&&(a=""));let l="";null!==i&&(null===s&&(s=i),l=s.portId,null===l&&(l=""));const h=r.archetypeLinkData;if(h instanceof gt){h.It();const c=h.copy();if(null!==c){c.fromNode=e,c.fromPortId=a,c.toNode=i,c.toPortId=l,n.add(c);const u=r.archetypeLabelNodeData;if(u instanceof nt){u.It();const d=u.copy();null!==d&&(d.labeledLink=c,n.add(d))}return c}}else if(null!==h){const c=o.copyLinkData(h);if(y.$(c)){null!==e&&o.xg(c,o.getKeyForNodeData(e.data),!0),o.bg(c,a,!0),null!==i&&o.xg(c,o.getKeyForNodeData(i.data),!1),o.bg(c,l,!1),o.addLinkData(c);const u=r.archetypeLabelNodeData;if(null!==u&&!(u instanceof nt)){const d=o.copyNodeData(u);o.addNodeData(d);const f=o.getKeyForNodeData(d);void 0!==f&&o.addLabelKeyForLinkData(c,f)}return n.findLinkForData(c)}}return null}}),U.g2("TreeModel",class wo extends pi{Ua=null;Tk(e,t){if(null===e||null===t||null!==t.findTreeParentLink())return;const i=this.diagram.toolManager.findTool("Linking");let s=e,n=t;if(this.diagram.isTreePathToChildren){if(null!==i&&i.Vu(s,n,null,!0))return}else if(s=t,n=e,null!==i&&i.Vu(s,n,null,!0))return;const o=this.getLinkCategoryForData(t.data),r=this.findLinkTemplateForCategory(o);if(null!==r){r.It();const a=r.copy();if(null!==a){const l=this.diagram.wi;this.diagram.wi=!0,a._o=o,a.te=t.data,a.fromNode=s,a.toNode=n,this.diagram.add(a),a.te=null,a.data=t.data,this.diagram.wi=l}}}getLinkCategoryForData(e){return this.diagram.model.getParentLinkCategoryForNodeData(e)}setLinkCategoryForData(e,t){this.diagram.model.setParentLinkCategoryForNodeData(e,t)}setFromNodeForLink(e,t,i){const s=this.diagram.model;void 0===i&&(i=null);const n=null!==t?t.data:null;if(this.diagram.isTreePathToChildren)s.setParentKeyForNodeData(e.data,s.getKeyForNodeData(n));else{const o=this.Ua;this.Ua=e,null!==i&&s.setParentKeyForNodeData(i.data,void 0),s.setParentKeyForNodeData(n,s.getKeyForNodeData(null!==e.toNode?e.toNode.data:null)),this.Ua=o}}setToNodeForLink(e,t,i){const s=this.diagram.model;void 0===i&&(i=null);const n=null!==t?t.data:null;if(this.diagram.isTreePathToChildren){const o=this.Ua;this.Ua=e,null!==i&&s.setParentKeyForNodeData(i.data,void 0),s.setParentKeyForNodeData(n,s.getKeyForNodeData(null!==e.fromNode?e.fromNode.data:null)),this.Ua=o}else s.setParentKeyForNodeData(e.data,s.getKeyForNodeData(n))}AC(e){this.diagram.model.setParentKeyForNodeData(e.data,void 0)}findLinkForKey(e){if(null==e)return null;const t=this.diagram.model.findNodeDataForKey(e);return null!==t?this.findLinkForData(t):null}doModelChanged(e){if(super.doModelChanged(e),!this.diagram)return;const t=this.diagram;if(e.model!==t.model)return;const i=e.change;if(t.G){t.G=!1;try{const s=e.modelChange;if(""!==s){if(2===i){if("nodeParentKey"===s){const n=e.object,o=n?this.findNodeForData(n):null,a=this.findNodeForKey(e.newValue);if(n&&null!==this.Ua)null!==a&&(this.Ua.data=n,this.Ua.category=this.getLinkCategoryForData(n));else if(null!==o){const l=o.findTreeParentLink();null!==l?null===a?t.remove(l):t.isTreePathToChildren?l.fromNode=a:l.toNode=a:this.Tk(a,o)}}else if("parentLinkCategory"===s){const n=e.object,o=n?this.findNodeForData(n):null,r=e.newValue;if(null!==o&&"string"==typeof r){const a=o.findTreeParentLink();null!==a&&(a.category=r)}}t.isModified=!0}}else 2===i&&(e.object===t.model&&"nodeParentKeyProperty"===e.propertyName&&(t.undoManager.isUndoingRedoing||this.rebuildParts()),t.isModified=!0)}finally{t.G=!0}}}updateRelationshipsFromData(e){const t=e.data;if(null===t)return;const i=e.diagram;if(null!==i&&e instanceof nt){const n=i.model.getParentKeyForNodeData(t),o=i.findNodeForKey(n);if(o!==e.findTreeParentNode()){const a=e.findTreeParentLink();null!==o?null!==a?i.isTreePathToChildren?a.fromNode=o:a.toNode=o:this.Tk(o,e):null!==a&&i.L2(a,!1)}}}ow(e,t){if(super.ow(e,t),"string"==typeof t&&null!==this.findPartForData(e)){const i=this.findLinkForData(e);null!==i&&i.updateTargetBindings(t)}}Nk(e){const t=this.diagram.model,i=t.getKeyForNodeData(e);if(void 0!==i){const s=t.lw(i),n=this.findPartForData(e);if(null!==s&&null!==n){const r=s.iterator;for(;r.next();){const a=r.value;if(t.containsNodeData(a)&&n instanceof nt&&t.getParentKeyForNodeData(a)===i){const l=this.findNodeForData(a);this.Tk(n,l)}}t.an(i)}const o=t.getParentKeyForNodeData(e);if(void 0!==o&&n instanceof nt){const r=this.findNodeForKey(o);this.Tk(r,n)}}}XC(e){const t=this.diagram.model;if(e instanceof nt){const i=t.getKeyForNodeData(e.data),s=this.findLinkForData(e.data);if(null!==s){s.isSelected=!1,s.isHighlighted=!1;const r=s.layer;if(null!==r){const a=r.ri(-1,s,!1);a>=0&&this.diagram.raiseChangedEvent(4,"parts",r,s,null,a,null);const l=s.layerChanged;null!==l&&l(s,r,null)}}const n=this.diagram.isTreePathToChildren,o=e.linksConnected;for(;o.next();){const r=o.value,a=n?r.toNode:r.fromNode;if(null!==a){const l=a.data;t.containsNodeData(l)&&t.hn(i,l)}}}}insertLink(e,t,i,s){const n=this.diagram.model;let o=e,r=i;return this.diagram.isTreePathToChildren||(o=i,r=e),null!==o&&null!==r?(n.setParentKeyForNodeData(r.data,n.getKeyForNodeData(o.data)),r.findTreeParentLink()):null}});const Li=X.go,xi={get version(){return U.version},Group:pt,List:H,Set:z,Map:xt,Point:S,Size:lt,Rect:j,Margin:It,Spot:A,Geometry:Ct,PathFigure:Ht,PathSegment:St,InputEvent:xe,DiagramEvent:vi,ChangedEvent:li,Model:bt,GraphLinksModel:Ut,TreeModel:Ve,Binding:We,ThemeBinding:ni,Transaction:hi,UndoManager:Pi,CommandHandler:$t,Tool:te,DraggingTool:Ft,DraggingInfo:He,DraggingOptions:Mi,LinkingBaseTool:ce,LinkingTool:Ps,RelinkingTool:Ze,LinkReshapingTool:Ss,ResizingTool:Qe,RotatingTool:Fe,ClickSelectingTool:Ms,ActionTool:Cs,ClickCreatingTool:_e,HTMLInfo:be,ContextMenuTool:ti,DragSelectingTool:ci,PanningTool:ki,TextEditingTool:Ls,ToolManager:Ue,Animation:Si,AnimationManager:ue,AnimationTrigger:Ri,Layer:Gt,Diagram:U,Palette:class to extends U{constructor(e,t){let i;return void 0===e||"string"==typeof e||X.Element&&e instanceof Element?i=e:y.$(e)&&(t=e),super(i),this.ET(),t&&this.setProperties(t),this}ET(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=A.TopCenter,this.layout=new Ys}setupRouters(){}reset(){super.reset(),this.ET()}},Overview:ui,Brush:V,GraphObject:st,Panel:J,RowColumnDefinition:ee,Shape:rt,TextBlock:mt,Picture:Kt,Part:At,Adornment:Nt,Node:nt,Link:gt,Placeholder:de,Layout:se,LayoutNetwork:Ie,LayoutVertex:Be,LayoutEdge:si,GridLayout:Ys,PanelLayout:Rt,CircularLayout:vo,CircularNetwork:Ks,CircularVertex:mi,CircularEdge:Us,ForceDirectedLayout:ne,ForceDirectedNetwork:Hs,ForceDirectedVertex:je,ForceDirectedEdge:yi,LayeredDigraphLayout:Po,LayeredDigraphNetwork:Js,LayeredDigraphVertex:oi,LayeredDigraphEdge:Ae,TreeLayout:ko,TreeNetwork:fs,TreeVertex:Xt,TreeEdge:Qs,Themes:ke,ThemeManager:$e,Router:_s,AnimationStyle:Ds,AutoScale:Ei,CycleMode:Os,Flip:Is,TextFormat:Xi,ImageStretch:Gi,LayoutConditions:zs,LinkAdjusting:Hi,Curve:Wi,Routing:qi,Orientation:Bi,TextOverflow:js,PortSpreading:Xs,ScrollMode:Rs,CollapsePolicy:Es,Sizing:Vi,TriggerStart:Fs,Stretch:Ii,ViewboxStretch:Vs,Wrap:zi,BrushType:Re,ColorSpace:Bs,GeometryStretch:Fi,GeometryType:Ke,SegmentType:ai,BindingMode:Ai,ChangeType:Oi,CircularArrangement:_i,CircularDirection:ts,CircularNodeDiameterFormula:is,CircularSorting:es,GridAlignment:Ji,GridArrangement:Zi,GridSorting:Qi,LayeredDigraphAggressive:rs,LayeredDigraphAlign:$s,LayeredDigraphCycleRemove:ss,LayeredDigraphInit:os,LayeredDigraphLayering:ns,LayeredDigraphPack:Ws,TreeAlignment:hs,TreeArrangement:ds,TreeCompaction:cs,TreeLayerStyle:Zs,TreePath:as,TreeSorting:ls,TreeStyle:us,GestureMode:ws,LinkingDirection:vs,ReshapingBehavior:ks,TextEditingAccept:Ns,TextEditingStarting:Ts,TextEditingState:As,WheelMode:bs};for(const m in xi){const e=xi[m];y.st(e)&&e!==Xi&&(e.className=m)}y.$(Li)&&Li.version&&y.ne("WARNING: a `go` object on the root object is already defined.  "+("Debug"in Li?"debug ":"")+"version: "+Li.version+", replaced with version: "+xi.version),U.prototype.go=xi,X.go=xi}(),typeof global<"u"?global:self;const _=typeof global<"u"?global.go:self.go,on=_.Point,ri=_.Size,wi=_.Margin,ve=_.Spot,rn=_.GraphLinksModel,re=_.Binding,an=_.ToolManager,ys=_.Diagram,ln=_.GraphObject,xs=_.Panel,Di=_.Shape,Ye=_.TextBlock,hn=_.Adornment,Ge=_.Node,cn=_.Link,un=_.TreeLayout,dn=_.Routing,fn=_.TreeAlignment,gn=_.TreeArrangement,pn=_.TreeCompaction,mn=_.TreeSorting;var yn=ye(7705);const xn=["diagramDiv"],bn=["deleteBox"];function wn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"button",23),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.finalizeBlueprint.emit())}),k.nrm(1,"ion-icon",24),k.k0s()}}function vn(X,y){if(1&X&&(k.j41(0,"div",37)(1,"span",38),k.EFF(2,"Net After Fee:"),k.k0s(),k.j41(3,"span",39),k.EFF(4),k.k0s()()),2&X){const Q=k.XpG(3);k.R7$(4),k.JRh(Q.formatBasisPoints(Q.selectedNode.netBasisPoints))}}function Pn(X,y){if(1&X&&(k.j41(0,"div",32)(1,"div",33)(2,"span",34),k.EFF(3,"SplitXCH Fee:"),k.k0s(),k.j41(4,"span",35),k.EFF(5),k.k0s()(),k.DNE(6,vn,5,1,"div",36),k.k0s()),2&X){const Q=k.XpG(2);k.R7$(5),k.JRh(Q.formatBasisPoints(Q.selectedNode.feeBasisPoints||0)),k.R7$(),k.Y8G("ngIf",void 0!==Q.selectedNode.netBasisPoints)}}function kn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",44)(1,"div",45)(2,"div",46),k.EFF(3),k.j41(4,"span",47),k.EFF(5),k.k0s()(),k.j41(6,"div",48),k.EFF(7),k.k0s()(),k.j41(8,"div",49)(9,"span",50),k.EFF(10),k.k0s(),k.j41(11,"button",51),k.bIt("click",function(){const O=ct.eBV(Q).$implicit,G=k.XpG(3);return ct.Njj(G.onEditRecipient(G.selectedNode,O))}),k.nrm(12,"ion-icon",52),k.k0s(),k.j41(13,"button",53),k.bIt("click",function(){const O=ct.eBV(Q).$implicit,G=k.XpG(3);return ct.Njj(G.onRemoveRecipient(G.selectedNode,O.id))}),k.nrm(14,"ion-icon",20),k.k0s()()()}if(2&X){const Q=y.$implicit,R=k.XpG(3);k.R7$(3),k.SpI(" ",Q.name," "),k.R7$(2),k.SpI("(",R.getAddressTypeDisplay(Q),")"),k.R7$(),k.AVh("placeholder",R.isPlaceholderAddress(Q.address)),k.R7$(),k.SpI(" ",Q.address," "),k.R7$(3),k.JRh(R.formatBasisPoints(Q.basisPoints))}}function Sn(X,y){if(1&X&&(k.j41(0,"div",40)(1,"h4",41),k.EFF(2,"Recipients"),k.k0s(),k.j41(3,"div",42),k.DNE(4,kn,15,6,"div",43),k.k0s()()),2&X){const Q=k.XpG(2);k.R7$(4),k.Y8G("ngForOf",Q.selectedNode.recipients)}}function Mn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",44)(1,"div",45)(2,"div",46),k.EFF(3),k.k0s(),k.j41(4,"div",48),k.EFF(5,"Split Branch"),k.k0s()(),k.j41(6,"div",49)(7,"span",50),k.EFF(8),k.k0s(),k.j41(9,"button",54),k.bIt("click",function(){const O=ct.eBV(Q).$implicit,G=k.XpG(3);return ct.Njj(G.onSelectNode(O))}),k.nrm(10,"ion-icon",55),k.k0s(),k.j41(11,"button",53),k.bIt("click",function(){const O=ct.eBV(Q).$implicit,G=k.XpG(3);return ct.Njj(G.onRemoveNestedSplit(G.selectedNode,O.id))}),k.nrm(12,"ion-icon",20),k.k0s()()()}if(2&X){const Q=y.$implicit,R=k.XpG(3);k.R7$(3),k.JRh(Q.name),k.R7$(5),k.JRh(R.formatBasisPoints(Q.basisPoints))}}function Cn(X,y){if(1&X&&(k.j41(0,"div",40)(1,"h4",41),k.EFF(2,"Nested Splits"),k.k0s(),k.j41(3,"div",42),k.DNE(4,Mn,13,2,"div",43),k.k0s()()),2&X){const Q=k.XpG(2);k.R7$(4),k.Y8G("ngForOf",Q.selectedNode.children)}}function Nn(X,y){1&X&&(k.j41(0,"div",56)(1,"p"),k.EFF(2,"No recipients or nested splits"),k.k0s(),k.j41(3,"p",57),k.EFF(4,"Use the + button to add recipients"),k.k0s()())}function Tn(X,y){if(1&X&&(k.j41(0,"div",25)(1,"div",26)(2,"h3",27),k.EFF(3),k.k0s(),k.j41(4,"div",28),k.EFF(5),k.k0s(),k.DNE(6,Pn,7,2,"div",29),k.k0s(),k.DNE(7,Sn,5,1,"div",30)(8,Cn,5,1,"div",30)(9,Nn,5,0,"div",31),k.k0s()),2&X){const Q=k.XpG();k.R7$(3),k.JRh(Q.selectedNode.name),k.R7$(2),k.JRh(Q.formatBasisPoints(Q.selectedNode.basisPoints)),k.R7$(),k.Y8G("ngIf",Q.selectedNode.isSplitXCH&&Q.selectedNode.feeBasisPoints),k.R7$(),k.Y8G("ngIf",Q.selectedNode.recipients&&Q.selectedNode.recipients.length>0),k.R7$(),k.Y8G("ngIf",Q.selectedNode.children&&Q.selectedNode.children.length>0&&Q.isSplitXCHNode(Q.selectedNode)),k.R7$(),k.Y8G("ngIf",!(Q.selectedNode.recipients&&0!==Q.selectedNode.recipients.length||Q.selectedNode.children&&0!==Q.selectedNode.children.length))}}let An=(()=>{var X;class y{constructor(R,O){this.splitTreeService=R,this.cdr=O,this.tree=null,this.selectedNode=null,this.nodeSelected=new k.bkB,this.nodeDoubleClicked=new k.bkB,this.addRecipient=new k.bkB,this.addNestedSplit=new k.bkB,this.nodeDeleted=new k.bkB,this.nodeRenamed=new k.bkB,this.removeRecipient=new k.bkB,this.removeNestedSplit=new k.bkB,this.editRecipient=new k.bkB,this.createNewTree=new k.bkB,this.exportToJSON=new k.bkB,this.exportToSplitXCH=new k.bkB,this.finalizeBlueprint=new k.bkB,this.showFinalizeButton=!1,this.diagram=null,this.model=null,this.isDraggingOverDelete=!1}ngOnInit(){this.treeSubscription=this.splitTreeService.currentTree$.subscribe(R=>{R&&(this.tree=R,setTimeout(()=>{this.diagram&&this.model&&this.updateDiagram()},50))})}ngAfterViewInit(){this.initDiagram(),this.tree&&setTimeout(()=>{this.updateDiagram()},100)}ngOnDestroy(){this.treeSubscription&&this.treeSubscription.unsubscribe()}ngOnChanges(R){this.diagram&&R.tree&&R.tree.previousValue!==R.tree.currentValue&&setTimeout(()=>{this.updateDiagram()},0),this.diagram&&R.selectedNode&&setTimeout(()=>{this.highlightSelectedNode()},0)}initDiagram(){if(!this.diagramDiv)return;const R=ln.make;this.diagram=R(ys,this.diagramDiv.nativeElement,{initialAutoScale:ys.Uniform,contentAlignment:ve.Center,layout:R(un,{angle:0,layerSpacing:200,nodeSpacing:80,alignment:fn.CenterChildren,arrangement:gn.Horizontal,sorting:mn.Forwards,compaction:pn.None}),"undoManager.isEnabled":!0,allowDrop:!0,"toolManager.mouseWheelBehavior":an.WheelZoom,padding:new wi(40,40,100,40),"draggingTool.dragsTree":!0,"commandHandler.copiesTree":!0,"commandHandler.copiesParentKey":!1,"commandHandler.deletesTree":!0}),this.setupDeleteBox(),this.diagram.nodeTemplate=R(Ge,"Auto",{defaultAlignment:ve.Center,selectionObjectName:"SHAPE",desiredSize:new ri(NaN,NaN),selectionChanged:O=>{if(O instanceof Ge&&O.isSelected){const G=O.data;G&&G.nodeId&&this.onNodeSelected(G.nodeId)}},doubleClick:(O,G)=>{const q=G.part;if(q instanceof Ge){const ht=q.data;ht&&ht.nodeId&&this.onNodeDoubleClicked(ht.nodeId)}},contextMenu:R(hn,"Vertical",R(xs,"Horizontal",R("ContextMenuButton",R(Ye,"Add Wallet"),{click:(O,G)=>{const q=G.part?.adornedPart;if(q instanceof Ge){const ht=q.data;ht&&ht.nodeId&&!ht.isRecipient&&this.onAddRecipient(ht.nodeId)}}},new re("visible","",function(O){return!O.isRecipient})),R("ContextMenuButton",R(Ye,"Add Nested Split"),{click:(O,G)=>{const q=G.part?.adornedPart;if(q instanceof Ge){const ht=q.data;ht&&ht.nodeId&&!ht.isRecipient&&this.onAddNestedSplit(ht.nodeId)}}},new re("visible","",function(O){return!O.isRecipient}))))},R(Di,{name:"SHAPE",figure:"RoundedRectangle",fill:"#ffffff",stroke:"#667eea",strokeWidth:2},new re("figure","isRecipient",O=>O?"Circle":"RoundedRectangle"),new re("fill","",function(O,G){const q=O?.isSelected;return O?.isRecipient||q?"#f0f4ff":"#ffffff"}),new re("stroke","",function(O,G){return O?.isRecipient&&O?.hasEmptyAddress?"#f5576c":"#667eea"}),new re("strokeWidth","",function(O){return O?.isRecipient&&O?.hasEmptyAddress||O?.isSelected?3:2}),new re("width","isRecipient",O=>O?140:NaN),new re("height","isRecipient",O=>O?140:NaN),new re("minSize","isRecipient",O=>O?new ri(140,140):new ri(180,100)),new re("maxSize","isRecipient",O=>O?new ri(140,140):new ri(220,130))),R(xs,"Vertical",{defaultAlignment:ve.Center,alignment:ve.Center,margin:12,alignmentFocus:ve.Center},R(Ye,{font:"bold 14px sans-serif",textAlign:"center",alignment:ve.Center,wrap:Ye.WrapFit,maxLines:2,editable:!0,stroke:"#000000"},new re("text","name").makeTwoWay(),{textEdited:(O,G,q)=>{if(O.part&&O.part.data){const ht=O.part.data;ht&&ht.nodeId&&this.nodeRenamed.emit({nodeId:ht.nodeId,newName:q})}return!0}}),R(Ye,{font:"12px sans-serif",textAlign:"center",alignment:ve.Center,margin:new wi(4,0,0,0),stroke:"#000000",editable:!1},new re("text","basisPoints",O=>qt.formatBasisPoints(O))),R(Ye,{font:"10px sans-serif",textAlign:"center",alignment:ve.Center,margin:new wi(2,0,0,0),stroke:"#666666"},new re("text","recipientCount",O=>O>0?`${O} recipient${O>1?"s":""}`:"Empty split")),R(Ye,{font:"9px monospace",textAlign:"center",alignment:ve.Center,margin:new wi(4,0,0,0),stroke:"#667eea",maxLines:1,editable:!1,visible:!1},new re("text","splitAddress",O=>O?O.length>20?O.substring(0,8)+"..."+O.substring(O.length-6):O:""),new re("visible","splitAddress",O=>!!O&&O.startsWith("xch1")))),R("Button",{alignment:ve.Bottom,alignmentFocus:ve.Center,click:(O,G)=>{const q=G.part;if(q instanceof Ge){const ht=q.data;ht&&ht.nodeId&&!ht.isRecipient&&this.onAddRecipient(ht.nodeId)}}},R(Di,"PlusLine",{width:16,height:16,stroke:"#667eea",strokeWidth:3,background:"#ffffff",fill:"#ffffff"}),new re("visible","",function(O){return!O.isRecipient}))),this.diagram.linkTemplate=R(cn,{routing:dn.Orthogonal,corner:8,selectable:!1,fromEndSegmentLength:20,toEndSegmentLength:20},R(Di,{stroke:"#86868b",strokeWidth:2})),this.model=R(rn,{linkKeyProperty:"key",nodeKeyProperty:"key"}),this.diagram.model=this.model}updateDiagram(){if(this.diagram&&this.model&&this.tree)try{this.diagram.startTransaction("Update Diagram");const R=[],O=[];let G=0,q=0;const ht=(H,vt)=>{const z=G++;R.push({key:z,nodeId:H.id,name:H.name,basisPoints:H.basisPoints,recipientCount:(H.recipients?.length||0)+(H.children?.length||0),isSelected:this.selectedNode?.id===H.id,isRecipient:!1,isSplitXCH:H.isSplitXCH||!1,splitAddress:H.splitAddress}),void 0!==vt&&O.push({key:q++,from:vt,to:z}),H.children&&H.children.length>0&&H.children.forEach(Dt=>{ht(Dt,z)}),H.recipients&&H.recipients.length>0&&H.recipients.forEach(Dt=>{const Et=G++,Vt=Dt.address?.trim()||"";R.push({key:Et,nodeId:Dt.id,name:Dt.name,basisPoints:Dt.basisPoints,recipientCount:0,isRecipient:!0,address:Dt.address,addressType:Dt.addressType,isSelected:!1,hasEmptyAddress:Dt.addressType===oe.FIXED_WALLET&&(""===Vt||"xch1..."===Vt||"xch1"===Vt)}),O.push({key:q++,from:z,to:Et})})};ht(this.tree.root),this.model.startTransaction("Update Diagram"),this.model.nodeDataArray=R,this.model.linkDataArray=O,this.model.commitTransaction("Update Diagram"),this.diagram.commitTransaction("Update Diagram"),this.diagram.layout.invalidateLayout(),setTimeout(()=>{this.highlightSelectedNode()},50)}catch(R){console.error("Error updating diagram:",R),this.diagram&&this.diagram.rollbackTransaction()}else console.log("Update diagram skipped:",{hasDiagram:!!this.diagram,hasModel:!!this.model,hasTree:!!this.tree})}findNodeByKey(R){return this.model?this.model.findNodeDataForKey(R):null}highlightSelectedNode(){if(this.diagram&&this.selectedNode&&(this.diagram.clearSelection(),this.model)){const R=this.model.nodeDataArray.find(O=>O.nodeId===this.selectedNode?.id);if(R){const O=this.diagram.findPartForData(R);O&&(this.diagram.select(O),this.diagram.centerRect(O.actualBounds))}}}onNodeSelected(R){if(!this.tree)return;const O=this.findNodeById(this.tree.root,R);O&&this.nodeSelected.emit(O)}onNodeDoubleClicked(R){if(!this.tree)return;const O=this.findNodeById(this.tree.root,R);O&&this.nodeDoubleClicked.emit(O)}onAddRecipient(R){if(!this.tree)return;const O=this.findNodeById(this.tree.root,R);O&&this.addRecipient.emit(O)}onAddNestedSplit(R){if(!this.tree)return;const O=this.findNodeById(this.tree.root,R);O&&this.addNestedSplit.emit(O)}onNodeRenamed(R,O){this.nodeRenamed.emit({nodeId:R,newName:O})}setupDeleteBox(){!this.deleteBox||!this.diagram||this.diagram.addDiagramListener("ExternalObjectsDropped",R=>{const O=R.diagram,G=O.selection,q=O.lastInput.viewPoint,ht=O.div;if(!ht)return;const H=ht.getBoundingClientRect();new on(q.x-H.left,q.y-H.top).y>H.height-100&&G.each(z=>{if(z instanceof Ge&&z.data){const Yt=z.data;Yt&&Yt.nodeId&&this.nodeDeleted.emit({nodeId:Yt.nodeId,isRecipient:Yt.isRecipient||!1})}}),this.isDraggingOverDelete=!1,this.cdr.detectChanges()})}findNodeById(R,O){if(R.id===O)return R;if(R.children)for(const G of R.children){const q=this.findNodeById(G,O);if(q)return q}return R.recipients&&R.recipients.find(q=>q.id===O)?R:null}zoomToFit(){this.diagram&&this.diagram.commandHandler.zoomToFit()}resetZoom(){this.diagram&&this.diagram.commandHandler.resetZoom()}formatBasisPoints(R){return qt.formatBasisPoints(R)}isSplitXCHNode(R){return!0===R.isSplitXCH}isPlaceholderAddress(R){return R.startsWith("splitxch_temp_")}getAddressTypeDisplay(R){switch(R.addressType){case oe.FIXED_WALLET:return"Wallet";case oe.SPLITXCH_PLACEHOLDER:return"Split (Pending)";case oe.SPLITXCH_REAL:return"Split";default:return"Unknown"}}onSelectNode(R){this.nodeSelected.emit(R)}onEditRecipient(R,O){this.editRecipient.emit({node:R,recipient:O})}onRemoveRecipient(R,O){this.removeRecipient.emit({node:R,recipientId:O})}onRemoveNestedSplit(R,O){this.removeNestedSplit.emit({parentNode:R,childNodeId:O})}static#t=X=()=>(this.\u0275fac=function(O){return new(O||y)(k.rXU(ms),k.rXU(yn.gRc))},this.\u0275cmp=k.VBU({type:y,selectors:[["app-split-diagram"]],viewQuery:function(O,G){if(1&O&&(k.GBs(xn,5),k.GBs(bn,5)),2&O){let q;k.mGM(q=k.lsd())&&(G.diagramDiv=q.first),k.mGM(q=k.lsd())&&(G.deleteBox=q.first)}},inputs:{tree:"tree",selectedNode:"selectedNode",showFinalizeButton:"showFinalizeButton"},outputs:{nodeSelected:"nodeSelected",nodeDoubleClicked:"nodeDoubleClicked",addRecipient:"addRecipient",addNestedSplit:"addNestedSplit",nodeDeleted:"nodeDeleted",nodeRenamed:"nodeRenamed",removeRecipient:"removeRecipient",removeNestedSplit:"removeNestedSplit",editRecipient:"editRecipient",createNewTree:"createNewTree",exportToJSON:"exportToJSON",exportToSplitXCH:"exportToSplitXCH",finalizeBlueprint:"finalizeBlueprint"},standalone:!1,features:[k.OA$],decls:27,vars:4,consts:[["diagramDiv",""],["deleteBox",""],[1,"diagram-container"],[1,"diagram-header-bar"],[1,"diagram-toolbar"],["title","Fit",1,"icon-button",3,"click"],["name","expand"],["title","Reset",1,"icon-button",3,"click"],["name","resize"],["title","New Split",1,"icon-button",3,"click"],["name","add-outline"],["title","Export",1,"icon-button",3,"click"],["name","download-outline"],["title","Export SplitXCH",1,"icon-button",3,"click"],["name","code-outline"],["class","icon-button","title","Finalize Blueprint",3,"click",4,"ngIf"],[1,"diagram-content-wrapper"],[1,"diagram-wrapper"],["class","diagram-sidebar",4,"ngIf"],[1,"delete-box"],["name","trash-outline"],[1,"diagram-hint"],["name","information-circle"],["title","Finalize Blueprint",1,"icon-button",3,"click"],["name","checkmark-done-outline"],[1,"diagram-sidebar"],[1,"sidebar-header"],[1,"sidebar-title"],[1,"sidebar-basis-points"],["class","sidebar-fee-info",4,"ngIf"],["class","sidebar-section",4,"ngIf"],["class","sidebar-empty",4,"ngIf"],[1,"sidebar-fee-info"],[1,"sidebar-fee-line"],[1,"sidebar-fee-label"],[1,"sidebar-fee-value"],["class","sidebar-net-line",4,"ngIf"],[1,"sidebar-net-line"],[1,"sidebar-net-label"],[1,"sidebar-net-value"],[1,"sidebar-section"],[1,"sidebar-section-title"],[1,"sidebar-recipient-list"],["class","sidebar-recipient-item",4,"ngFor","ngForOf"],[1,"sidebar-recipient-item"],[1,"sidebar-recipient-info"],[1,"sidebar-recipient-name"],[1,"sidebar-recipient-type"],[1,"sidebar-recipient-address"],[1,"sidebar-recipient-actions"],[1,"sidebar-recipient-percentage"],["title","Edit",1,"sidebar-icon-button",3,"click"],["name","create-outline"],["title","Remove",1,"sidebar-icon-button",3,"click"],["title","Select",1,"sidebar-icon-button",3,"click"],["name","arrow-forward-outline"],[1,"sidebar-empty"],[1,"sidebar-empty-hint"]],template:function(O,G){if(1&O){const q=k.RV6();k.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"button",5),k.bIt("click",function(){return ct.eBV(q),ct.Njj(G.zoomToFit())}),k.nrm(4,"ion-icon",6),k.k0s(),k.j41(5,"button",7),k.bIt("click",function(){return ct.eBV(q),ct.Njj(G.resetZoom())}),k.nrm(6,"ion-icon",8),k.k0s(),k.j41(7,"button",9),k.bIt("click",function(){return ct.eBV(q),ct.Njj(G.createNewTree.emit())}),k.nrm(8,"ion-icon",10),k.k0s(),k.j41(9,"button",11),k.bIt("click",function(){return ct.eBV(q),ct.Njj(G.exportToJSON.emit())}),k.nrm(10,"ion-icon",12),k.k0s(),k.j41(11,"button",13),k.bIt("click",function(){return ct.eBV(q),ct.Njj(G.exportToSplitXCH.emit())}),k.nrm(12,"ion-icon",14),k.k0s(),k.DNE(13,wn,2,0,"button",15),k.k0s()(),k.j41(14,"div",16),k.nrm(15,"div",17,0),k.DNE(17,Tn,10,6,"div",18),k.k0s(),k.j41(18,"div",19,1),k.nrm(20,"ion-icon",20),k.j41(21,"span"),k.EFF(22,"Drop Here To Delete"),k.k0s()(),k.j41(23,"div",21),k.nrm(24,"ion-icon",22),k.j41(25,"span"),k.EFF(26,"Click node name to edit \u2022 Right-click for menu \u2022 Drag to delete area to remove"),k.k0s()()()}2&O&&(k.R7$(13),k.Y8G("ngIf",G.showFinalizeButton),k.R7$(4),k.Y8G("ngIf",G.selectedNode),k.R7$(),k.AVh("drag-over",G.isDraggingOverDelete))},dependencies:[Je.Sq,Je.bT,ze.iq],styles:[".diagram-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;background:#fafbfc;border-radius:12px;overflow:hidden;box-shadow:inset 0 2px 8px #0000000a}.diagram-header-bar[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:space-between;align-items:center;padding:20px 16px 12px;background:#fffc;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-bottom:1px solid rgba(0,0,0,.05);min-height:56px;overflow:visible}.diagram-toolbar[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.icon-button[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:8px;background:#ffffffe6;border:1px solid rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;color:#1d1d1f;padding:0}.icon-button[_ngcontent-%COMP%]:hover{background:#0000000d;border-color:#00000026}.icon-button[_ngcontent-%COMP%]:active{background:#0000001a}.icon-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.diagram-content-wrapper[_ngcontent-%COMP%]{flex:1;display:flex;position:relative;min-height:400px;overflow:hidden}.diagram-wrapper[_ngcontent-%COMP%]{flex:1;min-height:400px;background:#fafbfc;position:relative;overflow:hidden}.diagram-wrapper[_ngcontent-%COMP%]     canvas{outline:none;cursor:grab}.diagram-wrapper[_ngcontent-%COMP%]     canvas:active{cursor:grabbing}.diagram-fab[_ngcontent-%COMP%]{position:absolute;top:-8px;right:16px;z-index:1000;pointer-events:auto}.diagram-sidebar[_ngcontent-%COMP%]{width:320px;background:#fff;border-left:1px solid rgba(0,0,0,.05);display:flex;flex-direction:column;overflow-y:auto;max-height:100%}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-header[_ngcontent-%COMP%]{padding:20px;border-bottom:1px solid rgba(0,0,0,.05);background:#fafbfc}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1d1d1f;margin:0 0 8px}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-basis-points[_ngcontent-%COMP%]{font-size:14px;margin-bottom:8px}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-fee-info[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px;border-top:1px solid rgba(0,0,0,.08)}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-fee-line[_ngcontent-%COMP%], .diagram-sidebar[_ngcontent-%COMP%]   .sidebar-net-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:13px}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-fee-label[_ngcontent-%COMP%], .diagram-sidebar[_ngcontent-%COMP%]   .sidebar-net-label[_ngcontent-%COMP%]{color:#86868b;font-weight:500}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-fee-value[_ngcontent-%COMP%]{color:#ff9500;font-weight:600}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-net-value[_ngcontent-%COMP%]{color:#667eea;font-weight:600}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-section[_ngcontent-%COMP%]{padding:16px 20px;border-bottom:1px solid rgba(0,0,0,.05)}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-section[_ngcontent-%COMP%]:last-child{border-bottom:none}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-section-title[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#86868b;text-transform:uppercase;letter-spacing:.5px;margin:0 0 12px}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-item[_ngcontent-%COMP%]{padding:12px;background:#fafbfc;border-radius:8px;display:flex;justify-content:space-between;align-items:center;transition:all .2s ease}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-item[_ngcontent-%COMP%]:hover{background:#f5f5f7}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-info[_ngcontent-%COMP%]{flex:1;min-width:0}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-name[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#1d1d1f;margin-bottom:4px;word-break:break-word}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-type[_ngcontent-%COMP%]{font-size:11px;color:#86868b;font-weight:400}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-address[_ngcontent-%COMP%]{font-size:12px;color:#86868b;font-family:SF Mono,Monaco,Courier New,monospace;word-break:break-all}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-address.placeholder[_ngcontent-%COMP%]{color:#ff9500}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-left:12px}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-recipient-percentage[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#667eea;min-width:60px;text-align:right}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-icon-button[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;background:transparent;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;color:#86868b}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-icon-button[_ngcontent-%COMP%]:hover{background:#0000000d;color:#1d1d1f}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-icon-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-empty[_ngcontent-%COMP%]{padding:40px 20px;text-align:center;color:#86868b;font-size:14px}.diagram-sidebar[_ngcontent-%COMP%]   .sidebar-empty[_ngcontent-%COMP%]   .sidebar-empty-hint[_ngcontent-%COMP%]{font-size:12px;margin-top:8px;opacity:.7}.diagram-hint[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px;padding:12px 16px;background:#fffc;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-top:1px solid rgba(0,0,0,.05);font-size:11px;color:#86868b;font-weight:500}.diagram-hint[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.delete-box[_ngcontent-%COMP%]{position:absolute;bottom:16px;left:50%;transform:translate(-50%);width:200px;height:60px;background:#f5576c1a;border:2px dashed #f5576c;border-radius:12px;display:flex;align-items:center;justify-content:center;gap:12px;color:#f5576c;font-weight:600;font-size:14px;pointer-events:none;transition:all .2s ease;opacity:0;z-index:10}.delete-box.drag-over[_ngcontent-%COMP%]{opacity:1;background:#f5576c33;border-color:#f5576c;transform:translate(-50%) scale(1.05)}.delete-box[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}"]}))}return X(),y})();function Ln(X,y){1&X&&(k.j41(0,"div"),k.EFF(1,"\u2713 Split configuration is valid and ready"),k.k0s())}function Dn(X,y){if(1&X&&(k.j41(0,"div"),k.EFF(1),k.k0s()),2&X){const Q=k.XpG(2);k.R7$(),k.SpI(" ",Q.validation.errors[0]," ")}}function Fn(X,y){if(1&X&&(k.j41(0,"div",22),k.EFF(1),k.k0s()),2&X){const Q=k.XpG(2);k.R7$(),k.SpI(" ",Q.validation.warnings[0]," ")}}function On(X,y){if(1&X&&(k.j41(0,"div",16)(1,"div",17),k.nrm(2,"ion-icon",18),k.j41(3,"div",19),k.DNE(4,Ln,2,0,"div",20)(5,Dn,2,1,"div",20)(6,Fn,2,1,"div",21),k.k0s()()()),2&X){const Q=k.XpG();k.AVh("success",Q.validation.valid)("error",Q.validation&&!Q.validation.valid&&Q.validation.errors.length>0),k.R7$(2),k.Y8G("name",Q.validation.valid?"checkmark-circle":"alert-circle"),k.R7$(2),k.Y8G("ngIf",Q.validation.valid),k.R7$(),k.Y8G("ngIf",!Q.validation.valid&&Q.validation.errors.length>0),k.R7$(),k.Y8G("ngIf",Q.validation.warnings.length>0)}}function Rn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",23)(1,"div",24)(2,"app-split-diagram",25),k.bIt("nodeSelected",function(O){ct.eBV(Q);const G=k.XpG();return ct.Njj(G.selectNode(O))})("nodeDoubleClicked",function(O){ct.eBV(Q);const G=k.XpG();return ct.Njj(G.selectNode(O))})("addRecipient",function(O){ct.eBV(Q);const G=k.XpG();return ct.Njj(G.openAddRecipientModal(O))})("addNestedSplit",function(O){ct.eBV(Q);const G=k.XpG();return ct.Njj(G.openAddNestedSplitModal(O))})("nodeDeleted",function(O){ct.eBV(Q);const G=k.XpG();return ct.Njj(G.handleNodeDeleted(O))})("nodeRenamed",function(O){ct.eBV(Q);const G=k.XpG();return ct.Njj(G.handleNodeRenamed(O))})("removeRecipient",function(O){ct.eBV(Q);const G=k.XpG();return ct.Njj(G.removeRecipient(O.node,O.recipientId))})("removeNestedSplit",function(O){ct.eBV(Q);const G=k.XpG();return ct.Njj(G.removeNestedSplit(O))})("editRecipient",function(O){ct.eBV(Q);const G=k.XpG();return ct.Njj(G.editRecipient(O.node,O.recipient))})("createNewTree",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.openNewTreeModal())})("exportToJSON",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.exportToJSON())})("exportToSplitXCH",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.exportToSplitXCH())})("finalizeBlueprint",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.finalizeBlueprint())}),k.k0s()()()}if(2&X){const Q=k.XpG();k.R7$(2),k.Y8G("tree",Q.tree)("selectedNode",Q.selectedNode)("showFinalizeButton",!Q.isFinalized()&&Q.hasPlaceholders())}}function En(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",26),k.nrm(1,"ion-icon",27),k.j41(2,"p",28),k.EFF(3,"No split tree created yet"),k.k0s(),k.j41(4,"button",29),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.openNewTreeModal())}),k.nrm(5,"ion-icon",30),k.EFF(6," Create Split Tree "),k.k0s()()}}function In(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",34)(1,"label",35),k.EFF(2,"XCH Wallet Address"),k.k0s(),k.j41(3,"input",47),k.mxI("ngModelChange",function(O){ct.eBV(Q);const G=k.XpG(2);return k.DH7(G.newRecipient.address,O)||(G.newRecipient.address=O),ct.Njj(O)}),k.k0s(),k.j41(4,"div",43),k.EFF(5,"Enter the recipient's Chia wallet address"),k.k0s()()}if(2&X){const Q=k.XpG(2);k.R7$(3),k.R50("ngModel",Q.newRecipient.address)}}function Bn(X,y){1&X&&(k.j41(0,"div",34)(1,"div",48),k.nrm(2,"ion-icon",49),k.EFF(3," This will create a new SplitXCH split branch. A placeholder address will be assigned until you finalize the blueprint. "),k.k0s()())}function Vn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",31)(1,"div",32)(2,"h2",33),k.EFF(3,"Add Recipient"),k.k0s()(),k.j41(4,"div",34)(5,"label",35),k.EFF(6,"Recipient Type"),k.k0s(),k.j41(7,"div",36)(8,"button",37),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.newRecipient.isFixedWallet=!0)}),k.nrm(9,"ion-icon",38),k.EFF(10," Fixed Wallet "),k.k0s(),k.j41(11,"button",37),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.newRecipient.isFixedWallet=!1)}),k.nrm(12,"ion-icon",39),k.EFF(13," New Split "),k.k0s()()(),k.j41(14,"div",34)(15,"label",35),k.EFF(16,"Recipient Name"),k.k0s(),k.j41(17,"input",40),k.mxI("ngModelChange",function(O){ct.eBV(Q);const G=k.XpG();return k.DH7(G.newRecipient.name,O)||(G.newRecipient.name=O),ct.Njj(O)}),k.k0s()(),k.DNE(18,In,6,1,"div",41)(19,Bn,4,0,"div",41),k.j41(20,"div",34)(21,"label",35),k.EFF(22,"Percentage"),k.k0s(),k.j41(23,"input",42),k.mxI("ngModelChange",function(O){ct.eBV(Q);const G=k.XpG();return k.DH7(G.newRecipient.percentage,O)||(G.newRecipient.percentage=O),ct.Njj(O)}),k.k0s(),k.j41(24,"div",43),k.EFF(25,"Must sum to 100% with other recipients/splits in this node"),k.k0s()(),k.j41(26,"div",44)(27,"button",45),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.showAddRecipientModal=!1)}),k.EFF(28,"Cancel"),k.k0s(),k.j41(29,"button",46),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.addRecipient())}),k.EFF(30),k.k0s()()()}if(2&X){const Q=k.XpG();k.R7$(8),k.AVh("primary",Q.newRecipient.isFixedWallet)("secondary",!Q.newRecipient.isFixedWallet),k.R7$(3),k.AVh("primary",!Q.newRecipient.isFixedWallet)("secondary",Q.newRecipient.isFixedWallet),k.R7$(6),k.R50("ngModel",Q.newRecipient.name),k.R7$(),k.Y8G("ngIf",Q.newRecipient.isFixedWallet),k.R7$(),k.Y8G("ngIf",!Q.newRecipient.isFixedWallet),k.R7$(4),k.R50("ngModel",Q.newRecipient.percentage),k.R7$(7),k.SpI(" ",Q.newRecipient.isFixedWallet?"Add Wallet":"Create Split Branch"," ")}}function jn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",31)(1,"div",32)(2,"h2",33),k.EFF(3,"Create New Split Tree"),k.k0s()(),k.j41(4,"div",34)(5,"label",35),k.EFF(6,"Tree Name"),k.k0s(),k.j41(7,"input",50),k.mxI("ngModelChange",function(O){ct.eBV(Q);const G=k.XpG();return k.DH7(G.newTreeName,O)||(G.newTreeName=O),ct.Njj(O)}),k.k0s(),k.j41(8,"div",43),k.EFF(9,"This will replace the current split tree with a new one"),k.k0s()(),k.j41(10,"div",44)(11,"button",45),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.showNewTreeModal=!1)}),k.EFF(12,"Cancel"),k.k0s(),k.j41(13,"button",46),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.createNewTree())}),k.EFF(14,"Create Tree"),k.k0s()()()}if(2&X){const Q=k.XpG();k.R7$(7),k.R50("ngModel",Q.newTreeName)}}function zn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",31)(1,"div",32)(2,"h2",33),k.EFF(3,"Create New Split Branch"),k.k0s()(),k.j41(4,"div",34)(5,"label",35),k.EFF(6,"Split Name"),k.k0s(),k.j41(7,"input",51),k.mxI("ngModelChange",function(O){ct.eBV(Q);const G=k.XpG();return k.DH7(G.newNestedSplit.name,O)||(G.newNestedSplit.name=O),ct.Njj(O)}),k.k0s()(),k.j41(8,"div",34)(9,"label",35),k.EFF(10,"Percentage"),k.k0s(),k.j41(11,"input",42),k.mxI("ngModelChange",function(O){ct.eBV(Q);const G=k.XpG();return k.DH7(G.newNestedSplit.percentage,O)||(G.newNestedSplit.percentage=O),ct.Njj(O)}),k.k0s(),k.j41(12,"div",43),k.EFF(13,"Must sum to 100% with other recipients/splits in this node"),k.k0s()(),k.j41(14,"div",44)(15,"button",45),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.showAddNestedSplitModal=!1)}),k.EFF(16,"Cancel"),k.k0s(),k.j41(17,"button",46),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG();return ct.Njj(O.addNestedSplit())}),k.EFF(18,"Create Branch"),k.k0s()()()}if(2&X){const Q=k.XpG();k.R7$(7),k.R50("ngModel",Q.newNestedSplit.name),k.R7$(4),k.R50("ngModel",Q.newNestedSplit.percentage)}}function Xn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",31)(1,"div",32)(2,"h2",33),k.EFF(3,"Edit Recipient"),k.k0s()(),k.j41(4,"div",34)(5,"label",35),k.EFF(6,"Recipient Name"),k.k0s(),k.j41(7,"input",40),k.mxI("ngModelChange",function(O){ct.eBV(Q);const G=k.XpG(2);return k.DH7(G.editingRecipient.name,O)||(G.editingRecipient.name=O),ct.Njj(O)}),k.k0s()(),k.j41(8,"div",34)(9,"label",35),k.EFF(10,"XCH Address"),k.k0s(),k.j41(11,"input",47),k.mxI("ngModelChange",function(O){ct.eBV(Q);const G=k.XpG(2);return k.DH7(G.editingRecipient.address,O)||(G.editingRecipient.address=O),ct.Njj(O)}),k.k0s()(),k.j41(12,"div",34)(13,"label",35),k.EFF(14,"Percentage"),k.k0s(),k.j41(15,"input",42),k.mxI("ngModelChange",function(O){ct.eBV(Q);const G=k.XpG(2);return k.DH7(G.editingRecipientPercentage,O)||(G.editingRecipientPercentage=O),ct.Njj(O)}),k.k0s()(),k.j41(16,"div",44)(17,"button",45),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG(2);return ct.Njj(O.showEditRecipientModal=!1)}),k.EFF(18,"Cancel"),k.k0s(),k.j41(19,"button",46),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG(2);return ct.Njj(O.saveRecipientEdit())}),k.EFF(20,"Save Changes"),k.k0s()()()}if(2&X){const Q=k.XpG(2);k.R7$(7),k.R50("ngModel",Q.editingRecipient.name),k.R7$(4),k.R50("ngModel",Q.editingRecipient.address),k.R7$(4),k.R50("ngModel",Q.editingRecipientPercentage)}}function Yn(X,y){if(1&X&&k.DNE(0,Xn,21,3,"div",52),2&X){const Q=k.XpG();k.Y8G("ngIf",Q.editingRecipient)}}function Gn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",65)(1,"div",66)(2,"div",67),k.EFF(3),k.k0s(),k.j41(4,"code",68),k.EFF(5),k.k0s()(),k.j41(6,"button",60),k.bIt("click",function(){const O=ct.eBV(Q).$implicit,G=k.XpG(3);return ct.Njj(G.copyAddressToClipboard(O.address))}),k.nrm(7,"ion-icon",61),k.k0s()()}if(2&X){const Q=y.$implicit;k.R7$(3),k.JRh(Q.name),k.R7$(2),k.JRh(Q.address)}}function Kn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",31)(1,"div",32)(2,"div",53),k.nrm(3,"ion-icon",54),k.k0s(),k.j41(4,"h2",33),k.EFF(5,"Blueprint Finalized Successfully!"),k.k0s(),k.j41(6,"p",55),k.EFF(7,"All SplitXCH addresses have been created"),k.k0s()(),k.j41(8,"div",56)(9,"label",57),k.EFF(10,"Root Split Address"),k.k0s(),k.j41(11,"div",58)(12,"code",59),k.EFF(13),k.k0s(),k.j41(14,"button",60),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG(2);return ct.Njj(O.copyAddressToClipboard(O.tree.root.splitAddress||""))}),k.nrm(15,"ion-icon",61),k.k0s()()(),k.j41(16,"div",34)(17,"label",35),k.EFF(18,"Created Split Addresses"),k.k0s(),k.j41(19,"div",62),k.DNE(20,Gn,8,2,"div",63),k.k0s()(),k.j41(21,"div",44)(22,"button",45),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG(2);return ct.Njj(O.showFinalizeModal=!1)}),k.EFF(23,"Close"),k.k0s(),k.j41(24,"button",46),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG(2);return ct.Njj(O.downloadFinalizedTree())}),k.nrm(25,"ion-icon",64),k.EFF(26," Download Finalized Tree "),k.k0s()()()}if(2&X){const Q=k.XpG(2);k.R7$(13),k.JRh(Q.tree.root.splitAddress),k.R7$(7),k.Y8G("ngForOf",Q.getFinalizationAddresses())}}function Un(X,y){if(1&X&&k.DNE(0,Kn,27,2,"div",52),2&X){const Q=k.XpG();k.Y8G("ngIf",Q.finalizationResult&&Q.finalizationResult.success&&Q.tree)}}function Hn(X,y){if(1&X){const Q=k.RV6();k.j41(0,"div",31)(1,"div",32)(2,"h2",33),k.EFF(3,"SplitXCH Export"),k.k0s()(),k.j41(4,"div",34)(5,"label",35),k.EFF(6,"SplitXCH Mapping"),k.k0s(),k.j41(7,"pre",69),k.EFF(8),k.nI1(9,"json"),k.k0s()(),k.j41(10,"div",44)(11,"button",45),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG(2);return ct.Njj(O.showExportModal=!1)}),k.EFF(12,"Close"),k.k0s(),k.j41(13,"button",46),k.bIt("click",function(){ct.eBV(Q);const O=k.XpG(2);return ct.Njj(O.copyToClipboard())}),k.EFF(14,"Copy to Clipboard"),k.k0s()()()}if(2&X){const Q=k.XpG(2);k.R7$(8),k.JRh(k.bMT(9,1,Q.exportMapping))}}function qn(X,y){if(1&X&&k.DNE(0,Hn,15,3,"div",52),2&X){const Q=k.XpG();k.Y8G("ngIf",Q.exportMapping)}}const Wn=[{path:"",component:(()=>{var X;class y{constructor(R,O,G,q){this.splitTreeService=R,this.splitXCHApi=O,this.alertController=G,this.loadingController=q,this.tree=null,this.validation=null,this.selectedNode=null,this.showAddRecipientModal=!1,this.showAddNestedSplitModal=!1,this.showEditRecipientModal=!1,this.showExportModal=!1,this.showNewTreeModal=!1,this.viewMode="diagram",this.newRecipient={name:"",address:"",percentage:0,isFixedWallet:!0},this.newNestedSplit={name:"",percentage:0},this.newTreeName="Main Split",this.editingRecipient=null,this.showFinalizeModal=!1,this.finalizationResult=null,this.editingRecipientBasisPoints=0,this.exportMapping=null,this.finalPercentagesArray=[]}ngOnInit(){this.splitTreeService.currentTree$.subscribe(R=>{this.tree=R,R&&(this.validation=this.splitTreeService.validateTree(R),this.getFinalPercentages())}),this.tree||(this.tree=this.splitTreeService.createNewTree("Main Split"),this.selectedNode=this.tree.root)}openNewTreeModal(){this.newTreeName="Main Split",this.showNewTreeModal=!0}createNewTree(){this.newTreeName&&""!==this.newTreeName.trim()?(this.tree=this.splitTreeService.createNewTree(this.newTreeName.trim()),this.selectedNode=this.tree.root,this.showNewTreeModal=!1):this.showAlert("Error","Please enter a name for the split tree.")}selectNode(R){this.selectedNode=R}getRootNode(){return this.tree?.root||null}openAddRecipientModal(R){var O=this;return(0,ge.A)(function*(){R.isSplitXCH?(O.selectedNode=R,O.newRecipient={name:"",address:"",percentage:0,isFixedWallet:!0},O.showAddRecipientModal=!0):O.showAlert("Error","You can only add recipients to SplitXCH nodes, not to wallet addresses.")})()}addRecipient(){if(!this.tree||!this.selectedNode)return;if(!this.newRecipient.name||!this.newRecipient.percentage)return void this.showAlert("Error","Please fill in name and percentage");const R=qt.percentageToBasisPoints(this.newRecipient.percentage);try{if(this.newRecipient.isFixedWallet){if(!this.newRecipient.address)return void this.showAlert("Error","Please enter a wallet address");this.splitTreeService.addFixedWalletRecipient(this.tree,this.selectedNode.id,this.newRecipient.name,this.newRecipient.address,R)}else this.splitTreeService.addNestedSplit(this.tree,this.selectedNode.id,this.newRecipient.name,R);this.showAddRecipientModal=!1,this.newRecipient={name:"",address:"",percentage:0,isFixedWallet:!0}}catch(O){this.showAlert("Error",O.message)}}removeRecipient(R,O){this.tree&&this.splitTreeService.removeRecipient(this.tree,R.id,O)}editRecipient(R,O){var G=this;return(0,ge.A)(function*(){G.selectedNode=R,G.editingRecipient={...O},G.editingRecipientBasisPoints=O.basisPoints,G.showEditRecipientModal=!0})()}get editingRecipientPercentage(){return qt.basisPointsToPercentage(this.editingRecipientBasisPoints)}set editingRecipientPercentage(R){this.editingRecipientBasisPoints=qt.percentageToBasisPoints(R)}saveRecipientEdit(){!this.tree||!this.selectedNode||!this.editingRecipient||(this.splitTreeService.updateRecipient(this.tree,this.selectedNode.id,this.editingRecipient.id,{...this.editingRecipient,basisPoints:this.editingRecipientBasisPoints}),this.showEditRecipientModal=!1,this.editingRecipient=null,this.editingRecipientBasisPoints=0)}openAddNestedSplitModal(R){var O=this;return(0,ge.A)(function*(){R.isSplitXCH?(O.selectedNode=R,O.newNestedSplit={name:"",percentage:0},O.showAddNestedSplitModal=!0):O.showAlert("Error","You can only add nested splits to SplitXCH nodes, not to wallet addresses.")})()}addNestedSplit(){if(!this.tree||!this.selectedNode)return;if(!this.selectedNode.isSplitXCH)return void this.showAlert("Error","You can only add nested splits to SplitXCH nodes.");if(!this.newNestedSplit.name||!this.newNestedSplit.percentage)return void this.showAlert("Error","Please fill in all fields");const R=qt.percentageToBasisPoints(this.newNestedSplit.percentage);try{this.splitTreeService.addNestedSplit(this.tree,this.selectedNode.id,this.newNestedSplit.name,R),this.showAddNestedSplitModal=!1,this.newNestedSplit={name:"",percentage:0}}catch(O){this.showAlert("Error",O.message)}}removeNestedSplit(R){this.tree&&this.splitTreeService.removeNestedSplit(this.tree,R.parentNode.id,R.childNodeId)}exportToSplitXCH(){var R=this;return(0,ge.A)(function*(){if(!R.tree)return;const O=R.splitTreeService.validateTree(R.tree);if(O.valid)return R.exportMapping=R.splitTreeService.exportToSplitXCH(R.tree),R.showExportModal=!0,R.exportMapping;R.showAlert("Validation Error",`Please fix errors before exporting:\n${O.errors.join("\n")}`)})()}copyToClipboard(){var R=this;return(0,ge.A)(function*(){if(!R.exportMapping)return;const O=JSON.stringify(R.exportMapping,null,2);try{yield navigator.clipboard.writeText(O),R.showAlert("Success","Copied to clipboard!")}catch{R.showAlert("Error","Failed to copy to clipboard")}})()}exportToJSON(){if(!this.tree)return;const R=this.splitTreeService.exportToJSON(this.tree),O=new Blob([R],{type:"application/json"}),G=URL.createObjectURL(O),q=document.createElement("a");q.href=G,q.download="split-tree.json",q.click(),URL.revokeObjectURL(G)}importTree(R){var O=this;return(0,ge.A)(function*(){const G=R.target;if(!G.files||0===G.files.length)return;const ht=yield G.files[0].text();try{O.splitTreeService.importTree(ht),O.showAlert("Success","Tree imported successfully")}catch(H){O.showAlert("Import Error",H.message)}})()}showAlert(R,O){var G=this;return(0,ge.A)(function*(){yield(yield G.alertController.create({header:R,message:O,buttons:["OK"]})).present()})()}getFinalPercentages(){if(!this.tree)return this.finalPercentagesArray=[],this.finalPercentagesArray;const R=this.splitTreeService.calculateFinalPercentages(this.tree);return this.finalPercentagesArray=Array.from(R.entries()).map(([O,G])=>({address:O,percentage:G})),this.finalPercentagesArray}formatPercentage(R){return R.toFixed(2)+"%"}formatBasisPoints(R){return qt.formatBasisPoints(R)}finalizeBlueprint(){var R=this;return(0,ge.A)(function*(){if(!R.tree)return;const O=R.splitTreeService.validateTree(R.tree);if(!O.valid)return void R.showAlert("Validation Error",`Please fix errors before finalizing:\n${O.errors.join("\n")}`);const G=yield R.loadingController.create({message:"Finalizing blueprint and creating SplitXCH addresses...",duration:0});yield G.present();try{const q=yield R.splitTreeService.finalizeBlueprint(R.tree,function(){var ht=(0,ge.A)(function*(H){console.log("Creating split via SplitXCH API with recipients:",H);try{const vt=yield R.splitXCHApi.createSplitAsync(H);return console.log("Split created successfully:",vt),vt}catch(vt){throw console.error("Failed to create split via SplitXCH API:",vt),new Error(`Failed to create split: ${vt.message}`)}});return function(H){return ht.apply(this,arguments)}}());yield G.dismiss(),R.finalizationResult=q,q.success&&q.finalizedTree?(R.tree=q.finalizedTree,R.selectedNode=R.tree.root,R.showFinalizeModal=!0):R.showAlert("Finalization Errors",`Some errors occurred:\n${q.errors.join("\n")}`)}catch(q){yield G.dismiss(),R.showAlert("Error",`Finalization failed: ${q.message}`)}})()}hasPlaceholders(){return!!this.tree&&this.splitTreeService.hasPlaceholders(this.tree)}isFinalized(){return this.tree?.metadata?.isFinalized||!1}getAddressTypeDisplay(R){switch(R.addressType){case oe.FIXED_WALLET:return"Wallet";case oe.SPLITXCH_PLACEHOLDER:return"Split (Pending)";case oe.SPLITXCH_REAL:return"Split";default:return"Unknown"}}isPlaceholderAddress(R){return R.startsWith("splitxch_temp_")}handleNodeDeleted(R){if(this.tree){if(R.isRecipient){const O=G=>{if(G.recipients&&G.recipients.find(ht=>ht.id===R.nodeId))return this.splitTreeService.removeRecipient(this.tree,G.id,R.nodeId),this.selectedNode&&this.selectedNode.id===R.nodeId&&(this.selectedNode=null),!0;if(G.children)for(const q of G.children)if(O(q))return!0;return!1};O(this.tree.root)}else{if(this.tree.root.id===R.nodeId)return void this.showAlert("Error","Cannot delete the root split node");const O=G=>{if(G.children){if(-1!==G.children.findIndex(ht=>ht.id===R.nodeId))return this.splitTreeService.removeNestedSplit(this.tree,G.id,R.nodeId),this.selectedNode&&this.selectedNode.id===R.nodeId&&(this.selectedNode=null),!0;for(const ht of G.children)if(O(ht))return!0}return!1};O(this.tree.root)}this.tree={...this.tree},this.tree.metadata&&(this.tree.metadata.updatedAt=new Date),this.splitTreeService.setCurrentTree(this.tree)}}handleNodeRenamed(R){if(this.tree)if(this.splitTreeService.findNodeById(this.tree,R.nodeId))this.splitTreeService.updateSplitNode(this.tree,R.nodeId,{name:R.newName});else{const G=q=>{if(q.recipients&&q.recipients.find(H=>H.id===R.nodeId))return this.splitTreeService.updateRecipient(this.tree,q.id,R.nodeId,{name:R.newName}),!0;if(q.children)for(const ht of q.children)if(G(ht))return!0;return!1};G(this.tree.root)}}isSplitXCHNode(R){return!0===R.isSplitXCH}copyAddressToClipboard(R){navigator.clipboard.writeText(R).then(()=>{this.showAlert("Success","Address copied to clipboard!")}).catch(()=>{this.showAlert("Error","Failed to copy address")})}getFinalizationAddresses(){if(!this.finalizationResult||!this.tree)return[];const R=[];this.tree.root.splitAddress&&R.push({name:this.tree.root.name,address:this.tree.root.splitAddress});const O=G=>{G.children&&G.children.forEach(q=>{q.isSplitXCH&&q.splitAddress&&(R.push({name:q.name,address:q.splitAddress}),O(q))})};return O(this.tree.root),R}downloadFinalizedTree(){if(!this.tree)return;const R=this.splitTreeService.exportToJSON(this.tree),O=new Blob([R],{type:"application/json"}),G=URL.createObjectURL(O),q=document.createElement("a");q.href=G,q.download=`split-tree-finalized-${Date.now()}.json`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(G),this.showAlert("Success","Finalized tree downloaded!")}static#t=X=()=>(this.\u0275fac=function(O){return new(O||y)(k.rXU(ms),k.rXU(nn),k.rXU(ze.hG),k.rXU(ze.Xi))},this.\u0275cmp=k.VBU({type:y,selectors:[["app-split-builder"]],standalone:!1,decls:33,vars:22,consts:[[1,"split-builder-container",3,"fullscreen"],[1,"split-builder-wrapper"],[1,"header-section"],[1,"header-content"],[1,"page-title"],["src","assets/icon/favicon.png","alt","IFSTT Logo",1,"title-logo"],[1,"beta-badge"],[1,"main-content"],["class","status-banner",3,"success","error",4,"ngIf"],["class","diagram-section",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"footer-section"],[1,"footer-text"],[1,"heart"],["href","https://koba42.com","target","_blank","rel","noopener noreferrer",1,"footer-link"],[3,"willDismiss","isOpen","showBackdrop","backdropDismiss"],[1,"status-banner"],[1,"status-content"],[1,"status-icon",3,"name"],[1,"status-text"],[4,"ngIf"],["style","margin-top: 8px; font-size: 14px; opacity: 0.9;",4,"ngIf"],[2,"margin-top","8px","font-size","14px","opacity","0.9"],[1,"diagram-section"],[1,"diagram-container"],[3,"nodeSelected","nodeDoubleClicked","addRecipient","addNestedSplit","nodeDeleted","nodeRenamed","removeRecipient","removeNestedSplit","editRecipient","createNewTree","exportToJSON","exportToSplitXCH","finalizeBlueprint","tree","selectedNode","showFinalizeButton"],[1,"empty-state"],["name","git-network-outline",1,"empty-state-icon"],[1,"empty-state-text"],[1,"primary-button",2,"margin-top","24px","max-width","200px","margin-left","auto","margin-right","auto",3,"click"],["name","add-outline"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"form-group"],[1,"form-label"],[2,"display","flex","gap","12px","margin-top","8px"],[1,"modal-button",2,"flex","1",3,"click"],["name","wallet-outline",2,"margin-right","8px"],["name","git-branch-outline",2,"margin-right","8px"],["type","text","placeholder","Enter recipient name",1,"form-input",3,"ngModelChange","ngModel"],["class","form-group",4,"ngIf"],["type","number","min","0","max","100","step","0.01","placeholder","0.00",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-note"],[1,"modal-actions"],[1,"modal-button","secondary",3,"click"],[1,"modal-button","primary",3,"click"],["type","text","placeholder","xch1...",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-note",2,"background","#f0f4ff","padding","12px","border-radius","8px","color","#667eea"],["name","information-circle",2,"vertical-align","middle"],["type","text","placeholder","Enter tree name",1,"form-input",3,"ngModelChange","ngModel"],["type","text","placeholder","Enter split name",1,"form-input",3,"ngModelChange","ngModel"],["class","modal-content",4,"ngIf"],[1,"success-icon"],["name","checkmark-circle",2,"font-size","48px","color","#34c759"],[1,"modal-subtitle"],[1,"form-group",2,"background","#f0f4ff","padding","16px","border-radius","12px","margin-bottom","20px"],[1,"form-label",2,"font-weight","600","color","#667eea","margin-bottom","8px"],[1,"address-display"],[2,"font-size","14px","word-break","break-all","color","#1d1d1f"],["title","Copy",1,"copy-button",3,"click"],["name","copy-outline"],[1,"addresses-list"],["class","address-item",4,"ngFor","ngForOf"],["name","download-outline",2,"margin-right","8px"],[1,"address-item"],[1,"address-item-info"],[1,"address-item-name"],[1,"address-item-address"],[2,"background","#f5f5f7","padding","16px","border-radius","12px","font-size","12px","overflow-x","auto","font-family","'SF Mono', Monaco, 'Courier New', monospace"]],template:function(O,G){1&O&&(k.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),k.nrm(5,"img",5),k.EFF(6," IFSTT "),k.j41(7,"span",6),k.EFF(8,"BETA"),k.k0s()()()(),k.j41(9,"div",7),k.DNE(10,On,7,8,"div",8)(11,Rn,3,3,"div",9)(12,En,7,0,"div",10),k.k0s(),k.j41(13,"div",11)(14,"p",12),k.EFF(15," Made with "),k.j41(16,"span",13),k.EFF(17,"\u2665"),k.k0s(),k.EFF(18," by "),k.j41(19,"a",14),k.EFF(20,"koba42.com"),k.k0s()()()(),k.j41(21,"ion-modal",15),k.bIt("willDismiss",function(){return G.showAddRecipientModal=!1}),k.DNE(22,Vn,31,13,"ng-template"),k.k0s(),k.j41(23,"ion-modal",15),k.bIt("willDismiss",function(){return G.showNewTreeModal=!1}),k.DNE(24,jn,15,1,"ng-template"),k.k0s(),k.j41(25,"ion-modal",15),k.bIt("willDismiss",function(){return G.showAddNestedSplitModal=!1}),k.DNE(26,zn,19,2,"ng-template"),k.k0s(),k.j41(27,"ion-modal",15),k.bIt("willDismiss",function(){return G.showEditRecipientModal=!1}),k.DNE(28,Yn,1,1,"ng-template"),k.k0s(),k.j41(29,"ion-modal",15),k.bIt("willDismiss",function(){return G.showFinalizeModal=!1}),k.DNE(30,Un,1,1,"ng-template"),k.k0s(),k.j41(31,"ion-modal",15),k.bIt("willDismiss",function(){return G.showExportModal=!1}),k.DNE(32,qn,1,1,"ng-template"),k.k0s()()),2&O&&(k.Y8G("fullscreen",!0),k.R7$(10),k.Y8G("ngIf",G.validation),k.R7$(),k.Y8G("ngIf",G.tree),k.R7$(),k.Y8G("ngIf",!G.tree),k.R7$(9),k.Y8G("isOpen",G.showAddRecipientModal)("showBackdrop",!0)("backdropDismiss",!0),k.R7$(2),k.Y8G("isOpen",G.showNewTreeModal)("showBackdrop",!0)("backdropDismiss",!0),k.R7$(2),k.Y8G("isOpen",G.showAddNestedSplitModal)("showBackdrop",!0)("backdropDismiss",!0),k.R7$(2),k.Y8G("isOpen",G.showEditRecipientModal)("showBackdrop",!0)("backdropDismiss",!0),k.R7$(2),k.Y8G("isOpen",G.showFinalizeModal)("showBackdrop",!0)("backdropDismiss",!0),k.R7$(2),k.Y8G("isOpen",G.showExportModal)("showBackdrop",!0)("backdropDismiss",!0))},dependencies:[Je.Sq,Je.bT,Xe.me,Xe.Q0,Xe.BC,Xe.VZ,Xe.zX,Xe.vS,ze.W9,ze.iq,ze.Sb,An,Je.TG],styles:[".split-builder-container[_ngcontent-%COMP%]{--background: linear-gradient(180deg, #f5f7fa 0%, #ffffff 100%);background:linear-gradient(180deg,#f5f7fa,#fff)}.split-builder-wrapper[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(180deg,#f5f7fa,#fff);display:flex;flex-direction:column}.header-section[_ngcontent-%COMP%]{background:#fffc;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid rgba(0,0,0,.05);padding:24px 0;position:sticky;top:0;z-index:100}.header-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 24px;display:flex;justify-content:space-between;align-items:center}.page-title[_ngcontent-%COMP%]{font-size:32px;font-weight:600;letter-spacing:-.5px;color:#1d1d1f;margin:0;display:flex;align-items:center;gap:12px}.title-logo[_ngcontent-%COMP%]{width:32px;height:32px;object-fit:contain;display:block}.beta-badge[_ngcontent-%COMP%]{display:inline-block;margin-left:10px;padding:4px 10px;font-size:11px;font-weight:600;letter-spacing:.5px;text-transform:uppercase;background:linear-gradient(135deg,#ff9500,#ff6b00);color:#fff;border-radius:12px;box-shadow:0 2px 8px #ff95004d;vertical-align:middle;line-height:1}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.icon-button[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:12px;background:#fff;border:1px solid rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;color:#1d1d1f}.icon-button[_ngcontent-%COMP%]:hover{background:#f5f5f7;transform:translateY(-1px);box-shadow:0 4px 12px #00000014}.icon-button[_ngcontent-%COMP%]:active{transform:translateY(0)}.icon-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.main-content[_ngcontent-%COMP%]{max-width:100%;width:100%;margin:0 auto;padding:32px 24px;flex:1}.footer-section[_ngcontent-%COMP%]{padding:32px 24px;text-align:center;border-top:1px solid rgba(0,0,0,.05);background:#ffffff80;margin-top:auto;width:100%}.footer-text[_ngcontent-%COMP%]{font-size:14px;color:#6e6e73;margin:0;font-weight:400}.footer-text[_ngcontent-%COMP%]   .heart[_ngcontent-%COMP%]{color:#ff3b30;display:inline-block;margin:0 4px}.footer-link[_ngcontent-%COMP%]{color:#667eea;text-decoration:none;font-weight:500;transition:color .2s ease}.footer-link[_ngcontent-%COMP%]:hover{color:#764ba2;text-decoration:underline}.footer-link[_ngcontent-%COMP%]:visited{color:#667eea}.status-banner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);border-radius:16px;padding:20px 24px;margin-bottom:32px;color:#fff;display:flex;align-items:center;justify-content:space-between;box-shadow:0 8px 24px #667eea40}.status-banner.error[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f093fb,#f5576c);box-shadow:0 8px 24px #f5576c40}.status-banner.success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4facfe,#00f2fe);box-shadow:0 8px 24px #4facfe40}.status-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex:1}.status-icon[_ngcontent-%COMP%]{font-size:24px}.status-text[_ngcontent-%COMP%]{font-size:15px;font-weight:500;line-height:1.5}.diagram-section[_ngcontent-%COMP%]{background:#fff;border-radius:20px;padding:32px;margin-bottom:32px;box-shadow:0 2px 16px #0000000a;border:1px solid rgba(0,0,0,.05)}.diagram-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.section-title[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#1d1d1f;margin:0}.diagram-container[_ngcontent-%COMP%]{height:600px;border-radius:12px;overflow:hidden;background:#fafbfc;position:relative}.controls-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:32px}@media (max-width: 768px){.controls-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}.control-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:24px;box-shadow:0 2px 16px #0000000a;border:1px solid rgba(0,0,0,.05);transition:all .2s ease}.control-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 24px #00000014;transform:translateY(-2px)}.control-card-title[_ngcontent-%COMP%]{font-size:17px;font-weight:600;color:#1d1d1f;margin:0 0 16px}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.primary-button[_ngcontent-%COMP%]{width:100%;padding:16px 24px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 12px #667eea4d}.primary-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #667eea66}.primary-button[_ngcontent-%COMP%]:active{transform:translateY(0)}.primary-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.secondary-button[_ngcontent-%COMP%]{width:100%;padding:16px 24px;background:#f5f5f7;color:#1d1d1f;border:1px solid rgba(0,0,0,.1);border-radius:12px;font-size:15px;font-weight:500;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center;gap:8px}.secondary-button[_ngcontent-%COMP%]:hover{background:#e8e8ed}.recipient-list[_ngcontent-%COMP%]{margin-top:16px}.recipient-item[_ngcontent-%COMP%]{padding:16px;background:#fafbfc;border-radius:12px;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;transition:all .2s ease}.recipient-item[_ngcontent-%COMP%]:hover{background:#f5f5f7}.recipient-info[_ngcontent-%COMP%]{flex:1}.recipient-name[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:#1d1d1f;margin:0 0 4px}.recipient-address[_ngcontent-%COMP%]{font-size:13px;color:#86868b;font-family:SF Mono,Monaco,Courier New,monospace}.recipient-address.placeholder[_ngcontent-%COMP%]{color:#ff9500}.recipient-percentage[_ngcontent-%COMP%]{font-size:17px;font-weight:600;color:#667eea;margin-right:16px}.recipient-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.icon-button-small[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:8px;background:transparent;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;color:#86868b}.icon-button-small[_ngcontent-%COMP%]:hover{background:#0000000d;color:#1d1d1f}ion-modal[_ngcontent-%COMP%]{--background: #ffffff;--color: #1d1d1f}.modal-content[_ngcontent-%COMP%]{padding:0;background:#fff!important;border-radius:20px 20px 0 0;color:#1d1d1f!important}.modal-header[_ngcontent-%COMP%]{padding:24px 24px 0;border-bottom:1px solid rgba(0,0,0,.1);margin-bottom:24px;background:#fff;text-align:center}.modal-header[_ngcontent-%COMP%]   .success-icon[_ngcontent-%COMP%]{margin-bottom:16px}.modal-header[_ngcontent-%COMP%]   .modal-subtitle[_ngcontent-%COMP%]{color:#86868b;font-size:14px;margin-top:8px;margin-bottom:0}.modal-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#1d1d1f!important;margin:0 0 24px}.form-group[_ngcontent-%COMP%]{margin-bottom:24px;padding:0 24px}.address-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#fff;padding:12px;border-radius:8px;border:1px solid rgba(0,0,0,.1)}.address-display[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{flex:1}.copy-button[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;background:transparent;border:1px solid rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;color:#86868b}.copy-button[_ngcontent-%COMP%]:hover{background:#0000000d;color:#1d1d1f;border-color:#00000026}.copy-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.addresses-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;max-height:300px;overflow-y:auto}.address-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;background:#fafbfc;padding:12px 16px;border-radius:8px;border:1px solid rgba(0,0,0,.05)}.address-item-info[_ngcontent-%COMP%]{flex:1;min-width:0}.address-item-name[_ngcontent-%COMP%]{font-weight:600;color:#1d1d1f;margin-bottom:4px;font-size:14px}.address-item-address[_ngcontent-%COMP%]{font-size:12px;color:#86868b;font-family:SF Mono,Monaco,Courier New,monospace;word-break:break-all}.form-label[_ngcontent-%COMP%]{display:block;font-size:13px;font-weight:600;color:#86868b;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}.form-input[_ngcontent-%COMP%]{width:100%;padding:14px 16px;font-size:16px;border:1px solid rgba(0,0,0,.1);border-radius:12px;background:#fff!important;color:#1d1d1f!important;transition:all .2s ease;font-family:inherit;-webkit-text-fill-color:#1d1d1f!important}.form-input[_ngcontent-%COMP%]::placeholder{color:#86868b!important;opacity:1}.form-input[_ngcontent-%COMP%]:-webkit-autofill, .form-input[_ngcontent-%COMP%]:-webkit-autofill:hover, .form-input[_ngcontent-%COMP%]:-webkit-autofill:focus{-webkit-text-fill-color:#1d1d1f!important;box-shadow:0 0 0 1000px #fff inset!important}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea;background:#fff!important;color:#1d1d1f!important;box-shadow:0 0 0 4px #667eea1a}.form-note[_ngcontent-%COMP%]{font-size:13px;color:#86868b;margin-top:8px;padding:0 24px}.modal-actions[_ngcontent-%COMP%]{padding:24px;display:flex;gap:12px;border-top:1px solid rgba(0,0,0,.1);margin-top:24px}.modal-button[_ngcontent-%COMP%]{flex:1;padding:14px 24px;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s ease;border:none}.modal-button.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;box-shadow:0 4px 12px #667eea4d}.modal-button.primary[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 6px 20px #667eea66}.modal-button.secondary[_ngcontent-%COMP%]{background:#f5f5f7;color:#1d1d1f}.modal-button.secondary[_ngcontent-%COMP%]:hover{background:#e8e8ed}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:64px 24px;color:#86868b}.empty-state-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:16px;opacity:.5}.empty-state-text[_ngcontent-%COMP%]{font-size:17px;font-weight:500}*[_ngcontent-%COMP%]{transition:background-color .2s ease,color .2s ease,border-color .2s ease}ion-fab[_ngcontent-%COMP%]{z-index:1000}ion-fab[_ngcontent-%COMP%]   ion-fab-button[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);--color: white;--box-shadow: 0 4px 16px rgba(102, 126, 234, .4);width:56px;height:56px}ion-fab[_ngcontent-%COMP%]   ion-fab-button[_ngcontent-%COMP%]:hover{--box-shadow: 0 6px 20px rgba(102, 126, 234, .5);transform:translateY(-2px)}ion-fab[_ngcontent-%COMP%]   ion-fab-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:28px}"]}))}return X(),y})()}];let $n=(()=>{var X;class y{static#t=X=()=>(this.\u0275fac=function(O){return new(O||y)},this.\u0275mod=k.$C({type:y}),this.\u0275inj=ct.G2t({imports:[ps.iI.forChild(Wn),ps.iI]}))}return X(),y})(),Jn=(()=>{var X;class y{static#t=X=()=>(this.\u0275fac=function(O){return new(O||y)},this.\u0275mod=k.$C({type:y}),this.\u0275inj=ct.G2t({imports:[Je.MD,Xe.YN,ze.bv,$n]}))}return X(),y})()}}]);